<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      sdorsett.github.io &middot; Things I find interesting
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/posts/">All Posts</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/sdorsett/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/sdorsett">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2018. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">sdorsett.github.io</a>
            <small>Things I find interesting</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/19/using-vagrant-to-deploy-to-ovh-public-cloud/">
        Using Vagrant to deploy an OVH public cloud server.
      </a>
    </h1>

    <span class="post-date">19 Aug 2018</span>

    <p>This is the fourth in a series of posts that will walk you through using the Openstack-based OVH public cloud. In this post you will get introduced to using Vagrant to create Openstack servers using the Openstack API.
This post is assumes you have already signed up for an account with ovhcloud.com, added a payment method, created a cloud project, created an Openstack user, created a ssh keypair in the Horizon UI and downloaded the openrc.sh file for this user. If you have not done these steps you can follow the steps in <a href="http://sdorsett.github.io/2018/08/08/creating-an-openstack-instance-on-ovh-public-cloud/">the first</a> and <a href="http://sdorsett.github.io/2018/08/10/using-the-openstack-cli-to-create-a-server-on-ovh-public-cloud/">second blog post</a> in this series that will walk you through completing those steps. </p>

<p>I will attempt in this post to present the options that are available to OVH public cloud customers along side the choices I made that were specific to my Openstack server.
Let&#39;s get started...</p>

<h2>1. Install Vagrant</h2>

<p>The first thing you will need to do before you can move forward with this post is install Vagrant. Go to https://www.vagrantup.com/downloads.html, download the installer for your specific operating system and install Vagrant.</p>

<h2>2. Install the Vagrant Openstack provider</h2>

<p>You will next need to install the Vagrant Openstack provider.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ vagrant plugin install vagrant-openstack-provider
Installing the &#39;vagrant-openstack-provider&#39; plugin. This can take a few minutes...
Fetching: terminal-table-1.4.5.gem (100%)
Fetching: sshkey-1.6.1.gem (100%)
Fetching: colorize-0.7.3.gem (100%)
Fetching: public_suffix-2.0.5.gem (100%)
Fetching: vagrant-openstack-provider-0.13.0.gem (100%)
Installed the plugin &#39;vagrant-openstack-provider (0.13.0)&#39;!
MacBook-Pro:~ standorsett$</code></pre></figure>
 

<h2>3. Create a new directory and add your Vagrantfile</h2>

<p>When using the <code>vagrant</code> command, it will look for a Vagrantfile in the current directory. As a result you should create a new directory for containing the Vagrantfile we will use for our Openstack server. </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ mkdir -p ~/Documents/vagrant/ovh_public_cloud_centos_7
MacBook-Pro:~ standorsett$ cd ~/Documents/vagrant/ovh_public_cloud_centos_7
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<p>Next you will need to create a Vagrantfile in our new directory that will describe the server you are wanting to have created.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ cat Vagrantfile
require &#39;vagrant-openstack-provider&#39;

Vagrant.configure(&#39;2&#39;) do |config|

  config.vm.define :&#39;vagrant-centos7&#39; do |v|

    v.ssh.username = &#39;centos&#39;
    v.ssh.private_key_path = &#39;~/.ssh/id_rsa-ovhus_public_cloud&#39;
    v.ssh.insert_key = &#39;false&#39;
    v.vm.synced_folder &#39;.&#39;, &#39;/vagrant&#39;, type: &#39;rsync&#39;
    v.vm.provider :openstack do |provider|
      provider.openstack_auth_url    = ENV[&#39;OS_AUTH_URL&#39;]
      provider.openstack_network_url = &#39;https://network.us-east-va-1.cloud.ovh.us/v2.0&#39;
      provider.identity_api_version  = ENV[&#39;OS_IDENTITY_API_VERSION&#39;]
      provider.username              = ENV[&#39;OS_USERNAME&#39;]
      provider.password              = ENV[&#39;OS_PASSWORD&#39;]
      provider.domain_name           = ENV[&#39;OS_USER_DOMAIN_NAME&#39;]
      provider.project_name          = ENV[&#39;OS_TENANT_NAME&#39;]
      provider.flavor                = &#39;&#39;
      provider.image                 = &#39;&#39;
      provider.keypair_name          = &#39;vagrant-keypair&#39;
      provider.region                = ENV[&#39;OS_REGION_NAME&#39;]
      provider.networks              = [ &#39;Ext-Net&#39; ]
    end
  end
end
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<p>The <code>v.ssh.private_key_path</code> should reference the ssh private key file that was created in our second blog post. The <code>provider.keypair_name</code> should be set to match the name of the keypair you created in the Openstack Horizon UI in the second blog post. The <code>provider.image</code> and <code>provider.flavor</code> values are initially blank, but you will update those shortly.</p>

<p>You also might notice that most of the details in this Vagrantfile are referencing <code>ENV</code> which means they will be pulled from environment variables.</p>

<h2>4. Source your openrc.sh file</h2>

<p>Source the openrc.sh you previously downloaded for your Openstack user. Enter the password for your Openstack user when prompted. This step will export the environemntal variables that the Vagrantfile needs in order to create the Openstack server.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ source ~/Downloads/openrc.sh
Please enter your OpenStack Password:
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<h2>5. Test connecting to the OVH public cloud.</h2>

<p>You can now test connecting to the OVH public cloud API by running <code>vagrant status</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant status
Current machine states:

vagrant-centos7           not created (openstack)

The server is not created. Run `vagrant up` to create it.
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<p>If you received a message that the server was not created, then your credentials and Openstack details are valid. </p>

<h2>6. Using the Vagrant Openstack provider to query for available flavor and images.</h2>

<p>The Vagrant Openstack provider can be used us query the Openstack API for available resources. I knew I wanted to use a Centos image so I ran <code>vagrant openstack image-list | egrep &#39;(--|Name|Centos)&#39;</code> to return images that contained the name Centos:</p>

<p><img src="/assets/08192018-01-vagrant-openstack-image-list.png" alt="screenshot"></p>

<p>I also knew I wanted to use a sandbox image, which all start with s1 in the name, so I ran <code>vagrant openstack flavor-list | egrep &#39;(--|Name|s1)&#39;</code> to return all s1 images:</p>

<p><img src="/assets/08192018-02-vagrant-openstack-flavor-list.png" alt="screenshot"> </p>

<h2>6. Update your Vagrantfile to reflect the image and flavor name that you want to use.</h2>

<p>After using the Vagrant Openstack provider to return the available image and flavor names, update your Vagrantfile to reference the image and flavor you want to use. I chose “Centos 7” and “s1-2” for mine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ cat Vagrantfile
require &#39;vagrant-openstack-provider&#39;
 
Vagrant.configure(&#39;2&#39;) do |config|
 
  config.vm.define :&#39;vagrant-centos7&#39; do |v|
 
    v.ssh.username = &#39;centos&#39;
    v.ssh.private_key_path = &#39;~/.ssh/id_rsa-ovhus_public_cloud&#39;
    v.ssh.insert_key = &#39;false&#39;
    v.vm.synced_folder &#39;.&#39;, &#39;/vagrant&#39;, type: &#39;rsync&#39;
    v.vm.provider :openstack do |provider|
      provider.openstack_auth_url    = ENV[&#39;OS_AUTH_URL&#39;]
      provider.openstack_network_url = &#39;https://network.us-east-va-1.cloud.ovh.us/v2.0&#39;
      provider.identity_api_version  = ENV[&#39;OS_IDENTITY_API_VERSION&#39;]
      provider.username              = ENV[&#39;OS_USERNAME&#39;]
      provider.password              = ENV[&#39;OS_PASSWORD&#39;]
      provider.domain_name           = ENV[&#39;OS_USER_DOMAIN_NAME&#39;]
      provider.project_name          = ENV[&#39;OS_TENANT_NAME&#39;]
      provider.flavor                = &#39;s1-2&#39;
      provider.image                 = &#39;Centos 7&#39;
      provider.keypair_name          = &#39;vagrant-keypair&#39;
      provider.region                = ENV[&#39;OS_REGION_NAME&#39;]
      provider.networks              = [ &#39;Ext-Net&#39; ]
    end
  end
end
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<h2>7. Run <code>vagrant up</code> to create the Openstack server</h2>

<p>The next step is for you to run <code>vagrant up</code> to create the Openstack server as defined in your Vagrantfile. </p>

<p>I want to give one warning that this command will not succeed successfully with vagrant-openstack-provider version 0.13.0, but we will address these issues in a moment. I pressed <code>control-c</code> after receiving a few of the Host unreachable messages to break out of Vagrant.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant up
Bringing machine &#39;vagrant-centos7&#39; up with &#39;openstack&#39; provider...
==&gt; vagrant-centos7: Finding flavor for server...
==&gt; vagrant-centos7: Finding image for server...
==&gt; vagrant-centos7: Finding network(s) for server...
==&gt; vagrant-centos7: Launching a server with the following settings...
==&gt; vagrant-centos7:  -- Tenant          :
==&gt; vagrant-centos7:  -- Name            : vagrant-centos7
==&gt; vagrant-centos7:  -- Flavor          : s1-2
==&gt; vagrant-centos7:  -- FlavorRef       : a64381e7-c4e7-4b01-9fbe-da405c544d2e
==&gt; vagrant-centos7:  -- Image           : Centos 7
==&gt; vagrant-centos7:  -- ImageRef        : e0a89ff2-e98f-4a34-afae-68f9f6c9b5ad
==&gt; vagrant-centos7:  -- KeyPair         : vagrant-keypair
==&gt; vagrant-centos7:  -- Network         : b347ed75-8603-4ce0-a40c-c6c98a8820fc
==&gt; vagrant-centos7: Waiting for the server to be built...
==&gt; vagrant-centos7: Waiting for machine to boot. This may take a few minutes...
    vagrant-centos7: SSH address: 2604:2dc0:101:100::1b:22
    vagrant-centos7: SSH username: centos
    vagrant-centos7: SSH auth method: private key
    vagrant-centos7: Warning: Host unreachable. Retrying...
    vagrant-centos7: Warning: Host unreachable. Retrying...
    vagrant-centos7: Warning: Host unreachable. Retrying...
^C
==&gt; vagrant-centos7: Waiting for cleanup before exiting...
An unknown error happened in Vagrant OpenStack provider

To easily debug what happened, we recommend to set the environment
variable VAGRANT_OPENSTACK_LOG to debug

    $ export VAGRANT_OPENSTACK_LOG=debug

If doing this does not help fixing your issue, there may be a bug
in the provider. Please submit an issue on Github at
https://github.com/ggiamarchi/vagrant-openstack-provider
with the stracktrace and the logs.

We are looking for feedback, so feel free to ask questions or
describe features you would like to see in this provider.
An unknown error happened in Vagrant OpenStack provider

To easily debug what happened, we recommend to set the environment
variable VAGRANT_OPENSTACK_LOG to debug

    $ export VAGRANT_OPENSTACK_LOG=debug

If doing this does not help fixing your issue, there may be a bug
in the provider. Please submit an issue on Github at
https://github.com/ggiamarchi/vagrant-openstack-provider
with the stracktrace and the logs.

We are looking for feedback, so feel free to ask questions or
describe features you would like to see in this provider.
Catched Error: Catched Error: Catched Error: Vagrant exited after cleanup due to external interrupt.
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<p>If you look back at the output of your command you will see a line displaying a message like <code>SSH address: 2604:2dc0:101:100::1b:22</code>
You will also see that the same IPV6 address is returned for the HostName when you run <code>vagrant ssh-config</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant ssh-config
Host vagrant-centos7
  HostName 2604:2dc0:101:100::1b
  User centos
  Port 22
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud
  IdentitiesOnly yes
  LogLevel ERROR

MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<h2>8. Updating the Vagrant Openstack provider to return an IPV4 address</h2>

<p>There is an <a href="https://github.com/ggiamarchi/vagrant-openstack-provider/pull/359">open pull request</a> for the Vagrant openstack provider to allow a user to specify if the provider should connect to an IPV4 or IPV6 address. Until that pull request is merge I would suggest making <a href="https://github.com/sghribi/vagrant-openstack-provider/commit/040c7168066bad36a9c9995418f3189d5a85a125">these suggested changes</a> to <code>~/.vagrant.d/gems/2.4.4/gems/vagrant-openstack-provider-0.13.0/lib/vagrant-openstack-provider/utils.rb</code></p>

<p><img src="/assets/08192018-04-edit-util-rb-file.png" alt="screenshot"></p>

<p>After modifying the utils.rb file try running <code>vagrant ssh-config</code> again to make sure the command is returning an IPV4 address.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant ssh-config
Host vagrant-centos7
  HostName 147.135.76.34
  User centos
  Port 22
  UserKnownHostsFile /dev/null
  StrictHostKeyChecking no
  PasswordAuthentication no
  IdentityFile /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud
  IdentitiesOnly yes
  LogLevel ERROR
 
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<h2>8. Use Vagrant to destroy and re-deploy the Openstack server</h2>

<p>Now that Vagrant is returning an IPV4 address it should deploy correctly. Destroy your Openstack server by running <code>vagrant destroy -f</code> </p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant destroy
==&gt; vagrant-centos7: Deleting server...
==&gt; vagrant-centos7: Waiting for the server to be deleted...
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>
 

<p>...followed by <code>vagrant up</code> to deploy it again</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant up
Bringing machine &#39;vagrant-centos7&#39; up with &#39;openstack&#39; provider...
==&gt; vagrant-centos7: Finding flavor for server...
==&gt; vagrant-centos7: Finding image for server...
==&gt; vagrant-centos7: Finding network(s) for server...
==&gt; vagrant-centos7: Launching a server with the following settings...
==&gt; vagrant-centos7:  -- Tenant          :
==&gt; vagrant-centos7:  -- Name            : vagrant-centos7
==&gt; vagrant-centos7:  -- Flavor          : s1-2
==&gt; vagrant-centos7:  -- FlavorRef       : a64381e7-c4e7-4b01-9fbe-da405c544d2e
==&gt; vagrant-centos7:  -- Image           : Centos 7
==&gt; vagrant-centos7:  -- ImageRef        : e0a89ff2-e98f-4a34-afae-68f9f6c9b5ad
==&gt; vagrant-centos7:  -- KeyPair         : vagrant-keypair
==&gt; vagrant-centos7:  -- Network         : b347ed75-8603-4ce0-a40c-c6c98a8820fc
==&gt; vagrant-centos7: Waiting for the server to be built...
==&gt; vagrant-centos7: Waiting for machine to boot. This may take a few minutes...
    vagrant-centos7: SSH address: 147.135.76.17:22
    vagrant-centos7: SSH username: centos
    vagrant-centos7: SSH auth method: private key
    vagrant-centos7: Warning: Connection refused. Retrying...
    vagrant-centos7: Warning: Connection refused. Retrying...
==&gt; vagrant-centos7: Machine booted and ready!
==&gt; vagrant-centos7: Installing rsync to the VM...
==&gt; vagrant-centos7: Rsyncing folder: /Users/standorsett/Documents/vagrant/ovh_public_cloud_centos_7/ =&gt; /vagrant
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>

<p>You can see in my output that Vagrant successfully connected to the assigned IPV4 address, installed rsync and used it to copy over the folder that contained the Vagrantfile to /vagrant.</p>

<h2>9. Connect to your Openstack server</h2>

<p>Connecting to your Openstack server created by Vagrant is as easy as running <code>vagrant ssh</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant ssh
[centos@vagrant-centos7 ~]$ cd /vagrant/
[centos@vagrant-centos7 vagrant]$ ls -la
total 12
drwxr-xr-x   2 centos centos 4096 Aug 19 23:31 .
dr-xr-xr-x. 19 root   root   4096 Aug 19 23:59 ..
-rw-r--r--   1 centos centos 1063 Aug 19 23:31 Vagrantfile
[centos@vagrant-centos7 vagrant]$ cat Vagrantfile
require &#39;vagrant-openstack-provider&#39;
 
Vagrant.configure(&#39;2&#39;) do |config|
 
  config.vm.define :&#39;vagrant-centos7&#39; do |v|
 
    v.ssh.username = &#39;centos&#39;
    v.ssh.private_key_path = &#39;~/.ssh/id_rsa-ovhus_public_cloud&#39;
    v.ssh.insert_key = &#39;false&#39;
    v.vm.synced_folder &#39;.&#39;, &#39;/vagrant&#39;, type: &#39;rsync&#39;
    v.vm.provider :openstack do |provider|
      provider.openstack_auth_url    = ENV[&#39;OS_AUTH_URL&#39;]
      provider.openstack_network_url = &#39;https://network.us-east-va-1.cloud.ovh.us/v2.0&#39;
      provider.identity_api_version  = ENV[&#39;OS_IDENTITY_API_VERSION&#39;]
      provider.username              = ENV[&#39;OS_USERNAME&#39;]
      provider.password              = ENV[&#39;OS_PASSWORD&#39;]
      provider.domain_name           = ENV[&#39;OS_USER_DOMAIN_NAME&#39;]
      provider.project_name          = ENV[&#39;OS_TENANT_NAME&#39;]
      provider.flavor                = &#39;s1-2&#39;
      provider.image                 = &#39;Centos 7&#39;
      provider.keypair_name          = &#39;vagrant-keypair&#39;
      provider.region                = ENV[&#39;OS_REGION_NAME&#39;]
      provider.networks              = [ &#39;Ext-Net&#39; ]
    end
  end
end
[centos@vagrant-centos7 vagrant]$ ip a show dev eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether fa:16:3e:79:76:78 brd ff:ff:ff:ff:ff:ff
    inet 147.135.76.17/32 brd 147.135.76.17 scope global dynamic eth0
       valid_lft 85791sec preferred_lft 85791sec
    inet6 fe80::f816:3eff:fe79:7678/64 scope link
       valid_lft forever preferred_lft forever
[centos@vagrant-centos7 vagrant]$</code></pre></figure>

<h2>10. Destroy your Vagrant Openstack server.</h2>

<p>After you are finished testing your Openstack server, you should destroy it in order to prevent being charged for it’s usage. This can be done using the same <code>vagrant destroy</code> command we did earlier.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:ovh_public_cloud_centos_7 standorsett$ vagrant destroy
==&gt; vagrant-centos7: Deleting server...
==&gt; vagrant-centos7: Waiting for the server to be deleted...
MacBook-Pro:ovh_public_cloud_centos_7 standorsett$</code></pre></figure>
 

<p>That all for this post covering how to use Vagrant to quickly deploy a OVH public cloud server. In this post you have only scratched the surface of what you can do with Vagrant, but hopefully if showed how simple it is to get started.
Please provide any feedback or suggestions to my twitter account located on the about page.</p>

<hr>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/14/using-rclone-to-connect-to-ovh-public-cloud-swift-storage/">
        Using rclone to manage OVH Public Cloud swift storage
      </a>
    </h1>

    <span class="post-date">14 Aug 2018</span>

    <p>This is the third in a series of posts that will walk you through using the Openstack-based OVH public cloud. In this post you will get introduced to using rclone to upload and retrieve files from the Openstack swift API. </p>

<p>This post is assumes you have already signed up for an account with ovhcloud.com, added a payment method, created a cloud project and created an Openstack user. If you have not done these steps you can follow the steps in <a href="http://sdorsett.github.io/2018/08/08/creating-an-openstack-instance-on-ovh-public-cloud/">the first</a> and <a href="http://sdorsett.github.io/2018/08/10/using-the-openstack-cli-to-create-a-server-on-ovh-public-cloud/">second blog post</a> in this series that will walk you through completing those steps.</p>

<p>I will attempt in this post to present the options that are available to OVH public cloud customers along side the choices I made that were specific to my Openstack server.</p>

<p>Let&#39;s get started...</p>

<hr>

<h2>1. Sign into <a href="https://ovhcloud.com/auth/">ovhcloud.com</a>.</h2>

<p>The first thing you will need to do before you can move forward with this post is sign into <a href="https://ovhcloud.com/auth/">https://ovhcloud.com/auth/</a> using the account you created in the first blog post..</p>

<p><img src="/assets/08102018-01-login-username-password.png" alt="screenshot"></p>

<p>If you setup two-factor authentication, you will be prompted to enter the current two-factor token.</p>

<p><img src="/assets/08102018-02-login-two-factor.png" alt="screenshot"></p>

<h2>2. Create a object container.</h2>

<p>The first step to store files in your OVH Public Cloud will be to create a swift object container to store the files. Object containers are managed by clicking the <code>storage</code> tab of the cloud project you want to store files in.</p>

<p><img src="/assets/08142018-01-openstack-storage-empty.png" alt="screenshot"></p>

<p>If you do not have any object containers create, you can create one by clicking the <code>Create a container</code> button.</p>

<p><img src="/assets/08142018-02-openstack-create-object-container.png" alt="screenshot"></p>

<p>Select the datacenter you want to create the object container in.</p>

<p><img src="/assets/08142018-03-openstack-create-object-container.png" alt="screenshot"></p>

<p>Select what purpose for which you are intending to use the object container storage. I am intending to test file that need to be publicly available, without any sort of authentication, so I chose <code>Public</code>. </p>

<p>Name the object container a name that reflects it&#39;s purpose and click <code>Create the container</code></p>

<p><img src="/assets/08142018-04-openstack-create-object-container.png" alt="screenshot"></p>

<p>You will next be taken to a view that lists the details of the newly created object container.</p>

<p><img src="/assets/08142018-05-openstack-create-object-container.png" alt="screenshot"></p>

<h2>3. Install rclone</h2>

<p>Rclone is self described as &#39;a command line program to sync files and directories to and from cloud storage.&#39; It is opensource and is compatible with Openstack swift, so it will work with OVH Public Cloud object containers.</p>

<p>The first thing you need to do is download the latest version for your operating system from the <a href="https://rclone.org/downloads/">rclone download page</a>, unzip the binary and place it within our path.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ cd ~/Downloads/
MacBook-Pro:Downloads standorsett$ wget https://downloads.rclone.org/v1.42/rclone-v1.42-osx-amd64.zip
--2018-08-14 13:50:18--  https://downloads.rclone.org/v1.42/rclone-v1.42-osx-amd64.zip
Resolving downloads.rclone.org (downloads.rclone.org)... 5.153.250.7
Connecting to downloads.rclone.org (downloads.rclone.org)|5.153.250.7|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 9748516 (9.3M) [application/zip]
Saving to: ‘rclone-v1.42-osx-amd64.zip’

rclone-v1.42-osx-amd64.zip                    100%[==============================================================================================&gt;]   9.30M   574KB/s    in 37s

2018-08-14 13:50:56 (255 KB/s) - ‘rclone-v1.42-osx-amd64.zip’ saved [9748516/9748516]

MacBook-Pro:Downloads standorsett$</code></pre></figure>

<p>...unzip the binary,</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:Downloads standorsett$ unzip rclone-v1.42-osx-amd64.zip
Archive:  rclone-v1.42-osx-amd64.zip
   creating: rclone-v1.42-osx-amd64/
  inflating: rclone-v1.42-osx-amd64/README.html
  inflating: rclone-v1.42-osx-amd64/rclone
  inflating: rclone-v1.42-osx-amd64/rclone.1
  inflating: rclone-v1.42-osx-amd64/README.txt
MacBook-Pro:Downloads standorsett$</code></pre></figure>

<p>...and place it within a folder that is exported in your path.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:Downloads standorsett$ sudo cp rclone-v1.42-osx-amd64/rclone /usr/local/bin/
MacBook-Pro:Downloads standorsett$ which rclone
/usr/local/bin/rclone
MacBook-Pro:Downloads standorsett$ rclone --version
rclone v1.42
- os/arch: darwin/amd64
- go version: go1.10.1
MacBook-Pro:Downloads standorsett$
MacBook-Pro:Downloads standorsett$ cd ~/
MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>4. Source the openrc.sh file you downloaded in the <a href="http://sdorsett.github.io/2018/08/10/using-the-openstack-cli-to-create-a-server-on-ovh-public-cloud/">previous blog post</a>.</h2>

<p>The simplest way to use rclone is to source the openrc.sh file you downloaded in the previous blog post. This will set environment variables that the rclone cli will use to connect to the OVH public cloud. When you source the openrc.sh file you will be prompted for the password of the Openstack user listed in this file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ source ~/Downloads/openrc.sh
Please enter your OpenStack Password:
MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>5. Export two RCLONE_CONFIG environment variables</h2>

<p>As mentioned on the <a href="https://rclone.org/swift/#using-an-alternate-authentication-method">rclone swift documentation</a> you can use rclone with swift without a config file by exporting two environment variables.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ export RCLONE_CONFIG_MYREMOTE_TYPE=swift
MacBook-Pro:~ standorsett$ export RCLONE_CONFIG_MYREMOTE_ENV_AUTH=true
MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>6. Using rclone to list remote object containers.</h2>

<p>You can now list all remove object containers by running the command <code>rclone lsd myremote:</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ export RCLONE_CONFIG_MYREMOTE_TYPE=swift
MacBook-Pro:~ standorsett$ export RCLONE_CONFIG_MYREMOTE_ENV_AUTH=true
MacBook-Pro:~ standorsett$ rclone lsd myremote:
2018/08/14 13:23:16 NOTICE: Config file &quot;/Users/standorsett/.config/rclone/rclone.conf&quot; not found - using defaults
           0 2018-08-14 13:23:18         0 public_storage_container
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>If you get tired of seeing the &#39;rclone.conf not found&#39; informational message, you can get rid of it by creating an empty config file with the same name mentioned.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ touch /Users/standorsett/.config/rclone/rclone.conf
MacBook-Pro:~ standorsett$ rclone lsd myremote:
           0 2018-08-14 13:23:40         0 public_storage_container
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>You can see the command I ran returned the <code>public_storage_container</code> object container I created in step 2.</p>

<h2>6. Using rclone to upload files to the object container.</h2>

<p>Now that you have confirmed rclone is seeing to the OVH Public Cloud object container you created in step 2, you can upload a file to it. I decided to test with the rclone zip file for OSX that I downlaoded in step 3.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ rclone copy ~/Downloads/rclone-v1.42-osx-amd64.zip myremote:public_storage_container
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>You can now run <code>rclone ls myremote:[object_container_name]</code> to list the contents of your object container. Here is the output of when I ran that command. I also decided to output the size of the file on the local disk to compare the two. Both the local and remote files contain the same number of bytes.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ rclone ls myremote:public_storage_container
  9748516 rclone-v1.42-osx-amd64.zip
MacBook-Pro:~ standorsett$ ls -la ~/Downloads/rclone-v1.42-osx-amd64.zip
-rw-r--r--@ 1 standorsett  staff  9748516 Jun 16 12:22 /Users/standorsett/Downloads/rclone-v1.42-osx-amd64.zip
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>The file sizes of the local and remote files matched, but I also wanted to be safe and compare the local MD5 hashsum</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ md5 ~/Downloads/rclone-v1.42-osx-amd64.zip
MD5 (/Users/standorsett/Downloads/rclone-v1.42-osx-amd64.zip) = 6fc9f13129bd890164be65bc11f6c870
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>...to the remote hashsum</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ rclone hashsum MD5 myremote:public_storage_container/rclone-v1.42-osx-amd64.zip
6fc9f13129bd890164be65bc11f6c870  rclone-v1.42-osx-amd64.zip
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>...and verified that the two hashsums matched.</p>

<h2>7. Downloading the file from the public object container.</h2>

<p>If you created a public object container, all the files contained within the object container can be downloaded without providing any authentication. You should alway consider the purpose of the files being uploaded to the object container when deciding if it should be private or public.</p>

<p>You can test that the files can be access without any authentication. First confirm the file is visible in the ovhcloud.com UI.</p>

<p><img src="/assets/08142018-06-confirming-file-uploaded-in-ui.png" alt="screenshot"></p>

<p>You can then paste the <code>Container URL</code> displayed in the object container in a browser and see all the objects contained in it.</p>

<p><img src="/assets/08142018-07-confirming-file-uploaded-in-browser.png" alt="screenshot"></p>

<p>The final test you can do is to add the file name you uploaded to the container URL and test downloading the file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ wget https://storage.us-east-va-1.cloud.ovh.us/v1/AUTH_2897923a654b40d0b8b36a502bda4a8f/public_storage_container/rclone-v1.42-osx-amd64.zip
--2018-08-14 22:21:38--  https://storage.us-east-va-1.cloud.ovh.us/v1/AUTH_2897923a654b40d0b8b36a502bda4a8f/public_storage_container/rclone-v1.42-osx-amd64.zip
Resolving storage.us-east-va-1.cloud.ovh.us (storage.us-east-va-1.cloud.ovh.us)... 147.135.3.101
Connecting to storage.us-east-va-1.cloud.ovh.us (storage.us-east-va-1.cloud.ovh.us)|147.135.3.101|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 9748516 (9.3M) [application/zip]
Saving to: ‘rclone-v1.42-osx-amd64.zip’

rclone-v1.42-osx-amd64.zip                    100%[==============================================================================================&gt;]   9.30M  2.45MB/s    in 4.3s

2018-08-14 22:21:42 (2.16 MB/s) - ‘rclone-v1.42-osx-amd64.zip’ saved [9748516/9748516]

MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>8. Delete the uploaded file with rclone.</h2>

<p>Once you are finished with your test files, you should delete them to prevent being charged for their usage. You can delete the files by running the rclone command of <code>rclone deletefile remote:path</code>. Here is the output of when I ran this command and then listed out the files in my object container to verify it had been deleted..</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ rclone deletefile myremote:public_storage_container/rclone-v1.42-osx-amd64.zip
MacBook-Pro:~ standorsett$ rclone ls myremote:public_storage_container
MacBook-Pro:~ standorsett$</code></pre></figure>

<hr>

<h3>That all for this post covering how to use the rclone utility to manage your OVH public cloud swift storage.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/10/using-the-openstack-cli-to-create-a-server-on-ovh-public-cloud/">
        Using the Openstack cli to create a server on OVH public cloud
      </a>
    </h1>

    <span class="post-date">10 Aug 2018</span>

    <p>This is the second in a series of posts that will walk you through using the Openstack-based OVH public cloud. In this post you will get introduced to using the Openstack cli to create an Openstack server.</p>

<p>This post is assumes you have already signed up for an account with ovhcloud.com, added a payment method and created a cloud project. If you have not done these steps you can follow <a href="http://sdorsett.github.io/2018/08/08/creating-an-openstack-instance-on-ovh-public-cloud/">the first blog post</a> in this series that will walk you through completing those steps. </p>

<p>I will attempt in this post to present the options that are available to OVH public cloud customers along side the choices I made that were specific to my Openstack server.</p>

<p>Let&#39;s get started...</p>

<hr>

<h2>1. Sign into <a href="https://ovhcloud.com/auth/">ovhcloud.com</a>.</h2>

<p>The first thing you will need to do before you can move forward with this post is sign into <a href="https://ovhcloud.com/auth/">https://ovhcloud.com/auth/</a> using the account you created in the first blog post..</p>

<p><img src="/assets/08102018-01-login-username-password.png" alt="screenshot"></p>

<p>If you setup two-factor authentication, you will be prompted to enter the current two-factor token.</p>

<p><img src="/assets/08102018-02-login-two-factor.png" alt="screenshot"></p>

<h2>2. Create a new user account to use with the Openstack API.</h2>

<p>The Openstack API will not use the credentials you used to log into the ovhcloud.com site, but will instead use an Openstack user to create, modify or view objects in an OVH cloud project.</p>

<p>If have not created one already, you will need to create an Openstack user account within the cloud project you want to work with. You can display all the Openstack user accounts that have been created in a cloud project by clicking the &#39;Openstack&#39; tab within any cloud project. </p>

<p><img src="/assets/08102018-03-openstack-users.png" alt="screenshot"></p>

<p>Create a new user by clicking the &quot;Add user&quot; button.</p>

<p><img src="/assets/08102018-04-openstack-add-user.png" alt="screenshot"></p>

<p>Once you have specified the username and clicked &quot;Confirm&quot; you will be taken back to the Openstack tab. You will see the user you created and will also be able to see the password generated for this user for a short period of time. Make sure you record this password to a safe place since it will not be visible for very long. </p>

<p><img src="/assets/08102018-05-openstack-users-password-shown.png" alt="screenshot"></p>

<p>After a period of time you will no longer be able to see the password for the user you created, but If you do happen to forget the password, you can always have a new password regenerated.</p>

<p><img src="/assets/08102018-14-openstack-users-password-hidden.png" alt="screenshot"></p>

<h2>3. Download an Openstack configuration file.</h2>

<p>Now that you have an Openstack user created you can download an openrc.sh file that will contain all the details need by the Openstack cli to connect as this user. Click the &#39;...&#39; icon and the end of the line for the user you want to download a configuration file for and select &#39;Downloading an Openstack configuration file&#39;.</p>

<p><img src="/assets/08102018-06-download-openrc.png" alt="screenshot"></p>

<p>Select the region (datacenter) you want to connect to and click &#39;confirm&#39;. Your browser will next prompt you where you want to save the downloaded openrc.sh file.</p>

<p><img src="/assets/08102018-07-download-openrc-region.png" alt="screenshot"></p>

<p>If you look at the downloaded file you will see that it sets environment variables containing the Openstack details needed to connect to your cloud project.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:Desktop standorsett$ cat ~/Downloads/openrc.sh
#!/bin/bash

# To use an Openstack cloud you need to authenticate against keystone, which
# returns a **Token** and **Service Catalog**. The catalog contains the
# endpoint for all services the user/tenant has access to - including nova,
# glance, keystone, swift.
#
export OS_AUTH_URL=https://auth.cloud.ovh.us/v3/
export OS_IDENTITY_API_VERSION=3

export OS_USER_DOMAIN_NAME=${OS_USER_DOMAIN_NAME:-&quot;Default&quot;}
export OS_PROJECT_DOMAIN_NAME=${OS_PROJECT_DOMAIN_NAME:-&quot;Default&quot;}


# With the addition of Keystone we have standardized on the term **tenant**
# as the entity that owns the resources.
export OS_TENANT_ID=2897923a654b40d0b8b36a502bda4a8f
export OS_TENANT_NAME=&quot;3543682553721111&quot;

# In addition to the owning entity (tenant), openstack stores the entity
# performing the action as the **user**.
export OS_USERNAME=&quot;5r7jJyuwwwsv&quot;

# With Keystone you pass the keystone password.
echo &quot;Please enter your OpenStack Password: &quot;
read -sr OS_PASSWORD_INPUT
export OS_PASSWORD=$OS_PASSWORD_INPUT

# If your configuration has multiple regions, we set that information here.
# OS_REGION_NAME is optional and only valid in certain environments.
export OS_REGION_NAME=&quot;US-EAST-VA-1&quot;
# Do not leave a blank variable, unset it if it was empty
if [ -z &quot;$OS_REGION_NAME&quot; ]; then unset OS_REGION_NAME; fi
MacBook-Pro:Desktop standorsett$</code></pre></figure>

<p>The only piece of information that this file does not contain is your password, which it will prompt for when you source this file.</p>

<h2>4. Log into the Openstack Horizon UI.</h2>

<p>Just like you needed to create an Openstack user for interacting with the Openstack API, you will need to create a ssh keypair used for connecting to Openstack servers. This can be done within the Openstack Horizon UI. </p>

<p>Click the <code>...</code> icon and the end of the line for the user you want to use for interacting with the Openstack API and select <code>Launch Openstack Horizon</code>.</p>

<p><img src="/assets/08102018-08-launch-openstack-horizon.png" alt="screenshot"></p>

<p>This will open another browser tab for the Openstack Horizon UI with your username already filled in. Provide the password for this user and click <code>connect</code>.</p>

<p><img src="/assets/08102018-09-login-openstack-horizon.png" alt="screenshot"></p>

<h2>5. Create a ssh key-pair in the Openstack Horizon UI.</h2>

<p>We need to add a new ssh keypair that the Openstack API can add to servers that are created through the API. To keep things simple I added the same public ssh key that I generated in the first blog post.</p>

<p>To add a new ssh key pair go to <code>Project | Compute | Key pairs | Create Key Pair</code></p>

<p><img src="/assets/08102018-10-openstack-horizon-key-pairs.png" alt="screenshot"></p>

<p>Give the key pair a friendly name you can remember and paste the contents of the public key file. Click <code>Import Key Pair</code> to add this key pair.  </p>

<p><img src="/assets/08102018-12-openstack-horizon-import-key-pair.png" alt="screenshot"></p>

<p>The key pair you just added will now be visible in the Horizon UI.</p>

<p><img src="/assets/08102018-13-openstack-horizon-key-pairs.png" alt="screenshot"></p>

<h2>6. Installing the Openstack cli.</h2>

<p>You will need to install the openstack cli on the operating system you are using. You can easily find instruction for installing it on whatever OS you prefer to use. I quickly installed it on my Mac laptop with homebrew using the following commands.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">brew install python2
pip2 install --upgrade pip setuptools
pip2 install --upgrade python-openstackclient</code></pre></figure>

<h2>7. Sourcing the openrc.sh file</h2>

<p>The first step to using the Openstack cli you just installed is to source the openrc.sh file you downloaded in step 3. This will set environment variables that the Openstack cli will use to connect to the OVH public cloud. When you source the openrc.sh file you will be prompted for the password of the Openstack user listed in this file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ source ~/Downloads/openrc.sh
Please enter your OpenStack Password:
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>If you take a look at your exported environmental variables after sourcing the openrc.sh file, you will see the values from the opensh.rc file set along with your password.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ export | grep OS_
declare -x OS_AUTH_URL=&quot;https://auth.cloud.ovh.us/v3/&quot;
declare -x OS_IDENTITY_API_VERSION=&quot;3&quot;
declare -x OS_PASSWORD=&quot;*******************************&quot;
declare -x OS_PROJECT_DOMAIN_NAME=&quot;Default&quot;
declare -x OS_REGION_NAME=&quot;US-EAST-VA-1&quot;
declare -x OS_TENANT_ID=&quot;2897923a654b40d0b8b36a502bda4a8f&quot;
declare -x OS_TENANT_NAME=&quot;3543682553721111&quot;
declare -x OS_USERNAME=&quot;5r7jJyuwwwsv&quot;
declare -x OS_USER_DOMAIN_NAME=&quot;Default&quot;
MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>8. Using the Openstack cli to create an Openstack server</h2>

<p>Now that you have sourced the openrc.sh file you can create an Openstack server using the Openstack cli.</p>

<p>The four pieces of information you will need to create a new server are:</p>

<ul>
<li>The ssh key pair name that will be allowed to connect.</li>
<li>The operating system (image) you want to use.</li>
<li>The size of the server (flavor) you want to use.</li>
<li>The security group you want to have applied to the server.</li>
</ul>

<p>First list the ssh key pairs so you can see the key pair you created in step 5 by running <code>openstack keypair list</code>. You will need the name of this keypair shortly.</p>

<p><img src="/assets/08102018-16-openstack-cli-keypair-list.png" alt="screenshot"></p>

<p>Next list the available operating system images by running <code>openstack image list</code>. You will need the ID of the image you want to use</p>

<p>I noted <code>e0a89ff2-e98f-4a34-afae-68f9f6c9b5ad</code> for the ID of the Centos 7 image I wanted to use in my test.</p>

<p><img src="/assets/08102018-17-openstack-cli-image-list.png" alt="screenshot"></p>

<p>Next list the available server sizes or flavors by running <code>openstack flavor list</code>. You will need the ID of the flavor of the server you want to create. I wanted to use a <code>s1-2</code> flavor image since it was the smallest sandbox server with the lowest hourly rate, so I noted it&#39;s ID was <code>a64381e7-c4e7-4b01-9fbe-da405c544d2e</code></p>

<p><img src="/assets/08102018-18-openstack-cli-flavor-list.png" alt="screenshot"></p>

<p>Finally list the security groups by running <code>openstack security group list</code>. The default security group which allows all inbound and outbound traffic is named <code>default</code>. I decided to use this default security group for my test rather than create a new one that was more restrictive.</p>

<p><img src="/assets/08102018-19-openstack-cli-security-group-list.png" alt="screenshot">
The default security group is named <code>default</code> so you will need to specify it when creating a server..</p>

<p>Now knowing the flavor id, image id, keypair name and security group name you are ready to create a new openstack server using a command like the following</p>
<figure class="highlight"><pre><code class="language-text" data-lang="text">openstack server create --flavor a64381e7-c4e7-4b01-9fbe-da405c544d2e --image e0a89ff2-e98f-4a34-afae-68f9f6c9b5ad --key-name ovhus_public_cloud --security-group default openstack_cli_test
</code></pre></figure>
<p>Below is a screenshot of me running that command.</p>

<p><img src="/assets/08102018-20-openstack-cli-server-create.png" alt="screenshot"></p>

<p>After the Openstack server has been created you can run <code>openstack server list</code> to show the details of the server you just created. The networks field will show the IP address of the server.</p>

<p><img src="/assets/08102018-21-openstack-cli-server-list.png" alt="screenshot"></p>

<p>Now that you know the IP address of the server you just created, You can test connecting to this server using the ssh key you created in the previous blog post.</p>

<p><img src="/assets/08102018-22-openstack-cli-server-ssh.png" alt="screenshot"></p>

<h2>9. Validating the Openstack server in ovhcloud.com UI</h2>

<p>You can check the ovhcloud.com UI to confirm the server has been created and the IP address is the same as what <code>openstack server list</code> displayed.</p>

<p><img src="/assets/08102018-23-ovhcloud-ui-server-created.png" alt="screenshot"></p>

<h2>10. Deleting the Openstack server using the Openstack cli.</h2>

<p>Once you are finished with your openstack server, you should delete the server to prevent being charged for it&#39;s usage. Run the following command in the Openstack cli to delete the server.</p>

<p><img src="/assets/08102018-24-openstack-cli-server-delete.png" alt="screenshot"></p>

<p>Running <code>openstack server list</code> will show that the server has been sucessfully deleted. </p>

<p><img src="/assets/08102018-25-openstack-cli-server-list.png" alt="screenshot"></p>

<p>You can also check the ovhcloud.com UI to confirm the server has been deleted.</p>

<p><img src="/assets/08102018-26-ovhcloud-ui-server-deleted.png" alt="screenshot"></p>

<hr>

<h3>That all for this post covering how to use the Openstack cli utility to create servers on the OVH public cloud.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/08/creating-an-openstack-server-on-ovh-public-cloud/">
        Manually creating an openstack server on OVH public cloud
      </a>
    </h1>

    <span class="post-date">08 Aug 2018</span>

    <p>This is the first in a series of posts that will walk you through using the openstack-based OVH public cloud. In this post you will get introduced to using the ovhcloud.com UI to create an Openstack server.</p>

<p>I will attempt in this post to present the options that are available to OVH public cloud customers along side the choices I made that were specific to my server.</p>

<p>Let&#39;s get started...</p>

<hr>

<h2>1. Create an account at <a href="https://ovhcloud.com/auth/">ovhcloud.com</a>.</h2>

<p>The first thing you will need to do before you can create OVH public cloud servers is setup an account by going to <a href="https://ovhcloud.com/auth/">https://ovhcloud.com/auth/</a> and clicking the &#39;Create an account&#39; button. </p>

<p><img src="/assets/08082018-01-create-an-account.png" alt="screenshot"></p>

<p>After providing my email address, specifying a complex password and adding my billing address I received an email within minutes that my account had been activated.</p>

<h2>2. Setup two-factor authentication.</h2>

<p>The second thing you should do after creating an account is setup two-factor authentication. Enabling two-factor authentication will require that you provide a code (token) from your two-factor authentication application on your phone or physical device, along with your username and password when you log into ovhcloud.com. I would highly recommend setting up two-factor authentication to help prevent unauthorized access to your OVH account.</p>

<p>I found the option to enable two-factor authentication by going to My Account | Security | Two-factor authentication | activate double authentication</p>

<p><img src="/assets/08082018-02-activate-two-factor-auth.png" alt="screenshot"></p>

<p>OVH supports mobile applications and physical devices for two-factor authentication. I selected mobile application since I would be using Google Authenticator.</p>

<p><img src="/assets/08082018-04-activate-two-factor-auth.png" alt="screenshot"></p>

<p>Next I scanned the QR code on my phone, provided a code (token) generated by the Google Authenticator app and gave it a friendly name.</p>

<p><img src="/assets/08082018-05-activate-two-factor-auth.png" alt="screenshot"></p>

<p>After clicking next you will be given emergency codes that can be used if you lose your mobile app or physical two-factor device. Copy these emergency codes and store them in a safe place since they can never be retrieved again. After clicking next the two-factor authentication option will show as being enabled.</p>

<p><img src="/assets/08082018-06-activate-two-factor-auth.png" alt="screenshot"></p>

<h2>3. Adding a payment method.</h2>

<p>You will now need to add a payment method, since it will be used to purchase cloud credits in the next step. I added a payment method by clicking my username at the upper right, clicking &#39;My payment methods&#39; and finally clicking the &#39;Add a payment method&#39; button. Provide your card number, experation date and security code and click the &#39;Add&#39; button.</p>

<p>Once your payment method shows a &quot;Confirmed&quot; status you are ready to proceed to the next step.</p>

<p><img src="/assets/08082018-07-add-payment-method.png" alt="screenshot"></p>

<h2>4. Creating a public cloud project.</h2>

<p>The next step you need to do is create a cloud project. To do this I went to order dropdown and clicked &#39;Cloud project&#39;.</p>

<p><img src="/assets/08082018-08-create-cloud-project.png" alt="screenshot"></p>

<p>Name your project and click &#39;launch your cloud project&#39;.</p>

<p><img src="/assets/08082018-09-create-cloud-project.png" alt="screenshot"></p>

<p>On the next screen you will be purchasing credits that your running servers will consume.</p>

<p><img src="/assets/08082018-10-create-cloud-project.png" alt="screenshot"></p>

<p>Accept the terms and conditions by clicking the check box. Your cloud project will be ordered and payment method charged once you click the &#39;Validate and pay&#39; button. </p>

<p><img src="/assets/08082018-11-create-cloud-project.png" alt="screenshot"></p>

<p>I received an email from OVH within 5 minutes of ordering to tell me that my cloud project had been created.</p>

<h2>5. Creating a new ssh key for OVH public cloud to use.</h2>

<p>You will need to generate a ssh key to connect to the OVH openstack servers. On my mac laptop I ran the following command to generate a new ssh key for this purpose.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">ssh-keygen -b 4096 -t rsa -C &quot;stan.dorsett+ovhus_public_cloud@gmail.com&quot; -f ~/.ssh/id_rsa-ovhus_public_cloud</code></pre></figure>

<ul>
<li>The <code>-b</code> option will specify the number of bits in the ssh key.</li>
<li>The <code>-t</code> option with specify the type of ssh key generated.</li>
<li>The <code>-C</code> option will add a comment to the end of the public key file.</li>
<li>The <code>-f</code> option will specify the file that the private key will be saved to. </li>
</ul>

<p>When running the command you will also get asked you if you want to add a passphrase that will need to be provided when you use the ssh key. I didn&#39;t choose to set a passphrase, but you can choose to if you feel the need.</p>

<p>Here is the output from my running of this command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ ssh-keygen -b 4096 -t rsa -C &quot;stan.dorsett+ovhus_public_cloud@gmail.com&quot; -f ~/.ssh/id_rsa-ovhus_public_cloud
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud.
Your public key has been saved in /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud.pub.
The key fingerprint is:
SHA256:7kSErA6S8zCIq0H/2hmcxE4+JUsW6ZmoDPIE/ULM8I4 stan.dorsett+ovhus_public_cloud@gmail.com
The key&#39;s randomart image is:
+---[RSA 4096]----+
|.                |
| *   ...         |
|. *  oo .        |
|o* .+.+.         |
|E.=.o@ .S        |
|=Xo+O =o         |
|ooo..O  o        |
|..  o +o         |
|.  ..+  .        |
+----[SHA256]-----+
MacBook-Pro:~ standorsett$</code></pre></figure>

<p>Output the public key so you can use it in the next step.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ cat /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDJ8LcFN8MRO/uwgVcdDg0grv
...lots of more characters here...
l0nXM7jjnjD9L3UMFw== stan.dorsett+ovhus_public_cloud@gmail.com
MacBook-Pro:~ standorsett$</code></pre></figure>

<h2>6. Add the ssh pub key to the OVH public cloud.</h2>

<p>You next need to add the public key generate in the previous step to OVH public cloud so it can be used to connect to servers you create.</p>

<p>Go to the project you created in the previous step. You can find this by clicking Cloud | Servers | [your project name].</p>

<p><img src="/assets/08082018-12-view-cloud-project.png" alt="screenshot"></p>

<p>Click the &#39;SSh keys&#39; tab to view or create new ssh keys.</p>

<p><img src="/assets/08082018-13-add-ssh-key.png" alt="screenshot"></p>

<p>Click &#39;Add a new key&#39; to add the public key generated in the previous step.</p>

<p><img src="/assets/08082018-14-add-ssh-key.png" alt="screenshot"></p>

<p>Paste the output from the public key file, provide a friendly name for the ssh key and click &quot;Add this key.&#39;</p>

<p><img src="/assets/08082018-15-add-ssh-key.png" alt="screenshot"></p>

<h2>7. Create a new openstack server.</h2>

<p>Under your cloud project and click the Infrastructure tab. From the Actions dropdown click &#39;Add a server.&#39;</p>

<p><img src="/assets/08082018-16-add-a-server.png" alt="screenshot"></p>

<p>Choose the OS (image) that you want to have deployed.</p>

<p><img src="/assets/08082018-17-pick-an-os-image.png" alt="screenshot"></p>

<p>Select the server type (flavor) of the server you want to create. The server type will specify the number of vcpu, memory, disk size and price per hour of the openstack server that will be created:</p>

<p><img src="/assets/08082018-18-select-instance-type.png" alt="screenshot"></p>

<p>Select the ssh key you created in the previous step. Click the &#39;Launch now&#39; button to create the server.</p>

<p><img src="/assets/08082018-19-launch-instance.png" alt="screenshot"></p>

<p>Once the server is created a &#39;Login information&#39; window will be displayed with the ssh username and ip address you will need to connect to the server.</p>

<p><img src="/assets/08082018-20-login-info.png" alt="screenshot"></p>

<h2>8. SSH to the new openstack server,</h2>

<p>You can now use the login infomation provided in the last step along with the private ssh key you generated to connect to your new server. I used the following commands to ssh from my Mac laptop to connect.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">ssh -i /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud centos@147.135.76.67</code></pre></figure>

<ul>
<li>The <code>-i</code> option is used to specify the ssh private key you generated earlier.</li>
</ul>

<p>Here is the output from my running of this command.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">MacBook-Pro:~ standorsett$ ssh -i /Users/standorsett/.ssh/id_rsa-ovhus_public_cloud centos@147.135.76.67
The authenticity of host &#39;147.135.76.67 (147.135.76.67)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:aVSsv0mHKgIizglcvouJkvtBBOiZfNcQTpIc5oxhNO4.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;147.135.76.67&#39; (ECDSA) to the list of known hosts.
[centos@server-1 ~]$</code></pre></figure>

<p>You can now run what commands you would like on your new openstack server, like checking the IP address of the server you created.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[centos@server-1 ~]$ ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether fa:16:3e:42:97:c4 brd ff:ff:ff:ff:ff:ff
    inet 147.135.76.67/32 brd 147.135.76.67 scope global dynamic eth0
       valid_lft 86350sec preferred_lft 86350sec
    inet6 fe80::f816:3eff:fe42:97c4/64 scope link
       valid_lft forever preferred_lft forever
[centos@server-1 ~]$</code></pre></figure>

<h2>9. Destroy the openstack server.</h2>

<p>Once you are finished with your openstack server, you should delete the server in order to stop being charged for it&#39;s usage. Click the drop down on the server and select &#39;delete&#39; to delete the server.</p>

<p><img src="/assets/08082018-21-instance-options.png" alt="screenshot"></p>

<p>Click &#39;Confirm&#39; to confirm that you want to delete the server. This is your last chance to reconsider if you really want to delete it.</p>

<p><img src="/assets/08082018-22-confirm-delete.png" alt="screenshot"></p>

<p>Your cloud project will now be back to not showing any servers.</p>

<p><img src="/assets/08082018-23-empty-cloud-project.png" alt="screenshot"></p>

<hr>

<h3>That all for this initial post covering how to sign up and get started using the OVH public cloud.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/08/06/exploring-the-ovhpublic-cloud/">
        Exploring the OVH public cloud and opensource tools that can use it.
      </a>
    </h1>

    <span class="post-date">06 Aug 2018</span>

    <p>This post is the beginning of a series of posts that will explain how to use the openstack-based OVH public cloud UI and opensource tools that you can use to automate and manage your openstack infrastructure. </p>

<p>Over the last few years, I have worked primarily with VMware products and have not taken the time to learn with openstack. Now that the OVH public cloud has launched in the United States, and I work for OVH US, I figured it was time to start learning how customers could put this offering to use.</p>

<p>The posts in this series of blog that have been released are:</p>

<ul>
<li><a href="http://sdorsett.github.io/2018/08/08/creating-an-openstack-server-on-ovh-public-cloud/">Manually creating an openstack server on OVH public cloud</a></li>
<li><a href="http://sdorsett.github.io/2018/08/10/using-the-openstack-cli-to-create-a-server-on-ovh-public-cloud/">Using the Openstack cli to create a server on OVH public cloud</a></li>
<li><a href="http://sdorsett.github.io/2018/08/14/using-rclone-to-connect-to-ovh-public-cloud-swift-storage/">Using rclone to manage OVH Public Cloud swift storage</a></li>
<li><a href="http://sdorsett.github.io/2018/08/19/using-vagrant-to-deploy-to-ovh-public-cloud//">Using Vagrant to deploy an OVH public cloud server</a></li>
</ul>

<hr>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
