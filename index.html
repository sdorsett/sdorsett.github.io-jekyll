<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      sdorsett.github.io &middot; Things I find interesting
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/posts/">All Posts</a>
        
      
    
      
        
      
    
      
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/sdorsett/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/sdorsett">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">sdorsett.github.io</a>
            <small>Things I find interesting</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/25/creating-a-packer-template-for-installing-centos-67/">
        Creating our first Packer template for installing CentOS 6.7 with vmtools
      </a>
    </h1>

    <span class="post-date">25 Dec 2015</span>

    <p>In the last two posts we covered <a href="https://sdorsett.github.io/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">installing a ESXi virtual machine for use with Packer</a> and <a href="https://sdorsett.github.io/2015/12/24/installing-packer-and-ovftool-on-centos/">Setting up Packer, ovftool and Apache web server on a CentOS virtual machine</a>. In this post we will be putting all this prep work to use in order to install a CentOS 6.7 image using Packer.</p>

<p>Before we get started I would like to mentioned that many of the configuration files I am using have been influenced by or directly copied from the following github repositories:  </p>

<p><a href="https://github.com/frapposelli/packer-templates/">https://github.com/frapposelli/packer-templates</a><br>
<a href="https://github.com/nanliu/packer-templates/">https://github.com/nanliu/packer-templates/</a>  </p>

<p>These public repositories by Fabio and Nan have been extremely helpful in my own understanding of how Packer works.
 Well...enough talking, let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we created in the previous post.</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett<span class="nv">$ </span>ssh root@192.168.1.52
root@192.168.1.52<span class="err">&#39;</span>s password:
Last login: Wed Dec <span class="m">23</span> 16:58:41 <span class="m">2015</span> from 192.168.1.163
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>2. Create a new folder for our packer-templates and run &quot;git init&quot; to start tracking changes.</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># mkdir packer-templates</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># cd packer-templates/</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git init</span>
Initialized empty Git repository in /root/packer-templates/.git/
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>3. Create directory structure for the .iso files, scripts and templates we will be using with Packer.</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># mkdir -p ~/packer-templates/{iso,scripts,templates}</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># ls</span>
iso  scripts  templates
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>4. Download the CentOS 6.7 minimal .iso and place it in the packer-templates/iso/ folder</h2>

<p>Open <a href="http://isoredirect.centos.org/centos/6/isos/x86_64/">http://isoredirect.centos.org/centos/6/isos/x86_64/</a> in a browser and pick a mirror to download the .iso from. Copy the URL to the CentOS-6.7-x86_64-minimal.iso image file and use wget to pull the image down in the CentOS virtual machine</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># cd ~/packer-templates/iso/</span>
<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c"># wget http://mirror.cs.pitt.edu/centos/6.7/isos/x86_64/CentOS-6.7-x86_64-minimal.iso</span>
--2015-12-23 20:04:30--  http://mirror.cs.pitt.edu/centos/6.7/isos/x86_64/CentOS-6.7-x86_64-minimal.iso
Resolving mirror.cs.pitt.edu... 136.142.23.206
Connecting to mirror.cs.pitt.edu<span class="p">|</span>136.142.23.206<span class="p">|</span>:80... connected.
HTTP request sent, awaiting response... <span class="m">200</span> OK
Length: <span class="m">414187520</span> <span class="o">(</span>395M<span class="o">)</span> <span class="o">[</span>application/octet-stream<span class="o">]</span>
Saving to: “CentOS-6.7-x86_64-minimal.iso”

100%<span class="o">[========================================================</span>&gt;<span class="o">]</span> 414,187,520 7.01M/s   in 58s

2015-12-23 20:05:28 <span class="o">(</span>6.77 MB/s<span class="o">)</span> - “CentOS-6.7-x86_64-minimal.iso” saved <span class="o">[</span>414187520/414187520<span class="o">]</span>

<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>5. Compare the sha1sum of the downloaded CentOS-6.7-x86_64-minimal.iso file to what is listed on the CentOS mirror.</h2>

<p>Open the sha1sum.txt file from the CentOS mirror you chose in your browser. It should show the following:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">7bb8c1c23a4fdef93e6f0a6347d570e5764d0b38  CentOS-6.7-x86_64-bin-DVD1.iso
79f58df5723f723fc62d5e8831ada38072096a46  CentOS-6.7-x86_64-bin-DVD2.iso
2ed5ea551dffc3e4b82847b3cee1f6cd748e8071  CentOS-6.7-x86_64-minimal.iso
c3678c6b72cbf2ed9b4e8a1ddb190fd262db8b7f  CentOS-6.7-x86_64-netinstall.iso
a7c05a7c0a4c6bdef8dd1cf8310613c154c2b9d5  CentOS-6.7-x86_64-LiveCD.iso
aebd4c2e81ace92ebda2bc909aca34a139ff2cea  CentOS-6.7-x86_64-LiveDVD.iso</code></pre></div>

<p>Compare the sha1sum from above to the actual sha1sum of the downloaded .iso</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c"># sha1sum CentOS-6.7-x86_64-minimal.iso</span>
2ed5ea551dffc3e4b82847b3cee1f6cd748e8071  CentOS-6.7-x86_64-minimal.iso
<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>The two hashes match so we know the file was downloaded without any corruption.</p>

<h2>6. Download patched vmtools from <a href="https://github.com/rasa/vmware-tools-patches">https://github.com/rasa/vmware-tools-patches</a> and place the .iso file in the packer-templates/iso/ folder.</h2>

<p>I have had issues with the VMware issued vmtools, specifically around CentOS 7 and trying to get hgfs (host guest file system) functional on Fusion. During that troubleshooting I discovered the patched vmware tools listed above and found installing those, rather than the VMware issue vmtools installer, resolved my issues.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># wget https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/7.1.3/3204469/packages/com.vmware.fusion.tools.linux.zip.tar</span>
--2015-12-23 21:20:55--  https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/7.1.3/3204469/packages/com.vmware.fusion.tools.linux.zip.tar
Resolving softwareupdate.vmware.com... 23.64.167.143, 2600:1404:a:589::2ef, 2600:1404:a:59a::2ef
Connecting to softwareupdate.vmware.com<span class="p">|</span>23.64.167.143<span class="p">|</span>:443... connected.
HTTP request sent, awaiting response... <span class="m">200</span> OK
Length: <span class="m">62074880</span> <span class="o">(</span>59M<span class="o">)</span> <span class="o">[</span>application/x-tar<span class="o">]</span>
Saving to: “com.vmware.fusion.tools.linux.zip.tar”

100%<span class="o">[========================================================</span>&gt;<span class="o">]</span> 62,074,880  6.95M/s   in 8.6s

2015-12-23 21:21:04 <span class="o">(</span>6.91 MB/s<span class="o">)</span> - “com.vmware.fusion.tools.linux.zip.tar” saved <span class="o">[</span>62074880/62074880<span class="o">]</span>

<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># tar xf com.vmware.fusion.tools.linux.zip.tar</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># unzip com.vmware.fusion.tools.linux.zip</span>
Archive:  com.vmware.fusion.tools.linux.zip
  inflating: manifest.plist
   creating: payload/
  inflating: payload/linux.iso
 extracting: payload/linux.iso.sig
  inflating: payload/tools-linux.plist
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># cp payload/linux.iso ~/packer-templates/iso/</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># cd ~/packer-templates/iso/</span>
<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c"># ln -s ./linux.iso vmware-tools-linux.iso</span>
<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c"># ls -la</span>
total 466960
drwxr-xr-x <span class="m">2</span> root root      <span class="m">4096</span> Dec <span class="m">23</span> 21:22 .
drwxr-xr-x <span class="m">6</span> root root      <span class="m">4096</span> Dec <span class="m">23</span> 21:22 ..
-rw-r--r-- <span class="m">1</span> root root <span class="m">414187520</span> Aug  <span class="m">4</span> 21:59 CentOS-6.7-x86_64-minimal.iso
-rw-r--r-- <span class="m">1</span> root root  <span class="m">63971328</span> Dec <span class="m">23</span> 21:21 linux.iso
lrwxrwxrwx <span class="m">1</span> root root        <span class="m">11</span> Dec <span class="m">23</span> 21:22 vmware-tools-linux.iso -&gt; ./linux.iso
<span class="o">[</span>root@packer-centos iso<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>7. Create a packer .json file in the template/ folder for our image</h2>

<p>Create the following file in the packer-templates/templates/ directory. The centos67.json file contains the instructions Packer will use to install the CentOS 6.7 image.</p>

<pre>
[root@packer-centos packer-templates]# cat templates/centos67.json
{
  "variables": {
    "version": "1.0"
  },
  "builders": [
    {
      "name": "centos67",
      "vm_name": "centos67",
      "vmdk_name": "centos67",
      "type": "vmware-iso",
      "communicator": "ssh",
      "ssh_pty": "true",
      "headless": false,
      "disk_size": 16384,
      "guest_os_type": "rhel6-64",
      "iso_url": "./iso/CentOS-6.7-x86_64-minimal.iso",
      "iso_checksum": "2ed5ea551dffc3e4b82847b3cee1f6cd748e8071",
      "iso_checksum_type": "sha1",
      "shutdown_command": "echo 'vagrant' | sudo -S /sbin/shutdown -P now",

      "remote_host": "{{user `packer_remote_host`}}",
      "remote_datastore": "{{user `packer_remote_datastore`}}",
      "remote_username": "{{user `packer_remote_username`}}",
      "remote_password": "{{user `packer_remote_password`}}",
      "remote_type": "esx5",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_wait_timeout": "60m",
      "tools_upload_flavor": "linux",
      "http_directory": ".",
      "boot_wait": "5s",
      "vmx_data": {
        "memsize": "4096",
        "numvcpus": "2",
        "ethernet0.networkName": "{{user `packer_remote_network`}}",
        "ethernet0.present": "TRUE",
        "ethernet0.startConnected": "TRUE",
        "ethernet0.virtualDev": "e1000",
        "ethernet0.addressType": "generated",
        "ethernet0.generatedAddressOffset": "0",
        "ethernet0.wakeOnPcktRcv": "FALSE"

      },
      "vmx_data_post": {
        "ide1:0.startConnected": "FALSE",
        "ide1:0.clientDevice": "TRUE",
        "ide1:0.fileName": "emptyBackingString",
        "ethernet0.virtualDev": "vmxnet3"
      },
      "boot_command": [
        "<tab> text ks=http://:/scripts/centos-6-kickstart.cfg<enter><wait>"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "iso/vmware-tools-linux.iso",
      "destination": "/tmp/vmware-tools-linux.iso"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vagrant-settings.sh"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vmware-tools_install.sh"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vmware-cleanup.sh"
    }
  ]
}
</pre>

<p>Let us go over some of what&#39;s in this .json file</p>

<ul>
<li>the builders block</li>
</ul>

<p>This section contains builder specific instruction. We are using the vmware-iso builder so much of this is describing how we want to VMware backed virtual machine configured.</p>

<p>You might notice something a little different about remote_host, remote_datastore, remote_username, remote_password and ethernet0.networkName parameters. These parameters contain information about the ESXi host we are using to create the Packer image, so rather than hard coding this info into each and every template these values can be pulled from user defined variables.</p>

<p>The benefit of separating &quot;data from code&quot; is two fold. First, this prevents sensitive datacenter specific information from being included in our template, which could end up in github or some other git repository. Secondly, we only need to update one location if the password of our remote_host ever needs to be changed.</p>

<ul>
<li>the provisioners block</li>
</ul>

<p>This section contains instruction on what to do after the OS is successfully installed packer. You can use &quot;file&quot; provisioners to copy files into the Packer built OS, as well as &quot;shell&quot; provisioners to run scripts to perform additional configuration. You will get a closer look at &quot;shell&quot; provisioner scripts shortly</p>

<h2>8. Create the script/ files that Packer will use to install the CentOS 6.7 image</h2>

<p>The following files are referenced in the centos67.json template and need to be created in the packer-templates/scripts/ folder</p>

<ul>
<li>scripts/centos-6-kickstart.cfg - this is the CentOS 6 kickstart file that describes how CentOS 6 should be installed</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-6-kickstart.cfg
firewall --disabled

install
cdrom

lang en_US.UTF-8
keyboard us
timezone  Europe/Rome

network --bootproto=dhcp
rootpw vagrant
authconfig --enableshadow --passalgo=sha512

selinux —-disabled
bootloader --location=mbr
text
skipx

logging --level=info
zerombr

clearpart --all --initlabel
autopart

auth  --useshadow  --enablemd5
firstboot --disabled
reboot

%packages --ignoremissing
@Base
@Core
%end

%post
yum install wget git -y
VAGRANT_USER=vagrant
/usr/sbin/groupadd vagrant
/usr/sbin/useradd vagrant -g vagrant -G wheel
echo "vagrant"|passwd --stdin vagrant
echo "vagrant        ALL=(ALL)       NOPASSWD: ALL" >> /etc/sudoers

sed -i "s/^.*requiretty/#Defaults requiretty/" /etc/sudoers
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vagrant-settings.sh - this is a bash script that describes how vagrant speciffied settings should be configured</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vagrant-settings.sh
#!/bin/bash -eux

# Vagrant specific
date > /etc/vagrant_box_build_time

VAGRANT_USER=vagrant
VAGRANT_HOME=/home/$VAGRANT_USER
VAGRANT_KEY_URL=https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub

# Add vagrant user (if it doesn't already exist)
if ! id -u $VAGRANT_USER >/dev/null 2>&1; then
    /usr/sbin/groupadd $VAGRANT_USER
    /usr/sbin/useradd $VAGRANT_USER -g $VAGRANT_USER -G wheel
    echo "${VAGRANT_USER}"|passwd --stdin $VAGRANT_USER
    echo "${VAGRANT_USER}        ALL=(ALL)       NOPASSWD: ALL" >> /etc/sudoers
fi

# Installing vagrant keys
mkdir -pm 700 $VAGRANT_HOME/.ssh
wget --no-check-certificate "${VAGRANT_KEY_URL}" -O $VAGRANT_HOME/.ssh/authorized_keys
chmod 0600 $VAGRANT_HOME/.ssh/authorized_keys
chown -R $VAGRANT_USER:$VAGRANT_USER $VAGRANT_HOME/.ssh
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vmware-tools_install.sh - this is a bash script that describes how vmtools should be installed</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vmware-tools_install.sh
#!/bin/bash
sudo yum upgrade ca-certificates -y
sudo yum install perl fuse-libs -y
sudo mkdir /mnt/cdrom
sudo mount -o loop /tmp/vmware-tools-linux.iso /mnt/cdrom
sudo cp /mnt/cdrom/VMwareTools*.tar.gz /tmp/
cd /tmp
tar xfz VMwareTools*.tar.gz
cd /tmp/vmware-tools-distrib
ls -la

# from http://www.virtuallyghetto.com/2015/06/automating-silent-installation-of-vmware-tools-on-linux-wautomatic-kernel-modules.html
# If you wish to change which Kernel modules get installed
# The last four entries (yes,no,no,no) map to the following:
#   VMware Host-Guest Filesystem
#   vmblock enables dragging or copying files
#   VMware automatic kernel modules
#   Guest Authentication
# and you can also change the other params as well
sudo cat > /tmp/answer << __ANSWER__
yes
/usr/bin
/etc
/etc/init.d
/usr/sbin
/usr/lib/vmware-tools
yes
/usr/share/doc/vmware-tools
yes
yes
yes
no
yes
no

__ANSWER__

sudo /tmp/vmware-tools-distrib/vmware-install.pl < /tmp/answer

sudo umount /mnt/cdrom
cd /tmp
rm -rf vmware-tools-distrib
rm -f VMwareTools*.tar.gz
rm /tmp/vmware-tools-linux.iso
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vmware-cleanup.sh - a bash script that cleans up the Packer image prior to being exported</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vmware-cleanup.sh
#!/bin/bash -eux
# Based off the great "Preparing Linux Template VMs"
# (http://lonesysadmin.net/2013/03/26/preparing-linux-template-vms/) article
# by Bob Plankers, thanks Bob!

CLEANUP_PAUSE=${CLEANUP_PAUSE:-0}
echo "==> Pausing for ${CLEANUP_PAUSE} seconds..."
sleep ${CLEANUP_PAUSE}

echo "==> erasing unused packages to free up space"
/usr/bin/yum -y erase gtk2 libX11 hicolor-icon-theme avahi freetype bitstream-vera-fonts

echo "==> Cleaning up yum cache"
/usr/bin/yum clean all

echo "==> Force logs to rotate"
/usr/sbin/logrotate -f /etc/logrotate.conf
/bin/rm -f /var/log/*-???????? /var/log/*.gz

echo "==> Clear audit log and wtmp"
/bin/cat /dev/null > /var/log/audit/audit.log
/bin/cat /dev/null > /var/log/wtmp

echo "==> Cleaning up udev rules"
/bin/rm -f /etc/udev/rules.d/70*

echo "==> Remove the traces of the template MAC address and UUIDs"
/bin/sed -i '/^\(HWADDR\|UUID\)=/d' /etc/sysconfig/network-scripts/ifcfg-eth0

echo "==> Cleaning up tmp"
/bin/rm -rf /tmp/*
/bin/rm -rf /var/tmp/*

echo "==> Remove the SSH host keys"
/bin/rm -f /etc/ssh/*key*

echo "==> Remove the root user’s shell history"
/bin/rm -f ~root/.bash_history
unset HISTFILE

echo "==> Installed packages"
rpm -qa

echo "==> yum -y clean all"
yum -y clean all

# Determine the version of RHEL
COND=`grep -i Taroon /etc/redhat-release`
if [ "$COND" = "" ]; then
        export PREFIX="/usr/sbin"
else
        export PREFIX="/sbin"
fi

FileSystem=`grep ext /etc/mtab| awk -F" " '{ print $2 }'`

for i in $FileSystem
do
        echo $i
        number=`df -B 512 $i | awk -F" " '{print $3}' | grep -v Used`
        echo $number
        percent=$(echo "scale=0; $number * 98 / 100" | bc )
        echo $percent
        dd count=`echo $percent` if=/dev/zero of=`echo $i`/zf
        /bin/sync
        sleep 15
        rm -f $i/zf
done

VolumeGroup=`$PREFIX/vgdisplay | grep Name | awk -F" " '{ print $3 }'`

for j in $VolumeGroup
do
        echo $j
        $PREFIX/lvcreate -l `$PREFIX/vgdisplay $j | grep Free | awk -F" " '{ print $5 }'` -n zero $j
        if [ -a /dev/$j/zero ]; then
                cat /dev/zero > /dev/$j/zero
                /bin/sync
                sleep 15
                $PREFIX/lvremove -f /dev/$j/zero
        fi
done

echo "==> Zero out the free space to save space in the final image"
dd if=/dev/zero of=/EMPTY bs=1M
rm -f /EMPTY

# Make sure we wait until all the data is written to disk, otherwise
# Packer might quit too early before the large files are deleted
sync
[root@packer-centos packer-templates]#
</pre>

<h2>9. Create packer-remote-info.json file that contains info on our ESXi virtual machine</h2>

<p>Create the following file that will contain the ESXi virtual machine specific information used by Packer. We will also add this file to .gitignore in a future step, to ensure this information does not get stored in a git repository.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># cat &lt;&lt; EOF &gt; ~/packer-templates/packer-remote-info.json</span>
&gt; <span class="o">{</span>
&gt;   <span class="s2">&quot;packer_remote_host&quot;</span>: <span class="s2">&quot;192.168.1.51&quot;</span>,
&gt;   <span class="s2">&quot;packer_remote_username&quot;</span>: <span class="s2">&quot;root&quot;</span>,
&gt;   <span class="s2">&quot;packer_remote_password&quot;</span>: <span class="s2">&quot;password&quot;</span>,
&gt;   <span class="s2">&quot;packer_remote_datastore&quot;</span>: <span class="s2">&quot;datastore1&quot;</span>,
&gt;   <span class="s2">&quot;packer_remote_network&quot;</span>: <span class="s2">&quot;VM Network&quot;</span>
&gt; <span class="o">}</span>
&gt; EOF
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>10. Use yum to install the tree command so we can visualize the packer-templates directory structure</h2>

<p>The tree command is helpful by allowing you to display the files and folders from a specific point in the file system. We will install this now to assist in showing the directory structure of the packer-templates directory.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># yum install -y tree</span>
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: mirror.utexas.edu
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package tree.x86_64 0:1.5.3-3.el6 will be installed
--&gt; Finished Dependency Resolution

Dependencies <span class="nv">Resolved</span>

<span class="o">==========================================================</span>
 Package      Arch      Version         Repository   <span class="nv">Size</span>
<span class="o">==========================================================</span>
Installing:
 tree         x86_64    1.5.3-3.el6     base         <span class="m">36</span> k

Transaction <span class="nv">Summary</span>
<span class="o">==========================================================</span>
Install       <span class="m">1</span> Package<span class="o">(</span>s<span class="o">)</span>

Total download size: <span class="m">36</span> k
Installed size: <span class="m">65</span> k
Downloading Packages:
tree-1.5.3-3.el6.x86_64.rpm              <span class="p">|</span>  <span class="m">36</span> kB    00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : tree-1.5.3-3.el6.x86_64                 1/1
  Verifying  : tree-1.5.3-3.el6.x86_64                 1/1

Installed:
  tree.x86_64 0:1.5.3-3.el6

Complete!
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>Run the tree command to see the directory structure:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># tree</span>
.
├── iso
│   ├── CentOS-6.7-x86_64-minimal.iso
│   ├── linux.iso
│   └── vmware-tools-linux.iso -&gt; ./linux.iso
├── packer-remote-info.json
├── scripts
│   ├── centos-6-kickstart.cfg
│   ├── centos-vagrant-settings.sh
│   ├── centos-vmware-cleanup.sh
│   └── centos-vmware-tools_install.sh
└── templates
    └── centos67.json

<span class="m">3</span> directories, <span class="m">9</span> files
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>11. Create .gitignore file that contains everything we don&#39;t have to stored in git</h2>

<p>Any files or folders listed in the .gitignore will be ignored by git. We will be adding the packer-remote-info.json file, since it contains username and password information, and the iso/ directory, since we don&#39;t want to upload the large .iso files to our git repository.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># cat .gitignore</span>
iso/
packer-remote-info.json
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git status</span>
<span class="c"># On branch master</span>
<span class="c">#</span>
<span class="c"># Initial commit</span>
<span class="c">#</span>
<span class="c"># Untracked files:</span>
<span class="c">#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span>
<span class="c">#</span>
<span class="c">#   .gitignore</span>
<span class="c">#   scripts/</span>
<span class="c">#   templates/</span>
nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> to track<span class="o">)</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>12. Push the changes we have made to a github repository</h2>

<p>I create a public github repository for storing all the files created during this Packer series. During this step I will be pushing the current state of the files to the <a href="https://github.com/sdorsett/packer-templates/tree/first-packer-template">&quot;first-packer-template&quot; branch</a> of this this github repository:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git remote add origin https://sdorsett@github.com/sdorsett/packer-templates.git</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git add .</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git commit -m &quot;first-packer-template&quot;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 3fba017<span class="o">]</span> first-packer-template
 <span class="m">6</span> files changed, <span class="m">277</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">0</span> deletions<span class="o">(</span>-<span class="o">)</span>
 create mode <span class="m">100644</span> .gitignore
 create mode <span class="m">100644</span> scripts/centos-6-kickstart.cfg
 create mode <span class="m">100644</span> scripts/centos-vagrant-settings.sh
 create mode <span class="m">100644</span> scripts/centos-vmware-cleanup.sh
 create mode <span class="m">100644</span> scripts/centos-vmware-tools_install.sh
 create mode <span class="m">100644</span> templates/centos67.json
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git checkout -b first-packer-template</span>
Switched to a new branch <span class="s1">&#39;first-packer-template&#39;</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># git push origin first-packer-template</span>
Password:
Counting objects: 10, <span class="k">done</span>.
Delta compression using up to <span class="m">2</span> threads.
Compressing objects: 100% <span class="o">(</span>8/8<span class="o">)</span>, <span class="k">done</span>.
Writing objects: 100% <span class="o">(</span>10/10<span class="o">)</span>, 3.90 KiB, <span class="k">done</span>.
Total <span class="m">10</span> <span class="o">(</span>delta 0<span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta 0<span class="o">)</span>
To https://sdorsett@github.com/sdorsett/packer-templates.git
 * <span class="o">[</span>new branch<span class="o">]</span>      first-packer-template -&gt; first-packer-template
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>13. packer build the template we created</h2>

<p>Now that we have all the necessary .iso files downloaded and template/script files created, we can test our build. In order to use the values in the packer-remote-info.json file, we will use the -var-file parameter to specify this file.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c"># packer build -var-file=./packer-remote-info.json templates/centos67.json</span>
centos67 output will be in this color.

<span class="o">==</span>&gt; centos67: Downloading or copying ISO
    centos67: Downloading or copying: file:///root/packer-templates/iso/CentOS-6.7-x86_64-minimal.iso
<span class="o">==</span>&gt; centos67: Uploading ISO to remote machine...
<span class="o">==</span>&gt; centos67: Creating virtual machine <span class="nv">disk</span>
<span class="o">==</span>&gt; centos67: Building and writing VMX <span class="nv">file</span>
<span class="o">==</span>&gt; centos67: Starting HTTP server on port <span class="nv">8448</span>
<span class="o">==</span>&gt; centos67: Registering remote VM...
<span class="o">==</span>&gt; centos67: Starting virtual machine...
<span class="o">==</span>&gt; centos67: Waiting 5s <span class="k">for</span> boot...
<span class="o">==</span>&gt; centos67: Connecting to VM via <span class="nv">VNC</span>
<span class="o">==</span>&gt; centos67: Typing the boot <span class="nb">command </span>over VNC...
<span class="o">==</span>&gt; centos67: Waiting <span class="k">for</span> SSH to become available...
<span class="o">==</span>&gt; centos67: Connected to SSH!
<span class="o">==</span>&gt; centos67: Uploading iso/vmware-tools-linux.iso <span class="o">=</span>&gt; /tmp/vmware-tools-linux.iso
<span class="o">==</span>&gt; centos67: Provisioning with shell script: scripts/centos-vagrant-settings.sh
    centos67: /tmp/script_7943.sh: line 20: wget: <span class="nb">command </span>not found
    centos67: chmod: cannot access <span class="sb">`</span>/home/vagrant/.ssh/authorized_keys<span class="s1">&#39;: No such file or directory</span>
<span class="s1">==&gt; centos67: Provisioning with shell script: scripts/centos-vmware-tools_install.sh</span>
<span class="s1">    centos67: Loaded plugins: fastestmirror</span>
<span class="s1">    centos67: Setting up Upgrade Process</span>
<span class="s1">    centos67: Determining fastest mirrors</span>
<span class="s1">    centos67: * base: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: * extras: mirror.us.oneandone.net</span>
<span class="s1">    centos67: * updates: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: No Packages marked for Update</span>
<span class="s1">    centos67: Loaded plugins: fastestmirror</span>
<span class="s1">    centos67: Setting up Install Process</span>
<span class="s1">    centos67: Loading mirror speeds from cached hostfile</span>
<span class="s1">    centos67: * base: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: * extras: mirror.us.oneandone.net</span>
<span class="s1">    centos67: * updates: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: Resolving Dependencies</span>
<span class="s1">    centos67: --&gt; Running transaction check</span>
<span class="s1">    centos67: ---&gt; Package fuse-libs.x86_64 0:2.8.3-4.el6 will be installed</span>
<span class="s1">    centos67: ---&gt; Package perl.x86_64 4:5.10.1-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl-libs = 4:5.10.1-141.el6_7.1 for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl-libs for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl(version) for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl(Pod::Simple) for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl(Module::Pluggable) for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Processing Dependency: libperl.so()(64bit) for package: 4:perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: --&gt; Running transaction check</span>
<span class="s1">    centos67: ---&gt; Package perl-Module-Pluggable.x86_64 1:3.90-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: ---&gt; Package perl-Pod-Simple.x86_64 1:3.13-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: --&gt; Processing Dependency: perl(Pod::Escapes) &gt;= 1.04 for package: 1:perl-Pod-Simple-3.13-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: ---&gt; Package perl-libs.x86_64 4:5.10.1-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: ---&gt; Package perl-version.x86_64 3:0.77-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: --&gt; Running transaction check</span>
<span class="s1">    centos67: ---&gt; Package perl-Pod-Escapes.x86_64 1:1.04-141.el6_7.1 will be installed</span>
<span class="s1">    centos67: --&gt; Finished Dependency Resolution</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Dependencies Resolved</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: ========================================</span>
<span class="s1">    centos67: Package         Arch   Version</span>
<span class="s1">    centos67: Repository</span>
<span class="s1">    centos67: Size</span>
<span class="s1">    centos67: ========================================</span>
<span class="s1">    centos67: Installing:</span>
<span class="s1">    centos67: fuse-libs       x86_64 2.8.3-4.el6</span>
<span class="s1">    centos67: base     74 k</span>
<span class="s1">    centos67: perl            x86_64 4:5.10.1-141.el6_7.1</span>
<span class="s1">    centos67: updates  10 M</span>
<span class="s1">    centos67: Installing for dependencies:</span>
<span class="s1">    centos67: perl-Module-Pluggable</span>
<span class="s1">    centos67: x86_64 1:3.90-141.el6_7.1</span>
<span class="s1">    centos67: updates  40 k</span>
<span class="s1">    centos67: perl-Pod-Escapes</span>
<span class="s1">    centos67: x86_64 1:1.04-141.el6_7.1</span>
<span class="s1">    centos67: updates  33 k</span>
<span class="s1">    centos67: perl-Pod-Simple x86_64 1:3.13-141.el6_7.1</span>
<span class="s1">    centos67: updates 213 k</span>
<span class="s1">    centos67: perl-libs       x86_64 4:5.10.1-141.el6_7.1</span>
<span class="s1">    centos67: updates 579 k</span>
<span class="s1">    centos67: perl-version    x86_64 3:0.77-141.el6_7.1</span>
<span class="s1">    centos67: updates  52 k</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Transaction Summary</span>
<span class="s1">    centos67: ========================================</span>
<span class="s1">    centos67: Install       7 Package(s)</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Total size: 11 M</span>
<span class="s1">    centos67: Total download size: 74 k</span>
<span class="s1">    centos67: Installed size: 36 M</span>
<span class="s1">    centos67: Downloading Packages:</span>
<span class="s1">    centos67: fuse-libs-2.8.3- |  74 kB     00:00</span>
<span class="s1">    centos67: warning: rpmts_HdrFromFdno: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY</span>
<span class="s1">    centos67: Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span>
<span class="s1">    centos67: Importing GPG key 0xC105B9DE:</span>
<span class="s1">    centos67: Userid : CentOS-6 Key (CentOS 6 Official Signing Key) &lt;centos-6-key@centos.org&gt;</span>
<span class="s1">    centos67: Package: centos-release-6-7.el6.centos.12.3.x86_64 (@anaconda-CentOS-201508042137.x86_64/6.7)</span>
<span class="s1">    centos67: From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</span>
<span class="s1">    centos67: Running rpm_check_debug</span>
<span class="s1">    centos67: Running Transaction Test</span>
<span class="s1">    centos67: Transaction Test Succeeded</span>
<span class="s1">    centos67: Running Transaction</span>
<span class="s1">    centos67:   Installing : 1:perl-Pod-Escapes   1/7</span>
<span class="s1">    centos67:   Installing : 1:perl-Module-Plug   2/7</span>
<span class="s1">    centos67:   Installing : 3:perl-version-0.7   3/7</span>
<span class="s1">    centos67:   Installing : 4:perl-libs-5.10.1   4/7</span>
<span class="s1">    centos67:   Installing : 1:perl-Pod-Simple-   5/7</span>
<span class="s1">    centos67:   Installing : 4:perl-5.10.1-141.   6/7</span>
<span class="s1">    centos67:   Installing : fuse-libs-2.8.3-4.   7/7</span>
<span class="s1">    centos67: Verifying  : 1:perl-Pod-Simple-   1/7</span>
<span class="s1">    centos67: Verifying  : 1:perl-Pod-Escapes   2/7</span>
<span class="s1">    centos67: Verifying  : fuse-libs-2.8.3-4.   3/7</span>
<span class="s1">    centos67: Verifying  : 1:perl-Module-Plug   4/7</span>
<span class="s1">    centos67: Verifying  : 3:perl-version-0.7   5/7</span>
<span class="s1">    centos67: Verifying  : 4:perl-libs-5.10.1   6/7</span>
<span class="s1">    centos67: Verifying  : 4:perl-5.10.1-141.   7/7</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Installed:</span>
<span class="s1">    centos67: fuse-libs.x86_64 0:2.8.3-4.el6</span>
<span class="s1">    centos67: perl.x86_64 4:5.10.1-141.el6_7.1</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Dependency Installed:</span>
<span class="s1">    centos67: perl-Module-Pluggable.x86_64 1:3.90-141.el6_7.1</span>
<span class="s1">    centos67: perl-Pod-Escapes.x86_64 1:1.04-141.el6_7.1</span>
<span class="s1">    centos67: perl-Pod-Simple.x86_64 1:3.13-141.el6_7.1</span>
<span class="s1">    centos67: perl-libs.x86_64 4:5.10.1-141.el6_7.1</span>
<span class="s1">    centos67: perl-version.x86_64 3:0.77-141.el6_7.1</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Complete!</span>
<span class="s1">    centos67: total 488</span>
<span class="s1">    centos67: drwxr-xr-x   7 root root   4096 Oct 30 07:10 .</span>
<span class="s1">    centos67: drwxrwxrwt.  4 root root   4096 Dec 24 02:34 ..</span>
<span class="s1">    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 bin</span>
<span class="s1">    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 doc</span>
<span class="s1">    centos67: drwxr-xr-x   5 root root   4096 Oct 30 07:10 etc</span>
<span class="s1">    centos67: -rw-r--r--   1 root root 269196 Oct 30 07:10 FILES</span>
<span class="s1">    centos67: -rw-r--r--   1 root root   2538 Oct 30 07:10 INSTALL</span>
<span class="s1">    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 installer</span>
<span class="s1">    centos67: drwxr-xr-x  15 root root   4096 Oct 30 07:10 lib</span>
<span class="s1">    centos67: -rwxr-xr-x   1 root root 196237 Oct 30 07:10 vmware-install.pl</span>
<span class="s1">    centos67: Creating a new VMware Tools installer database using the tar4 format.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Installing VMware Tools.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: In which directory do you want to install the binary files?</span>
<span class="s1">    centos67: [/usr/bin]</span>
<span class="s1">    centos67: The path &quot;yes&quot; is a relative path. Please enter an absolute path.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: In which directory do you want to install the binary files?</span>
<span class="s1">    centos67: [/usr/bin]</span>
<span class="s1">    centos67: What is the directory that contains the init directories (rc0.d/ to rc6.d/)?</span>
<span class="s1">    centos67: [/etc/rc.d]</span>
<span class="s1">    centos67: What is the directory that contains the init scripts?</span>
<span class="s1">    centos67: [/etc/init.d]</span>
<span class="s1">    centos67: In which directory do you want to install the daemon files?</span>
<span class="s1">    centos67: [/usr/sbin]</span>
<span class="s1">    centos67: In which directory do you want to install the library files?</span>
<span class="s1">    centos67: [/usr/lib/vmware-tools]</span>
<span class="s1">    centos67: The path &quot;/usr/lib/vmware-tools&quot; does not exist currently. This program is</span>
<span class="s1">    centos67: going to create it, including needed parent directories. Is this what you want?</span>
<span class="s1">    centos67: [yes]</span>
<span class="s1">    centos67: In which directory do you want to install the documentation files?</span>
<span class="s1">    centos67: [/usr/share/doc/vmware-tools]</span>
<span class="s1">    centos67: The path &quot;/usr/share/doc/vmware-tools&quot; does not exist currently. This program</span>
<span class="s1">    centos67: is going to create it, including needed parent directories. Is this what you</span>
<span class="s1">    centos67: want? [yes]</span>
<span class="s1">    centos67: The installation of VMware Tools 9.9.4 build-3193940 for Linux completed</span>
<span class="s1">    centos67: successfully. You can decide to remove this software from your system at any</span>
<span class="s1">    centos67: time by invoking the following command: &quot;/usr/bin/vmware-uninstall-tools.pl&quot;.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Before running VMware Tools for the first time, you need to configure it by</span>
<span class="s1">    centos67: invoking the following command: &quot;/usr/bin/vmware-config-tools.pl&quot;. Do you want</span>
<span class="s1">    centos67: this program to invoke the command for you now? [yes]</span>
<span class="s1">    centos67: Initializing...</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Making sure services for VMware Tools are stopped.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Found a compatible pre-built module for vmci.  Installing it...</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Found a compatible pre-built module for vsock.  Installing it...</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: The module vmxnet3 has already been installed on this system by another</span>
<span class="s1">    centos67: installer or package and will not be modified by this installer.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: The module pvscsi has already been installed on this system by another</span>
<span class="s1">    centos67: installer or package and will not be modified by this installer.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: The module vmmemctl has already been installed on this system by another</span>
<span class="s1">    centos67: installer or package and will not be modified by this installer.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: The VMware Host-Guest Filesystem allows for shared folders between the host OS</span>
<span class="s1">    centos67: and the guest OS in a Fusion or Workstation virtual environment.  Do you wish</span>
<span class="s1">    centos67: to enable this feature? [no]</span>
<span class="s1">    centos67: Found a compatible pre-built module for vmhgfs.  Installing it...</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Found a compatible pre-built module for vmxnet.  Installing it...</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: The vmblock enables dragging or copying files between host and guest in a</span>
<span class="s1">    centos67: Fusion or Workstation virtual environment.  Do you wish to enable this feature?</span>
<span class="s1">    centos67: [no]</span>
<span class="s1">    centos67: VMware automatic kernel modules enables automatic building and installation of</span>
<span class="s1">    centos67: VMware kernel modules at boot that are not already present. This feature can be</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: enabled/disabled by re-running vmware-config-tools.pl.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Would you like to enable VMware automatic kernel modules?</span>
<span class="s1">    centos67: [no]</span>
<span class="s1">    centos67: Do you want to enable Guest Authentication (vgauth)? [yes]</span>
<span class="s1">    centos67: No X install found.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Creating a new initrd boot image for the kernel.</span>
<span class="s1">    centos67: vmware-tools-thinprint start/running</span>
<span class="s1">    centos67: vmware-tools start/running</span>
<span class="s1">    centos67: The configuration of VMware Tools 9.9.4 build-3193940 for Linux for this</span>
<span class="s1">    centos67: running kernel completed successfully.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: You must restart your X session before any mouse or graphics changes take</span>
<span class="s1">    centos67: effect.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: You can now run VMware Tools by invoking &quot;/usr/bin/vmware-toolbox-cmd&quot; from the</span>
<span class="s1">    centos67: command line.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: To enable advanced X features (e.g., guest resolution fit, drag and drop, and</span>
<span class="s1">    centos67: file and text copy/paste), you will need to do one (or more) of the following:</span>
<span class="s1">    centos67: 1. Manually start /usr/bin/vmware-user</span>
<span class="s1">    centos67: 2. Log out and log back into your desktop session; and,</span>
<span class="s1">    centos67: 3. Restart your X session.</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: Enjoy,</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: --the VMware team</span>
<span class="s1">    centos67:</span>
<span class="s1">==&gt; centos67: Provisioning with shell script: scripts/centos-vmware-cleanup.sh</span>
<span class="s1">    centos67: ==&gt; Pausing for 0 seconds...</span>
<span class="s1">    centos67: ==&gt; erasing unused packages to free up space</span>
<span class="s1">    centos67: Loaded plugins: fastestmirror</span>
<span class="s1">    centos67: Setting up Remove Process</span>
<span class="s1">    centos67: No Match for argument: gtk2</span>
<span class="s1">    centos67: Loading mirror speeds from cached hostfile</span>
<span class="s1">    centos67: * base: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: * extras: mirror.us.oneandone.net</span>
<span class="s1">    centos67: * updates: dallas.tx.mirror.xygenhosting.com</span>
<span class="s1">    centos67: Package(s) gtk2 available, but not installed.</span>
<span class="s1">    centos67: No Match for argument: libX11</span>
<span class="s1">    centos67: Package(s) libX11 available, but not installed.</span>
<span class="s1">    centos67: No Match for argument: hicolor-icon-theme</span>
<span class="s1">    centos67: Package(s) hicolor-icon-theme available, but not installed.</span>
<span class="s1">    centos67: No Match for argument: avahi</span>
<span class="s1">    centos67: Package(s) avahi available, but not installed.</span>
<span class="s1">    centos67: No Match for argument: freetype</span>
<span class="s1">    centos67: Package(s) freetype available, but not installed.</span>
<span class="s1">    centos67: No Match for argument: bitstream-vera-fonts</span>
<span class="s1">    centos67: No Packages marked for removal</span>
<span class="s1">    centos67: ==&gt; Cleaning up yum cache</span>
<span class="s1">    centos67: Loaded plugins: fastestmirror</span>
<span class="s1">    centos67: Cleaning repos: base extras updates</span>
<span class="s1">    centos67: Cleaning up Everything</span>
<span class="s1">    centos67: Cleaning up list of fastest mirrors</span>
<span class="s1">    centos67: ==&gt; Force logs to rotate</span>
<span class="s1">    centos67: ==&gt; Clear audit log and wtmp</span>
<span class="s1">    centos67: ==&gt; Cleaning up udev rules</span>
<span class="s1">    centos67: ==&gt; Remove the traces of the template MAC address and UUIDs</span>
<span class="s1">    centos67: ==&gt; Cleaning up tmp</span>
<span class="s1">    centos67: ==&gt; Remove the SSH host keys</span>
<span class="s1">    centos67: ==&gt; Remove the root user’s shell history</span>
<span class="s1">    centos67: ==&gt; Installed packages</span>
<span class="s1">    centos67: setup-2.8.14-20.el6_4.1.noarch</span>
<span class="s1">    centos67: basesystem-10.0-4.el6.noarch</span>
<span class="s1">    centos67: kernel-firmware-2.6.32-573.el6.noarch</span>
<span class="s1">    centos67: glibc-common-2.12-1.166.el6.x86_64</span>
<span class="s1">    centos67: glibc-2.12-1.166.el6.x86_64</span>
<span class="s1">    centos67: bash-4.1.2-33.el6.x86_64</span>
<span class="s1">    centos67: libcap-2.16-5.5.el6.x86_64</span>
<span class="s1">    centos67: info-4.13a-8.el6.x86_64</span>
<span class="s1">    centos67: audit-libs-2.3.7-5.el6.x86_64</span>
<span class="s1">    centos67: libacl-2.2.49-6.el6.x86_64</span>
<span class="s1">    centos67: nspr-4.10.8-1.el6_6.x86_64</span>
<span class="s1">    centos67: libselinux-2.0.94-5.8.el6.x86_64</span>
<span class="s1">    centos67: sed-4.2.1-10.el6.x86_64</span>
<span class="s1">    centos67: nss-util-3.18.0-1.el6_6.x86_64</span>
<span class="s1">    centos67: bzip2-libs-1.0.5-7.el6_0.x86_64</span>
<span class="s1">    centos67: libstdc++-4.4.7-16.el6.x86_64</span>
<span class="s1">    centos67: gawk-3.1.7-10.el6.x86_64</span>
<span class="s1">    centos67: libgpg-error-1.7-4.el6.x86_64</span>
<span class="s1">    centos67: libudev-147-2.63.el6.x86_64</span>
<span class="s1">    centos67: grep-2.20-3.el6.x86_64</span>
<span class="s1">    centos67: sqlite-3.6.20-1.el6.x86_64</span>
<span class="s1">    centos67: libidn-1.18-2.el6.x86_64</span>
<span class="s1">    centos67: xz-libs-4.999.9-0.5.beta.20091007git.el6.x86_64</span>
<span class="s1">    centos67: nss-softokn-3.14.3-22.el6_6.x86_64</span>
<span class="s1">    centos67: bzip2-1.0.5-7.el6_0.x86_64</span>
<span class="s1">    centos67: libselinux-utils-2.0.94-5.8.el6.x86_64</span>
<span class="s1">    centos67: cpio-2.10-12.el6_5.x86_64</span>
<span class="s1">    centos67: libxml2-2.7.6-20.el6.x86_64</span>
<span class="s1">    centos67: tcp_wrappers-libs-7.6-57.el6.x86_64</span>
<span class="s1">    centos67: libtasn1-2.3-6.el6_5.x86_64</span>
<span class="s1">    centos67: p11-kit-trust-0.18.5-2.el6_5.2.x86_64</span>
<span class="s1">    centos67: libnih-1.0.1-7.el6.x86_64</span>
<span class="s1">    centos67: file-5.04-21.el6.x86_64</span>
<span class="s1">    centos67: libusb-0.1.12-23.el6.x86_64</span>
<span class="s1">    centos67: libutempter-1.1.5-4.1.el6.x86_64</span>
<span class="s1">    centos67: psmisc-22.6-19.el6_5.x86_64</span>
<span class="s1">    centos67: vim-minimal-7.4.629-5.el6.x86_64</span>
<span class="s1">    centos67: procps-3.2.8-33.el6.x86_64</span>
<span class="s1">    centos67: e2fsprogs-libs-1.41.12-22.el6.x86_64</span>
<span class="s1">    centos67: binutils-2.20.51.0.2-5.43.el6.x86_64</span>
<span class="s1">    centos67: diffutils-2.8.1-28.el6.x86_64</span>
<span class="s1">    centos67: dash-0.5.5.1-4.el6.x86_64</span>
<span class="s1">    centos67: groff-1.18.1.4-21.el6.x86_64</span>
<span class="s1">    centos67: coreutils-libs-8.4-37.el6.x86_64</span>
<span class="s1">    centos67: cracklib-2.8.16-4.el6.x86_64</span>
<span class="s1">    centos67: coreutils-8.4-37.el6.x86_64</span>
<span class="s1">    centos67: module-init-tools-3.9-25.el6.x86_64</span>
<span class="s1">    centos67: redhat-logos-60.0.14-12.el6.centos.noarch</span>
<span class="s1">    centos67: libpciaccess-0.13.3-0.1.el6.x86_64</span>
<span class="s1">    centos67: nss-3.18.0-5.3.el6_6.x86_64</span>
<span class="s1">    centos67: nss-tools-3.18.0-5.3.el6_6.x86_64</span>
<span class="s1">    centos67: libedit-2.11-4.20080712cvs.1.el6.x86_64</span>
<span class="s1">    centos67: mingetty-1.08-5.el6.x86_64</span>
<span class="s1">    centos67: krb5-libs-1.10.3-42.el6.x86_64</span>
<span class="s1">    centos67: libssh2-1.4.2-1.el6_6.1.x86_64</span>
<span class="s1">    centos67: rpm-libs-4.8.0-47.el6.x86_64</span>
<span class="s1">    centos67: rpm-4.8.0-47.el6.x86_64</span>
<span class="s1">    centos67: gnupg2-2.0.14-8.el6.x86_64</span>
<span class="s1">    centos67: fipscheck-lib-1.2.0-7.el6.x86_64</span>
<span class="s1">    centos67: mysql-libs-5.1.73-5.el6_6.x86_64</span>
<span class="s1">    centos67: pciutils-libs-3.1.10-4.el6.x86_64</span>
<span class="s1">    centos67: libcap-ng-0.6.4-3.el6_0.1.x86_64</span>
<span class="s1">    centos67: python-2.6.6-64.el6.x86_64</span>
<span class="s1">    centos67: python-pycurl-7.19.0-8.el6.x86_64</span>
<span class="s1">    centos67: pygpgme-0.1-18.20090824bzr68.el6.x86_64</span>
<span class="s1">    centos67: python-iniparse-0.3.1-2.1.el6.noarch</span>
<span class="s1">    centos67: newt-0.52.11-3.el6.x86_64</span>
<span class="s1">    centos67: ustr-1.0.4-9.1.el6.x86_64</span>
<span class="s1">    centos67: libaio-0.3.107-10.el6.x86_64</span>
<span class="s1">    centos67: gamin-0.1.10-9.el6.x86_64</span>
<span class="s1">    centos67: shared-mime-info-0.70-6.el6.x86_64</span>
<span class="s1">    centos67: grubby-7.0.15-7.el6.x86_64</span>
<span class="s1">    centos67: yum-plugin-fastestmirror-1.1.30-30.el6.noarch</span>
<span class="s1">    centos67: dbus-glib-0.86-6.el6.x86_64</span>
<span class="s1">    centos67: centos-release-6-7.el6.centos.12.3.x86_64</span>
<span class="s1">    centos67: iptables-1.4.7-16.el6.x86_64</span>
<span class="s1">    centos67: iputils-20071127-20.el6.x86_64</span>
<span class="s1">    centos67: initscripts-9.03.49-1.el6.centos.x86_64</span>
<span class="s1">    centos67: device-mapper-libs-1.02.95-2.el6.x86_64</span>
<span class="s1">    centos67: device-mapper-event-libs-1.02.95-2.el6.x86_64</span>
<span class="s1">    centos67: device-mapper-event-1.02.95-2.el6.x86_64</span>
<span class="s1">    centos67: cryptsetup-luks-libs-1.2.0-11.el6.x86_64</span>
<span class="s1">    centos67: kpartx-0.4.9-87.el6.x86_64</span>
<span class="s1">    centos67: plymouth-0.8.3-27.el6.centos.1.x86_64</span>
<span class="s1">    centos67: cyrus-sasl-2.1.23-15.el6_6.2.x86_64</span>
<span class="s1">    centos67: cronie-anacron-1.4.4-15.el6.x86_64</span>
<span class="s1">    centos67: crontabs-1.10-33.el6.noarch</span>
<span class="s1">    centos67: selinux-policy-3.7.19-279.el6.noarch</span>
<span class="s1">    centos67: kbd-1.15-11.el6.x86_64</span>
<span class="s1">    centos67: dracut-kernel-004-388.el6.noarch</span>
<span class="s1">    centos67: fuse-2.8.3-4.el6.x86_64</span>
<span class="s1">    centos67: system-config-firewall-base-1.2.27-7.2.el6_6.noarch</span>
<span class="s1">    centos67: cryptsetup-luks-1.2.0-11.el6.x86_64</span>
<span class="s1">    centos67: openssh-clients-5.3p1-111.el6.x86_64</span>
<span class="s1">    centos67: mdadm-3.3.2-5.el6.x86_64</span>
<span class="s1">    centos67: dhclient-4.1.1-49.P1.el6.centos.x86_64</span>
<span class="s1">    centos67: passwd-0.77-4.el6_2.2.x86_64</span>
<span class="s1">    centos67: grub-0.97-94.el6.x86_64</span>
<span class="s1">    centos67: sudo-1.8.6p3-19.el6.x86_64</span>
<span class="s1">    centos67: e2fsprogs-1.41.12-22.el6.x86_64</span>
<span class="s1">    centos67: acl-2.2.49-6.el6.x86_64</span>
<span class="s1">    centos67: bridge-utils-1.2-10.el6.x86_64</span>
<span class="s1">    centos67: gpg-pubkey-c105b9de-4e0fd3a3</span>
<span class="s1">    centos67: perl-Module-Pluggable-3.90-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: perl-libs-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: perl-5.10.1-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: libgcc-4.4.7-16.el6.x86_64</span>
<span class="s1">    centos67: filesystem-2.4.30-3.el6.x86_64</span>
<span class="s1">    centos67: ncurses-base-5.7-4.20090207.el6.x86_64</span>
<span class="s1">    centos67: tzdata-2015e-1.el6.noarch</span>
<span class="s1">    centos67: nss-softokn-freebl-3.14.3-22.el6_6.x86_64</span>
<span class="s1">    centos67: ncurses-libs-5.7-4.20090207.el6.x86_64</span>
<span class="s1">    centos67: libattr-2.4.44-7.el6.x86_64</span>
<span class="s1">    centos67: zlib-1.2.3-29.el6.x86_64</span>
<span class="s1">    centos67: popt-1.13-7.el6.x86_64</span>
<span class="s1">    centos67: libcom_err-1.41.12-22.el6.x86_64</span>
<span class="s1">    centos67: db4-4.7.25-19.el6_6.x86_64</span>
<span class="s1">    centos67: libsepol-2.0.41-4.el6.x86_64</span>
<span class="s1">    centos67: chkconfig-1.3.49.3-5.el6.x86_64</span>
<span class="s1">    centos67: shadow-utils-4.1.4.2-19.el6_6.1.x86_64</span>
<span class="s1">    centos67: readline-6.0-4.el6.x86_64</span>
<span class="s1">    centos67: libuuid-2.17.2-12.18.el6.x86_64</span>
<span class="s1">    centos67: libblkid-2.17.2-12.18.el6.x86_64</span>
<span class="s1">    centos67: file-libs-5.04-21.el6.x86_64</span>
<span class="s1">    centos67: dbus-libs-1.2.24-8.el6_6.x86_64</span>
<span class="s1">    centos67: pcre-7.8-7.el6.x86_64</span>
<span class="s1">    centos67: lua-5.1.4-4.1.el6.x86_64</span>
<span class="s1">    centos67: cyrus-sasl-lib-2.1.23-15.el6_6.2.x86_64</span>
<span class="s1">    centos67: expat-2.0.1-11.el6_2.x86_64</span>
<span class="s1">    centos67: elfutils-libelf-0.161-3.el6.x86_64</span>
<span class="s1">    centos67: libgcrypt-1.4.5-11.el6_4.x86_64</span>
<span class="s1">    centos67: findutils-4.4.2-6.el6.x86_64</span>
<span class="s1">    centos67: checkpolicy-2.0.22-1.el6.x86_64</span>
<span class="s1">    centos67: which-2.19-6.el6.x86_64</span>
<span class="s1">    centos67: pth-2.0.7-9.3.el6.x86_64</span>
<span class="s1">    centos67: sysvinit-tools-2.87-6.dsf.el6.x86_64</span>
<span class="s1">    centos67: p11-kit-0.18.5-2.el6_5.2.x86_64</span>
<span class="s1">    centos67: device-mapper-persistent-data-0.3.2-1.el6.x86_64</span>
<span class="s1">    centos67: upstart-0.6.5-13.el6_5.3.x86_64</span>
<span class="s1">    centos67: gmp-4.3.1-7.el6_2.2.x86_64</span>
<span class="s1">    centos67: MAKEDEV-3.24-6.el6.x86_64</span>
<span class="s1">    centos67: pinentry-0.7.6-8.el6.x86_64</span>
<span class="s1">    centos67: net-tools-1.60-110.el6_2.x86_64</span>
<span class="s1">    centos67: tar-1.23-13.el6.x86_64</span>
<span class="s1">    centos67: db4-utils-4.7.25-19.el6_6.x86_64</span>
<span class="s1">    centos67: libss-1.41.12-22.el6.x86_64</span>
<span class="s1">    centos67: m4-1.4.13-5.el6.x86_64</span>
<span class="s1">    centos67: make-3.81-20.el6.x86_64</span>
<span class="s1">    centos67: ncurses-5.7-4.20090207.el6.x86_64</span>
<span class="s1">    centos67: less-436-13.el6.x86_64</span>
<span class="s1">    centos67: gzip-1.3.12-22.el6.x86_64</span>
<span class="s1">    centos67: cracklib-dicts-2.8.16-4.el6.x86_64</span>
<span class="s1">    centos67: pam-1.1.1-20.el6.x86_64</span>
<span class="s1">    centos67: hwdata-0.233-14.1.el6.noarch</span>
<span class="s1">    centos67: plymouth-scripts-0.8.3-27.el6.centos.1.x86_64</span>
<span class="s1">    centos67: ca-certificates-2015.2.4-65.0.1.el6_6.noarch</span>
<span class="s1">    centos67: nss-sysinit-3.18.0-5.3.el6_6.x86_64</span>
<span class="s1">    centos67: logrotate-3.7.8-23.el6.x86_64</span>
<span class="s1">    centos67: gdbm-1.8.0-38.el6.x86_64</span>
<span class="s1">    centos67: keyutils-libs-1.4-5.el6.x86_64</span>
<span class="s1">    centos67: openssl-1.0.1e-42.el6.x86_64</span>
<span class="s1">    centos67: libcurl-7.19.7-46.el6.x86_64</span>
<span class="s1">    centos67: curl-7.19.7-46.el6.x86_64</span>
<span class="s1">    centos67: openldap-2.4.40-5.el6.x86_64</span>
<span class="s1">    centos67: gpgme-1.1.8-3.el6.x86_64</span>
<span class="s1">    centos67: fipscheck-1.2.0-7.el6.x86_64</span>
<span class="s1">    centos67: ethtool-3.5-6.el6.x86_64</span>
<span class="s1">    centos67: plymouth-core-libs-0.8.3-27.el6.centos.1.x86_64</span>
<span class="s1">    centos67: libffi-3.0.5-3.2.el6.x86_64</span>
<span class="s1">    centos67: python-libs-2.6.6-64.el6.x86_64</span>
<span class="s1">    centos67: python-urlgrabber-3.9.1-9.el6.noarch</span>
<span class="s1">    centos67: rpm-python-4.8.0-47.el6.x86_64</span>
<span class="s1">    centos67: slang-2.2.1-1.el6.x86_64</span>
<span class="s1">    centos67: newt-python-0.52.11-3.el6.x86_64</span>
<span class="s1">    centos67: libsemanage-2.0.43-5.1.el6.x86_64</span>
<span class="s1">    centos67: pkgconfig-0.23-9.1.el6.x86_64</span>
<span class="s1">    centos67: glib2-2.28.8-4.el6.x86_64</span>
<span class="s1">    centos67: libuser-0.56.13-5.el6.x86_64</span>
<span class="s1">    centos67: yum-metadata-parser-1.1.2-16.el6.x86_64</span>
<span class="s1">    centos67: yum-3.2.29-69.el6.centos.noarch</span>
<span class="s1">    centos67: dhcp-common-4.1.1-49.P1.el6.centos.x86_64</span>
<span class="s1">    centos67: policycoreutils-2.0.83-24.el6.x86_64</span>
<span class="s1">    centos67: iproute-2.6.32-45.el6.x86_64</span>
<span class="s1">    centos67: util-linux-ng-2.17.2-12.18.el6.x86_64</span>
<span class="s1">    centos67: udev-147-2.63.el6.x86_64</span>
<span class="s1">    centos67: device-mapper-1.02.95-2.el6.x86_64</span>
<span class="s1">    centos67: openssh-5.3p1-111.el6.x86_64</span>
<span class="s1">    centos67: lvm2-libs-2.02.118-2.el6.x86_64</span>
<span class="s1">    centos67: device-mapper-multipath-libs-0.4.9-87.el6.x86_64</span>
<span class="s1">    centos67: libdrm-2.4.59-2.el6.x86_64</span>
<span class="s1">    centos67: rsyslog-5.8.10-10.el6_6.x86_64</span>
<span class="s1">    centos67: postfix-2.6.6-6.el6_5.x86_64</span>
<span class="s1">    centos67: cronie-1.4.4-15.el6.x86_64</span>
<span class="s1">    centos67: iptables-ipv6-1.4.7-16.el6.x86_64</span>
<span class="s1">    centos67: kbd-misc-1.15-11.el6.noarch</span>
<span class="s1">    centos67: dracut-004-388.el6.noarch</span>
<span class="s1">    centos67: kernel-2.6.32-573.el6.x86_64</span>
<span class="s1">    centos67: selinux-policy-targeted-3.7.19-279.el6.noarch</span>
<span class="s1">    centos67: device-mapper-multipath-0.4.9-87.el6.x86_64</span>
<span class="s1">    centos67: lvm2-2.02.118-2.el6.x86_64</span>
<span class="s1">    centos67: openssh-server-5.3p1-111.el6.x86_64</span>
<span class="s1">    centos67: b43-openfwwf-5.2-10.el6.noarch</span>
<span class="s1">    centos67: iscsi-initiator-utils-6.2.0.873-14.el6.x86_64</span>
<span class="s1">    centos67: authconfig-6.1.12-23.el6.x86_64</span>
<span class="s1">    centos67: efibootmgr-0.5.4-13.el6.x86_64</span>
<span class="s1">    centos67: audit-2.3.7-5.el6.x86_64</span>
<span class="s1">    centos67: xfsprogs-3.1.1-16.el6.x86_64</span>
<span class="s1">    centos67: attr-2.4.44-7.el6.x86_64</span>
<span class="s1">    centos67: rootfiles-8.1-6.1.el6.noarch</span>
<span class="s1">    centos67: perl-Pod-Escapes-1.04-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: perl-version-0.77-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: perl-Pod-Simple-3.13-141.el6_7.1.x86_64</span>
<span class="s1">    centos67: fuse-libs-2.8.3-4.el6.x86_64</span>
<span class="s1">    centos67: ==&gt; yum -y clean all</span>
<span class="s1">    centos67: Loaded plugins: fastestmirror</span>
<span class="s1">    centos67: Cleaning repos: base extras updates</span>
<span class="s1">    centos67: Cleaning up Everything</span>
<span class="s1">    centos67: /</span>
<span class="s1">    centos67: 25211696</span>
<span class="s1">    centos67: /tmp/script_7943.sh: line 62: bc: command not found</span>
<span class="s1">    centos67:</span>
<span class="s1">    centos67: dd: invalid number `&#39;</span>
    centos67: /boot
    centos67: 60474
    centos67: /tmp/script_7943.sh: line 62: bc: <span class="nb">command </span>not found
    centos67:
    centos67: dd: invalid number <span class="sb">`</span><span class="s1">&#39;</span>
<span class="s1">    centos67: /tmp/script_7943.sh: line 70: /usr/sbin/vgdisplay: No such file or directory</span>
<span class="s1">    centos67: ==&gt; Zero out the free space to save space in the final image</span>
<span class="s1">    centos67: dd: writing `/EMPTY&#39;</span>: No space left on device
    centos67: 12970+0 records in
    centos67: 12969+0 records out
    centos67: <span class="m">13599232000</span> bytes <span class="o">(</span><span class="m">14</span> GB<span class="o">)</span> copied, 413.4 s, 32.9 MB/s
<span class="o">==</span>&gt; centos67: Gracefully halting virtual machine...
    centos67: Waiting <span class="k">for</span> VMware to clean up after itself...
<span class="o">==</span>&gt; centos67: Deleting unnecessary VMware files...
    centos67: Deleting: /vmfs/volumes/datastore1/output-centos67/vmware.log
<span class="o">==</span>&gt; centos67: Cleaning VMX prior to finishing up...
    centos67: Unmounting floppy from VMX...
    centos67: Detaching ISO from CD-ROM device...
    centos67: Disabling VNC server...
<span class="o">==</span>&gt; centos67: Compacting the disk <span class="nv">image</span>
<span class="o">==</span>&gt; centos67: Unregistering virtual machine...
Build <span class="s1">&#39;centos67&#39;</span> finished.

<span class="o">==</span>&gt; Builds finished. The artifacts of successful builds are:
--&gt; centos67: VM files in directory: /vmfs/volumes/datastore1/output-centos67
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>The output of the packer build command shows that the template was successfully created at /vmfs/volumes/datastore1/output-centos67, but the virtual machine was unregistered from ESXi.</p>

<h3>This seems like a good point to take break. We covered a lot of ground in this post, but as a result of all our work we have a working Packer template to build on.</h3>

<h3>If you would like to not have to manually create the files covered in this post, you can clone down <a href="https://github.com/sdorsett/packer-templates/tree/first-packer-template">this github repository</a> by running the following command:</h3>

<pre>
git clone -b "first-packer-template" https://github.com/sdorsett/packer-templates.git
</pre>  

<h3>You will still need to create the iso/ directory, download the needed .iso files and create the packer-remote-info.json file as covered in this post.</h3>

<h3>In the next post we will extend what was covered in this post by installing the Puppet agent in Packer image.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/24/installing-packer-and-ovftool-on-centos/">
        Setting up Packer, ovftool and Apache web server on a CentOS virtual machine
      </a>
    </h1>

    <span class="post-date">24 Dec 2015</span>

    <p>In the <a href="https://sdorsett.github.io/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">last post</a> we setup a ESXi virtual machine that would be the target for creating Packer images. In order to follow along with this post you will need two things:</p>

<ul>
<li>A fresh CentOS virtual machine on which we will install Packer - I&#39;m using CentOS 6.6 minimal install named &quot;packer-centos&quot; with 2 vCPU, 4GB of memory and a 100GB virtual hard drive. I also gave this virtual machine the IP address of 192.168.1.52</li>
<li><a href="https://my.vmware.com/web/vmware/details?productId=491&amp;downloadGroup=OVFTOOL410">VMware ovftool</a> - if you followed the previous post and are using ESXi 6.0 you will need a copy of ovftool 4.1.</li>
</ul>

<p>Let&#39;s get started...</p>

<h2>1. SSH to CentOS virtual machine you created.</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett<span class="nv">$ </span>ssh root@192.168.1.52
The authenticity of host <span class="s1">&#39;192.168.1.52 (192.168.1.52)&#39;</span> cant be established.
RSA key fingerprint is 58:f5:22:2e:f6:64:04:59:6b:0b:76:2f:33:6f:03:85.
Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no<span class="o">)</span>? yes
Warning: Permanently added <span class="s1">&#39;192.168.1.52&#39;</span> <span class="o">(</span>RSA<span class="o">)</span> to the list of known hosts.
root@192.168.1.52<span class="err">&#39;</span>s password:
Last login: Thu Oct <span class="m">22</span> 17:52:17 <span class="m">2015</span> from 192.168.1.1
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>2. Install the EPEL repository</h2>

<p>There will be several package we need to install that are coming from the CentOS EPEL repository, so we will need to install it.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># yum install -y epel-release</span>
Loaded plugins: fastestmirror
Setting up Install Process
Determining fastest mirrors
 * base: yum.tamu.edu
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
base
base/primary_db
extras
extras/primary_db
updates
updates/primary_db
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package epel-release.noarch 0:6-8 will be installed
--&gt; Finished Dependency Resolution

Dependencies <span class="nv">Resolved</span>

<span class="o">=============================================================</span>
 Package          Arch       Version     Repository     <span class="nv">Size</span>
<span class="o">=============================================================</span>
Installing:
 epel-release     noarch     6-8         extras         <span class="m">14</span> k

Transaction <span class="nv">Summary</span>
<span class="o">=============================================================</span>
Install       <span class="m">1</span> Package<span class="o">(</span>s<span class="o">)</span>

Total download size: <span class="m">14</span> k
Installed size: <span class="m">22</span> k
Downloading Packages:
epel-release-6-8.noarch.rpm     <span class="p">|</span>  <span class="m">14</span> kB     00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : epel-release-6-8.noarch     1/1
  Verifying  : epel-release-6-8.noarch     1/1

Installed:
  epel-release.noarch 0:6-8

Complete!

<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>3. Use yum to make sure the following packages are installed:</h2>

<ul>
<li>git - for version control and the ability to pull down git repositories</li>
<li>wget - provides the ability to download packages from URLs</li>
<li>unzip - needed to unzip Packer, since it comes as a .zip</li>
<li>sshpass - used for running SSH commands, but it allows us to specify a password to use</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># yum install -y git wget unzip sshpass</span>
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: fedora-epel.mirror.lstn.net
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Package git-1.7.1-3.el6_4.1.x86_64 already installed and latest version
Package wget-1.12-5.el6_6.1.x86_64 already installed and latest version
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package sshpass.x86_64 0:1.05-1.el6 will be installed
---&gt; Package unzip.x86_64 0:6.0-2.el6_6 will be installed
--&gt; Finished Dependency Resolution

Dependencies <span class="nv">Resolved</span>

<span class="o">============================================================</span>
 Package     Arch       Version        Repository     <span class="nv">Size</span>
<span class="o">============================================================</span>
Installing:
 sshpass     x86_64     1.05-1.el6     epel           <span class="m">19</span> k
 unzip       x86_64     6.0-2.el6_6    base           <span class="m">149</span> k

Transaction <span class="nv">Summary</span>
<span class="o">============================================================</span>
Install       <span class="m">2</span> Package<span class="o">(</span>s<span class="o">)</span>

Total download size: <span class="m">168</span> k
Installed size: <span class="m">346</span> k
Downloading Packages:
<span class="o">(</span>1/2<span class="o">)</span>: sshpass-1.05-1.el6.x86_64.rpm     <span class="p">|</span>  <span class="m">19</span> kB     00:00
<span class="o">(</span>2/2<span class="o">)</span>: unzip-6.0-2.el6_6.x86_64.rpm      <span class="p">|</span> <span class="m">149</span> kB     00:00
------------------------------------------------------------
Total                                                                                                                                                                     <span class="m">593</span> kB/s <span class="p">|</span> <span class="m">168</span> kB     00:00
warning: rpmts_HdrFromFdno: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
Importing GPG key 0x0608B895:
 Userid : EPEL <span class="o">(</span>6<span class="o">)</span> &lt;epel@fedoraproject.org&gt;
 Package: epel-release-6-8.noarch <span class="o">(</span>@extras<span class="o">)</span>
 From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : sshpass-1.05-1.el6.x86_64     1/2
  Installing : unzip-6.0-2.el6_6.x86_64      2/2
  Verifying  : unzip-6.0-2.el6_6.x86_64      1/2
  Verifying  : sshpass-1.05-1.el6.x86_64     2/2

Installed:
  sshpass.x86_64 0:1.05-1.el6     unzip.x86_64 0:6.0-2.el6_6

Complete!
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>4. Install Packer</h2>

<p>Go to <a href="https://packer.io/downloads.html">https://packer.io/downloads.html</a> and copy the URL for the Linux 64-bit package. In the SSH session to our CentOS virtual machine, perform the following steps:</p>

<p>Create a new directory to install packer into</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># mkdir /usr/local/packer_0.8.6</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>Download Packer using the URL you copied from the packer.io download page:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># wget https://releases.hashicorp.com/packer/0.8.6/packer_0.8.6_linux_amd64.zip</span>
--2015-12-23 17:22:03--  https://releases.hashicorp.com/packer/0.8.6/packer_0.8.6_linux_amd64.zip
Resolving releases.hashicorp.com... 23.235.44.69
Connecting to releases.hashicorp.com<span class="p">|</span>23.235.44.69<span class="p">|</span>:443... connected.
HTTP request sent, awaiting response... <span class="m">200</span> OK
Length: <span class="m">132616691</span> <span class="o">(</span>126M<span class="o">)</span> <span class="o">[</span>application/zip<span class="o">]</span>
Saving to: “packer_0.8.6_linux_amd64.zip”

100%<span class="o">[====================================</span>&gt;<span class="o">]</span> 132,616,691 6.97M/s   in 18s

2015-12-23 17:22:22 <span class="o">(</span>6.95 MB/s<span class="o">)</span> - “packer_0.8.6_linux_amd64.zip” saved <span class="o">[</span>132616691/132616691<span class="o">]</span>

<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># unzip packer_0.8.6_linux_amd64.zip -d /usr/local/packer_8.6/</span>
Archive:  packer_0.8.6_linux_amd64.zip
  inflating: /usr/local/packer_8.6/packer
  inflating: /usr/local/packer_8.6/packer-builder-amazon-chroot
  inflating: /usr/local/packer_8.6/packer-builder-amazon-ebs
  inflating: /usr/local/packer_8.6/packer-builder-amazon-instance
  inflating: /usr/local/packer_8.6/packer-builder-digitalocean
  inflating: /usr/local/packer_8.6/packer-builder-docker
  inflating: /usr/local/packer_8.6/packer-builder-file
  inflating: /usr/local/packer_8.6/packer-builder-googlecompute
  inflating: /usr/local/packer_8.6/packer-builder-null
  inflating: /usr/local/packer_8.6/packer-builder-openstack
  inflating: /usr/local/packer_8.6/packer-builder-parallels-iso
  inflating: /usr/local/packer_8.6/packer-builder-parallels-pvm
  inflating: /usr/local/packer_8.6/packer-builder-qemu
  inflating: /usr/local/packer_8.6/packer-builder-virtualbox-iso
  inflating: /usr/local/packer_8.6/packer-builder-virtualbox-ovf
  inflating: /usr/local/packer_8.6/packer-builder-vmware-iso
  inflating: /usr/local/packer_8.6/packer-builder-vmware-vmx
  inflating: /usr/local/packer_8.6/packer-post-processor-artifice
  inflating: /usr/local/packer_8.6/packer-post-processor-atlas
  inflating: /usr/local/packer_8.6/packer-post-processor-compress
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-import
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-push
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-save
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-tag
  inflating: /usr/local/packer_8.6/packer-post-processor-vagrant
  inflating: /usr/local/packer_8.6/packer-post-processor-vagrant-cloud
  inflating: /usr/local/packer_8.6/packer-post-processor-vsphere
  inflating: /usr/local/packer_8.6/packer-provisioner-ansible-local
  inflating: /usr/local/packer_8.6/packer-provisioner-chef-client
  inflating: /usr/local/packer_8.6/packer-provisioner-chef-solo
  inflating: /usr/local/packer_8.6/packer-provisioner-file
  inflating: /usr/local/packer_8.6/packer-provisioner-powershell
  inflating: /usr/local/packer_8.6/packer-provisioner-puppet-masterless
  inflating: /usr/local/packer_8.6/packer-provisioner-puppet-server
  inflating: /usr/local/packer_8.6/packer-provisioner-salt-masterless
  inflating: /usr/local/packer_8.6/packer-provisioner-shell
  inflating: /usr/local/packer_8.6/packer-provisioner-shell-local
  inflating: /usr/local/packer_8.6/packer-provisioner-windows-restart
  inflating: /usr/local/packer_8.6/packer-provisioner-windows-shell
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>Update ~/.bashrc to add &quot;/usr/local/packer_8.6&quot; to our path. Run &quot;source ~/.bashrc&quot; to re-read ~/.bashrc and validate $PATH has been updated.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># echo &#39;export PATH=&quot;/usr/local/packer_8.6:$PATH&quot;&#39; &gt;&gt; ~/.bashrc</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># source ~/.bashrc</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># echo $PATH</span>
/usr/local/packer_8.6:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>Ensure the packer binary can be found and is showing the proper version</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># which packer</span>
/usr/local/packer_8.6/packer
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># packer -v</span>
0.8.6
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>5. Stop the iptables firewall and disable it from started on reboot of the virtual machine</h2>

<p>Packer will start a web server service for providing kickstart and script files to Packer images during install. This service will use a random port within a range, so we will need to stop iptables in order to allow the Packer images to connect.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># service iptables stop</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># chkconfig iptables off</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>6. Install ovftool on the CentOS virtual machine</h2>

<p>Download linux 64bit version of ovftool 4.1 on your local machine</p>

<p><img src="/assets/01-download-ovftool-linux-64bit.png" alt="screenshot">  </p>

<p>SCP the downloaded file to the CentOS virtual machine</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett<span class="nv">$ </span>scp ~/Downloads/VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle root@192.168.1.52:/root/
root@192.168.1.52<span class="err">&#39;</span>s password:
VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle                    100%   37MB  12.4MB/s   00:03
sdorsett-mbp:~ sdorsett<span class="err">$</span></code></pre></div>

<p>Install ovftool on the CentOS virtual machine and validate the version</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># ls</span>
anaconda-ks.cfg  install.log  install.log.syslog  packer_0.8.6_linux_amd64.zip  VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># ./VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle</span>
Extracting VMware Installer...done.
You must accept the VMware OVF Tool component <span class="k">for</span> Linux End User
License Agreement to <span class="k">continue</span>.  Press Enter to proceed.
VMWARE END USER LICENSE AGREEMENT

PLEASE NOTE THAT THE TERMS OF THIS END USER LICENSE AGREEMENT SHALL GOVERN YOUR
USE OF THE SOFTWARE, REGARDLESS OF ANY TERMS THAT MAY APPEAR DURING THE
INSTALLATION OF THE SOFTWARE.

IMPORTANT-READ CAREFULLY:   BY DOWNLOADING, INSTALLING, OR USING THE SOFTWARE,
YOU <span class="o">(</span>THE INDIVIDUAL OR LEGAL ENTITY<span class="o">)</span> AGREE TO BE BOUND BY THE TERMS OF THIS END
USER LICENSE AGREEMENT <span class="o">(</span><span class="s2">&quot;EULA&quot;</span><span class="o">)</span>.  IF YOU DO NOT AGREE TO THE TERMS OF THIS
EULA, YOU MUST NOT DOWNLOAD, INSTALL, OR USE THE SOFTWARE, AND YOU MUST DELETE
OR RETURN THE UNUSED SOFTWARE TO THE VENDOR FROM WHICH YOU ACQUIRED IT WITHIN
THIRTY <span class="o">(</span>30<span class="o">)</span> DAYS AND REQUEST A REFUND OF THE LICENSE FEE, IF ANY, THAT YOU PAID
FOR THE SOFTWARE.
...

Do you agree? <span class="o">[</span>yes/no<span class="o">]</span>: yes

The product is ready to be installed.  Press Enter to begin
installation or Ctrl-C to cancel.

Installing VMware OVF Tool component <span class="k">for</span> Linux 4.1.0
    Configuring...
<span class="o">[</span><span class="c">######################################################################] 100%</span>
Installation was successful.
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># which ovftool</span>
/usr/bin/ovftool
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># ovftool -v</span>
VMware ovftool 4.1.0 <span class="o">(</span>build-2459827<span class="o">)</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>7. Install apache web server on the CentOS virtual machine</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># yum install -y httpd</span>
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: fedora-epel.mirror.lstn.net
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package httpd.x86_64 0:2.2.15-47.el6.centos.1 will be installed
--&gt; Processing Dependency: httpd-tools <span class="o">=</span> 2.2.15-47.el6.centos.1 <span class="k">for</span> package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: apr-util-ldap <span class="k">for</span> package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: /etc/mime.types <span class="k">for</span> package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: libaprutil-1.so.0<span class="o">()(</span>64bit<span class="o">)</span> <span class="k">for</span> package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: libapr-1.so.0<span class="o">()(</span>64bit<span class="o">)</span> <span class="k">for</span> package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Running transaction check
---&gt; Package apr.x86_64 0:1.3.9-5.el6_2 will be installed
---&gt; Package apr-util.x86_64 0:1.3.9-3.el6_0.1 will be installed
---&gt; Package apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1 will be installed
---&gt; Package httpd-tools.x86_64 0:2.2.15-47.el6.centos.1 will be installed
---&gt; Package mailcap.noarch 0:2.1.31-2.el6 will be installed
--&gt; Finished Dependency Resolution

Dependencies <span class="nv">Resolved</span>

<span class="o">======================================================================</span>
 Package        Arch       Version                  Repository   <span class="nv">Size</span>
<span class="o">======================================================================</span>
Installing:
 httpd          x86_64     2.2.15-47.el6.centos.1   updates      <span class="m">830</span> k
Installing <span class="k">for</span> dependencies:
 apr            x86_64     1.3.9-5.el6_2            base         <span class="m">123</span> k
 apr-util       x86_64     1.3.9-3.el6_0.1          base         <span class="m">87</span> k
 apr-util-ldap  x86_64     1.3.9-3.el6_0.1          base         <span class="m">15</span> k
 httpd-tools    x86_64     2.2.15-47.el6.centos.1   updates      <span class="m">77</span> k
 mailcap        noarch     2.1.31-2.el6             base         <span class="m">27</span> k

Transaction <span class="nv">Summary</span>
<span class="o">======================================================================</span>
Install       <span class="m">6</span> Package<span class="o">(</span>s<span class="o">)</span>

Total download size: 1.1 M
Installed size: 3.6 M
Downloading Packages:
<span class="o">(</span>1/6<span class="o">)</span>: apr-1.3.9-5.el6_2.x86_64.rpm                   <span class="p">|</span> <span class="m">123</span> kB  00:00
<span class="o">(</span>2/6<span class="o">)</span>: apr-util-1.3.9-3.el6_0.1.x86_64.rpm            <span class="p">|</span>  <span class="m">87</span> kB  00:00
<span class="o">(</span>3/6<span class="o">)</span>: apr-util-ldap-1.3.9-3.el6_0.1.x86_64.rpm       <span class="p">|</span>  <span class="m">15</span> kB  00:00
<span class="o">(</span>4/6<span class="o">)</span>: httpd-2.2.15-47.el6.centos.1.x86_64.rpm        <span class="p">|</span> <span class="m">830</span> kB  00:00
<span class="o">(</span>5/6<span class="o">)</span>: httpd-tools-2.2.15-47.el6.centos.1.x86_64.rpm  <span class="p">|</span>  <span class="m">77</span> kB  00:00
<span class="o">(</span>6/6<span class="o">)</span>: mailcap-2.1.31-2.el6.noarch.rpm                <span class="p">|</span>  <span class="m">27</span> kB  00:00
----------------------------------------------------------------------
Total                                        <span class="m">711</span> kB/s <span class="p">|</span> 1.1 MB  00:01
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : apr-1.3.9-5.el6_2.x86_64                         1/6
  Installing : apr-util-1.3.9-3.el6_0.1.x86_64                  2/6
  Installing : httpd-tools-2.2.15-47.el6.centos.1.x86_64        3/6
  Installing : apr-util-ldap-1.3.9-3.el6_0.1.x86_64             4/6
  Installing : mailcap-2.1.31-2.el6.noarch                      5/6
  Installing : httpd-2.2.15-47.el6.centos.1.x86_64              6/6
  Verifying  : httpd-tools-2.2.15-47.el6.centos.1.x86_64        1/6
  Verifying  : httpd-2.2.15-47.el6.centos.1.x86_64              2/6
  Verifying  : apr-util-ldap-1.3.9-3.el6_0.1.x86_64             3/6
  Verifying  : apr-1.3.9-5.el6_2.x86_64                         4/6
  Verifying  : mailcap-2.1.31-2.el6.noarch                      5/6
  Verifying  : apr-util-1.3.9-3.el6_0.1.x86_64                  6/6

Installed:
  httpd.x86_64 0:2.2.15-47.el6.centos.1

Dependency Installed:
  apr.x86_64 0:1.3.9-5.el6_2    apr-util.x86_64 0:1.3.9-3.el6_0.1    
  apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1  httpd-tools.x86_64 0:2.2.15-47.el6.centos.1     
  mailcap.noarch 0:2.1.31-2.el6

Complete!
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>7. Remove the apache welcome.conf, to enable directory browsing, and start the httpd service</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># rm /etc/httpd/conf.d/welcome.conf</span>
rm: remove regular file <span class="s1">&#39;/etc/httpd/conf.d/welcome.conf&#39;</span>? y
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># service httpd start</span>
Starting httpd:                                            <span class="o">[</span>  OK  <span class="o">]</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>8. create the directory /var/www/html/box-files and test that the directory is visible in a browser</h2>

<p>Create the /var/www/hmlt/box-files/ directory and an empty test-file.txt</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># mkdir /var/www/html/box-files</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># touch /var/www/html/box-files/test-file.txt</span>
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>Open the ip address of the CentOS virtual machine in a browser and verify that the test-file.txt is visible</p>

<p><img src="/assets/02-browse-apache-box-file-directory.png" alt="screenshot">  </p>

<p>Delete /var/www/html/box-files/test-file.txt, since it will not be needed:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c"># rm /var/www/html/box-files/test-file.txt</span>
rm: remove regular empty file <span class="s1">&#39;/var/www/html/box-files/test-file.txt&#39;</span>? y
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<h3>That all for this post covering how to install Packer, ovftool and Apache web server on a CentOS virtual machine. In the next post we will create a Packer template that uses what we have setup so far.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">
        Installing a ESXi 6.0 virtual machine for use with Packer
      </a>
    </h1>

    <span class="post-date">23 Dec 2015</span>

    <p>In order to begin using Packer to create images, we will first need to lay the &quot;virtual&quot; ground work. Packer can create virtual machine images on a wide variety of virtualization or cloud platforms, but since I work for VMware I have been using the ESXi hypervisor.</p>

<ul>
<li>This post will be covering installing ESXi as a virtual machine on a vSphere cluster. There is no reason that you couldn&#39;t use Packer with a stand alone physical server that has ESXi installed as well.</li>
<li>These steps were performed using the vCenter 6.0 web client. You could just as well use ESXi 5 with the C# client, but the steps for setting up nested virtualization will be slightly different.</li>
<li>There is nothing new about the steps being covered, but I figured it would be best to go ahead and document them.</li>
<li>If you are looking for the best resources regarding running ESXi in a virtual machine, I would suggest taking a look at <a href="http://www.virtuallyghetto.com/">William Lam&#39;s blog</a> which covers this subject in great detail. Williams site also provides more details about the embedded host client we will be using.</li>
</ul>

<p>Let&#39;s get started...</p>

<h2>1. Log into the web client of your vCenter instance and create a new virtual machine.</h2>

<p>We first need to create a new virtual machine inside of which we will install the ESXi 6.0 hypervisor.</p>

<p><img src="/assets/01-new-virtual-machine.jpg" alt="screenshot">  </p>

<h2>2. Step through the new virtual machine wizard:</h2>

<p><img src="/assets/02-create-new-virtual-machine.jpg" alt="screenshot">  </p>

<p>Name the virtual machine what you would like and click next. I named mine &quot;packer-esxi&quot;.</p>

<p><img src="/assets/03-virtual-machine-name.jpg" alt="screenshot">  </p>

<p>Select the vCenter cluster or resource pool the virtual machine will reside in and click next.</p>

<p><img src="/assets/04-select-compute-resource.jpg" alt="screenshot">  </p>

<p>Select the datastore you want the ESXi virtual machine to be created on and click next. I&#39;m using a local datastore on one of my physical ESXi hosts, to prevent Packer from using storage shared across the entire cluster.</p>

<p><img src="/assets/05-select-storage.jpg" alt="screenshot">  </p>

<p>Select the compatibility (virtual hardware level) for the virtual machine and click next. I kept with the default of version 11.</p>

<p><img src="/assets/06-select-compatibility.jpg" alt="screenshot">  </p>

<p>Select the guest operating system. vSphere 6.0 or newer will allow you to select ESXi 6.0 as you guest OS. Click next. This is where things will be different if you are using vSphere 5.0 and the c# client since you will only have ESXi 5.0 listed as an option.</p>

<p><img src="/assets/07-select-guest-os.jpg" alt="screenshot">  </p>

<p>Customize to virtual hardware to have the necessary resources. I had created my ESXi vurtual machine with:</p>

<ul>
<li>2 vCPU</li>
<li>16 GB of memory</li>
<li>100GB virtual hard drive</li>
</ul>

<p><img src="/assets/08-customize-hardware.jpg" alt="screenshot">  </p>

<p>Make sure you expand CPU and enable &quot;Hardware virtualization.&quot; The ESXi installer will fail if this is not enabled.</p>

<p><img src="/assets/09-customize-hardware.jpg" alt="screenshot">  </p>

<p>Click finish to create the virtual machine.</p>

<p><img src="/assets/10-ready-to-complete.jpg" alt="screenshot">  </p>

<h2>3. Enable promiscuous mode on virtual porgroup being used by ESXi virtual machine</h2>

<p>You will need to ensure the portgroup (virtual network) you are connecting the ESXi virtual machine to has promiscuous mode enabled. Enabling promiscuous mode is required for the ESXi virtual machine to pass traffic to the child virtual machines running on it.</p>

<p><img src="/assets/29-enable-protgroup-promiscuous-mode.png" alt="screenshot"></p>

<h2>4. Connect the virtual CDROM of the ESXi virtual machine to the ESXi 6.0 installer .iso and power it on.</h2>

<p><img src="/assets/11-start-esxi-vm.jpg" alt="screenshot">  </p>

<h2>5. Connect to the console of the ESXi virtual machine and step through the installer</h2>

<p>Press enter to begin</p>

<p><img src="/assets/12-esxi-installer.jpg" alt="screenshot">  </p>

<p>Press F11 to accept the EULA</p>

<p><img src="/assets/13-esxi-installer.jpg" alt="screenshot">  </p>

<p>Select the 100GB virtual hard drive we created with the virtual machine</p>

<p><img src="/assets/14-esxi-installer.jpg" alt="screenshot">  </p>

<p>Select your keyboard layout and press enter</p>

<p><img src="/assets/15-esxi-installer.jpg" alt="screenshot">  </p>

<p>Enter the root password twice and press enter</p>

<p><img src="/assets/16-esxi-installer.jpg" alt="screenshot">  </p>

<p><img src="/assets/17-esxi-installer.jpg" alt="screenshot">  </p>

<p>Press F11 to begin the install process</p>

<p><img src="/assets/18-esxi-installer.jpg" alt="screenshot">  </p>

<p>Disconnect the .iso file from the virtual CDROM before rebooting the virtual machine</p>

<p><img src="/assets/19-esxi-installer.jpg" alt="screenshot">  </p>

<p><img src="/assets/20-esxi-installer.jpg" alt="screenshot">  </p>

<p><img src="/assets/21-esxi-post-install.jpg" alt="screenshot">  </p>

<h2>6. Press F2 to log into ESXi and make the following changes:</h2>

<ul>
<li>Set the management IP address, subnet mask and gateway</li>
<li>Set the hostname, dns servers and search domain</li>
<li>Enable ssh</li>
</ul>

<p><img src="/assets/22-set-ip-address.jpg" alt="screenshot">  </p>

<p><img src="/assets/23-apply-network-config.jpg" alt="screenshot">  </p>

<p><img src="/assets/24-enable-ssh.jpg" alt="screenshot">  </p>

<h2>7. On your local machine download the embedded host client .vib</h2>

<p>The embedded host client is a VMware fling that allows you to manage an ESXi host from a browser, without needing the #c client or vCenter. You can download the embedded host client .vib from <a href="https://labs.vmware.com/flings/esxi-embedded-host-client">this link</a>.</p>

<p><img src="/assets/25-download-embedded-host-client.jpg" alt="screenshot">  </p>

<h2>8. SCP the downloaded .vib to the ESXi virtual machine</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett<span class="nv">$ </span>scp ~/Downloads/esxui_signed.vib root@192.168.1.51:/tmp/
The authenticity of host <span class="s1">&#39;192.168.1.51 (192.168.1.51)&#39;</span> cant be established.
RSA key fingerprint is 82:e9:6b:9e:9d:ac:d7:8a:65:e2:9e:bf:60:fc:2b:df.
Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no<span class="o">)</span>? yes
Warning: Permanently added <span class="s1">&#39;192.168.1.51&#39;</span> <span class="o">(</span>RSA<span class="o">)</span> to the list of known hosts.
Password: ********
esxui_signed.vib                                                                                                                                100% 2805KB   2.7MB/s   00:00
sdorsett-mbp:~ sdorsett<span class="err">$</span></code></pre></div>

<h2>9. SSH to the ESXi virtual machine and install the embedded host client .vib</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett<span class="nv">$ </span>ssh root@192.168.1.51
Password: ********
The <span class="nb">time </span>and date of this login have been sent to the system logs.

VMware offers supported, powerful system administration tools.  Please
see www.vmware.com/go/sysadmintools <span class="k">for</span> details.

The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation <span class="k">for</span> more information.

<span class="o">[</span>root@packer-esxi:~<span class="o">]</span> <span class="nb">cd </span>tmp
<span class="o">[</span>root@packer-esxi:/tmp<span class="o">]</span> ls
esxui_signed.vib  nfsgssd_krb5cc    probe.session     vmware-root

<span class="o">[</span>root@packer-esxi:/tmp<span class="o">]</span> esxcli software vib install -v /tmp/esxui_signed.vib
Installation Result
   Message: Operation finished successfully.
   Reboot Required: <span class="nb">false</span>
<span class="nb">   </span>VIBs Installed: VMware_bootbank_esx-ui_0.0.2-0.1.3357452
   VIBs Removed:
   VIBs Skipped:

<span class="o">[</span>root@packer-esxi:/tmp<span class="o">]</span></code></pre></div>

<h2>10. Enable guest ip hack on the ESXi virtual machine</h2>

<p>The <a href="https://www.packer.io/docs/builders/vmware-iso.html">Packer VMware .iso builder documentation</a> lists the following esxcli command as needing to be run on the ESXi virtual machine:</p>

<p><img src="/assets/28-enable-guest-ip-hack.jpg" alt="screenshot">  </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@packer-esxi:/tmp<span class="o">]</span> esxcli system settings advanced <span class="nb">set</span> -o /Net/GuestIPHack -i 1
<span class="o">[</span>root@packer-esxi:/tmp<span class="o">]</span> <span class="nb">exit</span>
Connection to 192.168.1.51 closed.
sdorsett-mbp:~ sdorsett<span class="err">$</span></code></pre></div>

<h2>11. Log into the embedded host client to validate that it it working properly</h2>

<p>Open a browser on your local machine and go to https://[ESXi-virtual-machine-ip-address]/ui<br>
Accept any certificate warnings and log in using root as the username and the password you entered while installing ESXi.</p>

<p><img src="/assets/26-embedded-host-client.jpg" alt="screenshot">  </p>

<p>Under Storage | Datastores we can see a datastore name &quot;datastore1&quot; was automatically created using the extra space of the virtual hard drive.</p>

<p><img src="/assets/27-embedded-host-client.jpg" alt="screenshot">  </p>

<h3>That all for this post covering how to create a ESXi virtual machine that we will use to create Packer images.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/22/pipeline-for-creating-packer-box-files/">
        Setting up a pipeline for creating Packer .box files
      </a>
    </h1>

    <span class="post-date">22 Dec 2015</span>

    <p>Recently at work, the vCloud Air Zombie team has been using Packer to generate Vagrant templates for use in development and testing.  I have previously covered <a href="https://sdorsett.github.io/2015/01/03/using-packer-on-centos/">how to use Packer to create create a .box template for use with Vagrant</a>, but I thought it might be useful to others to demonstrate how we are using Packer to create images.</p>

<p>This will be the first of several blog posts in which I intend to cover:</p>

<ul>
<li><a href="https://sdorsett.github.io/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">Installing a ESXi 6.0 virtual machine for use with Packer</a> - this is what Packer will be using to create the image.</li>
<li><a href="https://sdorsett.github.io/2015/12/24/installing-packer-and-ovftool-on-centos/">Setting up Packer, ovftool and Apache web server on a CentOS virtual machine</a> - this will be where the Packer templates are run from.</li>
<li><a href="https://sdorsett.github.io/2015/12/25/creating-a-packer-template-for-installing-centos-67/">Creating our first Packer template for installing CentOS 6.7 with vmtools</a> - templates are the &quot;recipes&quot; for what ingredients go into a Packer image.</li>
<li>Copying our existing CentOS 6.7 template and adding the Puppet agent - having the puppet agent in an image allows us to use puppet to describe configurations using puppet in either Packer and Vagrant.</li>
<li>Using ovftool to convert Packer generated virtual machines, into Vagrant .box files - ovftool allows you to export the Packer created images in either a Fusion or vSphere compatible format.</li>
<li>Hosting the resulting Vagrant .box files on a web server - Hosting the .box files on a web server allows them to be easily used within Vagrantfiles.</li>
</ul>

<p>These posts will hopefully be helpful by providing details on the process of using Packer to generate Vagrant .box files.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/06/creating-vcsa-box-manually/">
        Creating a vCSA 5.5 .box template on CentOS 6.5 for vagrant deployment
      </a>
    </h1>

    <span class="post-date">06 Jan 2015</span>

    <p>In the last few blogs post we have created ESXi .box templates, but in order to create a complete virtual lab using vagrant we will also need a vCenter Server Appliance virtual machine. The vCSA comes as a .ova template, so we will need to convert it to a vagrant-vmware-ovf .box template before we can use it with vagrant.</p>

<p>In this post we will need several packages installed, that we have covered in the last few posts:</p>

<ul>
<li>vagrant - I used vagrant 1.7.1 for these steps</li>
<li><a href="https://github.com/gosddc/vagrant-vcenter">gosddc/vagrant-vcenter</a>.
This repo contains a vagrant plugin (provider) that will deploy a vagrant-vmware-ovf generated .box template to a vcenter instance. This provider allows vagrant to seamlessly deploy to vCenter.</li>
<li>ovftool - I have ovftool 3.5.1 installed on my CentOS vm.</li>
</ul>

<p>I will be using the same CentOS virtual machine we used <a href="https://sdorsett.github.io/2015/01/04/installing-vagrant-on-centos/">in the last post</a> since it already has all the packages we will be needing.</p>

<h2>1. Download the vCenter Server Appliance .iso from the <a href="https://my.vmware.com/web/vmware/details?downloadGroup=VC55U2&amp;productId=353">vmware.com download page</a>.</h2>

<p>I will be using &quot;VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova&quot;, which is the vCSA 5.5 U2 .ova. </p>

<h2>2. Use ovftool to upload the vCSA .ova to vCenter:</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant ~<span class="o">]</span><span class="c"># ovftool --disableVerification  --noSSLVerify --datastore=esx01-local-sata --name=vcsa-5.5.0.20000-2063318 --network=vlan2 ~/VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova vi://root@192.168.1.201</span>
Opening OVA <span class="nb">source</span>: VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova
The manifest validates
Enter login information <span class="k">for</span> target vi://192.168.1.201/
Username: root
Password: **********
Opening VI target: vi://root@192.168.1.201:443/
Deploying to VI: vi://root@192.168.1.201:443/
Transfer Completed
Completed successfully
<span class="o">[</span>root@vagrant ~<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>You will need to modify the following parameters in the ovftool command:</p>

<ul>
<li>--datastore - this is the datastore that ovftool will deploy the virtual machine to</li>
<li>--name - this is the name the deployed virtual machine will be given</li>
<li>--network - this is the portgroup the deployed virtual machine will be connected to</li>
<li>vi://root://[esxi_host_ip_address] - update this part of the command with the IP address of one of your ESXi servers</li>
</ul>

<h2>3. Modify the vCSA virtual machine for vagrant deployment.</h2>

<h4>A. Power on the vcsa-5.5.0.20000-2063318 virtual machine in the VI or vSphere web client.</h4>

<h4>B. Once the vCSA virtual machine is up and running, SSH to the IP address that is acquired by DHCP.</h4>

<h5>C. Create the ~/.ssh directory</h5>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">localhost:~ <span class="c"># mkdir ~/.ssh</span></code></pre></div>

<h4>D. Add the vagrant public ssh key to ~/.ssh/authorized_keys:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">localhost:~ <span class="c"># cd .ssh</span>
localhost:~/.ssh <span class="c"># echo &#39;ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key&#39; &gt; ~/.ssh/authorized_keys</span></code></pre></div>

<h4>E. Modify the permissions on ~/.ssh &amp; ~/.ssh/authorized_keys since openssh is particular about file permissions:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">localhost:~/.ssh <span class="c"># chmod 700 ~/.ssh</span>
localhost:~/.ssh <span class="c"># chmod 600 ~/.ssh/authorized_keys</span></code></pre></div>

<h4>F. Modify the following lines in /etc/ssh/sshd_config:</h4>

<p>Uncomment and update the following lines:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">PubkeyAuthentication yes                  <span class="c"># line 47</span>
AuthorizedKeysFile ~/.ssh/authorized_keys <span class="c"># line 48</span></code></pre></div>

<p>Comment out the following line:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#MaxSessions 1                            # line 44</span></code></pre></div>

<h4>G. Power down the vcsa-5.5.0.20000-2063318 virtual machine in the VI or vSphere web client.</h4>

<h2>4. Use ovftool to export the vcsa-5.5.0.20000-2063318 virtual machine.</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant ~<span class="o">]</span><span class="c"># ovftool vi://root@192.168.1.201/vcsa-5.5.0.20000-2063318 ./</span>
Enter login information <span class="k">for</span> <span class="nb">source </span>vi://192.168.1.201/
Username: root
Password: **********
Opening VI <span class="nb">source</span>: vi://root@192.168.1.201:443/vcsa-5.5.0.20000-2063318
Opening OVF target: ./
Writing OVF package: ./vcsa-5.5.0.20000-2063318/vcsa-5.5.0.20000-2063318.ovf
Transfer Completed
Completed successfully</code></pre></div>

<p>&quot;vi://root@192.168.1.201&quot; will need to be updated to use the IP address of the ESXi host that has your vcsa-5.5.0.20000-2063318 virtual machine.</p>

<h2>5. add the additional vagrant-vmware-ovf files and tar up the vcsa-5.5.0.20000-2063318 .ovf as a .box file:</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant ~<span class="o">]</span><span class="c"># cd vcsa-5.5.0.20000-2063318/</span>
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># echo &#39;{&quot;provider&quot;:&quot;vmware_ovf&quot;}&#39; &gt;&gt; metadata.json</span>
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># touch Vagrantfile</span>
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># tar cvzf vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box ./*</span>
./metadata.json
./Vagrantfile
./vcsa-5.5.0.20000-2063318-disk1.vmdk
./vcsa-5.5.0.20000-2063318-disk2.vmdk
./vcsa-5.5.0.20000-2063318.mf
./vcsa-5.5.0.20000-2063318.ovf
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c">#</span></code></pre></div>

<h2>6. Create a directory to keep our vagrant-vmware-ovf .box template in and move the vCSA template to it:</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># mkdir ~/box-files/</span>
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># mv vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box ~/box-files/</span></code></pre></div>

<h4>C. Create directory and Vagrantfile for the vCSA virtual machines we will deploy with vagrant:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># mkdir -p ~/vagrant-vms/vcsa-test/</span>
<span class="o">[</span>root@vagrant vcsa-5.5.0.20000-2063318<span class="o">]</span><span class="c"># cd ~/vagrant-vms/vcsa-test/</span>
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vi Vagrantfile</span>
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># cat Vagrantfile</span>
<span class="nv">vcsa_box_url</span> <span class="o">=</span> <span class="s1">&#39;/root/box-files/vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box&#39;</span>

<span class="nv">$script</span> <span class="o">=</span> <span class="s">&lt;&lt;SCRIPT</span>
<span class="s">#!/bin/bash</span>
<span class="s"># Commands to configure all the necessary services to start the vCenter Service, thanks @lamw ! see:</span>
<span class="s"># http://www.virtuallyghetto.com/2012/02/automating-vcenter-server-appliance.html</span>
<span class="s"> </span>
<span class="s">echo &quot;Accepting EULA ...&quot;</span>
<span class="s">/usr/sbin/vpxd_servicecfg eula accept</span>
<span class="s"> </span>
<span class="s">echo &quot;Configuring Embedded DB ...&quot;</span>
<span class="s">/usr/sbin/vpxd_servicecfg db write embedded</span>
<span class="s"> </span>
<span class="s">echo &quot;Configuring SSO...&quot;</span>
<span class="s">/usr/sbin/vpxd_servicecfg sso write embedded</span>
<span class="s"> </span>
<span class="s">echo &quot;Starting VCSA ...&quot;</span>
<span class="s">/usr/sbin/vpxd_servicecfg service start</span>

<span class="s"># http://www.virtuallyghetto.com/2014/02/how-to-automate-ntp-configurations-on.html</span>
<span class="s">/usr/sbin/vpxd_servicecfg timesync write ntp &#39;pool.ntp.org&#39; &#39;&#39;</span>

<span class="s"># Command to set IP address to 192.168.1.81:</span>
<span class="s"># http://www.virtuallyghetto.com/2013/02/automating-vcsa-network-configurations.html</span>
<span class="s">echo &quot;Setting static IP address to 192.168.1.81&quot;</span>
<span class="s">/opt/vmware/share/vami/vami_set_network eth0 STATICV4 192.168.1.81 255.255.255.0 192.168.1.1 &gt;&amp;- 2&gt;&amp;- &lt;&amp;- &amp;</span>
<span class="s">SCRIPT</span>

<span class="nv">nodes</span> <span class="o">=</span> <span class="o">[</span>
  <span class="o">{</span> :hostname <span class="o">=</span>&gt; <span class="s1">&#39;vcsa-01a&#39;</span>, :box <span class="o">=</span>&gt; <span class="s1">&#39;vcsa-5.5.0.20000-2063318&#39;</span>, :box_url <span class="o">=</span>&gt; vcsa_box_url<span class="o">}</span>
<span class="o">]</span>
 
Vagrant.configure<span class="o">(</span><span class="s1">&#39;2&#39;</span><span class="o">)</span> <span class="k">do</span> <span class="p">|</span>config<span class="p">|</span>
 
  config.vm.provider :vcenter <span class="k">do</span> <span class="p">|</span>vcenter<span class="p">|</span>
    vcenter.hostname <span class="o">=</span> <span class="s1">&#39;192.168.1.195&#39;</span>
    vcenter.username <span class="o">=</span> <span class="s1">&#39;root&#39;</span>
    vcenter.password <span class="o">=</span> <span class="s1">&#39;mySecretP@ssw0rd&#39;</span>
    vcenter.folder_name <span class="o">=</span> <span class="s1">&#39;Vagrant/Deployed&#39;</span>
    vcenter.datacenter_name <span class="o">=</span> <span class="s1">&#39;datacenter-01&#39;</span>
    vcenter.computer_name <span class="o">=</span> <span class="s1">&#39;cluster-01&#39;</span>
    vcenter.datastore_name <span class="o">=</span> <span class="s1">&#39;vsanDatastore&#39;</span>
    vcenter.template_folder_name <span class="o">=</span> <span class="s1">&#39;Vagrant/Templates&#39;</span>
    vcenter.network_name <span class="o">=</span> <span class="s1">&#39;vlan2&#39;</span>
    vcenter.linked_clones <span class="o">=</span> <span class="nb">true</span>
<span class="nb">    </span>vcenter.enable_vm_customization <span class="o">=</span> <span class="nb">false</span>
<span class="nb">  </span>end
 
  <span class="c"># Go through nodes and configure each of them.j</span>
  nodes.each <span class="k">do</span> <span class="p">|</span>node<span class="p">|</span>
    config.vm.define node<span class="o">[</span>:hostname<span class="o">]</span> <span class="k">do</span> <span class="p">|</span>node_config<span class="p">|</span>
 
      <span class="k">if</span> node<span class="o">[</span>:hostname<span class="o">]</span>.include? <span class="s1">&#39;vcsa-&#39;</span>
        node_config.ssh.username <span class="o">=</span> <span class="s1">&#39;root&#39;</span>
        node_config.ssh.insert_key <span class="o">=</span> <span class="nb">false</span>
<span class="nb">        </span>node_config.vm.synced_folder <span class="s1">&#39;.&#39;</span>, <span class="s1">&#39;/vagrant&#39;</span>, disabled: <span class="nb">true</span>
<span class="nb">        </span>node_config.vm.provision <span class="s2">&quot;shell&quot;</span>, inline: <span class="nv">$script</span>
      end 
      node_config.vm.box <span class="o">=</span> node<span class="o">[</span>:box<span class="o">]</span>
      node_config.vm.hostname <span class="o">=</span> node<span class="o">[</span>:hostname<span class="o">]</span>
      node_config.vm.box_url <span class="o">=</span> node<span class="o">[</span>:box_url<span class="o">]</span>
    end
  end
end</code></pre></div>

<p>This Vagrantfile is specifying vagrant to use the vagrant-vcenter profiler to create one virtual machine (vcsa-01a) from the vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box file. You will need update the following properties to reflect your own vCenter configuration:</p>

<ul>
<li>vcenter.hostname = the IP address of your vCenter server</li>
<li>vcenter.username = the username used to connect to your vCenter server</li>
<li>vcenter.password = the password used to connect to your vCenter server</li>
<li>vcenter.datacenter_name = the vCenter virtual datacenter to use for virtual machine deployment</li>
<li>vcenter.computer_name = the vCenter host or cluster to use for virtual machine deployment. I&#39;ve used the cluster in my example.</li>
<li>vcenter.datastore_name = the vCenter datastore to use for virtual machine deployment</li>
<li>vcenter.folder_name = the vm folder that the virtual machines will be deployed to</li>
<li>vcenter.template_folder_name = the vm folder that the vCSA template will be created in</li>
<li>vcenter.network_name = the vCenter portgroup to connect the vCSA template to. There should be a DHCP server on this portgroup to provide IP addresses to the deployed vCSA template.</li>
</ul>

<p>There is also a script section at the top of the Vagrantfile I would like to point out. William Lam has posted several posts documenting how to automate vCSA configuration, and several of his suggestions have been included in this section. Namely those are:</p>

<ul>
<li>Accepting the EULA</li>
<li>Configuring the vCSA to use the internal database</li>
<li>Configuring internal SSO</li>
<li>Starting the vCenter services</li>
<li>Setting NTP</li>
<li>Assigning a static IP address using vami_set_network command</li>
</ul>

<p>You might want to adjust the last part of the script, since it will set vCSA to use 192.168.1.81 as it&#39;s static IP address. </p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&quot;Setting static IP address to 192.168.1.81&quot;</span>
/opt/vmware/share/vami/vami_set_network eth0 STATICV4 192.168.1.81 255.255.255.0 192.168.1.1 &gt;<span class="p">&amp;</span>- 2&gt;<span class="p">&amp;</span>- &lt;<span class="p">&amp;</span>- <span class="p">&amp;</span></code></pre></div>

<p>I prefer to set a static address for the vCSA, so that any scripts that follow the vCSA deployment will know exactly what IP address to use to connect to it. Also you might be wondering about extra characters following the VAMI command. Since this command is modifying the IP address of the virtual machine, we&#39;re need to run this command in the background without expecting a response. Here the breakdown of what is being done:</p>

<ul>
<li>&gt;&amp;- means close stdout.</li>
<li>2&gt;&amp;- means close stderr.</li>
<li>&lt;&amp;- means close stdin.</li>
<li>&amp; means run in the background</li>
</ul>

<p>If we didn&#39;t pipe the vami_set_network command through these commands, vagrant would keep waiting on output in the SSH session that the command was successfully run, but the IP address had been changed so it would never receive the expected response. </p>

<h2>4. &quot;vagrant up&quot;</h2>

<h4>A. Now that we have created a Vagrantfile config file and updated it with our vCenter information we can bring up our virtual machine by running &quot;vagrant up&quot; in the directory with the Vagrantfile.</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vagrant up</span>
Bringing machine <span class="s1">&#39;vcsa-01a&#39;</span> up with <span class="s1">&#39;vcenter&#39;</span> provider...
<span class="o">==</span>&gt; vcsa-01a: Creating VM...
<span class="o">==</span>&gt; vcsa-01a: Powering on VM...
<span class="o">==</span>&gt; vcsa-01a: Running provisioner: shell...
    vcsa-01a: Running: inline <span class="nv">script</span>
<span class="o">==</span>&gt; vcsa-01a: Accepting EULA ...
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_CFG_RESULT</span><span class="o">=</span><span class="nv">0</span>
<span class="o">==</span>&gt; vcsa-01a: Configuring Embedded DB ...
<span class="o">==</span>&gt; vcsa-01a: insserv: Service network is missed in the runlevels <span class="m">4</span> to use service <span class="nv">postgresql</span>
<span class="o">==</span>&gt; vcsa-01a: insserv: Service syslog is missed in the runlevels <span class="m">4</span> to use service <span class="nv">postgresql</span>
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_DB_SCHEMA_VERSION</span><span class="o">=</span>VirtualCenter Database 5.5
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_DB_SCHEMA_INITIALIZED</span><span class="o">=</span><span class="nv">1</span>
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_CFG_RESULT</span><span class="o">=</span><span class="nv">0</span>
<span class="o">==</span>&gt; vcsa-01a: Configuring SSO...
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_CFG_RESULT</span><span class="o">=</span><span class="nv">0</span>
<span class="o">==</span>&gt; vcsa-01a: Starting VCSA ...
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_CFG_RESULT</span><span class="o">=</span><span class="nv">0</span>
<span class="o">==</span>&gt; vcsa-01a: insserv: Service network is missed in the runlevels <span class="m">4</span> to use service <span class="nv">postgresql</span>
<span class="o">==</span>&gt; vcsa-01a: insserv: Service syslog is missed in the runlevels <span class="m">4</span> to use service <span class="nv">postgresql</span>
<span class="o">==</span>&gt; vcsa-01a: <span class="nv">VC_CFG_RESULT</span><span class="o">=</span><span class="nv">0</span>
<span class="o">==</span>&gt; vcsa-01a: Setting static IP address to 192.168.1.81
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c">#</span></code></pre></div>
 

<h4>B. Once the &quot;vagrant up&quot; command completes, you can check the status of the vCSA vm using &quot;vagrant status&quot;:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vagrant status</span>
Current machine states:

vcsa-01a                  running <span class="o">(</span>vcenter<span class="o">)</span>

The VM is running. To stop this VM, you can run <span class="sb">`</span>vagrant halt<span class="sb">`</span> to
shut it down forcefully, or you can run <span class="sb">`</span>vagrant <span class="nb">suspend</span><span class="sb">`</span> to simply
<span class="nb">suspend </span>the virtual machine. In either <span class="k">case</span>, to restart it again,
simply run <span class="sb">`</span>vagrant up<span class="sb">`</span>.
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c">#</span></code></pre></div>

<h4>D. You can now ssh into the vCSA virtual machine using &quot;vagrant ssh&quot;:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vagrant ssh</span>
<span class="o">==</span>&gt; vcsa-01a: External IP <span class="k">for</span> vcsa-01a: 192.168.1.81
Last login: Sat Jan <span class="m">10</span> 20:08:07 UTC <span class="m">2015</span> from 192.168.1.24 on pts/0
Last login: Sat Jan <span class="m">10</span> 20:09:36 <span class="m">2015</span> from 192.168.1.24
localhost:~ <span class="c"># service vmware-vpxd status</span>
vmware-vpxd is running
tomcat is running
localhost:~ <span class="c"># exit</span>
<span class="nb">logout</span>
Connection to 192.168.1.81 closed.
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c">#</span></code></pre></div>

<p>I wanted to point out that vagrant automatically detected up the IP address change we made through vmtools, so we didn&#39;t have to perform any additional steps for &quot;vagrant ssh&quot; to work.</p>

<h4>E. Once we are done using our virtual machine, it can be destroyed with a &quot;vagrant destroy&quot; command:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vagrant destroy</span>
    vcsa-01a: Are you sure you want to destroy the <span class="s1">&#39;vcsa-01a&#39;</span> VM? <span class="o">[</span>y/N<span class="o">]</span> <span class="nv">y</span>
<span class="o">==</span>&gt; vcsa-01a: Powering off VM...
<span class="o">==</span>&gt; vcsa-01a: Destroying VM...
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c">#</span></code></pre></div>

<h4>F. If you are ever unsure of the state of the vagrant virtual machine you can run &quot;vagrant status&quot; to check:</h4>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c"># vagrant status</span>
Current machine states:

vcsa-01a                  not created <span class="o">(</span>vcenter<span class="o">)</span>

The environment has not yet been created. Run <span class="sb">`</span>vagrant up<span class="sb">`</span> to
create the environment. If a machine is not created, only the
default provider will be shown. So <span class="k">if</span> a provider is not listed,
<span class="k">then</span> the machine is not created <span class="k">for</span> that environment.
<span class="o">[</span>root@vagrant vcsa-test<span class="o">]</span><span class="c">#</span></code></pre></div>

<h3>That all for this post covering how to create a vCSA .box template and deploy it using the vagrant-vcenter provider.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
