<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>sdorsett.github.io</title>
 <link href="http://sdorsett.github.io/atom.xml" rel="self"/>
 <link href="http://sdorsett.github.io/"/>
 <updated>2015-01-10T20:42:46+00:00</updated>
 <id>http://sdorsett.github.io</id>
 <author>
   <name>Mark Otto</name>
   <email></email>
 </author>

 
 <entry>
   <title>Creating a vCSA 5.5 .box template on CentOS 6.5 for vagrant deployment</title>
   <link href="http://sdorsett.github.io/2015/01/06/creating-vcsa-box-manually/"/>
   <updated>2015-01-06T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2015/01/06/creating-vcsa-box-manually</id>
   <content type="html">&lt;p&gt;In the last few blogs post we have created ESXi .box templates, but in order to create a complete virtual lab using vagrant we will also need a vCenter Server Appliance virtual machine. The vCSA comes as a .ova template, so we will need to convert it to a vagrant-vmware-ovf .box template before we can use it with vagrant.&lt;/p&gt;

&lt;p&gt;In this post we will need several packages installed, that we have covered in the last few posts:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;vagrant - I used vagrant 1.7.1 for these steps&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/gosddc/vagrant-vcenter&quot;&gt;gosddc/vagrant-vcenter&lt;/a&gt;.
This repo contains a vagrant plugin (provider) that will deploy a vagrant-vmware-ovf generated .box template to a vcenter instance. This provider allows vagrant to seamlessly deploy to vCenter.&lt;/li&gt;
&lt;li&gt;ovftool - I have ovftool 3.5.1 installed on my CentOS vm.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I will be using the same CentOS virtual machine we used &lt;a href=&quot;https://sdorsett.github.io/2015/01/04/installing-vagrant-on-centos/&quot;&gt;in the last post&lt;/a&gt; since it already has all the packages we will be needing.&lt;/p&gt;

&lt;h2&gt;1. Download the vCenter Server Appliance .iso from the &lt;a href=&quot;https://my.vmware.com/web/vmware/details?downloadGroup=VC55U2&amp;amp;productId=353&quot;&gt;vmware.com download page&lt;/a&gt;.&lt;/h2&gt;

&lt;p&gt;I will be using &amp;quot;VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova&amp;quot;, which is the vCSA 5.5 U2 .ova. &lt;/p&gt;

&lt;h2&gt;2. Use ovftool to upload the vCSA .ova to vCenter:&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ovftool --disableVerification  --noSSLVerify --datastore=esx01-local-sata --name=vcsa-5.5.0.20000-2063318 --network=vlan2 ~/VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova vi://root@192.168.1.201&lt;/span&gt;
Opening OVA &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;: VMware-vCenter-Server-Appliance-5.5.0.20000-2063318_OVF10.ova
The manifest validates
Enter login information &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; target vi://192.168.1.201/
Username: root
Password: **********
Opening VI target: vi://root@192.168.1.201:443/
Deploying to VI: vi://root@192.168.1.201:443/
Transfer Completed
Completed successfully
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You will need to modify the following parameters in the ovftool command:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;--datastore - this is the datastore that ovftool will deploy the virtual machine to&lt;/li&gt;
&lt;li&gt;--name - this is the name the deployed virtual machine will be given&lt;/li&gt;
&lt;li&gt;--network - this is the portgroup the deployed virtual machine will be connected to&lt;/li&gt;
&lt;li&gt;vi://root://[esxi_host_ip_address] - update this part of the command with the IP address of one of your ESXi servers&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;3. Modify the vCSA virtual machine for vagrant deployment.&lt;/h2&gt;

&lt;h4&gt;A. Power on the vcsa-5.5.0.20000-2063318 virtual machine in the VI or vSphere web client.&lt;/h4&gt;

&lt;h4&gt;B. Once the vCSA virtual machine is up and running, SSH to the IP address that is acquired by DHCP.&lt;/h4&gt;

&lt;h5&gt;C. Create the ~/.ssh directory&lt;/h5&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;localhost:~ &lt;span class=&quot;c&quot;&gt;# mkdir ~/.ssh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Add the vagrant public ssh key to ~/.ssh/authorized_keys:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;localhost:~ &lt;span class=&quot;c&quot;&gt;# cd .ssh&lt;/span&gt;
localhost:~/.ssh &lt;span class=&quot;c&quot;&gt;# echo &amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key&amp;#39; &amp;gt; ~/.ssh/authorized_keys&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Modify the permissions on ~/.ssh &amp;amp; ~/.ssh/authorized_keys since openssh is particular about file permissions:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;localhost:~/.ssh &lt;span class=&quot;c&quot;&gt;# chmod 700 ~/.ssh&lt;/span&gt;
localhost:~/.ssh &lt;span class=&quot;c&quot;&gt;# chmod 600 ~/.ssh/authorized_keys&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;F. Modify the following lines in /etc/ssh/sshd_config:&lt;/h4&gt;

&lt;p&gt;Uncomment and update the following lines:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;PubkeyAuthentication yes                  &lt;span class=&quot;c&quot;&gt;# line 47&lt;/span&gt;
AuthorizedKeysFile ~/.ssh/authorized_keys &lt;span class=&quot;c&quot;&gt;# line 48&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comment out the following line:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;#MaxSessions 1                            # line 44&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;G. Power down the vcsa-5.5.0.20000-2063318 virtual machine in the VI or vSphere web client.&lt;/h4&gt;

&lt;h2&gt;4. Use ovftool to export the vcsa-5.5.0.20000-2063318 virtual machine.&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ovftool vi://root@192.168.1.201/vcsa-5.5.0.20000-2063318 ./&lt;/span&gt;
Enter login information &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;vi://192.168.1.201/
Username: root
Password: **********
Opening VI &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;: vi://root@192.168.1.201:443/vcsa-5.5.0.20000-2063318
Opening OVF target: ./
Writing OVF package: ./vcsa-5.5.0.20000-2063318/vcsa-5.5.0.20000-2063318.ovf
Transfer Completed
Completed successfully&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&amp;quot;vi://root@192.168.1.201&amp;quot; will need to be updated to use the IP address of the ESXi host that has your vcsa-5.5.0.20000-2063318 virtual machine.&lt;/p&gt;

&lt;h2&gt;5. add the additional vagrant-vmware-ovf files and tar up the vcsa-5.5.0.20000-2063318 .ovf as a .box file:&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd vcsa-5.5.0.20000-2063318/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# echo &amp;#39;{&amp;quot;provider&amp;quot;:&amp;quot;vmware_ovf&amp;quot;}&amp;#39; &amp;gt;&amp;gt; metadata.json&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# touch Vagrantfile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar cvzf vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box ./*&lt;/span&gt;
./metadata.json
./Vagrantfile
./vcsa-5.5.0.20000-2063318-disk1.vmdk
./vcsa-5.5.0.20000-2063318-disk2.vmdk
./vcsa-5.5.0.20000-2063318.mf
./vcsa-5.5.0.20000-2063318.ovf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;6. Create a directory to keep our vagrant-vmware-ovf .box template in and move the vCSA template to it:&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir ~/box-files/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mv vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box ~/box-files/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Create directory and Vagrantfile for the vCSA virtual machines we will deploy with vagrant:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir -p ~/vagrant-vms/vcsa-test/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-5.5.0.20000-2063318&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/vagrant-vms/vcsa-test/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vi Vagrantfile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat Vagrantfile&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;vcsa_box_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/root/box-files/vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box&amp;#39;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;lt;&amp;lt;SCRIPT&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;# Commands to configure all the necessary services to start the vCenter Service, thanks @lamw ! see:&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;# http://www.virtuallyghetto.com/2012/02/automating-vcenter-server-appliance.html&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;echo &amp;quot;Accepting EULA ...&amp;quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/usr/sbin/vpxd_servicecfg eula accept&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;echo &amp;quot;Configuring Embedded DB ...&amp;quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/usr/sbin/vpxd_servicecfg db write embedded&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;echo &amp;quot;Configuring SSO...&amp;quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/usr/sbin/vpxd_servicecfg sso write embedded&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt; &lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;echo &amp;quot;Starting VCSA ...&amp;quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/usr/sbin/vpxd_servicecfg service start&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;# http://www.virtuallyghetto.com/2014/02/how-to-automate-ntp-configurations-on.html&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/usr/sbin/vpxd_servicecfg timesync write ntp &amp;#39;pool.ntp.org&amp;#39; &amp;#39;&amp;#39;&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;# Command to set IP address to 192.168.1.81:&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;# http://www.virtuallyghetto.com/2013/02/automating-vcsa-network-configurations.html&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;echo &amp;quot;Setting static IP address to 192.168.1.81&amp;quot;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;/opt/vmware/share/vami/vami_set_network eth0 STATICV4 192.168.1.81 255.255.255.0 192.168.1.1 &amp;gt;&amp;amp;- 2&amp;gt;&amp;amp;- &amp;lt;&amp;amp;- &amp;amp;&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;SCRIPT&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; :hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcsa-01a&amp;#39;&lt;/span&gt;, :box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcsa-5.5.0.20000-2063318&amp;#39;&lt;/span&gt;, :box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; vcsa_box_url&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
 
Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
 
  config.vm.provider :vcenter &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vcenter&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    vcenter.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;192.168.1.195&amp;#39;&lt;/span&gt;
    vcenter.username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root&amp;#39;&lt;/span&gt;
    vcenter.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;mySecretP@ssw0rd&amp;#39;&lt;/span&gt;
    vcenter.folder_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vagrant/Deployed&amp;#39;&lt;/span&gt;
    vcenter.datacenter_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;datacenter-01&amp;#39;&lt;/span&gt;
    vcenter.computer_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cluster-01&amp;#39;&lt;/span&gt;
    vcenter.datastore_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsanDatastore&amp;#39;&lt;/span&gt;
    vcenter.template_folder_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vagrant/Templates&amp;#39;&lt;/span&gt;
    vcenter.network_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vlan2&amp;#39;&lt;/span&gt;
    vcenter.linked_clones &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vcenter.enable_vm_customization &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;  &lt;/span&gt;end
 
  &lt;span class=&quot;c&quot;&gt;# Go through nodes and configure each of them.j&lt;/span&gt;
  nodes.each &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    config.vm.define node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node_config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
 
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;.include? &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcsa-&amp;#39;&lt;/span&gt;
        node_config.ssh.username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root&amp;#39;&lt;/span&gt;
        node_config.ssh.insert_key &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;        &lt;/span&gt;node_config.vm.synced_folder &lt;span class=&quot;s1&quot;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&amp;#39;/vagrant&amp;#39;&lt;/span&gt;, disabled: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;        &lt;/span&gt;node_config.vm.provision &lt;span class=&quot;s2&quot;&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;, inline: &lt;span class=&quot;nv&quot;&gt;$script&lt;/span&gt;
      end 
      node_config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box_url&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    end
  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This Vagrantfile is specifying vagrant to use the vagrant-vcenter profiler to create one virtual machine (vcsa-01a) from the vcsa-5.5.0.20000-2063318-vmware_ovf-1.0.box file. You will need update the following properties to reflect your own vCenter configuration:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;vcenter.hostname = the IP address of your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.username = the username used to connect to your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.password = the password used to connect to your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.datacenter_name = the vCenter virtual datacenter to use for virtual machine deployment&lt;/li&gt;
&lt;li&gt;vcenter.computer_name = the vCenter host or cluster to use for virtual machine deployment. I&amp;#39;ve used the cluster in my example.&lt;/li&gt;
&lt;li&gt;vcenter.datastore_name = the vCenter datastore to use for virtual machine deployment&lt;/li&gt;
&lt;li&gt;vcenter.folder_name = the vm folder that the virtual machines will be deployed to&lt;/li&gt;
&lt;li&gt;vcenter.template_folder_name = the vm folder that the vCSA template will be created in&lt;/li&gt;
&lt;li&gt;vcenter.network_name = the vCenter portgroup to connect the vCSA template to. There should be a DHCP server on this portgroup to provide IP addresses to the deployed vCSA template.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There is also a script section at the top of the Vagrantfile I would like to point out. William Lam has posted several posts documenting how to automate vCSA configuration, and several of his suggestions have been included in this section. Namely those are:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Accepting the EULA&lt;/li&gt;
&lt;li&gt;Configuring the vCSA to use the internal database&lt;/li&gt;
&lt;li&gt;Configuring internal SSO&lt;/li&gt;
&lt;li&gt;Starting the vCenter services&lt;/li&gt;
&lt;li&gt;Setting NTP&lt;/li&gt;
&lt;li&gt;Assigning a static IP address using vami_set_network command&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You might want to adjust the last part of the script, since it will set vCSA to use 192.168.1.81 as it&amp;#39;s static IP address. &lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;Setting static IP address to 192.168.1.81&amp;quot;&lt;/span&gt;
/opt/vmware/share/vami/vami_set_network eth0 STATICV4 192.168.1.81 255.255.255.0 192.168.1.1 &amp;gt;&lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;- 2&amp;gt;&lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;- &amp;lt;&lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;- &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I prefer to set a static address for the vCSA, so that any scripts that follow the vCSA deployment will know exactly what IP address to use to connect to it. Also you might be wondering about extra characters following the VAMI command. Since this command is modifying the IP address of the virtual machine, we&amp;#39;re need to run this command in the background without expecting a response. Here the breakdown of what is being done:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;gt;&amp;amp;- means close stdout.&lt;/li&gt;
&lt;li&gt;2&amp;gt;&amp;amp;- means close stderr.&lt;/li&gt;
&lt;li&gt;&amp;lt;&amp;amp;- means close stdin.&lt;/li&gt;
&lt;li&gt;&amp;amp; means run in the background&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we didn&amp;#39;t pipe the vami_set_network command through these commands, vagrant would keep waiting on output in the SSH session that the command was successfully run, but the IP address had been changed so it would never receive the expected response. &lt;/p&gt;

&lt;h2&gt;4. &amp;quot;vagrant up&amp;quot;&lt;/h2&gt;

&lt;h4&gt;A. Now that we have created a Vagrantfile config file and updated it with our vCenter information we can bring up our virtual machine by running &amp;quot;vagrant up&amp;quot; in the directory with the Vagrantfile.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcsa-01a&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcenter&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Creating VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Powering on VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Running provisioner: shell...
    vcsa-01a: Running: inline &lt;span class=&quot;nv&quot;&gt;script&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Accepting EULA ...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_CFG_RESULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Configuring Embedded DB ...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: insserv: Service network is missed in the runlevels &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; to use service &lt;span class=&quot;nv&quot;&gt;postgresql&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: insserv: Service syslog is missed in the runlevels &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; to use service &lt;span class=&quot;nv&quot;&gt;postgresql&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_DB_SCHEMA_VERSION&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;VirtualCenter Database 5.5
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_DB_SCHEMA_INITIALIZED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_CFG_RESULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Configuring SSO...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_CFG_RESULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Starting VCSA ...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_CFG_RESULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: insserv: Service network is missed in the runlevels &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; to use service &lt;span class=&quot;nv&quot;&gt;postgresql&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: insserv: Service syslog is missed in the runlevels &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; to use service &lt;span class=&quot;nv&quot;&gt;postgresql&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: &lt;span class=&quot;nv&quot;&gt;VC_CFG_RESULT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Setting static IP address to 192.168.1.81
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 

&lt;h4&gt;B. Once the &amp;quot;vagrant up&amp;quot; command completes, you can check the status of the vCSA vm using &amp;quot;vagrant status&amp;quot;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant status&lt;/span&gt;
Current machine states:

vcsa-01a                  running &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

The VM is running. To stop this VM, you can run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant halt&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; to
shut it down forcefully, or you can run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant &lt;span class=&quot;nb&quot;&gt;suspend&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; to simply
&lt;span class=&quot;nb&quot;&gt;suspend &lt;/span&gt;the virtual machine. In either &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;, to restart it again,
simply run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant up&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. You can now ssh into the vCSA virtual machine using &amp;quot;vagrant ssh&amp;quot;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: External IP &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; vcsa-01a: 192.168.1.81
Last login: Sat Jan &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; 20:08:07 UTC &lt;span class=&quot;m&quot;&gt;2015&lt;/span&gt; from 192.168.1.24 on pts/0
Last login: Sat Jan &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; 20:09:36 &lt;span class=&quot;m&quot;&gt;2015&lt;/span&gt; from 192.168.1.24
localhost:~ &lt;span class=&quot;c&quot;&gt;# service vmware-vpxd status&lt;/span&gt;
vmware-vpxd is running
tomcat is running
localhost:~ &lt;span class=&quot;c&quot;&gt;# exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;logout&lt;/span&gt;
Connection to 192.168.1.81 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I wanted to point out that vagrant automatically detected up the IP address change we made through vmtools, so we didn&amp;#39;t have to perform any additional steps for &amp;quot;vagrant ssh&amp;quot; to work.&lt;/p&gt;

&lt;h4&gt;E. Once we are done using our virtual machine, it can be destroyed with a &amp;quot;vagrant destroy&amp;quot; command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
    vcsa-01a: Are you sure you want to destroy the &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcsa-01a&amp;#39;&lt;/span&gt; VM? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Powering off VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; vcsa-01a: Destroying VM...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;F. If you are ever unsure of the state of the vagrant virtual machine you can run &amp;quot;vagrant status&amp;quot; to check:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant status&lt;/span&gt;
Current machine states:

vcsa-01a                  not created &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

The environment has not yet been created. Run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant up&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt; to
create the environment. If a machine is not created, only the
default provider will be shown. So &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; a provider is not listed,
&lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; the machine is not created &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; that environment.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vcsa-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;That all for this post covering how to create a vCSA .box template and deploy it using the vagrant-vcenter provider.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Installing vagrant and the vagrant-vcenter provider on CentOS 6.5</title>
   <link href="http://sdorsett.github.io/2015/01/04/installing-vagrant-on-centos/"/>
   <updated>2015-01-04T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2015/01/04/installing-vagrant-on-centos</id>
   <content type="html">&lt;p&gt;If you followed the steps in one of the two previous posts, you have a ESXi .box template in the vagrant-vmware-ovf format. This format allows for deploying the exact same template to vCenter, vCloud Director or vCloud Air, by simply specifying a different provider in vagrant. This post will cover deploying to vCenter, since that is the most readily available of the three. &lt;/p&gt;

&lt;p&gt;In this post we will again talk about the following helpful gosddc project:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/gosddc/vagrant-vcenter&quot;&gt;gosddc/vagrant-vcenter&lt;/a&gt;.
This repo contains a vagrant plugin (provider) that will deploy a vagrant-vmware-ovf generated .box template to a vcenter instance. This provider allows vagrant to seamlessly deploy to vCenter.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We will need a virtual machine with a minimal install of CentOS 6.5 to install vagrant or you can use the same CentOS virtual machine we used &lt;a href=&quot;https://sdorsett.github.io/2015/01/03/using-packer-on-centos/&quot;&gt;in the last post&lt;/a&gt;. For convenience I will be using the same virtual machine.&lt;/p&gt;

&lt;h2&gt;1. Let&amp;#39;s get started by installing the necessary dependancies.&lt;/h2&gt;

&lt;h4&gt;A. Run the following command to install the some needed packages:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install -y gcc-c++ glibc-headers openssl-devel readline libyaml-devel readline-devel zlib zlib-devel iconv-devel libxml2 libxml2-devel libxslt libxslt-devel wget git unzip&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Download and install ruby-build:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# git clone https://github.com/sstephenson/ruby-build.git&lt;/span&gt;
Initialized empty Git repository in /root/ruby-build/.git/
remote: Counting objects: 4212, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
remote: Compressing objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;16/16&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
remote: Total &lt;span class=&quot;m&quot;&gt;4212&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 4&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, reused &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Receiving objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4212/4212&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, 761.14 KiB &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;730&lt;/span&gt; KiB/s, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
Resolving deltas: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2142/2142&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ruby-build/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ./install.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Running the &amp;quot;ruby-build --definitions&amp;quot; command will provide an output of the versions of Ruby that ruby-buid supports:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby-build --definitions&lt;/span&gt;
1.8.6-p383
1.8.6-p420
1.8.7-p249
1.8.7-p302
1.8.7-p334
1.8.7-p352
1.8.7-p357
1.8.7-p358
1.8.7-p370
1.8.7-p371
1.8.7-p374
1.8.7-p375
1.9.1-p378
1.9.1-p430
1.9.2-p0
1.9.2-p180
1.9.2-p290
1.9.2-p318
1.9.2-p320
1.9.2-p326
1.9.2-p330
1.9.3-dev
1.9.3-preview1
1.9.3-rc1
1.9.3-p0
1.9.3-p125
1.9.3-p194
1.9.3-p286
1.9.3-p327
1.9.3-p362
1.9.3-p374
1.9.3-p385
1.9.3-p392
1.9.3-p429
1.9.3-p448
1.9.3-p484
1.9.3-p545
1.9.3-p547
1.9.3-p550
1.9.3-p551
2.0.0-dev
2.0.0-preview1
2.0.0-preview2
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Install ruby 1.9.3 build 551 using the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby-build 1.9.3-p551 /usr/local/&lt;/span&gt;
Downloading yaml-0.1.6.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/7da6971b4bd08a986dd2a61353bc422362bd0edcc67d7ebaac68c95f74182749
Installing yaml-0.1.6...
Installed yaml-0.1.6 to /usr/local/

Downloading ruby-1.9.3-p551.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/bb5be55cd1f49c95bb05b6f587701376b53d310eb1bb7c76fbd445a1c75b51e8
Installing ruby-1.9.3-p551...
Installed ruby-1.9.3-p551 to /usr/local/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Download and install the latest version of ruby gems. You can always find the URL to the most recent version at &lt;a href=&quot;https://rubygems.org/pages/download&quot;&gt;rubygems.org&lt;/a&gt;.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget http://production.cf.rubygems.org/rubygems/rubygems-2.4.5.tgz&lt;/span&gt;
--2015-01-02 21:14:39-- http://production.cf.rubygems.org/rubygems/rubygems-2.4.5.tgz
Resolving production.cf.rubygems.org... 54.230.6.155, 54.230.6.120, 54.230.7.122, ...
Connecting to production.cf.rubygems.org&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;54.230.6.155&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;:80... connected.
HTTP request sent, awaiting response... &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; OK
Length: &lt;span class=&quot;m&quot;&gt;446665&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;436K&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;application/x-tar&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
Saving to: &lt;span class=&quot;s2&quot;&gt;&amp;quot;rubygems-2.4.5.tgz&amp;quot;&lt;/span&gt;

100%&lt;span class=&quot;o&quot;&gt;[==================================================================================================&lt;/span&gt;&amp;gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 446,665 1.78M/s in 0.2s 

2015-01-02 21:14:45 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.78 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;s2&quot;&gt;&amp;quot;rubygems-2.4.5.tgz&amp;quot;&lt;/span&gt; saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;446665/446665&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar -zxf rubygems-2.4.5.tgz&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd rubygems-2.4.5&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.4.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby setup.rb&lt;/span&gt;
RubyGems 2.4.5 installed
Installing ri documentation &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; rubygems-2.4.5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2. Create a directory to keep our vagrant-vmware-ovf .box template to and copy the template we previously created to it:&lt;/h2&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir ~/box-files/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cp /root/packer/packer-templates/esxi55/esxi55-vmware_ovf-1.1.box ~/box-files/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;3. The next thing we need to do is download and install vagrant and the vagrant-vcenter provider:&lt;/h2&gt;

&lt;h4&gt;A. Download and install the latest version of vagrant. You can find the URL to the latest versions of the linux 64bit .rpm at &lt;a href=&quot;https://www.vagrantup.com/downloads.html&quot;&gt;vagrantup.com&lt;/a&gt;.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.4.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.1_x86_64.rpm&lt;/span&gt;
--2015-01-03 16:02:34-- https://dl.bintray.com/mitchellh/vagrant/vagrant_1.7.1_x86_64.rpm
Resolving dl.bintray.com... 108.168.194.92, 108.168.194.91
Connecting to dl.bintray.com&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;108.168.194.92&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;:443... connected.
HTTP request sent, awaiting response... &lt;span class=&quot;m&quot;&gt;302&lt;/span&gt; 
Resolving d29vzk4ow07wi7.cloudfront.net... 54.230.7.101, 54.230.5.129, 54.230.6.222, ...
Connecting to d29vzk4ow07wi7.cloudfront.net&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;54.230.7.101&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;:443... connected.
HTTP request sent, awaiting response... &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; OK
Length: &lt;span class=&quot;m&quot;&gt;65197711&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;62M&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;application/unknown&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
Saving to: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant_1.7.1_x86_64.rpm&amp;quot;&lt;/span&gt;

100%&lt;span class=&quot;o&quot;&gt;[==================================================================================================&lt;/span&gt;&amp;gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 65,197,711 1.92M/s in 33s 

2015-01-03 16:03:18 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.87 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant_1.7.1_x86_64.rpm&amp;quot;&lt;/span&gt; saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;65197711/65197711&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# rpm -i vagrant_1.7.1_x86_64.rpm&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant -v&lt;/span&gt;
Vagrant 1.7.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Install the vagrant-vcenter plugin using the following commands:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant plugin list&lt;/span&gt;
vagrant-share &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.1.4, system&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant plugin install vagrant-vcenter&lt;/span&gt;
Installing the &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vcenter&amp;#39;&lt;/span&gt; plugin. This can take a few minutes...
Installed the plugin &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vcenter (0.3.2)&amp;#39;&lt;/span&gt;!
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Create directory and Vagrantfile for the ESXi virtual machines we will deploy with vagrant:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir -p ~/vagrant-vms/esxi-test/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd vagrant-vms/esxi-test/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vi Vagrantfile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat Vagrantfile&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;esxi_box_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/root/box-files/esxi55-vmware_ovf-1.1.box&amp;#39;&lt;/span&gt;
 
&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; :hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-01a&amp;#39;&lt;/span&gt;, :box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt;, :box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; esxi_box_url&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; :hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-02a&amp;#39;&lt;/span&gt;, :box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt;, :box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; esxi_box_url&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
 
Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
 
  config.vm.provider :vcenter &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vcenter&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    vcenter.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;192.168.1.195&amp;#39;&lt;/span&gt;
    vcenter.username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root&amp;#39;&lt;/span&gt;
    vcenter.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;mySecretP@ssw0rd&amp;#39;&lt;/span&gt;
    vcenter.folder_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vagrant/Deployed&amp;#39;&lt;/span&gt;
    vcenter.datacenter_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;datacenter-01&amp;#39;&lt;/span&gt;
    vcenter.computer_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cluster-01&amp;#39;&lt;/span&gt;
    vcenter.datastore_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsanDatastore&amp;#39;&lt;/span&gt;
    vcenter.template_folder_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vagrant/Templates&amp;#39;&lt;/span&gt;
    vcenter.network_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vlan2&amp;#39;&lt;/span&gt;
    vcenter.linked_clones &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vcenter.enable_vm_customization &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;  &lt;/span&gt;end
 
  &lt;span class=&quot;c&quot;&gt;# Go through nodes and configure each of them.j&lt;/span&gt;
  nodes.each &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    config.vm.define node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node_config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
 
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;.include? &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-&amp;#39;&lt;/span&gt;
        node_config.ssh.username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root&amp;#39;&lt;/span&gt;
        node_config.ssh.shell &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;sh&amp;#39;&lt;/span&gt;
        node_config.ssh.insert_key &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;        &lt;/span&gt;node_config.vm.synced_folder &lt;span class=&quot;s1&quot;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, &lt;span class=&quot;s1&quot;&gt;&amp;#39;/vagrant&amp;#39;&lt;/span&gt;, disabled: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;      &lt;/span&gt;end
 
      node_config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box_url&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    end
  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This Vagrantfile is specifying vagrant to use the vagrant-vcenter profiler to create two virtual machines (esx-01a &amp;amp; esx-02a) from the esx55-vmware_ovf-1.1.box file. You will need update the following properties to reflect your own vCenter configuration:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;vcenter.hostname = the IP address of your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.username = the username used to connect to your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.password = the password used to connect to your vCenter server&lt;/li&gt;
&lt;li&gt;vcenter.datacenter_name = the vCenter virtual datacenter to use for virtual machine deployment&lt;/li&gt;
&lt;li&gt;vcenter.computer_name = the vCenter host or cluster to use for virtual machine deployment. I&amp;#39;ve used the cluster in my example.&lt;/li&gt;
&lt;li&gt;vcenter.datastore_name = the vCenter datastore to use for virtual machine deployment&lt;/li&gt;
&lt;li&gt;vcenter.folder_name = the vm folder that the virtual machines will be deployed to&lt;/li&gt;
&lt;li&gt;vcenter.template_folder_name = the vm folder that the ESXi template will be created in&lt;/li&gt;
&lt;li&gt;vcenter.network_name = the vCenter portgroup to connect the ESXi templates to. There should be a DHCP server on this portgroup to provide IP addresses to the deployed ESXi templates.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;4. &amp;quot;vagrant up&amp;quot;&lt;/h2&gt;

&lt;h4&gt;A. Now that we have created a Vagrantfile config file and updated it with our vCenter information we can bring up our virtual machine by running &amp;quot;vagrant up&amp;quot; in the directory with the Vagrantfile.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-01a&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcenter&amp;#39;&lt;/span&gt; provider...
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-02a&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcenter&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Box &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt; could not be found. Attempting to find and install...
 esx-01a: Box Provider: vmware_ovf, vcloud, vcenter
 esx-01a: Box Version: &amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Adding box &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; provider: vmware_ovf, vcloud, vcenter
 esx-01a: Downloading: file:///root/box-files/esxi55-vmware_ovf-1.1.box
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Successfully added box &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vmware_ovf&amp;#39;&lt;/span&gt;!
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Box &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt; could not be found. Attempting to find and install...
 esx-02a: Box Provider: vmware_ovf, vcloud, vcenter
 esx-02a: Box Version: &amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Adding box &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxi55&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; provider: vmware_ovf, vcloud, &lt;span class=&quot;nv&quot;&gt;vcenter&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Uploading &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Adding &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
2015-01-03 16:28:34 -0600: networks: &lt;span class=&quot;nv&quot;&gt;vlan2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; vlan2
2015-01-03 16:28:34 -0600: Uploading OVF to esx02.tyrell.corp...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Uploading &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Adding &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
2015-01-03 16:28:35 -0600: networks: &lt;span class=&quot;nv&quot;&gt;vlan2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; vlan2
2015-01-03 16:28:35 -0600: Uploading OVF to esx01.tyrell.corp...
DEBUG: Timeout: 300
Iteration 1: Trying to get host&lt;span class=&quot;s1&quot;&gt;&amp;#39;s IP address ...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt; % Total % Received % Xferd Average Speed Time Time Time Current&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt; Dload Upload Total Spent Left Speed&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt; 15 473M 15 75.3M 0 0 4554k 0 0:01:46 0:00:16 0:01:30 4552k2015-01-03 16:29:02 -0600: Template already exists, waiting for it to be ready&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt; 20 473M 20 98.8M 0 0 5122k 0 0:01:34 0:00:19 0:01:15 7489k2015-01-03 16:29:05 -0600: Template VM found&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;100 473M 100 473M 0 0 9245k 0 0:00:52 0:00:52 --:--:-- 9.9M&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;Iteration 1: Trying to access nfcLease.info.entity ...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;HttpNfcLeaseComplete succeeded&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi_box_url = &amp;#39;&lt;/span&gt;/root/box-files/esxi55-vmware_ovf-1.1.box&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Creating VM...
2015-01-03 16:29:42 -0600: Template fully prepared and ready to be &lt;span class=&quot;nv&quot;&gt;cloned&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Creating VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Powering on VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Powering on VM...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
 

&lt;h4&gt;B. Once the &amp;quot;vagrant up&amp;quot; command completes, you can check the status of the vms using &amp;quot;vagrant status&amp;quot;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant status&lt;/span&gt;
Current machine states:

esx-01a running &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
esx-02a running &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant status NAME&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Looking in vCenter you will see the virtual machines that vagrant deployed:&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/01-esx-01a.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;D. You can now ssh into either of the ESXi virtual machines using &amp;quot;vagrant ssh [vm_name]&amp;quot;:&lt;/h4&gt;

&lt;p&gt;To connect to esx-01a you simply run &amp;quot;vagrant ssh esx-01a&amp;quot;:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh esx-01a&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: External IP &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; esx-01a: 192.168.1.177
The &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;and date of this login have been sent to the system logs.

VMware offers supported, powerful system administration tools. Please
see www.vmware.com/go/sysadmintools &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; details.

The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; more information.

~ &lt;span class=&quot;c&quot;&gt;# esxcli network ip interface list&lt;/span&gt;
vmk0
 Name: vmk0
 MAC Address: 00:50:56:6f:9d:66
 Enabled: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;Portset: vSwitch0
 Portgroup: Management Network
 Netstack Instance: defaultTcpipStack
 VDS Name: N/A
 VDS UUID: N/A
 VDS Port: N/A
 VDS Connection: -1
 MTU: 1500
 TSO MSS: 65535
 Port ID: 33554437
~ &lt;span class=&quot;c&quot;&gt;# exit&lt;/span&gt;
Connection to 192.168.1.177 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The same can be done for esx-02a:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh esx-02a&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: External IP &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; esx-02a: 192.168.1.178
The &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;and date of this login have been sent to the system logs.

VMware offers supported, powerful system administration tools. Please
see www.vmware.com/go/sysadmintools &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; details.

The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; more information.
~ &lt;span class=&quot;c&quot;&gt;# esxcli network ip interface list&lt;/span&gt;
vmk0
 Name: vmk0
 MAC Address: 00:50:56:67:d5:b7
 Enabled: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt; &lt;/span&gt;Portset: vSwitch0
 Portgroup: Management Network
 Netstack Instance: defaultTcpipStack
 VDS Name: N/A
 VDS UUID: N/A
 VDS Port: N/A
 VDS Connection: -1
 MTU: 1500
 TSO MSS: 65535
 Port ID: 33554437
~ &lt;span class=&quot;c&quot;&gt;# exit&lt;/span&gt;
Connection to 192.168.1.178 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Once we are done using our virtual machines they can be destroyed with a &amp;quot;vagrant destroy&amp;quot; command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
    esx-02a: Are you sure you want to destroy the &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-02a&amp;#39;&lt;/span&gt; VM? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Powering off VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-02a: Destroying VM...
    esx-01a: Are you sure you want to destroy the &lt;span class=&quot;s1&quot;&gt;&amp;#39;esx-01a&amp;#39;&lt;/span&gt; VM? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Powering off VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esx-01a: Destroying VM...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;F. If you are ever unsure of the state of the vagrant virtual machines you can run &amp;quot;vagrant status&amp;quot; to check:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant status&lt;/span&gt;
Current machine states:

esx-01a                   not created &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
esx-02a                   not created &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vcenter&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;vagrant status NAME&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;That all for this post covering the basics of getting vagrant and the vagrant-vcenter provider installed/configured on CentOS.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Using packer on CentOS 6.5 to create an ESXi .box template for vagrant deployment</title>
   <link href="http://sdorsett.github.io/2015/01/03/using-packer-on-centos/"/>
   <updated>2015-01-03T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2015/01/03/using-packer-on-centos</id>
   <content type="html">&lt;p&gt;In the previous post I demonstrated using packer to create a ESXi .box template on OS X with fusion and the vagrant vmware provider. Both of these pieces of software have a cost associated with their usage, so in this post I will demonstrate how to use CentOS 6.5 and ESXi for the same results.  &lt;/p&gt;

&lt;p&gt;In this post we will again talk about two helpful gosddc projects:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf&quot;&gt;gosddc/packer-post-processor-vagrant-vmware-ovf&lt;/a&gt;.
This repo contains a packer post processor that leverages VMware OVF Tool to create a vmware_ovf Vagrant box that is compatible with vagrant-vcloud, vagrant-vcenter and vagrant-vcloudair vagrant providers. It is only compatible with the packer VMware builder. This project is a post processor that makes the generation of the .box file seemless. Unfortunately there currently seems to be &lt;a href=&quot;https://github.com/mitchellh/packer/issues/1457&quot;&gt;a bug with packer&lt;/a&gt; exporting the virtual machine artifact from a remote ESXi server. Hopefully this issue will be resolved with an upcoming release of packer which will allow this post processor to be used with remote ESXi.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-templates&quot;&gt;gosddc/packer-templates&lt;/a&gt;.
This repo contains Packer templates for boxes available at https://vagrantcloud.com/gosddc, they only work with VMware and require the packer-post-processor-vagrant-vmware-ovf post-processor to work. These templates are a good starting point for generating packer templates on VMware products.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We will be using a virtual machine with a minimal install of CentOS 6.5 to install everything we need to build the packer template.&lt;/p&gt;

&lt;h2&gt;1. Let&amp;#39;s get started by installing packer.&lt;/h2&gt;

&lt;h4&gt;A.  Copy the linux 64bit packer installer URL from the following link:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://www.packer.io/downloads.html&quot;&gt;https://www.packer.io/downloads.html&lt;/a&gt;&lt;/p&gt;

&lt;h4&gt;B.  Use wget on your CentOS vm to download the URL you copied&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget https://dl.bintray.com/mitchellh/packer/packer_0.7.5_linux_amd64.zip&lt;/span&gt;
--2015-01-02 21:17:41-- https://dl.bintray.com/mitchellh/packer/packer_0.7.5_linux_amd64.zip
Resolving dl.bintray.com... 108.168.194.91, 108.168.194.92
Connecting to dl.bintray.com&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;108.168.194.91&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;:443... connected.
HTTP request sent, awaiting response... &lt;span class=&quot;m&quot;&gt;302&lt;/span&gt; 
Resolving d29vzk4ow07wi7.cloudfront.net... 54.230.5.16, 54.230.5.11, 54.230.5.30, ...
Connecting to d29vzk4ow07wi7.cloudfront.net&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;54.230.5.16&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;:443... connected.
HTTP request sent, awaiting response... &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; OK
Length: &lt;span class=&quot;m&quot;&gt;87262135&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;83M&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;application/unknown&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
Saving to: &lt;span class=&quot;s2&quot;&gt;&amp;quot;packer_0.7.5_linux_amd64.zip&amp;quot;&lt;/span&gt;

100%&lt;span class=&quot;o&quot;&gt;[==================================================================================================&lt;/span&gt;&amp;gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 87,262,135 1.92M/s in 50s 

2015-01-02 21:18:42 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.65 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - &lt;span class=&quot;s2&quot;&gt;&amp;quot;packer_0.7.5_linux_amd64.zip&amp;quot;&lt;/span&gt; saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;87262135/87262135&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C.  Install the unzip package on our CentOS vm since that&amp;#39;s the format packer comes compressed in:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install -y unzip&lt;/span&gt;
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: repos.dfw.quadranet.com
 * extras: mirror.anl.gov
 * updates: mirror.us.oneandone.net
base                                                                                                                 &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 3.7 kB     00:00     
extras                                                                                                               &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 3.4 kB     00:00     
updates                                                                                                              &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 3.4 kB     00:00     
Resolving Dependencies
--&amp;gt; Running transaction check
---&amp;gt; Package unzip.x86_64 0:6.0-1.el6 will be installed
--&amp;gt; Finished Dependency Resolution

Dependencies &lt;span class=&quot;nv&quot;&gt;Resolved&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;============================================================================================================================================&lt;/span&gt;
 Package                         Arch                             Version                              Repository                      &lt;span class=&quot;nv&quot;&gt;Size&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;============================================================================================================================================&lt;/span&gt;
Installing:
 unzip                           x86_64                           6.0-1.el6                            base                           &lt;span class=&quot;m&quot;&gt;149&lt;/span&gt; k

Transaction &lt;span class=&quot;nv&quot;&gt;Summary&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;============================================================================================================================================&lt;/span&gt;
Install       &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; Package&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Total download size: &lt;span class=&quot;m&quot;&gt;149&lt;/span&gt; k
Installed size: &lt;span class=&quot;m&quot;&gt;313&lt;/span&gt; k
Downloading Packages:
unzip-6.0-1.el6.x86_64.rpm                                                                                           &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;149&lt;/span&gt; kB     00:00     
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : unzip-6.0-1.el6.x86_64                                                                                                   1/1 
  Verifying  : unzip-6.0-1.el6.x86_64                                                                                                   1/1 

Installed:
  unzip.x86_64 0:6.0-1.el6                                                                                                                  

Complete!
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D.  Create the /usr/local/packer_7.5 directory and unzip the packer download to this location.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir /usr/local/packer_7.5&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cp packer_0.7.5_linux_amd64.zip /usr/local/packer_7.5/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd /usr/local/packer_7.5/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# unzip packer_0.7.5_linux_amd64.zip&lt;/span&gt;
Archive: packer_0.7.5_linux_amd64.zip
inflating: packer 
inflating: packer-builder-amazon-chroot 
inflating: packer-builder-amazon-ebs 
inflating: packer-builder-amazon-instance 
inflating: packer-builder-digitalocean 
inflating: packer-builder-docker 
inflating: packer-builder-googlecompute 
inflating: packer-builder-null 
inflating: packer-builder-openstack 
inflating: packer-builder-parallels-iso 
inflating: packer-builder-parallels-pvm 
inflating: packer-builder-qemu 
inflating: packer-builder-virtualbox-iso 
inflating: packer-builder-virtualbox-ovf 
inflating: packer-builder-vmware-iso 
inflating: packer-builder-vmware-vmx 
inflating: packer-post-processor-atlas 
inflating: packer-post-processor-compress 
inflating: packer-post-processor-docker-import 
inflating: packer-post-processor-docker-push 
inflating: packer-post-processor-docker-save 
inflating: packer-post-processor-docker-tag 
inflating: packer-post-processor-vagrant 
inflating: packer-post-processor-vagrant-cloud 
inflating: packer-post-processor-vsphere 
inflating: packer-provisioner-ansible-local 
inflating: packer-provisioner-chef-client 
inflating: packer-provisioner-chef-solo 
inflating: packer-provisioner-file 
inflating: packer-provisioner-puppet-masterless 
inflating: packer-provisioner-puppet-server 
inflating: packer-provisioner-salt-masterless 
inflating: packer-provisioner-shell&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E.  Add /usr/local/packer_7.5 to your path by running the following command.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# export PATH=&amp;quot;/usr/local/packer_7.5:$PATH&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;F. Add the export command we just ran into ~/.bash_profile to ensure this path change persists after reboots.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat ~/.bash_profile&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/local/packer_7.5:$PATH&amp;quot;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;G. Stop iptables since packer will be using a http server to publish the ESXi kickstart files:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# service iptables stop&lt;/span&gt;
iptables: Setting chains to policy ACCEPT: filter &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; OK &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
iptables: Flushing firewall rules: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; OK &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
iptables: Unloading modules: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; OK &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer_7.5&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2. The next thing we need to do is download and install ovftool:&lt;/h2&gt;

&lt;h4&gt;A. Download and install the latest version of the VMware OVF tool. VMware-ovftool-3.5.1-1747221-lin.x86_64.bundle is what I used.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# chmod +x VMware-ovftool-3.5.1-1747221-lin.x86_64.bundle&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ./VMware-ovftool-3.5.1-1747221-lin.x86_64.bundle&lt;/span&gt;
Extracting VMware Installer...done.
You must accept the VMware OVF Tool component &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; Linux End User
License Agreement to &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;. Press Enter to proceed.
VMWARE END USER LICENSE AGREEMENT

1.4 &lt;span class=&quot;s2&quot;&gt;&amp;quot;Intellectual Property Rights&amp;quot;&lt;/span&gt; means all worldwide intellectual
property rights, including without limitation, copyrights, trademarks, service
Do you agree? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;yes/no&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;: yes

The product is ready to be installed. Press Enter to begin
installation or Ctrl-C to cancel.

Installing VMware OVF Tool component &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; Linux 3.5.1
Configuring...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;######################################################################] 100%&lt;/span&gt;
Installation was successful.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Verify ovftool is successfully added to your path by running &amp;quot;ovftool -v&amp;quot;. This command should output the version of ovftool we installed.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ovftool -v&lt;/span&gt;
VMware ovftool 3.5.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build-1747221&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;3. Now we can download and install the gosddc packer components we will need.&lt;/h2&gt;

&lt;h4&gt;A. Download the most recent linux amd64 version of the compiled packer-processor-vagrant-vmware-ovf binary from the following link:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf/releases&quot;&gt;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf/releases&lt;/a&gt;&lt;/p&gt;

&lt;h4&gt;B. Unzip packer-post-processor-vagrant-vmware-ovf and copy it to &amp;quot;/usr/local/packer_7.5&amp;quot;. Ensure the permissions of this file match the other files in this directory.&lt;/h4&gt;

&lt;h4&gt;C. Create a directory to contain the packer templates:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir ~/packer&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/packer&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5&gt;D. Clone the gosddc packer-templates repository:&lt;/h5&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# git clone https://github.com/gosddc/packer-templates.git&lt;/span&gt;
Initialized empty Git repository in /root/packer/packer-templates/.git/
remote: Counting objects: 195, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
remote: Total &lt;span class=&quot;m&quot;&gt;195&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, reused &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;delta 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Receiving objects: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;195/195&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, 39.32 KiB, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.
Resolving deltas: 100% &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;105/105&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;4. Next we need to download the ESXi 5.5 .iso and copy it into the proper directory location.&lt;/h2&gt;

&lt;h4&gt;A. create an &amp;quot;iso&amp;quot; directory for storing the ESXi iso files:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd packer-templates/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir iso&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Download and copy the &amp;quot;VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso&amp;quot; ESXi 5.5 installer to the iso directory.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cp ~/VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso iso/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;5. Finally we will need to modify, validate and build the packer esxi.json packer template we will be using.&lt;/h2&gt;

&lt;h4&gt;A. modify ~/packer/packer-templates/templates/esxi.json to look like the following:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vi templates/esxi.json&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat templates/esxi.json&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;version&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;builders&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vm_name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmdk_name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55-disk0&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmware-iso&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;headless&amp;quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;disk_size&amp;quot;&lt;/span&gt;: 4096,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;guest_os_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;centos-64&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_url&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;./iso/VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_checksum&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;ef599dc7e647177027684c0eee346ccdbc8704f2&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_checksum_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;sha1&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;remote_host&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;192.168.1.201&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;remote_datastore&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esx01-local-sata&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;remote_username&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;root&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;remote_password&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;mySecretP@ssw0rd&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;remote_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esx5&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_username&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;root&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_password&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_wait_timeout&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;60m&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;shutdown_command&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxcli system maintenanceMode set -e true -t 0 ; esxcli system shutdown poweroff -d 10 -r &amp;#39;Packer Shutdown&amp;#39; ; esxcli system maintenanceMode set -e false -t 0&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;tools_upload_flavor&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;linux&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;http_directory&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;boot_wait&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;5s&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmx_data&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;memsize&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;4096&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;numvcpus&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;vhv.enable&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;TRUE&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;ethernet0.virtualDev&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;e1000&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;ethernet0.networkName&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vlan2&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;ethernet0.present&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;TRUE&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmx_data_post&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;guestos&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmkernel5&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;ide1:0.present&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;FALSE&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;boot_command&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;enter&amp;gt;&amp;lt;wait&amp;gt;O&amp;lt;wait&amp;gt; ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/scripts/esxi-5-kickstart.cfg&amp;lt;enter&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;provisioners&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;file&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;source&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;puppet/modules/vagrantbaseconfig/files/vagrant.pub&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;/etc/ssh/keys-root/authorized_keys&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;script&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;scripts/esxi-vmware-tools_install.sh&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;script&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;scripts/esxi-cloning_configuration.sh&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are several things I would like to point out in the esxi.json file we just created.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;builder - this section specifies that we will be using the &amp;quot;vmware-iso&amp;quot; builder, with a remote ESXi host, to create our packer template. You will need to modify several part of this to match your ESXi server:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt; remote_host - this is the IP address of our ESXi server.&lt;/li&gt;
&lt;li&gt; remote_datastore - this is the datastore our virtual machine will be built on.&lt;/li&gt;
&lt;li&gt; remote_username - the ESXi username used to connect&lt;/li&gt;
&lt;li&gt; remote_password - the ESXi password used to connect&lt;/li&gt;
&lt;li&gt; remote_type - this specifies the remote server is ESXi 5.x&lt;/li&gt;
&lt;li&gt; ethernet0.networkName - this is the portgroup that the packer virtual machine connects to. This should be the same portgroup that the CentOS vm is one, since the ESXi install will need a kickstart file served by a http server included with packer.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Also in the builder section you might notice we are setting the &amp;quot;guest_os_type&amp;quot; to be &amp;quot;centos-64&amp;quot; during install. This is due to packer attempting to mount the vmtools .iso at the end of the install process. This has no impact on the install and we change it back to &amp;quot;vmkernel5&amp;quot; in the &amp;quot;vmx_data_post&amp;quot; section, which gets processed post after the virtual machine is powered down after the install process has completed.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;provisioners - this section specifies we will be using multiple provisioners to modify our template after it has been created:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;a file provisioner that will copy the vagrant public ssh key into our ESXi template&lt;/li&gt;
&lt;li&gt;a shell script to install the vmware tools VIB for nested ESXi&lt;/li&gt;
&lt;li&gt;a shell script to make necessary MAC address changes in our nested ESXi template.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;post-processors - I have removed the vagrant-vmware-ovf post processor due to the bug I mentioned earlier.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4&gt;B. modify the esxi-cloning_configuration.sh script in the scripts directory to read as follows:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vi scripts/esxi-cloning_configuration.sh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat scripts/esxi-cloning_configuration.sh&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Settings to ensure that ESXi cloning goes smooth, thanks @lamw ! see:&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# http://www.virtuallyghetto.com/2013/12/how-to-properly-clone-nested-esxi-vm.html&lt;/span&gt;
esxcli system settings advanced &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt; -o /Net/FollowHardwareMac -i 1
sed -i &lt;span class=&quot;s1&quot;&gt;&amp;#39;/\/system\/uuid/d&amp;#39;&lt;/span&gt; /etc/vmware/esx.conf
sed -i &lt;span class=&quot;s1&quot;&gt;&amp;#39;/\/net\/vmkernelnic\/child\[0000\]\/mac/d&amp;#39;&lt;/span&gt; /etc/vmware/esx.conf

&lt;span class=&quot;c&quot;&gt;# DHCP doesn&amp;#39;t refresh correctly upon boot, this will force a renew, it will&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# be executed on every boot, if you don&amp;#39;t like this behavior you can remove&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the line during the Vagrant provisioning part.&lt;/span&gt;
sed -i &lt;span class=&quot;s1&quot;&gt;&amp;#39;/exit 0/d&amp;#39;&lt;/span&gt; /etc/rc.local.d/local.sh 
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;esxcli network ip interface set -e false -i vmk0; esxcli network ip interface set -e true -i vmk0&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local.d/local.sh 
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;exit 0&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local.d/local.sh 

&lt;span class=&quot;c&quot;&gt;# Ensure changes are persistent&lt;/span&gt;
/sbin/auto-backup.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We are adding the following line to delete the line that contains the vmkernel port MAC address in /etc/vmware/esx.conf, in order to force it to be regenerated on each clones template:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sed -i &lt;span class=&quot;s1&quot;&gt;&amp;#39;/\/net\/vmkernelnic\/child\[0000\]\/mac/d&amp;#39;&lt;/span&gt; /etc/vmware/esx.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Validate the packer esxi.json file is ready for building by running the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# packer validate templates/esxi.json &lt;/span&gt;
Template validated successfully.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Start the build by running:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# packer build templates/esxi.json &lt;/span&gt;
esxi55 output will be in this color.

&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Downloading or copying ISO
esxi55: Downloading or copying: file:///root/packer/packer-templates/iso/VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Uploading ISO to remote machine...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Creating virtual machine &lt;span class=&quot;nv&quot;&gt;disk&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Building and writing VMX &lt;span class=&quot;nv&quot;&gt;file&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Starting HTTP server on port &lt;span class=&quot;nv&quot;&gt;8828&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Registering remote VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Starting virtual machine...
esxi55: The VM will be run headless, without a GUI. If you want to
esxi55: view the screen of the VM, connect via VNC without a password to
esxi55: 192.168.1.201:5988
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Waiting 5s &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; boot...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Connecting to VM via &lt;span class=&quot;nv&quot;&gt;VNC&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Typing the boot &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;over VNC...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Connected to SSH!
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Uploading puppet/modules/vagrantbaseconfig/files/vagrant.pub &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /etc/ssh/keys-root/authorized_keys
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Provisioning with shell script: scripts/esxi-vmware-tools_install.sh
esxi55: Installation Result
esxi55: Message: The update completed successfully, but the system needs to be rebooted &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; the changes to be effective.
esxi55: Reboot Required: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
esxi55: VIBs Installed: VMware_bootbank_esx-tools-for-esxi_9.7.0-0.0.00000
esxi55: VIBs Removed:
esxi55: VIBs Skipped:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Provisioning with shell script: scripts/esxi-cloning_configuration.sh
esxi55: diff: can&lt;span class=&quot;s1&quot;&gt;&amp;#39;t stat &amp;#39;&lt;/span&gt;/tmp/auto-backup.35224//etc/ssh/keys-root/authorized_keys&lt;span class=&quot;s1&quot;&gt;&amp;#39;: No such file or directory&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Saving current state in /bootbank&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Clock updated.&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Time: 04:39:41 Date: 01/03/2015 UTC&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Gracefully halting virtual machine...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Waiting for VMware to clean up after itself...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Deleting unnecessary VMware files...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Deleting: /vmfs/volumes/esx01-local-sata/output-esxi55/vmware.log&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Cleaning VMX prior to finishing up...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Unmounting floppy from VMX...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;esxi55: Detaching ISO from CD-ROM device...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Compacting the disk image&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Unregistering virtual machine...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;Build &amp;#39;&lt;/span&gt;esxi55&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt; finished.

&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; Builds finished. The artifacts of successful builds are:
--&amp;gt; esxi55: VM files in directory: /vmfs/volumes/esx01-local-sata/output-esxi55
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant packer-templates&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you want to keep an eye on the build process you can connect a VNC client to the address and port listed during the packer build process. For my build this was what was displayed:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;esxi55: The VM will be run headless, without a GUI. If you want to
esxi55: view the screen of the VM, connect via VNC without a password to
esxi55: 192168.1.201:5988&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The other option to track the progress of the ESXi install is to open the console of the virtual machine in the VI or web client.&lt;/p&gt;

&lt;h4&gt;D. The last line of the packer output shows the datastore location of the virtual machine that was created. We need to SSH to the ESXi host in order to re-register the virtual machine, in order to export it using ovftool:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ssh root@192.168.1.201 &amp;quot;vim-cmd solo/registervm /vmfs/volumes/esx01-local-sata/output-esxi55/*.vmx&amp;quot;&lt;/span&gt;
Password: 
70&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Update this command to reflect the IP address and path to the virtual machine that packer created. Also take note of the vmid that the command returns, since we&amp;#39;ll need this in a future step.&lt;/p&gt;

&lt;h4&gt;E. Use the following command to export the virtual machine we just registered:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ovftool vi://root:[esxi_password]@192.168.1.201/esxi55 ./&lt;/span&gt;
Opening VI &lt;span class=&quot;nb&quot;&gt;source&lt;/span&gt;: vi://root@192.168.1.201:443/esxi55
Opening OVF target: ./
Writing OVF package: ./esxi55/esxi55.ovf
Transfer Completed 
Completed successfully&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Replace the IP address, password and virtual machine name if needed.&lt;/p&gt;

&lt;h4&gt;F. Unregister the virtual machine template using the following command with the vmid returned by the registration command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ssh root@192.168.1.201 &amp;quot;vim-cmd vmsvc/unregister 70&amp;quot;&lt;/span&gt;
Password:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;6. Since we disable the vagrant-vcenter-ovf post processor, we will need to create the .box file according to the specifications&lt;a href=&quot;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf/wiki/vmware_ovf-Box-Format&quot;&gt; listed here&lt;/a&gt;:&lt;/h2&gt;

&lt;h4&gt;A. Create the metadata.json file needed by the vagrant-vmware-ovf .box file:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# echo &amp;#39;{&amp;quot;provider&amp;quot;:&amp;quot;vmware_ovf&amp;quot;}&amp;#39; &amp;gt;&amp;gt; metadata.json&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Create an empty Vagrantfile to include in the .box file:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# touch Vagrantfile&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Use tar to compress the files in this directory into a .box file:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar cvzf esxi55-vmware_ovf-1.1.box ./*&lt;/span&gt;
./esxi55-disk1.vmdk
./esxi55.mf
./esxi55.ovf
./metadata.json
./Vagrantfile
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ls -la&lt;/span&gt;
total 968296
drwxr-xr-x. &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; root root      &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:36 .
drwxr-xr-x. &lt;span class=&quot;m&quot;&gt;9&lt;/span&gt; root root      &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 20:12 ..
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;m&quot;&gt;496975360&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:32 esxi55-disk1.vmdk
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root       &lt;span class=&quot;m&quot;&gt;125&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:32 esxi55.mf
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root      &lt;span class=&quot;m&quot;&gt;7522&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:32 esxi55.ovf
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;m&quot;&gt;494527542&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:36 esxi55-vmware_ovf-1.1.box
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root        &lt;span class=&quot;m&quot;&gt;26&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:34 metadata.json
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; root root         &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; Jan  &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; 15:34 Vagrantfile
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant esxi55&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;That all for this post covering the basics of getting packer and getting it installed/configured on CentOS. In the next blog post I&amp;#39;m planning  on covering how to install vagrant on CentOS and using it to deploy this .box templates to vCenter.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Using packer on OS X to create an ESXi .box template for vagrant deployment</title>
   <link href="http://sdorsett.github.io/2014/12/28/getting-packer-installed-on-OS-X/"/>
   <updated>2014-12-28T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/12/28/getting-packer-installed-on-OS-X</id>
   <content type="html">&lt;p&gt;I&amp;#39;ve been recently working on using packer to create vagrant .box files rather than manually creating them as I documented in a previous post. For this post I will be using fusion and the vagrant vmware provider, each of which have an associated cost, but I will cover a free alternative using packer and CentOS in a future post.&lt;/p&gt;

&lt;p&gt;Several github projects by gosddc have helped me in getting packer up and running on my Macbook:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf&quot;&gt;gosddc/packer-post-processor-vagrant-vmware-ovf&lt;/a&gt;.
This repo contains a packer post processor that leverages VMware OVF Tool to create a vmware_ovf Vagrant box that is compatible with vagrant-vcloud, vagrant-vcenter and vagrant-vcloudair vagrant providers. It is only compatible with the packer VMware builder.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-templates&quot;&gt;gosddc/packer-templates&lt;/a&gt;.
This repo contains Packer templates for boxes available at https://vagrantcloud.com/gosddc, they only work with VMware and require the packer-post-processor-vagrant-vmware-ovf post-processor to work. These templates are a good starting point for generating pakcer templates on VMware products.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;1. Let&amp;#39;s get started by installing packer.&lt;/h2&gt;

&lt;h4&gt;A.  Download packer from the following link:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://www.packer.io/downloads.html&quot;&gt;https://www.packer.io/downloads.html&lt;/a&gt;&lt;/p&gt;

&lt;h4&gt;B.  Unzip the downloaded files to /usr/local/packer_7.5:&lt;/h4&gt;

&lt;h4&gt;C.  Add /usr/local/packer_7.5 to your path by running the following command.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:~ sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/local/packer_7.5:$PATH&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Add the export command we just ran into ~/.bash_profile to ensure this path change persists after reboots.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:~ sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cat ~/.bash_profile
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;/usr/local/packer_7.5:$PATH&amp;quot;&lt;/span&gt;
sdorsett-mbp:~ sdorsett&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2. Next we need to download and install VMware ovftool, since the vagrant-vmware-ovf requires it.&lt;/h2&gt;

&lt;h4&gt;A. Download and install the latest version of the VMware OVF tool. VMware-ovftool-3.5.0-1274719-mac.x64.dmg is what I used.&lt;/h4&gt;

&lt;h4&gt;B. Verify ovftool is succesfully added to your path by running &amp;quot;ovftool -v&amp;quot;. This command should output the version of ovftool we installed.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:~ sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ovftool -v
VMware ovftool 3.5.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;build-1274719&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;3. Now we can download and install the gosddc packer components we will need.&lt;/h2&gt;

&lt;h4&gt;A. Download the most recent version of the compiled packer-processor-vagrant-vmware-ovf binary from the following link:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf/releases&quot;&gt;https://github.com/gosddc/packer-post-processor-vagrant-vmware-ovf/releases&lt;/a&gt;&lt;/p&gt;

&lt;h4&gt;B. Unzip packer-post-processor-vagrant-vmware-ovf and copy it to &amp;quot;usr/local/packer_7.5&amp;quot;. Ensure the permissions of this file match the other files in this directory.&lt;/h4&gt;

&lt;h4&gt;C. Create a directory to contain the packer templates:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:~ sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir ~/Documents/packer
sdorsett-mbp:~ sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/Documents/packer/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h5&gt;D. Clone the gosddc packer-templates repository:&lt;/h5&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/gosddc/packer-templates.git
sdorsett-mbp:packer sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;packer-templates&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;4. Now we need to download the ESXi 5.5 .iso and copy it into the proper directory location.&lt;/h2&gt;

&lt;h4&gt;A. create an &amp;quot;iso&amp;quot; directory for storing the ESXi iso files:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir ~/Documents/packer/packer-templates/iso&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Download and copy the &amp;quot;VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso&amp;quot; ESXi 5.5 installer to the iso directory.&lt;/h4&gt;

&lt;h2&gt;5. Finally we will need to modify, validate and build the packer esxi.json packer template we will be using.&lt;/h2&gt;

&lt;h4&gt;A. modify ~/Documents/packer/packer-templates/templates/esxi.json to look like the following:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cat templates/esxi.json
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;variables&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;version&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;builders&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vm_name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmdk_name&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxi55-disk0&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmware-iso&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;headless&amp;quot;&lt;/span&gt;: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;disk_size&amp;quot;&lt;/span&gt;: 4096,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;guest_os_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmkernel5&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_url&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;./iso/VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_checksum&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;ef599dc7e647177027684c0eee346ccdbc8704f2&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;iso_checksum_type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;sha1&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_username&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;root&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_password&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;ssh_wait_timeout&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;60m&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;shutdown_command&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;esxcli system maintenanceMode set -e true -t 0 ; esxcli system shutdown poweroff -d 10 -r &amp;#39;Packer Shutdown&amp;#39; ; esxcli system maintenanceMode set -e false -t 0&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;http_directory&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;.&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;boot_wait&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;5s&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;vmx_data&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;memsize&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;4096&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;numvcpus&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;vhv.enable&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;TRUE&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;boot_command&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;enter&amp;gt;&amp;lt;wait&amp;gt;O&amp;lt;wait&amp;gt; ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/scripts/esxi-5-kickstart.cfg&amp;lt;enter&amp;gt;&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;provisioners&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;file&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;source&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;puppet/modules/vagrantbaseconfig/files/vagrant.pub&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;destination&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;/etc/ssh/keys-root/authorized_keys&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;script&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;scripts/esxi-vmware-tools_install.sh&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;,
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;shell&amp;quot;&lt;/span&gt;,
      &lt;span class=&quot;s2&quot;&gt;&amp;quot;script&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;scripts/esxi-cloning_configuration.sh&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;s2&quot;&gt;&amp;quot;post-processors&amp;quot;&lt;/span&gt;: &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;s2&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant-vmware-ovf&amp;quot;&lt;/span&gt;,
     &lt;span class=&quot;s2&quot;&gt;&amp;quot;compression_level&amp;quot;&lt;/span&gt;: 9,
     &lt;span class=&quot;s2&quot;&gt;&amp;quot;output&amp;quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&amp;quot;{{.BuildName}}-{{.Provider}}-{{user `version`}}.box&amp;quot;&lt;/span&gt;

   &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;There are several things I would like to point out in the esxi.json file we just created.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;builder - this section specifies that we will be using the &amp;quot;vmware-iso&amp;quot; builder, with VMware fusion, to create our packer template. We can modify attributes of our template virtual machine in this section:

&lt;ul&gt;
&lt;li&gt;disk size ( disk_size)&lt;/li&gt;
&lt;li&gt;memory ( memsize )&lt;/li&gt;
&lt;li&gt;vCPU count ( numvcpus )&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;provisioners - this section specifies we will be using multiple provisioners to modify our template after it has been created:

&lt;ul&gt;
&lt;li&gt;a file provisioner that will copy the vagrant public ssh key into our ESXi template&lt;/li&gt;
&lt;li&gt;a shell script to install the vmware tools VIB for nested ESXi&lt;/li&gt;
&lt;li&gt;a shell script to make necessary MAC address changes in our nested ESXi template.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;post-processors - this final section will convert the virtual machine artifact generated in VMware fusion into a vmware-ovf .box file we can use with vagrant&lt;/li&gt;
&lt;/ol&gt;

&lt;h4&gt;B. Validate the packer esxi.json file is ready for building by running the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer validate templates/esxi.json
Template validated successfully.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Start the build by running:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;packer build templates/esxi.json
esxi55 output will be in this color.

&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Downloading or copying ISO
    esxi55: Downloading or copying: file:///Users/sdorsett/Documents/packer/packer-templates/iso/VMware-VMvisor-Installer-5.5.0-1331820.x86_64.iso
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Creating virtual machine &lt;span class=&quot;nv&quot;&gt;disk&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Building and writing VMX &lt;span class=&quot;nv&quot;&gt;file&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Starting HTTP server on port &lt;span class=&quot;nv&quot;&gt;8351&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Starting virtual machine...
    esxi55: The VM will be run headless, without a GUI. If you want to
    esxi55: view the screen of the VM, connect via VNC without a password to
    esxi55: 127.0.0.1:5986
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Waiting 5s &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; boot...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Connecting to VM via &lt;span class=&quot;nv&quot;&gt;VNC&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Typing the boot &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;over VNC...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Connected to SSH!
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Uploading puppet/modules/vagrantbaseconfig/files/vagrant.pub &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /etc/ssh/keys-root/authorized_keys
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Provisioning with shell script: scripts/esxi-vmware-tools_install.sh
    esxi55: Installation Result
    esxi55: Message: The update completed successfully, but the system needs to be rebooted &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; the changes to be effective.
    esxi55: Reboot Required: &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;esxi55: VIBs Installed: VMware_bootbank_esx-tools-for-esxi_9.7.0-0.0.00000
    esxi55: VIBs Removed:
    esxi55: VIBs Skipped:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; esxi55: Provisioning with shell script: scripts/esxi-cloning_configuration.sh
    esxi55: diff: can&lt;span class=&quot;s1&quot;&gt;&amp;#39;t stat &amp;#39;&lt;/span&gt;/tmp/auto-backup.35216//etc/ssh/keys-root/authorized_keys&lt;span class=&quot;s1&quot;&gt;&amp;#39;: No such file or directory&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Saving current state in /bootbank&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Clock updated.&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Time: 02:09:44   Date: 12/30/2014   UTC&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Gracefully halting virtual machine...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Waiting for VMware to clean up after itself...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Deleting unnecessary VMware files...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Deleting: output-esxi55/564d2ab2-395b-a9ba-9c17-2fe36682237c.vmem&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Deleting: output-esxi55/esxi55.plist&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Deleting: output-esxi55/vmware.log&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Cleaning VMX prior to finishing up...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Unmounting floppy from VMX...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55: Detaching ISO from CD-ROM device...&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Compacting the disk image&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55: Running post-processor: vagrant-vmware-ovf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;==&amp;gt; esxi55 (vagrant-vmware-ovf): Creating Vagrant box for &amp;#39;&lt;/span&gt;vmware_ovf&lt;span class=&quot;s1&quot;&gt;&amp;#39; provider&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Deleting key: ide1:0.filename&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Deleting key: floppy0.present&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Setting key: floppy0.present = FALSE&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Setting key: ide1:0.present = FALSE&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Creating directory: output-esxi55/ovf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Starting ovftool&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Reading files in output-esxi55/ovf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Copying: esxi55-disk1.vmdk&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Copying: esxi55.mf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Copying: esxi55.ovf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Compressing: Vagrantfile&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Compressing: esxi55-disk1.vmdk&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Compressing: esxi55.mf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Compressing: esxi55.ovf&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;    esxi55 (vagrant-vmware-ovf): Compressing: metadata.json&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;Build &amp;#39;&lt;/span&gt;esxi55&lt;span class=&quot;s1&quot;&gt;&amp;#39; finished.&lt;/span&gt;

&lt;span class=&quot;s1&quot;&gt;==&amp;gt; Builds finished. The artifacts of successful builds are:&lt;/span&gt;
&lt;span class=&quot;s1&quot;&gt;--&amp;gt; esxi55: &amp;#39;&lt;/span&gt;vmware_ovf&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt; provider box: esxi55-vmware_ovf-1.0.box
sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If you want to keep an eye on the build process you can connect a VNC client to the address and port listed during the packer build process. For my build this was what was displayed:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;esxi55: The VM will be run headless, without a GUI. If you want to
    esxi55: view the screen of the VM, connect via VNC without a password to
    esxi55: 127.0.0.1:5986&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When I connected the &amp;quot;Chicken of the VNC&amp;quot; client installed on my macbook to &amp;quot;127.0.0.1:5986&amp;quot; I could see where the build was at during the install process:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/01-esxi-vnc-client.png&quot; alt=&quot;screenshot&quot;&gt;  &lt;/p&gt;

&lt;h4&gt;D. Once the packer build completes you should end up with a &amp;quot;esxi55-vmware_ovf-1.0.box&amp;quot; file in the same directory you ran the &amp;quot;packer build&amp;quot; command in. This .box file can be used with vagrant and the gosddc vagrant providers to deploy this template to ESXi, vCenter, vCloud Director and vCloud Air.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sdorsett-mbp:packer-templates sdorsett&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ls *.box
esxi55-vmware_ovf-1.0.box&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Hopefully you found this post helpful in getting packer and the packer vagrant-vmware-ovf post processor installed/configured. The next blog post will be covering how to install packer on CentOS and build a packer virtual machine on a remote ESXi host.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Installing Vagrant and the vagrant-vcloud plugin on CentOS 6.x</title>
   <link href="http://sdorsett.github.io/2014/05/26/vagrant-install/"/>
   <updated>2014-05-26T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/05/26/vagrant-install</id>
   <content type="html">&lt;p&gt;In this post I&amp;#39;m setting out to explain how to create a CentOS 6.4 vm, from template, in vCHS (or a vCloud Director instance) and then install vagrant-vcloud on that. &lt;/p&gt;

&lt;h3&gt;1. Create a CentOS 6.x minimal virtual machine from a template in a vCHS organization.&lt;/h3&gt;

&lt;p&gt;I will demonstrate creating a new CentOS vm in vCHS using a template, but you could just as easily create a new CentOS virtual machine from scratch in vCloud Director.&lt;/p&gt;

&lt;h4&gt;A. Log into vCHS using your credentials and click on your virtual datacenter.&lt;/h4&gt;

&lt;h4&gt;B. Next click on the &amp;quot;Virtual Machines&amp;quot; tab and then click the &amp;quot;Deploy a Virtual Machine&amp;quot; button:&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/01-create-centos-64-vm.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;C. Select the &amp;quot;CentOS 6.4 64 Bit&amp;quot; template and click &amp;quot;Continue&amp;quot;&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/02-select-centos-64-template.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;D. Name the virtual machine and set the guest OS name of your new virtual machine. Click &amp;quot;Deploy This Virtual Machine&amp;quot;:&lt;/h4&gt;

&lt;p&gt;I named my virtual machine and set the guest OS name both to &amp;quot;vagrant&amp;quot;, but you can change these to what ever you prefer.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/03-virtual-machine-resource-settings.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;E. Power on and then click the name of the virtual machine you just created:&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/04-centos-vm-created.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;F. Click the &amp;quot;Launch Console&amp;quot; link to open the console of the virtual machine you just created.&lt;/h4&gt;

&lt;p&gt;Notice that the guest OS password created by guest customization is displayed on the left. Log into the virtual machine, using &amp;quot;root&amp;quot; and the displayed password, then change this password immediately to something else:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/05-open-console-and-log-in.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h3&gt;2. Modify /etc/resolv.conf&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat /etc/resolv.conf&lt;/span&gt;
nameserver 8.8.8.8 
nameserver 8.8.4.4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;At this point you should have network connectivity to your new vagrant vapp. While I won&amp;#39;t cover it in the post, you can now either setup a DNAT rule to forward SSH to the vagrant vapp or continue the configuration using the vapp console.&lt;/p&gt;

&lt;h3&gt;3. Install Ruby 1.9.3 using ruby-build:&lt;/h3&gt;

&lt;h4&gt;A. Use yum to install the packages we&amp;#39;ll need to get ruby, rubygems and vagrant installed:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install -y gcc-c++ glibc-headers openssl-devel readline libyaml-devel readline-devel zlib zlib-devel iconv-devel libxml2 libxml2-devel libxslt libxslt-devel wget git&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Pull down the latest version of ruby-build using git:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# git clone https://github.com/sstephenson/ruby-build.git&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Change to the directory the previous command created:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ruby-build/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Run the &amp;#39;install.sh&amp;#39; script to install ruby-build:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ./install.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. I would recommend installing Ruby version 1.9.3-p545 with the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby-build --definitionsruby-build 1.9.3-p545 /usr/local/&lt;/span&gt;
Downloading yaml-0.1.6.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/5fe00cda18ca5daeb43762b80c38e06e
Installing yaml-0.1.6...
Installed yaml-0.1.6 to /usr/local/

Downloading ruby-1.9.3-p545.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/8e8f6e4d7d0bb54e0edf8d9c4120f40c
Installing ruby-1.9.3-p545...

Installed ruby-1.9.3-p545 to /usr/local/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;4. Install rubygems by downloading the latest version from &lt;a href=&quot;https://rubygems.org/pages/download&quot;&gt;rubygems.org&lt;/a&gt; and install it:&lt;/h3&gt;

&lt;h4&gt;A. Use wget to download the latest version listed on the rubygems download page:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget http://production.cf.rubygems.org/rubygems/rubygems-2.2.2.tgz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Use tar to unzip the tar-gzipped file we downloaded:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar xvzf rubygems-2.2.2.tgz&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd rubygems-2.2.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Install rubygems by running the &amp;#39;setup.rb&amp;#39; script:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.2.2&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby setup.rb&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;5. Install Vagrant&lt;/h3&gt;

&lt;h4&gt;A. Use wget to download the latest version listed on the &lt;a href=&quot;https://www.vagrantup.com/downloads.html&quot;&gt;Vagrant download&lt;/a&gt; page:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.2.2&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.6.2_x86_64.rpm&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Use the &amp;#39;rpm&amp;#39; command to install the RPM package we downloaded in the previous step:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# rpm -i vagrant_1.6.2_x86_64.rpm&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Export the directory that the vagrant executable was install to, in order to make it easier to run:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# export PATH=$PATH:/opt/vagrant/bin/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;6. Installing the vagrant-vcloud plugin&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant blog&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant plugin install vagrant-vcloud&lt;/span&gt;
Installing the &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vcloud&amp;#39;&lt;/span&gt; plugin. This can take a few minutes...
Installed the plugin &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vcloud (0.3.3)&amp;#39;&lt;/span&gt;!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;7. Creating a Vagrantfile for testing vagrant-vcloud install&lt;/h3&gt;

&lt;h4&gt;A.  We need to create a directory structure and Vagrantfile to test that the vagrant-vcloud provider is properly working. For the .box file we will use a sample precise32 (Ubuntu 12.04 32bit) vagrant .box file created for the vcloud provider by &lt;a href=&quot;http://blog.tsugliani.fr/&quot;&gt;Timo Sugliani&lt;/a&gt;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir -p ~/vagrant-vms/precise32-test&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat ~/vagrant-vms/precise32-test/Vagrantfile &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;precise32_vm_box_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://vagrant.tsugliani.fr/precise32.box&amp;quot;&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;nodes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; :hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;test-vm&amp;quot;&lt;/span&gt;,  
    :box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;precise32&amp;quot;&lt;/span&gt;, 
    :box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; precise32_vm_box_url &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;

  &lt;span class=&quot;c&quot;&gt;# vCloud Director provider settings&lt;/span&gt;
  config.vm.provider :vcloud &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vcloud&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;

    vcloud.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;https://[Your_vCD_URL]:443&amp;#39;&lt;/span&gt;
    vcloud.username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_username@somedomain.com]&amp;#39;&lt;/span&gt;
    vcloud.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_password]&amp;#39;&lt;/span&gt;

    vcloud.org_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_org_name]&amp;#39;&lt;/span&gt;
    vcloud.vdc_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_vdc_name]&amp;#39;&lt;/span&gt;
    vcloud.catalog_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_org_catalog]&amp;#39;&lt;/span&gt;
    vcloud.network_bridge &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vcloud.vdc_network_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;[Your_vCHS_vdc_name]-default-routed&amp;#39;&lt;/span&gt;

  end

  nodes.each &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    config.vm.define node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;node_config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
      node_config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.hostname &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:hostname&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
      node_config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;:box_url&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    end
  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In this configuration file:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;quot;vcloud.hostname&amp;quot; is your vCloud Director FQDN or IP address. This should be the base URL and not by the specific URL for your org.&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.username&amp;quot; is the username we will be using to connect to vCHS or vCloud Director&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.password&amp;quot; is the password we will be using to connect to vCHS or vCloud Director&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.org_name&amp;quot; will be the name of your vCHS or vCloud Director organization&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.vdc_name&amp;quot; will be the name of your vCHS or vCloud Director virtual datacenter&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.catalog_name&amp;quot; will be the name of your organization catalog a template derived from the .box file will be created in&lt;/li&gt;
&lt;li&gt;&amp;quot;vcloud.dc_network_name&amp;quot; is the organization network the vagrant vapp will be connected to&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;B.  Now we can change directory to that directory and test everything with a &amp;quot;vagrant up --provider=vcloud&amp;quot;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/vagrant-vms/precise32-test&lt;/span&gt;
oot@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up --provider=vcloud&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;test-vm&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcloud&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Box &lt;span class=&quot;s1&quot;&gt;&amp;#39;precise32&amp;#39;&lt;/span&gt; could not be found. Attempting to find and install...
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Box Provider: vcloud
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Box Version: &amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Adding box &lt;span class=&quot;s1&quot;&gt;&amp;#39;precise32&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; provider: vcloud
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Downloading: http://vagrant.tsugliani.fr/precise32.box
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Successfully added box &lt;span class=&quot;s1&quot;&gt;&amp;#39;precise32&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;v0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcloud&amp;#39;&lt;/span&gt;!
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Catalog item &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;precise32&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; in Catalog &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Org Private Catalog&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; does not exist!
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Would you like to upload the &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;precise32&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; box to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Org Private Catalog&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Catalog?
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Choice &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;yes/no&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;nv&quot;&gt;yes&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Uploading &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;precise32&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;...
Uploading Box...
Uploading Box...
Uploading Box... Progress: 22%  ETA: 00:02:16&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Once the .box files has started uploading, you can check the progress in the org catalog of your vCloud Director instance:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/06-precise32-upload.png&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;C. The uploading progress will get to 100% and you will see the vApp getting created, powered on and SSH access achieved:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Uploading Box...
Uploading Box... Progress: 100% Time: 00:02:32                                                                                                   
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Adding &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;precise32&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; to Catalog &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Org Private Catalog&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Building vApp...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: vApp Vagrant-root-vagrant-8b9115d1 successfully created.
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Powering on VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH Access on 192.168.109.4:22 ... 
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH Access on 192.168.109.4:22 ... 
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH Access on 192.168.109.4:22 ... 
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Rsyncing folder: /root/vagrant-vms/precise32-test/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /vagrant
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# root@vagrant precise32-test]#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Test network connectivity by running &amp;quot;vagrant ssh&amp;quot;:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: External IP &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: 192.168.109.4
Welcome to Ubuntu 12.04 LTS &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GNU/Linux 3.2.0-23-generic-pae i686&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

 * Documentation:  https://help.ubuntu.com/
Welcome to your Vagrant-built virtual machine.
Last login: Thu Jul &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt; 11:20:25 2013
vagrant@test-vm:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hostname -f
&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Run &amp;quot;vagrant vcloud --status&amp;quot; to validate the vCloud Director status of your vagrant vapp:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant vcloud --status&lt;/span&gt;
Initializing vCloud Director provider...
Fetching vCloud Director status...
+-------------------------------+-----------------------------------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;  Vagrant vCloud Director Status : https://&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Your_vCD_URL&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;:443            &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+-------------------------------+-----------------------------------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Organization Name             &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Your_vCHS_org_name&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;                    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Organization vDC Name         &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; vCHS-vagrant-demo                       &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Organization vDC ID           &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; b9494d6a-ebda-4368-8f76-0e93b7edcb17    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Organization vDC Network Name &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Your_vCHS_vdc_name&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;-default-routed     &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+-------------------------------+-----------------------------------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; vApp Name                     &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Vagrant-root-vagrant-8b9115d1           &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; vAppID                        &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; ec918e84-6026-42b2-8639-5390d8c88b0c    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; -&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm                    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 4fc82b9b-c79d-483b-9a71-a87d22289102    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+-------------------------------+-----------------------------------------+&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;F. Run &amp;quot;vagrant vcloud --network&amp;quot; to validate the vCloud Director network mapping of your vagrant vapp:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant vcloud --network&lt;/span&gt;
Initializing vCloud Director provider...
Fetching vCloud Director network settings ...
+---------+---------------+------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;             Network Map              &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+---------+---------------+------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; VM Name &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; IP Address    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Connection &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+---------+---------------+------------+
&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; 192.168.109.4 &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; Direct     &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
+---------+---------------+------------+&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;g. Destroy the cloned vm by running &amp;quot;vagrant destroy&amp;quot; command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Are you sure you want to destroy the &lt;span class=&quot;s1&quot;&gt;&amp;#39;test-vm&amp;#39;&lt;/span&gt; VM? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;y&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Powering off VM...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Single VM left in the vApp, Powering off vApp...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;-vm: Destroying vApp...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant precise32-test&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should see &amp;quot;Power Off vapp&amp;quot; and &amp;quot;Delete vapp&amp;quot; tasks being run and then completing on your organizations vapps.&lt;/p&gt;

&lt;h3&gt;Hopefully you found this post helpful in getting vagrant and the vagrant-cloud plugin installed and configured. The next blog post will be covering how to modify the Vagrantfile to create a vapp in a vCHS or vCloud Director instance that doesn&amp;#39;t contain the vagrant vm.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Introducing the vagrant-vcloud provider</title>
   <link href="http://sdorsett.github.io/2014/05/25/vagrant-vcloud/"/>
   <updated>2014-05-25T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/05/25/vagrant-vcloud</id>
   <content type="html">&lt;p&gt;While continuing to explore what the vagrant-vsphere provider is capable of I came across the &lt;a href=&quot;https://github.com/frapposelli/vagrant-vcloud&quot;&gt;vagrant-vcloud&lt;/a&gt; provider, which had recently released a new version. I work for the vCHS operations group, so I figured it would be interesting to compare the feature differences of the vsphere &amp;amp; vcloud providers. &lt;/p&gt;

&lt;p&gt;Over the next few blog posts I intend to cover the following vagrant-vcloud provider related topics:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://sdorsett.github.io/2014/05/26/vagrant-install/&quot;&gt;Installing Vagant and the vagrant-vcloud plugin on a CentOS 6.x virtual machine in vCloud Directory or vCHS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Creating a simple vagrant-vcloud Vagrantfile configuration to deploy a vm &lt;/li&gt;
&lt;li&gt;Creating a more advanced vagrant-vcloud Vagrantfile configuration&lt;/li&gt;
&lt;li&gt;Creating a CentOS 6.x .box that is customized for Vagrant and vcloud director&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These posts will hopefully explain the steps necessary to get vagrant-vcloud installed and working with a vCloud Director or vCHS environment.&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Creating a Puppet manifest and integrating it with Vagrant</title>
   <link href="http://sdorsett.github.io/2014/05/06/vagrant-and-puppet/"/>
   <updated>2014-05-06T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/05/06/vagrant-and-puppet</id>
   <content type="html">&lt;p&gt;This post will cover configuring Vagrant to automatically run a Puppet manifest on the vm created by &amp;quot;vagrant up.&amp;quot; This capability allows you to test your Puppet manifests, make changes and test again, all quickly and easily. Let&amp;#39;s get started:&lt;/p&gt;

&lt;h3&gt;1. Create the Puppet manifest &amp;amp; modules we will be using for our Vagrant tests.&lt;/h3&gt;

&lt;p&gt;For testing purposes we will be creating a Puppet manifest that ensures NTP is installed and is configured to use the following NTP servers:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;0.pool.ntp.org&lt;/li&gt;
&lt;li&gt;1.pool.ntp.org&lt;/li&gt;
&lt;li&gt;2.pool.ntp.org&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;A. First we should install tree, since it will help us visualize the directory structure of the puppet manifest directories we will be creating:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install -y tree&lt;/span&gt;
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.centarra.com
 * epel: mirror.unl.edu
 * extras: mirrors.finalasp.com
 * updates: mirrors.centarra.com
Setting up Install Process
Resolving Dependencies
--&amp;gt; Running transaction check
---&amp;gt; Package tree.x86_64 0:1.5.3-2.el6 will be installed
--&amp;gt; Finished Dependency Resolution

Dependencies &lt;span class=&quot;nv&quot;&gt;Resolved&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;====================================================================&lt;/span&gt;
 Package      Arch           Version             Repository    &lt;span class=&quot;nv&quot;&gt;Size&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;====================================================================&lt;/span&gt;
Installing:
 tree         x86_64         1.5.3-2.el6         base          &lt;span class=&quot;m&quot;&gt;36&lt;/span&gt; k

Transaction &lt;span class=&quot;nv&quot;&gt;Summary&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;====================================================================&lt;/span&gt;
Install       &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; Package&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Total download size: &lt;span class=&quot;m&quot;&gt;36&lt;/span&gt; k
Installed size: &lt;span class=&quot;m&quot;&gt;65&lt;/span&gt; k
Downloading Packages:
tree-1.5.3-2.el6.x86_64.rpm                    &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;36&lt;/span&gt; kB     00:00     
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : tree-1.5.3-2.el6.x86_64                          1/1 
  Verifying  : tree-1.5.3-2.el6.x86_64                          1/1 

Installed:
  tree.x86_64 0:1.5.3-2.el6                                           

Complete!
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Change to the directory that contains the Vagrantfile &amp;amp; example_box directory we&amp;#39;ve been working in over the last few blog posts:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/vagrant-vms/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tree&lt;/span&gt;
.
 example_box
  dummy.box
 Vagrantfile

&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; directory, &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; files
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Create the following modules &amp;amp; manifests directory structure for our Puppet manifest files:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir -p {manifests,modules/ntp/manifests,modules/ntp/templates,modules/common/manifests}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tree&lt;/span&gt;
.
 example_box
  dummy.box
 manifests
 modules
  common
   manifests
  ntp
      manifests
      templates
 Vagrantfile

&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt; directories, &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; files
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Create manifests/site.pp with the following contents:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vi manifests/site.pp&lt;/span&gt;
node default &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  include common
    class &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;ntp&amp;#39;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This is the Puppet manifest that we will configure Vagrent to run automatically. The &amp;quot;node default&amp;quot; section will be applied by any hostname that runs this manifest. The &amp;quot;node default&amp;quot; section calls the common &amp;amp; ntp modules which we will create next.&lt;/p&gt;

&lt;h4&gt;E. Create modules/common/manifests/init.pp with the following contents:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat modules/common/manifests/init.pp&lt;/span&gt;
class common &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  include common::data
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

class common::data &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$ntpServerList&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;0.pool.ntp.org&amp;#39;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&amp;#39;1.pool.ntp.org&amp;#39;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&amp;#39;2.pool.ntp.org&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This manifest is what gets run when Puppets runs &amp;quot;include common&amp;quot; in the manifests/site.pp manifest. When this manifest is run it creates an array named &amp;quot;common::data::ntpServerList&amp;quot; containing the ntp servers we&amp;#39;re needing to have defined.&lt;/p&gt;

&lt;h4&gt;F. Create modules/ntp/manifests/init.pp with the following contents:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat modules/ntp/manifests/init.pp&lt;/span&gt;
class ntp&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$ntpServerList&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$common&lt;/span&gt;::data::ntpServerList&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  package &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;ntp&amp;#39;&lt;/span&gt;:
  &lt;span class=&quot;nv&quot;&gt;ensure&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;present&amp;#39;&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#package&lt;/span&gt;

  file &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;/etc/ntp.conf&amp;#39;&lt;/span&gt;:
    &lt;span class=&quot;nv&quot;&gt;mode&lt;/span&gt;    &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;644&amp;quot;&lt;/span&gt;,
    &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; template&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ntp/client-ntp.conf.erb&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;,
    &lt;span class=&quot;nv&quot;&gt;notify&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; Service&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ntpd&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
    &lt;span class=&quot;nv&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; Package&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ntp&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# file&lt;/span&gt;

  service &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;ntpd&amp;#39;&lt;/span&gt;:
    &lt;span class=&quot;nv&quot;&gt;ensure&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; running,
    &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;,
    &lt;span class=&quot;nv&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; Package&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ntp&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;,
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# service&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This manifest is what gets run when Puppet calls &amp;quot;class {&amp;#39;ntp&amp;#39;:}&amp;quot; in the manifests/site.pp manifest. When this manifest is run it will ensure the ntp package is installed, the file &amp;quot;/etc/ntp.conf&amp;quot; is created containing our list of ntp servers and the ntpd service is started.    &lt;/p&gt;

&lt;h4&gt;G. Create modules/ntp/templates/client-ntp.conf.erb with the following contents:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;# This file is being maintained by Puppet.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# DO NOT EDIT&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Permit time synchronization with our time source, but do not&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# permit the source to query or modify the service on this system.&lt;/span&gt;
restrict default kod nomodify notrap nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery

&lt;span class=&quot;c&quot;&gt;# Permit all access over the loopback interface.  This could&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# be tightened as well, but to do so would effect some of&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the administrative functions.&lt;/span&gt;
restrict 127.0.0.1
restrict -6 ::1

&amp;lt;% ntpServerList.each &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;ntpServer&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; -%&amp;gt;
server &amp;lt;%&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ntpServer %&amp;gt;
&amp;lt;% end -%&amp;gt;

&lt;span class=&quot;c&quot;&gt;# Drift file.  Put this in a directory which the daemon can write to.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# No symbolic links allowed, either, since the daemon updates the file&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# by creating a temporary in the same directory and then rename()&amp;#39;ing&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# it to the file.&lt;/span&gt;
driftfile /var/lib/ntp/drift
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This .erb file is a ruby template describing what the file /etc/ntp.conf should contain. The magic of this is the section:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&amp;lt;% ntpServerList.each &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;ntpServer&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt; -%&amp;gt;
server &amp;lt;%&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ntpServer %&amp;gt;
&amp;lt;% end -%&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This section is actually ruby code that runs a foreach loop on the array &amp;quot;ntpServerList&amp;quot; and adds a line for each ntp server contained in that array. &lt;/p&gt;

&lt;h4&gt;H. Run the tree command and you should see the following file/directory structure:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tree&lt;/span&gt;
.
 example_box
  dummy.box
 manifests
  site.pp
 modules
  common
   manifests
       init.pp
  ntp
      manifests
       init.pp
      templates
          client-ntp.conf.erb
 Vagrantfile

&lt;span class=&quot;m&quot;&gt;8&lt;/span&gt; directories, &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; files
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;2. Modify the Vagrantfile we created in the last post to include the following:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat Vagrantfile&lt;/span&gt;
Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
  config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dummy&amp;#39;&lt;/span&gt;
  config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./example_box/dummy.box&amp;#39;&lt;/span&gt;

  config.vm.provider :vsphere &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vsphere&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    vsphere.host &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;192.168.1.195&amp;#39;&lt;/span&gt;
    vsphere.name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-test&amp;#39;&lt;/span&gt;
    vsphere.clone_from_vm &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.template_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-centos-6.5&amp;#39;&lt;/span&gt;
    vsphere.user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root@localos&amp;#39;&lt;/span&gt;
    vsphere.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;S0meR@nd0mP@ssw0rd&amp;#39;&lt;/span&gt;
    vsphere.insecure &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.data_store_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsanDatastore&amp;#39;&lt;/span&gt;
    vsphere.linked_clone &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.customization_spec_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-centos&amp;#39;&lt;/span&gt;
  end
  config.vm.provision &lt;span class=&quot;s2&quot;&gt;&amp;quot;puppet&amp;quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;puppet&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    puppet.manifests_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;manifests&amp;quot;&lt;/span&gt;
    puppet.manifest_file &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;site.pp&amp;quot;&lt;/span&gt;
    puppet.module_path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;modules&amp;quot;&lt;/span&gt;
  end
end
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The following new lines have been added:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;quot;puppet.manifests_path&amp;quot; specifies the sub-directory, from the directory containing the Vagrantfile, that contains the puppet manifests.&lt;/li&gt;
&lt;li&gt;&amp;quot;puppet.manifest_file&amp;quot; specifies the puppet manifest that will be initially run.&lt;/li&gt;
&lt;li&gt;&amp;quot;puppet.module_path&amp;quot; specifies the sub-directory, from the directory containing the Vagrantfile, that contains the puppet modules.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;3. Test the configuration changes we made by running a &amp;quot;vagrant up&amp;quot;:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up --provider=vsphere&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsphere&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere CloneVM with the following settings:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Source VM: vagrant-centos-6.5
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Name: vagrant-test
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: New virtual machine successfully cloned and &lt;span class=&quot;nv&quot;&gt;started&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /vagrant
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/manifests/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /tmp/vagrant-puppet-1/manifests
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/modules/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /tmp/vagrant-puppet-1/modules-0
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Running provisioner: puppet...
Running Puppet with site.pp...
notice: /File&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/etc/ntp.conf&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;/content: content changed &lt;span class=&quot;s1&quot;&gt;&amp;#39;{md5}d7e1e16f9c0cd6382f6b68b486163db1&amp;#39;&lt;/span&gt; to &lt;span class=&quot;s1&quot;&gt;&amp;#39;{md5}f7a83a4ca84e1ba2bba0166c5620e9e7&amp;#39;&lt;/span&gt;
notice: /Stage&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;main&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;/Ntp/Service&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;ntpd&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;: Triggered &lt;span class=&quot;s1&quot;&gt;&amp;#39;refresh&amp;#39;&lt;/span&gt; from &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; events
notice: Finished catalog run in 0.72 seconds
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You might notice a few new lines since the &amp;quot;vagrant up&amp;quot; we ran in the last post. &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The manifests &amp;amp; modules folders we specified in Vagrantfile have been copied over using rsync. &lt;/li&gt;
&lt;li&gt;The Puppet agent is running a &amp;quot;puppet apply&amp;quot; using the site.pp file we specified. &lt;/li&gt;
&lt;li&gt;/etc/ntp.conf was modified by Puppet&lt;/li&gt;
&lt;li&gt;The NTP service was notified that it needed to refresh it&amp;#39;s configuration since /etc/ntp.conf had been modified.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;4. Connect to the vagrant vm to validate that /etc/ntp.conf has been modified to include the three NTP servers we specified:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cat /etc/ntp.conf
&lt;span class=&quot;c&quot;&gt;# This file is being maintained by Puppet.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# DO NOT EDIT&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Permit time synchronization with our time source, but do not&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# permit the source to query or modify the service on this system.&lt;/span&gt;
restrict default kod nomodify notrap nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery

&lt;span class=&quot;c&quot;&gt;# Permit all access over the loopback interface.  This could&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# be tightened as well, but to do so would effect some of&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the administrative functions.&lt;/span&gt;
restrict 127.0.0.1
restrict -6 ::1

server 0.pool.ntp.org iburst
server 1.pool.ntp.org iburst
server 2.pool.ntp.org iburst

&lt;span class=&quot;c&quot;&gt;# Drift file.  Put this in a directory which the daemon can write to.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# No symbolic links allowed, either, since the daemon updates the file&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# by creating a temporary in the same directory and then rename()&amp;#39;ing&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# it to the file.&lt;/span&gt;
driftfile /var/lib/ntp/drift
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;logout&lt;/span&gt;
Connection to 192.168.1.123 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;5. Modify the site.pp file to add a node definition for our vagrant vm:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat site.pp&lt;/span&gt;
node default &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  include common
    class &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;ntp&amp;#39;&lt;/span&gt;:&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
node &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-test.mylab.net&amp;#39;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  include common
    class &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;ntp&amp;#39;&lt;/span&gt;:
      &lt;span class=&quot;nv&quot;&gt;ntpServerList&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;3.pool.ntp.org&amp;#39;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&amp;#39;4.pool.ntp.org&amp;#39;&lt;/span&gt;,&lt;span class=&quot;s1&quot;&gt;&amp;#39;5.pool.ntp.org&amp;#39;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The new &amp;quot;node &amp;#39;vagrant-test.mylab.net&amp;#39;&amp;quot; definition will only be run by hosts with a matching hostname. Any host that doesn&amp;#39;t have a matching host definition will continue to run the &amp;quot;node default&amp;quot; section. Node definitions allow you to change variables or even modules that will be run by specific hosts and provide flexibility in the changes made to a given host. Our new node section will configure &amp;quot;vagrant-test.mylab.net&amp;quot; to use a different set of ntp servers than any other host that runs this Puppet manifest  &lt;/p&gt;

&lt;h3&gt;6. Run &amp;#39;vagrant provision&amp;#39; to apply the updated Puppet manifest to our Vagrant vm:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant provision&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /vagrant
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/manifests/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /tmp/vagrant-puppet-1/manifests
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/modules/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /tmp/vagrant-puppet-1/modules-0
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Running provisioner: puppet...
Running Puppet with site.pp...
notice: /File&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;/etc/ntp.conf&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;/content: content changed &lt;span class=&quot;s1&quot;&gt;&amp;#39;{md5}f7a83a4ca84e1ba2bba0166c5620e9e7&amp;#39;&lt;/span&gt; to &lt;span class=&quot;s1&quot;&gt;&amp;#39;{md5}414e811fdbfa3f8cfa38e1e4e6d0586f&amp;#39;&lt;/span&gt;
notice: /Stage&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;main&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;/Ntp/Service&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;ntpd&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;: Triggered &lt;span class=&quot;s1&quot;&gt;&amp;#39;refresh&amp;#39;&lt;/span&gt; from &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; events
notice: Finished catalog run in 0.34 seconds
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;While we could have destroyed and recreated our Vagrant vm to test the change to the Puppet manifest, &amp;#39;vagrant provision&amp;#39; quickly resyncs the folders defined in our Vagrantfile and re-runs our Puppet manifest.&lt;/p&gt;

&lt;h3&gt;7. Connect to the vagrant vm to validate that /etc/ntp.conf has been modified to include the three NTP servers we defined fof this specific node:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
Last login: Tue May  &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; 15:09:50 &lt;span class=&quot;m&quot;&gt;2014&lt;/span&gt; from 192.168.1.40
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cat /etc/ntp.conf
&lt;span class=&quot;c&quot;&gt;# This file is being maintained by Puppet.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# DO NOT EDIT&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Permit time synchronization with our time source, but do not&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# permit the source to query or modify the service on this system.&lt;/span&gt;
restrict default kod nomodify notrap nopeer noquery
restrict -6 default kod nomodify notrap nopeer noquery

&lt;span class=&quot;c&quot;&gt;# Permit all access over the loopback interface.  This could&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# be tightened as well, but to do so would effect some of&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# the administrative functions.&lt;/span&gt;
restrict 127.0.0.1
restrict -6 ::1

server 3.pool.ntp.org iburst
server 4.pool.ntp.org iburst
server 5.pool.ntp.org iburst

&lt;span class=&quot;c&quot;&gt;# Drift file.  Put this in a directory which the daemon can write to.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# No symbolic links allowed, either, since the daemon updates the file&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# by creating a temporary in the same directory and then rename()&amp;#39;ing&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# it to the file.&lt;/span&gt;
driftfile /var/lib/ntp/drift
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;logout&lt;/span&gt;
Connection to 192.168.1.123 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;8. Shutdown the vagrant machine:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere &lt;span class=&quot;nv&quot;&gt;PowerOff&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vShpere Destroy
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Hopefully you found this post helpful in demonstrating how to use Puppet with Vagrant, as well as the benefits it provides for testing Puppet manfests and modules&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Using advanced vagrant-vsphere provider settings and vCenter guest customization</title>
   <link href="http://sdorsett.github.io/2014/04/24/vagrant-and-vcenter-guest-customization/"/>
   <updated>2014-04-24T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/04/24/vagrant-and-vcenter-guest-customization</id>
   <content type="html">&lt;p&gt;This post will pick up where we left off by demonstrating more vagrant-vsphere provider settings using the CentOS template we customized in the last blog post. Let&amp;#39;s get started:&lt;/p&gt;

&lt;h3&gt;1. Create a new customization specification in the vSphere web client. This customization specification will allow us to set the hostname of the vm created by &amp;quot;vagrant up&amp;quot; to the same name as the virtual machine.&lt;/h3&gt;

&lt;h4&gt;A. Go to Home | Customization Specification Manager:&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/01-web-client-home.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;B. Click the &amp;quot;Create a new specification&amp;quot; button:&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/02-create-guest-customization.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;C. Select &amp;quot;Linux&amp;quot; for the &amp;quot;Target VM Operating System&amp;quot; and name the customization specification. Click &amp;quot;Next&amp;quot; to continue&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/03-new-guest-customization.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;D. For &amp;quot;Computer Name&amp;quot; select &amp;quot;Use the virtual machine name&amp;quot; and click &amp;quot;Next&amp;quot; to continue.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/04-set-computer-name.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;E. For &amp;quot;Time Zone&amp;quot; select the time zone you want to use and click &amp;quot;Next&amp;quot; to continue.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/05-set-timezone.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;F. For &amp;quot;Configure Network&amp;quot; keep the default and click &amp;quot;Next to continue.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/06-configure-network.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;G. For &amp;quot;Enter DNS and Domain settings&amp;quot; enter the DNS servers and the domain name you want to assign to the cloned vm. Click &amp;quot;Next to continue.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/07-dns-settings.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h4&gt;H. Click &amp;quot;Finish&amp;quot; to create the customization specification.&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/assets/08-finish.jpg&quot; alt=&quot;screenshot&quot;&gt;&lt;/p&gt;

&lt;h3&gt;2. Modify the Vagrantfile we created in the initial &amp;quot;&lt;a href=&quot;http://sdorsett.github.io/2014/04/19/vagrant-install/&quot;&gt;Installing Vagrant and the vagrant-vsphere plugin on CentOS 6.x&lt;/a&gt;&amp;quot; post.&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat Vagrantfile&lt;/span&gt;
Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
  config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dummy&amp;#39;&lt;/span&gt;
  config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./example_box/dummy.box&amp;#39;&lt;/span&gt;

  config.vm.provider :vsphere &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vsphere&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    vsphere.host &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;192.168.1.195&amp;#39;&lt;/span&gt;
    vsphere.name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-test&amp;#39;&lt;/span&gt;
    vsphere.clone_from_vm &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.template_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-centos-6.5&amp;#39;&lt;/span&gt;
    vsphere.user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root@localos&amp;#39;&lt;/span&gt;
    vsphere.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;S0meR@nd0mP@ssw0rd&amp;#39;&lt;/span&gt;
    vsphere.insecure &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.data_store_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsanDatastore&amp;#39;&lt;/span&gt;
    vsphere.linked_clone &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.customization_spec_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-centos&amp;#39;&lt;/span&gt;
  end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The following new lines have been added:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;quot;vsphere.data_store_name&amp;quot; is the datastore that the cloned vm will be deployed to.&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.linked_clone&amp;quot; being set to &amp;quot;true&amp;quot; will cause the cloned vm to be deployed as a linked clone. This will dramatically decrease the amount of time needed to clone the vm when &amp;quot;vagrant up&amp;quot; command is issued.&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.customization_spec_name&amp;quot; will specify the customization specification that will be applied to the cloned vm. Set this to the customization specification we created in the previous step.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;3. Test the configuration changes we made by running a &amp;quot;vagrant up&amp;quot;:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up --provider=vsphere&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsphere&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere CloneVM with the following settings:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Source VM: vagrant-centos-6.5
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Name: vagrant-test
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: New virtual machine successfully cloned and &lt;span class=&quot;nv&quot;&gt;started&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /vagrant
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should find the time it took to deploy the linked clone vm was much faster than previous full clones of the vagrant template vm.&lt;/p&gt;

&lt;h3&gt;4. Connect to the vagrant vm to validate the hostname of the vm matched the vm name &amp;amp; search domain:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hostname -f
vagrant-test.mylab.net
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-test ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;logout&lt;/span&gt;
Connection to 192.168.1.117 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;5. Clean up after ourselves and call it a day:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere &lt;span class=&quot;nv&quot;&gt;PowerOff&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vShpere Destroy
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You might be wondering why setting the hostname &amp;amp; domain name might be so important. We will see in future posts how to use hostnames to determine which manifests will be applied to specific vms we clone and power up with Vagrant.&lt;/p&gt;

&lt;h3&gt;Hopefully you found this post helpful understanding more about the usefulness of customization specifications and advanced vagrant-vsphere configurations. The next blog post will start diving into using Vagrant to test Puppet manifests.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Creating a CentOS 6.x template that is customized for Vagrant</title>
   <link href="http://sdorsett.github.io/2014/04/20/vagrant-boxes/"/>
   <updated>2014-04-20T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/04/20/vagrant-boxes</id>
   <content type="html">&lt;p&gt;This post will continue our examination of using the vagrant-vsphere plugin, by customizing a CentOS template for integration with Vagrant. Having a Vagrant customize template will allow us to deploy this template and SSH to the cloned vm using the &amp;quot;vagrant ssh&amp;quot; command, as well automatically run puppet manifests when we deploy a vm using Vagrant. Let&amp;#39;s get started:&lt;/p&gt;

&lt;h3&gt;1. Ensure you have a DHCP server on the network you will be connecting the Vagrant deployed templates to. While you can utilized guest customization to assign a static IP addresses to a Vagrant deployed vm, using DHCP will make this process much easier.&lt;/h3&gt;

&lt;h3&gt;2. Create a CentOS 6.x minimal virtual machine for configuring as our Vagrant CentOS template.&lt;/h3&gt;

&lt;p&gt;Create or clone a fresh CentOS 6.x minimal virtual machine. I already have an existing Centos 6.5 minimal template that I simply cloned for this purpose.&lt;/p&gt;

&lt;h3&gt;3. Power on the new cloned vm and connect using SSH to the DHCP assigned IP address for this vm.&lt;/h3&gt;

&lt;h3&gt;4. Ensure you have perl, rsync, ruby &amp;amp; puppet agent installed:&lt;/h3&gt;

&lt;h4&gt;A. Import the EPEL 6 key and RPM:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# rpm --import http://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-6&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# rpm -Kih http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;########################################### [100%]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;########################################### [100%]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Use yum to install ruby, wget, puppet, facter &amp;amp; rsync:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install ruby ruby-libs ruby-shad wget yum-priorities puppet facter rsync -y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;5. Ensure you have vmtools installed on the new CentOS template.&lt;/h3&gt;

&lt;h4&gt;A. Start the install process by clicking &amp;quot;VM | Guest | Install/Upgrade VMware Tools&amp;quot; in the vShpere client. When prompted select &amp;quot;Automatice Tools Upgrade&amp;quot; and click &amp;quot;OK&amp;quot;&lt;/h4&gt;

&lt;h4&gt;B. Create a directory to mount the virtual CDROM to with the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir /mnt/cdrom&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Mount the virtual CDROM to /mnt/cdrom with the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mount /dev/cdrom /mnt/cdrom&lt;/span&gt;
mount: block device /dev/sr0 is write-protected, mounting &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;-only&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Copy the VMware Tools installer over to the /root directory and unzip it:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cp /mnt/cdrom/VMwareTools-* ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar -zxf ~/VMwareTools*&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Change directory into the directory we just untared and run the &amp;quot;vmware-install.pl&amp;quot; to start the installer:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd vmware-tools-distrib/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 vmware-tools-distrib&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ./vmware-install.pl&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should be able to accept the defaults for all prompts and complete the VMware tools installer. Once the installer has completed check the vm summary of this template vm in the vSphere client. The VMware Tools should show as &amp;quot;Running&amp;quot; and &amp;quot;Current.&amp;quot;&lt;/p&gt;

&lt;h4&gt;F. Unmount the virtual CDROM using the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# umount /dev/cdrom&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;6. We will next follow the steps for &lt;a href=&quot;https://docs.vagrantup.com/v2/boxes/base.html&quot;&gt;creating a base box&lt;/a&gt; from the Vagrant website.&lt;/h3&gt;

&lt;p&gt;One thing to point out is we will be configuring the vagrant template for password less SSH using a vagrant user with the password of &amp;quot;vagrant.&amp;quot; The Vagrant website mentions &amp;#39;by default, Vagrant expects a &amp;quot;vagrant&amp;quot; user to SSH into the machine as. This user should be setup with the insecure keypair that Vagrant uses as a default to attempt to SSH. Also, even though Vagrant uses key-based authentication by default, it is a general convention to set the password for the &amp;quot;vagrant&amp;quot; user to &amp;quot;vagrant.&amp;quot;&amp;#39;&lt;/p&gt;

&lt;p&gt;This vagrant template should only be used for lab or development work and never used for production or publicly facing virtual machines due to the security risks of having known users, passwords &amp;amp; private SSH keys configured by default. &lt;/p&gt;

&lt;h4&gt;A. Add a new user named &amp;quot;vagrant&amp;quot; to the template.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# useradd vagrant&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Change the password of the user &amp;quot;vagrant&amp;quot; to &amp;quot;vagrant&amp;quot;&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# [root@centos-6-5 ~]# passwd vagrant&lt;/span&gt;
Changing password &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; user vagrant.
New password: &amp;lt;&lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;the word &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt;&amp;gt;
BAD PASSWORD: it is based on a dictionary word
BAD PASSWORD: is too simple
Retype new password: &amp;lt;&lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;the word &lt;span class=&quot;s2&quot;&gt;&amp;quot;vagrant&amp;quot;&lt;/span&gt; again&amp;gt;
passwd: all authentication tokens updated successfully.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. We will next need to copy the contents of the vagrant.pub file located at the &lt;a href=&quot;9https://github.com/mitchellh/vagrant/tree/master/keys&quot;&gt;vagrant github site&lt;/a&gt; into the /home/vagrant/.ssh/authorized_keys file.&lt;/h4&gt;

&lt;p&gt;First we will su (switch user) to the vagrant user by running the following command:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# su vagrant&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 root&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Next we will create the .ssh directory since is does not exist:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 root&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mkdir ~/.ssh
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 root&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/.ssh
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 .ssh&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;
/home/vagrant/.ssh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;We will now create /home/vagrant/.ssh/authorized_keys with the contents of &lt;a href=&quot;https://raw.githubusercontent.com/mitchellh/vagrant/master/keys/vagrant.pub&quot;&gt;this file&lt;/a&gt; from the vagrant github page:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 .ssh&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key&amp;#39;&lt;/span&gt; &amp;gt; ~/.ssh/authorized_keys
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 .ssh&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;cat ~/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; vagrant insecure public key&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The vagrant website also mentions &amp;#39;that OpenSSH is very picky about file permissions. Therefore, make sure that ~/.ssh has 0700 permissions and the authorized keys file has 0600 permissions.&amp;#39; We will correct those permissions now:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 .ssh&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; ~/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;chmod &lt;span class=&quot;m&quot;&gt;700&lt;/span&gt; ~/.ssh
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;chmod &lt;span class=&quot;m&quot;&gt;600&lt;/span&gt; ~/.ssh/authorized_keys
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ls -la
total 24
drwx------. &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; vagrant vagrant &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:22 .
drwxr-xr-x. &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; root    root    &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:15 ..
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; vagrant vagrant   &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt; Jul &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;2013&lt;/span&gt; .bash_logout
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; vagrant vagrant  &lt;span class=&quot;m&quot;&gt;176&lt;/span&gt; Jul &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;2013&lt;/span&gt; .bash_profile
-rw-r--r--. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; vagrant vagrant  &lt;span class=&quot;m&quot;&gt;124&lt;/span&gt; Jul &lt;span class=&quot;m&quot;&gt;18&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;2013&lt;/span&gt; .bashrc
drwx------. &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; vagrant vagrant &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:26 .ssh
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ls -la .ssh
total 12
drwx------. &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; vagrant vagrant &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:26 .
drwx------. &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; vagrant vagrant &lt;span class=&quot;m&quot;&gt;4096&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:22 ..
-rw-------. &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; vagrant vagrant  &lt;span class=&quot;m&quot;&gt;409&lt;/span&gt; Apr &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; 14:26 authorized_keys
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. We will to edit the sudo file. Type the following command to open the sudo file in vi:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# visudo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Locate the line containing:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Defaults    requiretty&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;...and change it to read:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Defaults    requiretty&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;The # sign at the beginning of the line will cause this line to be ignored as a comment.
We also need to add the following line at the bottom of the file:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;vagrant &lt;span class=&quot;nv&quot;&gt;ALL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=(&lt;/span&gt;ALL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; NOPASSWD: ALL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. One more recommendation from the vagrant website is to edit /etc/ssh/sshd_config and change any line matching:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;UseDNS yes&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;to &lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;UseDNS no&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;This avoids a reverse DNS lookup on the connecting SSH client which can take many seconds.&lt;/p&gt;

&lt;h3&gt;7. Lastly this is a template, so we will need to remove /etc/udev/rules.d/70-persistent-net.rules file because it contains the MAC address of the current virtual NIC. It will be recreated on boot up or when we deploy other virtual machines from this template.&lt;/h3&gt;

&lt;h3&gt;8. We will now shutdown the template by running halt:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# halt&lt;/span&gt;
Broadcast message from root@centos-6-5
    &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/dev/pts/1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 14:51 ...
The system is going down &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; halt NOW!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;9. We now need to SSH to the vagrant vm that has the vagrant-vsphere plugin installed. This is the vm we created if you followed the &lt;a href=&quot;https://sdorsett.github.io/2014/04/19/vagrant-install/&quot;&gt;last blog post.&lt;/a&gt;&lt;/h3&gt;

&lt;h4&gt;A. Edit the Vagrantfile we created to modify the following line to reflect the name you gave the new vagrant template we cloned or created in the steps above:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;vsphere.template_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-centos-6.5&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. We can test this new template by issuing the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up --provider=vsphere&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsphere&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere CloneVM with the following settings:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Source VM: vagrant-centos-6.5
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Name: vagrant-test
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: New virtual machine successfully cloned and &lt;span class=&quot;nv&quot;&gt;started&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Rsyncing folder: /root/vagrant-vms/ &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&amp;gt; /vagrant&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Unlike our &amp;#39;vagrant up&amp;quot; command in the last post we have established a SSH session with the cloned template using the vagrant user we created and the public key in that users authorized_keys file.&lt;/p&gt;

&lt;p&gt;You also might notice that the entire directory we launched the &amp;#39;vagrant up&amp;quot; command from has been copied over to /vagrant on the cloned vm using rsync. We will go into leveraging this feature with puppet in our next blog post.&lt;/p&gt;

&lt;h4&gt;C. Using SSH to connect to the vagrant vm is as easy as &amp;#39;vagrant ssh&amp;#39;&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# hostname&lt;/span&gt;
vagrant.mylab.net
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant ssh&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hostname
vagrant-centos-6-5
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;vagrant@vagrant-centos-6-5 ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;logout&lt;/span&gt;
Connection to 192.168.1.133 closed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Finally we will power down and delete the cloned template by running the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere &lt;span class=&quot;nv&quot;&gt;PowerOff&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vShpere Destroy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Hopefully you found this post helpful in demonstrating how to create a vagrant specific template to use with the vagrant-vsphere plugin. The next blog post will be covering how to take advantage of customization specifications and advanced Vagrantfile configurations on a vm deployed using vagrant.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Installing Vagrant and the vagrant-vsphere plugin on CentOS 6.x</title>
   <link href="http://sdorsett.github.io/2014/04/19/vagrant-install/"/>
   <updated>2014-04-19T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/04/19/vagrant-install</id>
   <content type="html">&lt;p&gt;Some readers might find this post to be a little &amp;quot;in the weeds&amp;quot; and cover details they are already familiar with. I struggled in my first attempts to get Vagrant working on CentOS, because I couldn&amp;#39;t find any good tutorials that covered the entire process. If you get bored with basic network configuration or have another preferred method for installing Ruby, please understand I&amp;#39;m trying to provide as much detail as possible to those without much linux experience. I am also assuming you have a working vCenter, ESXi hosts and dhcp server configured to assign IP addresses for the Vagrant virtual machines we will be deploying.&lt;/p&gt;

&lt;h3&gt;1. Create a CentOS 6.x minimal virtual machine for installing Vagrant.&lt;/h3&gt;

&lt;p&gt;Create or clone a fresh CentOS 6.x minimal virtual machine. I already had an existing Centos 6.5 minimal template that I simply cloned for this purpose.&lt;/p&gt;

&lt;h3&gt;2. Power on the new cloned vm and connect to the virtual machine console&lt;/h3&gt;

&lt;h3&gt;3. Modify /etc/sysconfig/network, /etc/sysconfig/network-scripts/ifcfg-eth0 &amp;amp; /etc/resolv.conf to reflect the network settings for your vagrant vm:&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat /etc/sysconfig/network &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;NETWORKING&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yes 
&lt;span class=&quot;nv&quot;&gt;HOSTNAME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;vagrant.mylab.net 
&lt;span class=&quot;nv&quot;&gt;GATEWAY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.1 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat /etc/sysconfig/network-scripts/ifcfg-eth0 &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;DEVICE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;eth0 
&lt;span class=&quot;nv&quot;&gt;TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Ethernet 
&lt;span class=&quot;nv&quot;&gt;ONBOOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;yes 
&lt;span class=&quot;nv&quot;&gt;NM_CONTROLLED&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;no 
&lt;span class=&quot;nv&quot;&gt;BOOTPROTO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;static 
&lt;span class=&quot;nv&quot;&gt;IPADDR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.40 
&lt;span class=&quot;nv&quot;&gt;NETMASK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;255.255.255.0 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat /etc/resolv.conf&lt;/span&gt;
 search mylab.net 
nameserver 192.168.1.1 
nameserver 8.8.8.8 
nameserver 8.8.4.4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;4. Restart the vm for the hostname change to take affect&lt;/h3&gt;

&lt;h3&gt;5. SSH to the vagrant vm using the IP address you assigned in /etc/sysconf/network-scripts/ifcfg-eth0&lt;/h3&gt;

&lt;h3&gt;6. Install Ruby 1.9.3. There are &lt;a href=&quot;http://www.agilesysadmin.net/acquiring-a-modern-ruby-part-one&quot;&gt;several ways&lt;/a&gt; to install ruby 1.9.3 on CentOS, but I&amp;#39;ll cover using ruby-build to accomplish this:&lt;/h3&gt;

&lt;h4&gt;A. Use yum to install the packages we&amp;#39;ll need to get ruby, rubygems and vagrant installed:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# yum install -y gcc-c++ glibc-headers openssl-devel readline libyaml-devel readline-devel zlib zlib-devel iconv-devel libxml2 libxml2-devel libxslt libxslt-devel wget git&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Pull down the latest version of ruby-build using git:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# git clone https://github.com/sstephenson/ruby-build.git&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Change to the directory the previous command created:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ruby-build/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Run the &amp;#39;install.sh&amp;#39; script to install ruby-build:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ./install.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. I have not been successful in getting vagrant-vsphere to run on any version of ruby newer than 1.9.3-p545. As a result I would recommend installing that version with the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby-build --definitionsruby-build 1.9.3-p545 /usr/local/&lt;/span&gt;
Downloading yaml-0.1.6.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/5fe00cda18ca5daeb43762b80c38e06e
Installing yaml-0.1.6...
Installed yaml-0.1.6 to /usr/local/

Downloading ruby-1.9.3-p545.tar.gz...
-&amp;gt; http://dqw8nmjcqpjn7.cloudfront.net/8e8f6e4d7d0bb54e0edf8d9c4120f40c
Installing ruby-1.9.3-p545...

Installed ruby-1.9.3-p545 to /usr/local/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;7. We will next need to install rubygems. The process I used was to download the latest version from &lt;a href=&quot;https://rubygems.org/pages/download&quot;&gt;rubygems.org&lt;/a&gt; and install it:&lt;/h3&gt;

&lt;h4&gt;A. Use wget to download the latest version listed on the rubygems download page:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ruby-build&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget http://production.cf.rubygems.org/rubygems/rubygems-2.2.2.tgz&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Use tar to unzip the tar-gzipped file we downloaded:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar xvzf rubygems-2.2.2.tgz&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd rubygems-2.2.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Install rubygems by running the &amp;#39;setup.rb&amp;#39; script:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.2.2&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ruby setup.rb&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;8. Installing Vagrant&lt;/h3&gt;

&lt;h4&gt;A. Use wget to download the latest version listed on the &lt;a href=&quot;https://www.vagrantup.com/downloads.html&quot;&gt;Vagrant download&lt;/a&gt; page:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant rubygems-2.2.2&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.5.2_x86_64.rpm&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Use the &amp;#39;rpm&amp;#39; command to install the RPM package we downloaded in the previous step:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# rpm -i vagrant_1.5.2_x86_64.rpm&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Export the directory that the vagrant executable was install to, in order to make it easier to run:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# export PATH=$PATH:/opt/vagrant/bin/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;9. Installing the vagrant-vsphere plugin&lt;/h3&gt;

&lt;h4&gt;A. The nokogiri gem, which is a ruby HTML, XML &amp;amp; SAM parser, is required by vagrant-vsphere so we will install it with the following commands:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# gem install nokogiri&lt;/span&gt;
Building native extensions.  This could take a &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;...
Successfully installed nokogiri-1.6.1
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\x89&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxslt/1.1.26/libxslt-1.1.26/tests/xmlspec/logo-REC, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xF6&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxslt/1.1.26/libxslt-1.1.26/libxslt/xslt.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xF6&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxslt/1.1.26/libxslt-1.1.26/ChangeLog, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xE1&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxslt/1.1.26/libxslt-1.1.26/NEWS, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xFD&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxslt/1.1.26/libxslt-1.1.26/win32/Readme.txt, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xC0&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxml2/2.8.0/libxml2-2.8.0/test/XInclude/ents/isolatin.txt, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xE4&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxml2/2.8.0/libxml2-2.8.0/doc/examples/testWriter.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xF8&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxml2/2.8.0/libxml2-2.8.0/testapi.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xE9&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxml2/2.8.0/libxml2-2.8.0/runtest.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xF8&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ext/nokogiri/tmp/x86_64-redhat-linux/ports/libxml2/2.8.0/libxml2-2.8.0/entities.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xC0&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ports/x86_64-redhat-linux/libxslt/1.1.26/bin/xsltproc, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xE4&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ports/x86_64-redhat-linux/libxml2/2.8.0/share/doc/libxml2-2.8.0/html/testWriter.c, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xC0&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ports/x86_64-redhat-linux/libxml2/2.8.0/bin/xmllint, skipping
unable to convert &lt;span class=&quot;s2&quot;&gt;&amp;quot;\xC0&amp;quot;&lt;/span&gt; from ASCII-8BIT to UTF-8 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; ports/x86_64-redhat-linux/libxml2/2.8.0/bin/xmlcatalog, skipping
&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; gem installed&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Next we will install the rbvmomi gem with the following command. rbvmomi is a ruby interface for using the vSphere API.&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# gem install rbvmomi&lt;/span&gt;
Successfully installed rbvmomi-1.8.1
&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; gem installed&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C. Now we can install the vagrant-vsphere plugin with the following command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant plugin install vagrant-vsphere&lt;/span&gt;
Installing the &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vsphere&amp;#39;&lt;/span&gt; plugin. This can take a few minutes...
Installed the plugin &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-vsphere (0.8.1)&amp;#39;&lt;/span&gt;!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;8. Configuring vagrant-vsphere&lt;/h3&gt;

&lt;p&gt;The vagrant-vsphere &lt;a href=&quot;https://github.com/nsidc/vagrant-vsphere&quot;&gt;README.md on github&lt;/a&gt; mentions we need to create a vSphere box from the metadata.json located in the example_box directory. &lt;/p&gt;

&lt;h4&gt;A.  We can use the linux the &amp;quot;find&amp;quot; command to determine the path to the example_box directory:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# find / -name example_box&lt;/span&gt;
/root/.vagrant.d/gems/gems/vagrant-vsphere-0.8.1/example_box&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B.  Now we can change directory to that directory and create the necessary dummy box file:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant ~&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd /root/.vagrant.d/gems/gems/vagrant-vsphere-0.8.1/example_box&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant example_box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# tar cvzf dummy.box ./metadata.json&lt;/span&gt;
./metadata.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;C.  Next we will create a new folder under /root for storing the box file we created and other vagrant configuration files&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant example_box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mkdir -p ~/vagrant-vms/example_box&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant example_box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# mv dummy.box ~/vagrant-vms/example_box&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;D. Vagrant reads it&amp;#39;s configuration from a file named Vagrantfile, located in the directory from which the &amp;quot;vagrant up&amp;quot; command is run in. We need to go back to our &amp;quot;vagrant-vms&amp;quot; folder and create this file:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant example_box&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cd ~/vagrant-vms/&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# touch Vagrantfile&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;E. Modify the Vagrantfile to reflect your vsphere configuration. Here&amp;#39;s an example of my working Vagrantfile:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# cat Vagrantfile&lt;/span&gt;

Vagrant.configure&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
  config.vm.box &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;dummy&amp;#39;&lt;/span&gt;
  config.vm.box_url &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;./example_box/dummy.box&amp;#39;&lt;/span&gt;

  config.vm.provider :vsphere &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;vsphere&lt;span class=&quot;p&quot;&gt;|&lt;/span&gt;
    vsphere.host &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vcenter.mylab.net&amp;#39;&lt;/span&gt;
    vsphere.name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;vagrant-test&amp;#39;&lt;/span&gt;
    vsphere.clone_from_vm &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;    &lt;/span&gt;vsphere.template_name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Centos-6.5&amp;#39;&lt;/span&gt;
    vsphere.user &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;root@localos&amp;#39;&lt;/span&gt;
    vsphere.password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;S0meR@nd0mP@ssw0rd&amp;#39;&lt;/span&gt;
    vsphere.insecure &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;  &lt;/span&gt;end
end&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;In this configuration file:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;quot;vsphere.host&amp;quot; is your vCenter server FQDN or IP address&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.name&amp;quot; will be the name of the virtual machine that gets created&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.clone_from_vm&amp;quot; specifies we will be cloning a vm rather than template&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.template_name&amp;quot; is the name of the vm we will be cloning&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.user&amp;quot; is the username we will be using to connect to vCenter&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.password&amp;quot; is the password we will be using to connect ot vCenter&lt;/li&gt;
&lt;li&gt;&amp;quot;vsphere.insecure&amp;quot; tells vagrant to not worry about validating the certificate on the vCenter server&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;9. Vargrant up!!!!&lt;/h3&gt;

&lt;p&gt;If everything has gone correctly up to this point we can issue a &amp;quot;vagrant up --provider=vsphere&amp;quot; command from the directory that contains the Vagrantfile:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant up --provider=vsphere&lt;/span&gt;
Bringing machine &lt;span class=&quot;s1&quot;&gt;&amp;#39;default&amp;#39;&lt;/span&gt; up with &lt;span class=&quot;s1&quot;&gt;&amp;#39;vsphere&amp;#39;&lt;/span&gt; provider...
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere CloneVM with the following settings:
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Source VM: CentOS-6.5
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default:  -- Name: vagrant-test
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; SSH to become available...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should see a &amp;quot;Clone virtual machine&amp;quot; task being run on your vCenter server and then completing.&lt;/p&gt;

&lt;h3&gt;10. Canceling the &amp;quot;Vagrant up&amp;quot; command and destroying our cloned vm.&lt;/h3&gt;

&lt;p&gt;Since we have not properly prepared the vm we are cloning (I will have another blog post covering this topic) Vagrant will never be able to successfully connect to the cloned vm using SSH. As a result we will need to cancel the &amp;quot;vagrant up&amp;quot; command:&lt;/p&gt;

&lt;h4&gt;A. Press [control-c] to attempt to gracefully exit &amp;quot;vagrant-up&amp;quot;&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;^C&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Waiting &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; cleanup before exiting...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;I&amp;#39;ve never seen this task complete so I will press [control-c] again to immediately exit:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;^C&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Exiting immediately, without cleanup!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;B. Destroy the cloned vm by running &amp;quot;vagrant destroy&amp;quot; command:&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;root@vagrant vagrant-vms&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# vagrant destroy&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vSphere &lt;span class=&quot;nv&quot;&gt;PowerOff&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&amp;gt; default: Calling vShpere Destroy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You should see a &amp;quot;Power Off virtual machine&amp;quot; and &amp;quot;Delet virtual machine&amp;quot; tasks being run and then completing on your vCenter server.&lt;/p&gt;

&lt;h3&gt;Hopefully you found this post helpful in getting vagrant and the vagrant-vsphere plugin installed and configured. The next blog post will be covering how to create a template vm that has been prepared for vagrant to connect seemlessly using SSH.&lt;/h3&gt;

&lt;h3&gt;Please provide any feedback or suggestions to my twitter account located on the about page.&lt;/h3&gt;
</content>
 </entry>
 
 <entry>
   <title>Vagrant and why it is useful in learning Puppet</title>
   <link href="http://sdorsett.github.io/2014/04/16/vagrant-explained/"/>
   <updated>2014-04-16T00:00:00+00:00</updated>
   <id>http://sdorsett.github.io/2014/04/16/vagrant-explained</id>
   <content type="html">&lt;p&gt;Vagrant, according to the &lt;a href=&quot;http://docs.vagrantup.com/v2/why-vagrant/&quot;&gt;documentation&lt;/a&gt;, provides a &amp;quot;disposable environment and consistent workflow for developing and testing infrastructure management scripts. You can quickly test things like shell scripts, Chef cookbooks, Puppet modules, and more using local virtualization such as VirtualBox or VMware. Then, with the same configuration, you can test these scripts on remote clouds such as AWS or RackSpace with the same workflow.&amp;quot;&lt;/p&gt;

&lt;p&gt;I&amp;#39;ve been wanting to dedicate more time to working with Puppet and needed a better way to quickly test my manifests on a fresh system. The vCHS automation team has demonstrated using Vagant with VMware fusion, but I wanted to be able to use it in my homelab, natively with vSphere/ESXi. The vagrant-vsphere plugin provides the ability to use simple commands to deploy a vm/template, apply a specified manifest and even SSH to the freshly create vm. &lt;/p&gt;

&lt;p&gt;This will be the first of several blog posts in which I will cover:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://sdorsett.github.io/2014/04/19/vagrant-install/&quot;&gt;Installing Vagant and the vagrant-vsphere plugin on a CentOS 6.x virtual machine&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sdorsett.github.io/2014/04/20/vagrant-boxes/&quot;&gt;Creating a CentOS 6.x template that is customized for Vagrant&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sdorsett.github.io/2014/04/24/vagrant-and-vcenter-guest-customization/&quot;&gt;Using advanced vagrant-vsphere provider settings and vCenter guest customization&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sdorsett.github.io/2014/05/06/vagrant-and-puppet/&quot;&gt;Creating a Puppet manifest and integrating it with Vagrant&lt;/a&gt; &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These posts will hopefully help you understand the steps necessary to get vagrant installed and working with a vSphere environment.&lt;/p&gt;
</content>
 </entry>
 

</feed>
