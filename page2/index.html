<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      sdorsett.github.io &middot; Things I find interesting
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/posts/">All Posts</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/sdorsett/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/sdorsett">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2018. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">sdorsett.github.io</a>
            <small>Things I find interesting</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/28/scripted-packer-build-and-export/">
        Scripted Packer build, ovftool export and Vagrant .box file creation
      </a>
    </h1>

    <span class="post-date">28 Dec 2015</span>

    <p>This is the seventh in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the last post we covered <a href="https://sdorsett.github.io/2015/12/27/using-ovftool-to-export-packer-generated-virtual-machines/">using ovftool to convert Packer generated virtual machines into Vagrant .box files</a>. I promised to show you a better way of exporting and creating the Vagrant .box files, so in this post we will be combining the following items in one script:</p>

<ul>
<li>Kicking off the Packer build of a specific template</li>
<li>Exporting the Packer generated virtual machine</li>
<li>Creating the necessary metadata.json &amp; Vagrantfile files</li>
<li>Compressing the files into a TAR file with the .box extension</li>
<li>Copying the Vagrant .box files to /vat/www/html/box-files/ so they can accessed by HTTP</li>
</ul>

<p>Let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we have been using in previous posts.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
root@192.168.1.52&#39;s password:
Last login: Sat Dec 26 22:04:20 2015 from 192.168.1.163
[root@packer-centos ~]#</code></pre></figure>

<h2>2. Create a new directory, in the packer-templates directory, for storing build scripts.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# mkdir ~/packer-templates/build-scripts
[root@packer-centos ~]# cd packer-templates/build-scripts/
[root@packer-centos build-scripts]#</code></pre></figure>

<h2>3. Next we will create a generic script for performing a Packer build of a template.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos build-scripts]# cat generic-packer-build-script.sh
#!/bin/bash

source /root/.bashrc

echo &quot;starting packer build of $PACKER_VM_NAME&quot;
packer build -var-file=packer-remote-info.json /root/packer-templates/templates/$PACKER_VM_NAME.json

echo &quot;registering ${PACKER_VM_NAME} virtual machine on ${PACKER_REMOTE_HOST}&quot;
/usr/bin/sshpass -p ${PACKER_REMOTE_PASSWORD} ssh root@${PACKER_REMOTE_HOST} &quot;vim-cmd solo/registervm /vmfs/volumes/${PACKER_REMOTE_DATASTORE}/output-${PACKER_VM_NAME}/*.vmx&quot;

mkdir -p /root/box_files/ovf/empty_dir/
mkdir -p /root/box_files/vmx/empty_dir/

rm -rf /root/box_files/ovf/${PACKER_VM_NAME}
rm -rf /root/box_files/vmx/${PACKER_VM_NAME}

echo &quot;output of /vmfs/volumes/${PACKER_REMOTE_DATASTORE}/output-${PACKER_VM_NAME}/*.vmxf:&quot;
/usr/bin/sshpass -p ${PACKER_REMOTE_PASSWORD} ssh root@${PACKER_REMOTE_HOST} &quot;cat /vmfs/volumes/${PACKER_REMOTE_DATASTORE}/output-${PACKER_VM_NAME}/*.vmxf&quot;

ovftool vi://root:${PACKER_REMOTE_PASSWORD}@${PACKER_REMOTE_HOST}/${PACKER_VM_NAME} /root/box_files/ovf/
ovftool -tt=vmx vi://root:${PACKER_REMOTE_PASSWORD}@${PACKER_REMOTE_HOST}/${PACKER_VM_NAME} /root/box_files/vmx/

echo &quot;creating metadata.json and Vagrantfile files in ovf virtual machine directory&quot;
echo &#39;{&quot;provider&quot;:&quot;vmware_ovf&quot;}&#39; &gt;&gt; /root/box_files/ovf/${PACKER_VM_NAME}/metadata.json
touch /root/box_files/ovf/${PACKER_VM_NAME}/Vagrantfile
cd /root/box_files/ovf/empty_dir/
cd /root/box_files/ovf/${PACKER_VM_NAME}/

echo &quot;compressing ovf virtual machine files to /var/www/html/box-files/${PACKER_VM_NAME}-vmware_ovf-1.0.box&quot;
tar cvzf /var/www/html/box-files/$PACKER_VM_NAME-vmware_ovf-1.0.box ./*

echo &quot;creating metadata.json and Vagrantfile files in vmx virtual machine directory&quot;
echo &#39;{&quot;provider&quot;:&quot;vmware_desktop&quot;}&#39; &gt;&gt; /root/box_files/vmx/${PACKER_VM_NAME}/metadata.json
touch /root/box_files/vmx/${PACKER_VM_NAME}/Vagrantfile
cd /root/box_files/vmx/empty_dir/
cd /root/box_files/vmx/${PACKER_VM_NAME}/

echo &quot;compressing vmx virtual machine files to /var/www/html/box-files/${PACKER_VM_NAME}-vmware_desktop-1.0.box&quot;
tar cvzf /var/www/html/box-files/$PACKER_VM_NAME-vmware_desktop-1.0.box ./*

echo &quot;cleaning up /root/box_files directories&quot;
rm -rf /root/box_files/ovf/$PACKER_VM_NAME
rm -rf /root/box_files/vmx/$PACKER_VM_NAME

echo &quot;deleting $PACKER_VM_NAME from $PACKER_REMOTE_HOST&quot;
/usr/bin/sshpass -p ${PACKER_REMOTE_PASSWORD} ssh root@${PACKER_REMOTE_HOST}  &quot;vim-cmd vmsvc/getallvms | grep ${PACKER_VM_NAME} | cut -d &#39; &#39; -f 1 | xargs vim-cmd vmsvc/destroy&quot;

echo &quot;packer build of $PACKER_VM_NAME has been  completed&quot;

[root@packer-centos build-scripts]#</code></pre></figure>

<p>If you look over this script you will notice it covers all of the tasks we performed manually in the last two posts. You might all notice the following environmental variables listed:</p>

<ul>
<li>PACKER_REMOTE_HOST</li>
<li>PACKER_REMOTE_USERNAME</li>
<li>PACKER_REMOTE_PASSWORD</li>
<li>PACKER_REMOTE_DATASTORE</li>
<li>PACKER_VM_NAME</li>
</ul>

<p>We are again using the idea of &quot;separating data from code&quot; to keep environment specific information out of the scripts. This will help in keeping sensitive information from being store with our scripts in a code repository.</p>

<h2>4. We now need to added the above listed PACKER_REMOTE environmental variables into the .bashrc file, so the script will know how to connect to vCenter</h2>

<p>Add the following lines to the bottom of /root/.bashrc. Make sure to update any of them that do you match your environment:</p>

<pre>
PACKER_REMOTE_HOST=192.168.1.51
PACKER_REMOTE_USERNAME=root
PACKER_REMOTE_PASSWORD=password
PACKER_REMOTE_DATASTORE=datastore1
</pre>

<p>After updating the ~/.bashrc file, reread the file by running the following command:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos build-scripts]# source ~/.bashrc
[root@packer-centos build-scripts]#</code></pre></figure>

<p>You can also validate the environmental variables exist by using the echo commmand:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos build-scripts]# echo $PACKER_REMOTE_HOST
192.168.1.51
[root@packer-centos build-scripts]#</code></pre></figure>

<h2>5. We need to delete the existing Packer generated virtual machines from the ESXi virtual machine embedded host client, since the Packer build will halt if the virtual machine it is trying to build already exists:</h2>

<p><img src="/assets/01-delete-virtual-machine.png" alt="screenshot">  </p>

<h2>6. With the generic Packer build script and environmental variables in place we can test our script out. First off we need to ensure the execution bit is set on our generic Packer build script:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos build-scripts]# cd ~/packer-templates/
[root@packer-centos packer-templates]# chmod +x build-scripts/generic-packer-build-script.sh
[root@packer-centos packer-templates]# ls -la build-scripts/generic-packer-build-script.sh
-rwxr-xr-x 1 root root 2091 Dec 26 22:27 build-scripts/generic-packer-build-script.sh
[root@packer-centos packer-templates]#</code></pre></figure>

<p>Now that we have set the script as executable, we can use it to build to centos67 template by passing in the PACKER<em>VM</em>NAME environmental variable like the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# PACKER_VM_NAME=centos67 build-scripts/generic-packer-build-script.sh
starting packer build of centos67
centos67 output will be in this color.

==&gt; centos67: Downloading or copying ISO
    centos67: Downloading or copying: file:///root/packer-templates/iso/CentOS-6.7-x86_64-minimal.iso
==&gt; centos67: Uploading ISO to remote machine...
==&gt; centos67: Creating virtual machine disk
==&gt; centos67: Building and writing VMX file
==&gt; centos67: Starting HTTP server on port 8001
==&gt; centos67: Registering remote VM...
==&gt; centos67: Starting virtual machine...
==&gt; centos67: Waiting 5s for boot...
==&gt; centos67: Connecting to VM via VNC
==&gt; centos67: Typing the boot command over VNC...
==&gt; centos67: Waiting for SSH to become available...
...</code></pre></figure>

<p>Checking the embedded host client we can see that the CentOS 6.7 operating system is being installed.</p>

<p><img src="/assets/02-centos67-os-install.png" alt="screenshot"></p>

<p>Once the Packer build completes you will see the following output:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">centos67: ==&gt; Zero out the free space to save space in the final image
centos67: dd: writing `/EMPTY&#39;: No space left on device
centos67: 12950+0 records in
centos67: 12949+0 records out
centos67: 13578776576 bytes (14 GB) copied, 462.514 s, 29.4 MB/s
==&gt; centos67: Gracefully halting virtual machine...
centos67: Waiting for VMware to clean up after itself...
==&gt; centos67: Deleting unnecessary VMware files...
centos67: Deleting: /vmfs/volumes/datastore1/output-centos67/vmware.log
==&gt; centos67: Cleaning VMX prior to finishing up...
centos67: Unmounting floppy from VMX...
centos67: Detaching ISO from CD-ROM device...
centos67: Disabling VNC server...
==&gt; centos67: Compacting the disk image
==&gt; centos67: Unregistering virtual machine...
Build &#39;centos67&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; centos67: VM files in directory: /vmfs/volumes/datastore1/output-centos67</code></pre></figure>

<p>At this point the script will re-register the vm Packer built and output the .vmxf file of the virtual machine. This is use for ensuring vmtools was properly installed, since this file contains the vmtool components and their versions that were successfully installed:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">registering centos67 virtual machine on 192.168.1.51
18
output of /vmfs/volumes/datastore1/output-centos67/*.vmxf:
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;Foundry&gt;&lt;VM/&gt;&lt;tools-install-info&gt;&lt;installError&gt;0&lt;/installError&gt;&lt;updateCounter&gt;1&lt;/updateCounter&gt;&lt;/tools-install-info&gt;&lt;tools-manifest&gt;&lt;monolithic version=&quot;9.9.4&quot;/&gt;&lt;svga33 version=&quot;10.3.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga4 version=&quot;10.4.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse42 version=&quot;1.0.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga42 version=&quot;10.10.2.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse43 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga43 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse43_64 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga43_64 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse67 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga67 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse67_64 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga67_64 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse68 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga68 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse68_64 version=&quot;12.6.4.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga68_64 version=&quot;10.16.7.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse70 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga70 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse70_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga70_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse71 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga71 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse71_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga71_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse73 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga73 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse73_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga73_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse73_99 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga73_99 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse73_99_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga73_99_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse74 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga74 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse74_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga74_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse75 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga75 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse75_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga75_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse76 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga76 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmmouse76_64 version=&quot;12.7.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;svga76_64 version=&quot;11.0.99.4&quot; installed=&quot;FALSE&quot;/&gt;&lt;checkvm version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmtoolsd version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;upgrader version=&quot;9.9.4.51858&quot; installed=&quot;FALSE&quot;/&gt;&lt;hgfsclient version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;hgfsmounter version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmguestlib version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmguestlibjava version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;toolbox-cmd version=&quot;9.9.4.51858&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmci version=&quot;9.6.2.0&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmhgfs version=&quot;1.4.20.1&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmmemctl version=&quot;1.2.1.2&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmsync version=&quot;1.1.0.1&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmxnet version=&quot;2.1.0.0&quot; installed=&quot;TRUE&quot;/&gt;&lt;vmxnet3 version=&quot;1.3.0.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vmblock version=&quot;1.1.2.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;vsock version=&quot;9.6.1.0&quot; installed=&quot;TRUE&quot;/&gt;&lt;pvscsi version=&quot;1.2.3.0&quot; installed=&quot;FALSE&quot;/&gt;&lt;/tools-manifest&gt;&lt;/Foundry&gt;</code></pre></figure>

<p>The next stage of the build script will run the ovftool commands to export .vmx and .ovf format virtual machines from ESXi.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">Opening VI source: vi://root@192.168.1.51:443/centos67
Opening OVF target: /root/box_files/ovf/
Writing OVF package: /root/box_files/ovf/centos67/centos67.ovf
Transfer Completed
Completed successfully
Opening VI source: vi://root@192.168.1.51:443/centos67
Opening VMX target: /root/box_files/vmx/
Writing VMX file: /root/box_files/vmx/centos67/centos67.vmx
Transfer Completed
Completed successfully</code></pre></figure>

<p>The next stage of the build script will create the metadata.json and Vagrantfiles needed for the Vagrant .box files. It will then TAR up all the virtual machine files contained in the ovf &amp; vmx folders. This stage will also save the TAR files to /var/www/html/box-files/ so that they will be available over http.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">creating metadata.json and Vagrantfile files in ovf virtual machine directory
compressing ovf virtual machine files to /var/www/html/box-files/centos67-vmware_ovf-1.0.box
./centos67-disk1.vmdk
./centos67.mf
./centos67.ovf
./metadata.json
./Vagrantfile
creating metadata.json and Vagrantfile files in vmx virtual machine directory
compressing vmx virtual machine files to /var/www/html/box-files/centos67-vmware_desktop-1.0.box
./centos67-disk1.vmdk
./centos67.vmx
./metadata.json
./Vagrantfile</code></pre></figure>

<p>The final section of the build script will remove the directories that ovftool generated in /root/box_files (to keep disk space usage to a minimum) and delete the Packer virtual machine from ESXi.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">cleaning up /root/box_files directories
deleting centos67 from 192.168.1.51
packer build of centos67 has been  completed
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>6. We can now list the files in /var/www/html/box-files and see the two .box files generated by the script.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# ls -lah /var/www/html/box-files/
total 654M
drwxr-xr-x 2 root root 4.0K Dec 28 15:44 .
drwxr-xr-x 3 root root 4.0K Dec 23 18:09 ..
-rw-r--r-- 1 root root 319M Dec 28 15:46 centos67-vmware_desktop-1.0.box
-rw-r--r-- 1 root root 336M Dec 28 15:44 centos67-vmware_ovf-1.0.box
[root@packer-centos packer-templates]#</code></pre></figure>

<p>We can also open a browser and see the .box files the script generated.</p>

<p><img src="/assets/01-browse-vagrant-box-files.png" alt="screenshot">  </p>

<h3>If you would like to not have to manually create the build script covered in this post, you can clone down <a href="https://github.com/sdorsett/packer-templates/tree/adding-build-script">this github repository</a> by running the following command:</h3>

<pre>
git clone -b "adding-build-script" https://github.com/sdorsett/packer-templates.git
</pre>  

<p>If you cloned the packer-templates repo in the last post, you can pull down the updates by running the following command:</p>

<pre>
git fetch --all
git pull origin "adding-build-script"
</pre>  

<h3>This brings us to the end of this post. I hope I made good on my promise of showing an automated ways of converting the Packer templates to .box files. In the next post I think we should cover how to test our Vagrant .box files are functional by deploying them using Vagrant.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/27/using-ovftool-to-export-packer-generated-virtual-machines/">
        Using ovftool to convert Packer generated virtual machines into Vagrant .box files
      </a>
    </h1>

    <span class="post-date">27 Dec 2015</span>

    <p>This is the sixth in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the last post we covered <a href="https://sdorsett.github.io/2015/12/26/copy-our-existing-template-and-add-the-puppet-agent/">copying our existing CentOS 6.7 template and adding the Puppet agent</a> in order to generate a new Packer template. In this post we will be covering how to use ovftool to convert Packer generated virtual machines into Vagrant .box files. This post will be going over the manual steps on purpose, since I feel it will make more sense when we start to cover automating the steps that you can already performed by hand.</p>

<p>Let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we have been using in previous posts.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
root@192.168.1.52&#39;s password:
Last login: Sat Dec 26 20:52:17 2015 from 192.168.1.163
[root@packer-centos ~]#</code></pre></figure>

<h2>2. Create two new directories for downloading virtual machines, one for .ovf and one for .vmx virtual machine formats.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">root@packer-centos ~]# mkdir -p ~/box_files/{ovf,vmx}
[root@packer-centos ~]# tree ~/box_files/
/root/box_files/
├── ovf
└── vmx

2 directories, 0 files
[root@packer-centos ~]#</code></pre></figure>

<h2>3. Now that we have locations for our ovftool exported virtual machine, we need to re-register the Packer created virtual machines. SSH to your ESXi virtual machine and cd to the datastore that you created the Packer virtual machines on.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:Desktop sdorsett$ ssh root@192.168.1.51
Password:
The time and date of this login have been sent to the system logs.

VMware offers supported, powerful system administration tools.  Please
see www.vmware.com/go/sysadmintools for details.

The ESXi Shell can be disabled by an administrative user. See the
vSphere Security documentation for more information.
[root@packer-esxi:~] cd /vmfs/volumes/datastore1/
[root@packer-esxi:/vmfs/volumes/5679efd9-3e1658e4-f977-0050569b912b] ls output-*
output-centos67:
centos67-flat.vmdk  centos67.vmdk       centos67.vmx
centos67.nvram      centos67.vmsd       centos67.vmxf

output-centos67-pe-puppet-382:
centos67-pe-puppet-382-flat.vmdk  centos67-pe-puppet-382.vmsd
centos67-pe-puppet-382.nvram      centos67-pe-puppet-382.vmx
centos67-pe-puppet-382.vmdk       centos67-pe-puppet-382.vmxf
[root@packer-esxi:/vmfs/volumes/5679efd9-3e1658e4-f977-0050569b912b]</code></pre></figure>

<h2>4. We next need to register both of the .vmx files of the Packer virtual machines displayed above on the ESXi virtual machine.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-esxi:/vmfs/volumes/] vim-cmd solo/registervm /vmfs
/volumes/datastore1/output-centos67/*.vmx
15
[root@packer-esxi:/vmfs/volumes/] vim-cmd solo/registervm /vmfs
/volumes/datastore1/output-centos67-pe-puppet-382/*.vmx
16
[root@packer-esxi:/vmfs/volumes/]</code></pre></figure>

<p>You will notice that each of the vim-cmd commands returned a number. That number is the vmid of the virtual machine that was registered. Also if you check the embedded host client, you will see those virtual machines we just registered with the vim-cmd command listed under &quot;Virtual Machines.&quot;</p>

<p><img src="/assets/01-registered-virtual-machines.png" alt="screenshot">  </p>

<h2>5. Once the Packer virtual machines have been registered, we can use ovftool on the CentOS virtual machine to export them as .ovf files.</h2>

<p>After the files are exported, we can then compress the .ovf files into a vmware_ovf compatible .box file. Using the vmware_ovf format will provide a generic .box file that can be deployed to vCenter, vCloud Director or vCloud Air Vagrant providers.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# ovftool vi://root@192.168.1.51/centos67 /root/box_files/ovf/
Enter login information for source vi://192.168.1.51/
Username: root
Password: ********
Opening VI source: vi://root@192.168.1.51:443/centos67
Opening OVF target: /root/box_files/ovf/
Writing OVF package: /root/box_files/ovf/centos67/centos67.ovf
Transfer Completed
Completed successfully

[root@packer-centos ~]# ovftool vi://root@192.168.1.51/centos67-pe-puppet-382 /root/box_files/ovf/
Enter login information for source vi://192.168.1.51/
Username: root
Password: ********
Opening VI source: vi://root@192.168.1.51:443/centos67-pe-puppet-382
Opening OVF target: /root/box_files/ovf/
Writing OVF package: /root/box_files/ovf/centos67-pe-puppet-382/centos67-pe-puppet-382.ovf
Transfer Completed
Completed successfully

[root@packer-centos ~]#</code></pre></figure>

<h2>6. We can also use ovftool to export the Packer virtual machines in a .vmx format for use with VMware Fusion or Workstation:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# ovftool -tt=vmx vi://root@192.168.1.51/centos67 /root/box_files/vmx/Enter login information for source vi://192.168.1.51/
Username: root
Password: ********
Opening VI source: vi://root@192.168.1.51:443/centos67
Opening VMX target: /root/box_files/vmx/
Writing VMX file: /root/box_files/vmx/centos67/centos67.vmx
Transfer Completed
Completed successfully

[root@packer-centos ~]# ovftool -tt=vmx vi://root@192.168.1.51/centos67-pe-puppet-382 /root/box_files/vmx/
Enter login information for source vi://192.168.1.51/
Username: root
Password: ********
Opening VI source: vi://root@192.168.1.51:443/centos67-pe-puppet-382
Opening VMX target: /root/box_files/vmx/
Writing VMX file: /root/box_files/vmx/centos67-pe-puppet-382/centos67-pe-puppet-382.vmx
Transfer Completed
Completed successfully

[root@packer-centos ~]#</code></pre></figure>

<h2>7. We will start with converting the .ovf exported templates.</h2>

<p>Each of the exported template directories will need a metadata.js and Vagrantfile created. After creating the metadata.js and Vagrantfile files, we will tar all of the files in each directory into a .box file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# cd /root/box_files/ovf/centos67
[root@packer-centos centos67]# echo &#39;{&quot;provider&quot;:&quot;vmware_ovf&quot;}&#39; &gt;&gt; metadata.json
[root@packer-centos centos67]# touch Vagrantfile
[root@packer-centos centos67]# tar cvzf /root/box_files/centos67-vmware_ovf-1.0.box ./*
./centos67-disk1.vmdk
./centos67.mf
./centos67.ovf
./metadata.json
./Vagrantfile

[root@packer-centos centos67]# cd /root/box_files/ovf/centos67-pe-puppet-382
[root@packer-centos centos67-pe-puppet-382]# echo &#39;{&quot;provider&quot;:&quot;vmware_ovf&quot;}&#39; &gt;&gt; metadata.json
[root@packer-centos centos67-pe-puppet-382]# touch Vagrantfile
[root@packer-centos centos67-pe-puppet-382]# tar cvzf /root/box_files/centos67-pe-puppet-382-vmware_ovf-1.0.box ./*
./centos67-pe-puppet-382-disk1.vmdk
./centos67-pe-puppet-382.mf
./centos67-pe-puppet-382.ovf
./metadata.json
./Vagrantfile

[root@packer-centos centos67-pe-puppet-382]#</code></pre></figure>

<h2>8. Next we will convert the .vmx exported templates.</h2>

<p>Each of the exported template directories will also need a slightly different metadata.js file created, Vagrantfile created and finally tar all of the files in each directory into a .box file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos centos67-pe-puppet-382]# cd /root/box_files/vmx/centos67
[root@packer-centos centos67]# echo &#39;{&quot;provider&quot;:&quot;vmware_desktop&quot;}&#39; &gt;&gt; metadata.json
[root@packer-centos centos67]# touch Vagrantfile
[root@packer-centos centos67]# tar cvzf /root/box_files/centos67-vmware_desktop-1.0.box ./*
./centos67-disk1.vmdk
./centos67.vmx
./metadata.json
./Vagrantfile

[root@packer-centos centos67]# cd /root/box_files/vmx/centos67-pe-puppet-382/
[root@packer-centos centos67-pe-puppet-382]# echo &#39;{&quot;provider&quot;:&quot;vmware_desktop&quot;}&#39; &gt;&gt; metadata.json
[root@packer-centos centos67-pe-puppet-382]# touch Vagrantfile
[root@packer-centos centos67-pe-puppet-382]# tar cvzf /root/box_files/centos67-pe-puppet-382-vmware_desktop-1.0.box ./*
./centos67-pe-puppet-382-disk1.vmdk
./centos67-pe-puppet-382.vmx
./metadata.json
./Vagrantfile

[root@packer-centos centos67-pe-puppet-382]#</code></pre></figure>

<h2>9. Finally we can use the tree command to see the overall directory structure of the .ovf and .vmx templates, as well as the list of the .box files:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos centos67-pe-puppet-382]# tree /root/box_files/
/root/box_files/
├── centos67-pe-puppet-382-vmware_desktop-1.0.box
├── centos67-pe-puppet-382-vmware_ovf-1.0.box
├── centos67-vmware_desktop-1.0.box
├── centos67-vmware_ovf-1.0.box
├── ovf
│   ├── centos67
│   │   ├── centos67-disk1.vmdk
│   │   ├── centos67.mf
│   │   ├── centos67.ovf
│   │   ├── metadata.json
│   │   └── Vagrantfile
│   └── centos67-pe-puppet-382
│       ├── centos67-pe-puppet-382-disk1.vmdk
│       ├── centos67-pe-puppet-382.mf
│       ├── centos67-pe-puppet-382.ovf
│       ├── metadata.json
│       └── Vagrantfile
└── vmx
    ├── centos67
    │   ├── centos67-disk1.vmdk
    │   ├── centos67.vmx
    │   ├── metadata.json
    │   └── Vagrantfile
    └── centos67-pe-puppet-382
        ├── centos67-pe-puppet-382-disk1.vmdk
        ├── centos67-pe-puppet-382.vmx
        ├── metadata.json
        └── Vagrantfile

6 directories, 22 files
[root@packer-centos centos67-pe-puppet-382]#</code></pre></figure>

<h3>This brings us to the end of this post. Again I&#39;m sorry for this post not covering any automated ways of converting the Packer templates to .box files, but in the next post you&#39;ll learn how we can ease this manual pain with some  scripts.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/26/copy-our-existing-template-and-add-the-puppet-agent/">
        Copying our existing CentOS 6.7 template and adding the Puppet agent
      </a>
    </h1>

    <span class="post-date">26 Dec 2015</span>

    <p>This is the fifth in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the last post we covered <a href="https://sdorsett.github.io/2015/12/25/creating-a-packer-template-for-installing-centos-67/">creating a Packer template for installing CentOS 6.7 with vmtools</a>. In this post we will be basing a new Packer template on the one we created last post and add installing the Puppet Enterprise 3.8.2 agent.</p>

<p>This is an older version of the Puppet Enterprise agent, but it will let us create a Vagrant .box file that can be used for testing Puppet 3.x code.</p>

<p>Let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we have been using in previous posts.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
root@192.168.1.52&#39;s password:
Last login: Fri Dec 25 20:22:44 2015 from 192.168.1.253
[root@packer-centos ~]#</code></pre></figure>

<h2>2. Create a new bash script named centos-install-pe-puppet-382.sh at packer-templates/scripts/ to install the Puppet Enterprise 3.8.2 agent:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# cd ~/packer-templates/scripts/
[root@packer-centos scripts]# cat centos-install-pe-puppet-382.sh
#!/bin/bash

VERSION=&#39;3.8.2&#39;
PKGNAME=&quot;puppet-enterprise-${VERSION}-el-6-x86_64&quot;
TARFILE=&quot;${PKGNAME}.tar.gz&quot;
URL=&quot;https://pm.puppetlabs.com/puppet-enterprise/${VERSION}/${TARFILE}&quot;

TMPDIR=&#39;/tmp&#39;
HOSTNAME=`hostname`
cd $TMPDIR
echo &quot;Fetching ${TARFILE}&quot;
[ -e $TARFILE ] || curl -fLO $URL
echo &quot;Extracting ${TARFILE}&quot;
[ -d $PKGNAME ] || tar -xf $TARFILE
cd $PKGNAME

cat &gt; agent.ans &lt;&lt;EOF
q_all_in_one_install=n
q_database_install=n
q_pe_database=n
q_puppetca_install=n
q_puppetdb_install=n
q_puppetmaster_install=n
q_puppet_enterpriseconsole_install=n
q_run_updtvpkg=n
q_continue_or_reenter_master_hostname=c
q_fail_on_unsuccessful_master_lookup=n
q_puppetagent_certname=$HOSTNAME
q_puppetagent_install=y
q_puppetagent_server=puppet
q_puppet_cloud_install=y
q_puppet_symlinks_install=y
q_vendor_packages_install=y
q_install=y
EOF

./puppet-enterprise-installer -a agent.ans

# Remove certname so the system will use host FQDN
sed -i &#39;/certname =/d&#39; /etc/puppetlabs/puppet/puppet.conf

# Symlink so puppet is in vagrant provisioner PATH
ln -s /opt/puppet/bin/facter /usr/bin/facter
ln -s /opt/puppet/bin/puppet /usr/bin/puppet

[root@packer-deploy scripts]#</code></pre></figure>

<h2>3. Copy the Packer template we created previously, as the starting point for a new CentOS 6.7 template that will have Puppet Enterprise 3.8.2 installed</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# cd ~/packer-templates/templates/
[root@packer-centos templates]# ls
centos67.json
[root@packer-centos templates]# cp centos67.json centos67-pe-puppet-382.json
[root@packer-centos templates]#
[root@packer-deploy scripts]#</code></pre></figure>

<h2>4. Update the provisioners blocker to include the &quot;scripts/centos-install-pe-puppet-382.sh&quot; bash script.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos templates]# cat centos67-pe-puppet-382.json
{
  &quot;variables&quot;: {
    &quot;version&quot;: &quot;1.0&quot;
  },
  &quot;builders&quot;: [
    {
      &quot;name&quot;: &quot;centos67-pe-puppet-382&quot;,
      &quot;vm_name&quot;: &quot;centos67-pe-puppet-382&quot;,
      &quot;vmdk_name&quot;: &quot;centos67-pe-puppet-382&quot;,
      &quot;type&quot;: &quot;vmware-iso&quot;,
      &quot;communicator&quot;: &quot;ssh&quot;,
      &quot;ssh_pty&quot;: &quot;true&quot;,
      &quot;headless&quot;: false,
      &quot;disk_size&quot;: 16384,
      &quot;guest_os_type&quot;: &quot;rhel6-64&quot;,
      &quot;iso_url&quot;: &quot;./iso/CentOS-6.7-x86_64-minimal.iso&quot;,
      &quot;iso_checksum&quot;: &quot;2ed5ea551dffc3e4b82847b3cee1f6cd748e8071&quot;,
      &quot;iso_checksum_type&quot;: &quot;sha1&quot;,
      &quot;shutdown_command&quot;: &quot;echo &#39;vagrant&#39; | sudo -S /sbin/shutdown -P now&quot;,

      &quot;remote_host&quot;: &quot;&quot;,
      &quot;remote_datastore&quot;: &quot;&quot;,
      &quot;remote_username&quot;: &quot;&quot;,
      &quot;remote_password&quot;: &quot;&quot;,
      &quot;remote_type&quot;: &quot;esx5&quot;,
      &quot;ssh_username&quot;: &quot;root&quot;,
      &quot;ssh_password&quot;: &quot;vagrant&quot;,
      &quot;ssh_wait_timeout&quot;: &quot;60m&quot;,
      &quot;tools_upload_flavor&quot;: &quot;linux&quot;,
      &quot;http_directory&quot;: &quot;.&quot;,
      &quot;boot_wait&quot;: &quot;5s&quot;,
      &quot;vmx_data&quot;: {
        &quot;memsize&quot;: &quot;4096&quot;,
        &quot;numvcpus&quot;: &quot;2&quot;,
        &quot;ethernet0.networkName&quot;: &quot;&quot;,
        &quot;ethernet0.present&quot;: &quot;TRUE&quot;,
        &quot;ethernet0.startConnected&quot;: &quot;TRUE&quot;,
        &quot;ethernet0.virtualDev&quot;: &quot;e1000&quot;,
        &quot;ethernet0.addressType&quot;: &quot;generated&quot;,
        &quot;ethernet0.generatedAddressOffset&quot;: &quot;0&quot;,
        &quot;ethernet0.wakeOnPcktRcv&quot;: &quot;FALSE&quot;

      },
      &quot;vmx_data_post&quot;: {
        &quot;ide1:0.startConnected&quot;: &quot;FALSE&quot;,
        &quot;ide1:0.clientDevice&quot;: &quot;TRUE&quot;,
        &quot;ide1:0.fileName&quot;: &quot;emptyBackingString&quot;,
        &quot;ethernet0.virtualDev&quot;: &quot;vmxnet3&quot;
      },
      &quot;boot_command&quot;: [
        &quot;&lt;tab&gt; text ks=http://:/scripts/centos-6-kickstart.cfg&lt;enter&gt;&lt;wait&gt;&quot;
      ]
    }
  ],
  &quot;provisioners&quot;: [
    {
      &quot;type&quot;: &quot;file&quot;,
      &quot;source&quot;: &quot;iso/vmware-tools-linux.iso&quot;,
      &quot;destination&quot;: &quot;/tmp/vmware-tools-linux.iso&quot;
    },
    {
      &quot;type&quot;: &quot;shell&quot;,
      &quot;execute_command&quot;: &quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;,
      &quot;script&quot;: &quot;scripts/centos-vagrant-settings.sh&quot;
    },
    {
      &quot;type&quot;: &quot;shell&quot;,
      &quot;execute_command&quot;: &quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;,
      &quot;script&quot;: &quot;scripts/centos-vmware-tools_install.sh&quot;
    },
    {
      &quot;type&quot;: &quot;shell&quot;,
      &quot;execute_command&quot;: &quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;,
      &quot;script&quot;: &quot;scripts/centos-install-pe-puppet-382.sh&quot;
    },
    {
      &quot;type&quot;: &quot;shell&quot;,
      &quot;execute_command&quot;: &quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;,
      &quot;script&quot;: &quot;scripts/centos-vmware-cleanup.sh&quot;
    }
  ]
}</code></pre></figure>

<h2>5. The packer-templates directory should now contain the following directories and files:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# tree /root/packer-templates/
/root/packer-templates/
├── iso
│   ├── CentOS-6.7-x86_64-minimal.iso
│   ├── linux.iso
│   └── vmware-tools-linux.iso -&gt; ./linux.iso
├── packer_cache
├── packer-remote-info.json
├── README.md
├── scripts
│   ├── centos-6-kickstart.cfg
│   ├── centos-install-pe-puppet-382.sh
│   ├── centos-vagrant-settings.sh
│   ├── centos-vmware-cleanup.sh
│   └── centos-vmware-tools_install.sh
└── templates
    ├── centos67.json
    └── centos67-pe-puppet-382.json

4 directories, 12 files
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>6. Push the changes we have made to a github repository</h2>

<p>During this step pushed the two new files to the <a href="https://github.com/sdorsett/packer-templates/tree/adding-second-packer-template">adding-second-packer-template branch</a> of the github repository I have created for this series of blog posts:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# git status
# On branch first-packer-template
# Untracked files:
#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
#
#   scripts/centos-install-pe-puppet-382.sh
#   templates/centos67-pe-puppet-382.json
nothing added to commit but untracked files present (use &quot;git add&quot; to track)
[root@packer-centos packer-templates]# git add .
[root@packer-centos packer-templates]# git commit -m &quot;adding templates/centos67-pe-puppet-382.json and scripts/centos-install-pe-puppet-382.sh&quot;
[first-packer-template 75bb98e] adding templates/centos67-pe-puppet-382.json and scripts/centos-install-pe-puppet-382.sh
 2 files changed, 125 insertions(+), 0 deletions(-)
 create mode 100644 scripts/centos-install-pe-puppet-382.sh
 create mode 100644 templates/centos67-pe-puppet-382.json
[root@packer-centos packer-templates]# git checkout -b adding-second-packer-template
Switched to a new branch &#39;adding-second-packer-template&#39;
[root@packer-centos packer-templates]# git push origin adding-second-packer-template
Password:
Counting objects: 9, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (6/6), done.
Writing objects: 100% (6/6), 1.95 KiB, done.
Total 6 (delta 1), reused 0 (delta 0)
To https://sdorsett@github.com/sdorsett/packer-templates.git
 * [new branch]      adding-second-packer-template -&gt; adding-second-packer-template
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>13. Have Packer build the new template we created</h2>

<p>Now that we have updated the new template file and created the script file that will install the Puppet Enterprise 3.8.2 agent, we can test our build. In order to use the values in the packer-remote-info.json file, we will use the -var-file parameter to specify this file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">root@packer-centos packer-templates]# packer build -var-file=./packer-remote-info.json templates/centos67-pe-puppet-382.json
centos67-pe-puppet-382 output will be in this color.

==&gt; centos67-pe-puppet-382: Downloading or copying ISO
    centos67-pe-puppet-382: Downloading or copying: file:///root/packer-templates/iso/CentOS-6.7-x86_64-minimal.iso
==&gt; centos67-pe-puppet-382: Uploading ISO to remote machine...
==&gt; centos67-pe-puppet-382: Creating virtual machine disk
==&gt; centos67-pe-puppet-382: Building and writing VMX file
==&gt; centos67-pe-puppet-382: Starting HTTP server on port 8019
==&gt; centos67-pe-puppet-382: Registering remote VM...
==&gt; centos67-pe-puppet-382: Starting virtual machine...
==&gt; centos67-pe-puppet-382: Waiting 7s for boot...
==&gt; centos67-pe-puppet-382: Connecting to VM via VNC
==&gt; centos67-pe-puppet-382: Typing the boot command over VNC...
==&gt; centos67-pe-puppet-382: Waiting for SSH to become available...</code></pre></figure>

<p>At this point you should see a centos67 virtual machine in the embedded host client of the ESXi virtual machine.</p>

<p><img src="/assets/01-centos-67-pe-puppet-382-virtual-machine.png" alt="screenshot">  </p>

<p>Once the CentOS 6.7 install completes and the virtual machine reboots, you will see the packer build output continue with the provisioners block of the Packer template.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Connected to SSH!</code></pre></figure>

<p>The first provisioner is the file provisioner that will copy iso/vmware-tools-linux.iso to /tmp/vmware-tools-linux.iso within the CentOS 6.7 virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Uploading iso/vmware-tools-linux.iso =&gt; /tmp/vmware-tools-linux.iso</code></pre></figure>

<p>The second provisioner is a shell provisioner that will run the scripts/centos-vagrant-settings.sh bash script. This script will added the necessary changes for this Packer image to be used by Vagrant.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vagrant-settings.sh</code></pre></figure>

<p>The third provisioner is a shell provisioner that will run the scripts/centos-vmware-tools_install.sh bash script. This script will install all the needed dependencies for vmtools and then install vmtools using an answer file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vmware-tools_install.sh
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Upgrade Process
    centos67-pe-puppet-382: Determining fastest mirrors
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: No Packages marked for Update
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Install Process
    centos67-pe-puppet-382: Loading mirror speeds from cached hostfile
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package 4:perl-5.10.1-141.el6_7.1.x86_64 already installed and latest version
    centos67-pe-puppet-382: Resolving Dependencies
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package fuse-libs.x86_64 0:2.8.3-4.el6 will be installed
    centos67-pe-puppet-382: --&gt; Finished Dependency Resolution
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependencies Resolved
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ========================================
    centos67-pe-puppet-382: Package  Arch   Version     Repository
    centos67-pe-puppet-382: Size
    centos67-pe-puppet-382: ========================================
    centos67-pe-puppet-382: Installing:
    centos67-pe-puppet-382: fuse-libs
    centos67-pe-puppet-382: x86_64 2.8.3-4.el6 base  74 k
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Transaction Summary
    centos67-pe-puppet-382: ========================================
    centos67-pe-puppet-382: Install       1 Package(s)
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Total download size: 74 k
    centos67-pe-puppet-382: Installed size: 251 k
    centos67-pe-puppet-382: Downloading Packages:
    centos67-pe-puppet-382: fuse-libs-2.8.3- |  74 kB     00:00
    centos67-pe-puppet-382: Running rpm_check_debug
    centos67-pe-puppet-382: Running Transaction Test
    centos67-pe-puppet-382: Transaction Test Succeeded
    centos67-pe-puppet-382: Running Transaction
    centos67-pe-puppet-382:   Installing : fuse-libs-2.8.3-4.   1/1
    centos67-pe-puppet-382: Verifying  : fuse-libs-2.8.3-4.   1/1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installed:
    centos67-pe-puppet-382: fuse-libs.x86_64 0:2.8.3-4.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Complete!
    centos67-pe-puppet-382: total 488
    centos67-pe-puppet-382: drwxr-xr-x   7 root root   4096 Oct 30 07:10 .
    centos67-pe-puppet-382: drwxrwxrwt.  4 root root   4096 Dec 26 20:56 ..
    centos67-pe-puppet-382: drwxr-xr-x   2 root root   4096 Oct 30 07:10 bin
    centos67-pe-puppet-382: drwxr-xr-x   2 root root   4096 Oct 30 07:10 doc
    centos67-pe-puppet-382: drwxr-xr-x   5 root root   4096 Oct 30 07:10 etc
    centos67-pe-puppet-382: -rw-r--r--   1 root root 269196 Oct 30 07:10 FILES
    centos67-pe-puppet-382: -rw-r--r--   1 root root   2538 Oct 30 07:10 INSTALL
    centos67-pe-puppet-382: drwxr-xr-x   2 root root   4096 Oct 30 07:10 installer
    centos67-pe-puppet-382: drwxr-xr-x  15 root root   4096 Oct 30 07:10 lib
    centos67-pe-puppet-382: -rwxr-xr-x   1 root root 196237 Oct 30 07:10 vmware-install.pl
    centos67-pe-puppet-382: Creating a new VMware Tools installer database using the tar4 format.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installing VMware Tools.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: In which directory do you want to install the binary files?
    centos67-pe-puppet-382: [/usr/bin]
    centos67-pe-puppet-382: The path &quot;yes&quot; is a relative path. Please enter an absolute path.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: In which directory do you want to install the binary files?
    centos67-pe-puppet-382: [/usr/bin]
    centos67-pe-puppet-382: What is the directory that contains the init directories (rc0.d/ to rc6.d/)?
    centos67-pe-puppet-382: [/etc/rc.d]
    centos67-pe-puppet-382: What is the directory that contains the init scripts?
    centos67-pe-puppet-382: [/etc/init.d]
    centos67-pe-puppet-382: In which directory do you want to install the daemon files?
    centos67-pe-puppet-382: [/usr/sbin]
    centos67-pe-puppet-382: In which directory do you want to install the library files?
    centos67-pe-puppet-382: [/usr/lib/vmware-tools]
    centos67-pe-puppet-382: The path &quot;/usr/lib/vmware-tools&quot; does not exist currently. This program is
    centos67-pe-puppet-382: going to create it, including needed parent directories. Is this what you want?
    centos67-pe-puppet-382: [yes]
    centos67-pe-puppet-382: In which directory do you want to install the documentation files?
    centos67-pe-puppet-382: [/usr/share/doc/vmware-tools]
    centos67-pe-puppet-382: The path &quot;/usr/share/doc/vmware-tools&quot; does not exist currently. This program
    centos67-pe-puppet-382: is going to create it, including needed parent directories. Is this what you
    centos67-pe-puppet-382: want? [yes]
    centos67-pe-puppet-382: The installation of VMware Tools 9.9.4 build-3193940 for Linux completed
    centos67-pe-puppet-382: successfully. You can decide to remove this software from your system at any
    centos67-pe-puppet-382: time by invoking the following command: &quot;/usr/bin/vmware-uninstall-tools.pl&quot;.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Before running VMware Tools for the first time, you need to configure it by
    centos67-pe-puppet-382: invoking the following command: &quot;/usr/bin/vmware-config-tools.pl&quot;. Do you want
    centos67-pe-puppet-382: this program to invoke the command for you now? [yes]
    centos67-pe-puppet-382: Initializing...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Making sure services for VMware Tools are stopped.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module for vmci.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module for vsock.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module vmxnet3 has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module pvscsi has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module vmmemctl has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The VMware Host-Guest Filesystem allows for shared folders between the host OS
    centos67-pe-puppet-382: and the guest OS in a Fusion or Workstation virtual environment.  Do you wish
    centos67-pe-puppet-382: to enable this feature? [no]
    centos67-pe-puppet-382: Found a compatible pre-built module for vmhgfs.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module for vmxnet.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The vmblock enables dragging or copying files between host and guest in a
    centos67-pe-puppet-382: Fusion or Workstation virtual environment.  Do you wish to enable this feature?
    centos67-pe-puppet-382: [no]
    centos67-pe-puppet-382: VMware automatic kernel modules enables automatic building and installation of
    centos67-pe-puppet-382: VMware kernel modules at boot that are not already present. This feature can be
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: enabled/disabled by re-running vmware-config-tools.pl.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Would you like to enable VMware automatic kernel modules?
    centos67-pe-puppet-382: [no]
    centos67-pe-puppet-382: Do you want to enable Guest Authentication (vgauth)? [yes]
    centos67-pe-puppet-382: No X install found.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Creating a new initrd boot image for the kernel.
    centos67-pe-puppet-382: vmware-tools-thinprint start/running
    centos67-pe-puppet-382: vmware-tools start/running
    centos67-pe-puppet-382: The configuration of VMware Tools 9.9.4 build-3193940 for Linux for this
    centos67-pe-puppet-382: running kernel completed successfully.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You must restart your X session before any mouse or graphics changes take
    centos67-pe-puppet-382: effect.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You can now run VMware Tools by invoking &quot;/usr/bin/vmware-toolbox-cmd&quot; from the
    centos67-pe-puppet-382: command line.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: To enable advanced X features (e.g., guest resolution fit, drag and drop, and
    centos67-pe-puppet-382: file and text copy/paste), you will need to do one (or more) of the following:
    centos67-pe-puppet-382: 1. Manually start /usr/bin/vmware-user
    centos67-pe-puppet-382: 2. Log out and log back into your desktop session; and,
    centos67-pe-puppet-382: 3. Restart your X session.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Enjoy,
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: --the VMware team
    centos67-pe-puppet-382:</code></pre></figure>

<p>The fourth provisioner is the shell provisioner that will run the scripts/centos-install-pe-puppet-382.sh bash script. This is the script we added to the Packer template to install the Puppet Enterprise 3.8.2 agent.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-install-pe-puppet-382.sh
    centos67-pe-puppet-382: Fetching puppet-enterprise-3.8.2-el-6-x86_64.tar.gz
    centos67-pe-puppet-382: % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
    centos67-pe-puppet-382: Dload  Upload   Total   Spent    Left  Speed
    centos67-pe-puppet-382: 100  437M  100  437M    0     0  6688k      0  0:01:06  0:01:06 --:--:-- 6879k
    centos67-pe-puppet-382: Extracting puppet-enterprise-3.8.2-el-6-x86_64.tar.gz
    centos67-pe-puppet-382: ========================================================================
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise v3.8.2 installer
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise documentation can be found at http://docs.puppetlabs.com/pe/3.8/
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP 1: READ ANSWERS FROM FILE
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ## Reading answers from file: ./agent.ans
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP 2: SELECT AND CONFIGURE ROLES
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: This installer lets you select and install the various roles
    centos67-pe-puppet-382: required in a Puppet Enterprise deployment: puppet master,
    centos67-pe-puppet-382: console, database, cloud provisioner, and puppet agent.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: NOTE: when specifying hostnames during installation, use the fully-qualified domain name (foo.example.com) rather than a shortened name (foo).
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; puppet master
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The puppet master serves configurations to a group of puppet
    centos67-pe-puppet-382: agent nodes. This role also provides MCollective&#39;s message queue
    centos67-pe-puppet-382: and client interface. It should be installed on a robust,
    centos67-pe-puppet-382: dedicated server.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install puppet master? [y/N] n
    centos67-pe-puppet-382: ?? Puppet master hostname to connect to? [Default: puppet] puppet
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; database support
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: This role provides database support for PuppetDB and PE&#39;s
    centos67-pe-puppet-382: console. PuppetDB is a centralized data service that caches data
    centos67-pe-puppet-382: generated by Puppet and provides access to it via a robust API.
    centos67-pe-puppet-382: The console uses data provided by a PostgreSQL server and
    centos67-pe-puppet-382: database both of which will be installed along with PuppetDB on
    centos67-pe-puppet-382: the node you specify.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: IMPORTANT: If you choose not to install PuppetDB at this time,
    centos67-pe-puppet-382: you will be prompted for the host name of the node you intend to
    centos67-pe-puppet-382: use to provide database services. Note that you must install
    centos67-pe-puppet-382: database support on that node for the console to function. When
    centos67-pe-puppet-382: using a separate node, you should install database support on it
    centos67-pe-puppet-382: BEFORE installing the console role.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install PuppetDB? [y/N] n
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; console
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The console is a web interface where you can view reports,
    centos67-pe-puppet-382: classify nodes, control Puppet runs, and invoke MCollective
    centos67-pe-puppet-382: agents. It can be installed on the puppet master&#39;s node, but for
    centos67-pe-puppet-382: performance considerations, especially in larger deployments, it
    centos67-pe-puppet-382: can also be installed on a separate node.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install the console? [y/N] n
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; cloud provisioner
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The cloud provisioner can create and bootstrap new machine
    centos67-pe-puppet-382: instances and add them to your Puppet infrastructure. It should
    centos67-pe-puppet-382: be installed on a trusted node where site administrators have
    centos67-pe-puppet-382: shell access.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install the cloud provisioner? [y/N] y
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; puppet agent
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The puppet agent role is automatically installed with the
    centos67-pe-puppet-382: console, puppet master, puppetdb, and cloud provisioner roles.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Puppet agent needs a unique name (&quot;certname&quot;) for its
    centos67-pe-puppet-382: certificate; this can be an arbitrary string. Certname for this
    centos67-pe-puppet-382: node? [Default: localhost] localhost.localdomain
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; Vendor Packages
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The installer has detected that Puppet Enterprise requires
    centos67-pe-puppet-382: additional packages from your operating system vendor&#39;s
    centos67-pe-puppet-382: repositories, and can automatically install them. If you choose
    centos67-pe-puppet-382: not to install these packages automatically, the installer will
    centos67-pe-puppet-382: exit so you can install them manually.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Additional vendor packages required for installation:
    centos67-pe-puppet-382: * dmidecode
    centos67-pe-puppet-382: * libxslt
    centos67-pe-puppet-382: * pciutils
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install these packages automatically? [Y/n] y
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP 3: CONFIRM PLAN
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You have selected to install the following components (and their dependencies)
    centos67-pe-puppet-382: * Cloud Provisioner
    centos67-pe-puppet-382: * Puppet Agent
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Perform installation? [Y/n] y
    centos67-pe-puppet-382: ## Answers saved in the following files: /tmp/puppet-enterprise-3.8.2-el-6-x86_64/answers.lastrun.localhost and /etc/puppetlabs/installer/answers.install
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ========================================================================
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP 4: INSTALL PACKAGES
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ## Installing packages from repositories...
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Install Process
    centos67-pe-puppet-382: Loading mirror speeds from cached hostfile
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package zlib-1.2.3-29.el6.x86_64 already installed and latest version
    centos67-pe-puppet-382: Package which-2.19-6.el6.x86_64 already installed and latest version
    centos67-pe-puppet-382: Package net-tools-1.60-110.el6_2.x86_64 already installed and latest version
    centos67-pe-puppet-382: Resolving Dependencies
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package cronie.x86_64 0:1.4.4-15.el6 will be updated
    centos67-pe-puppet-382: --&gt; Processing Dependency: cronie = 1.4.4-15.el6 for package: cronie-anacron-1.4.4-15.el6.x86_64
    centos67-pe-puppet-382: ---&gt; Package cronie.x86_64 0:1.4.4-15.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package dmidecode.x86_64 1:2.12-6.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package libxml2.x86_64 0:2.7.6-20.el6 will be updated
    centos67-pe-puppet-382: ---&gt; Package libxml2.x86_64 0:2.7.6-20.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package libxslt.x86_64 0:1.1.26-2.el6_3.1 will be installed
    centos67-pe-puppet-382: ---&gt; Package pciutils.x86_64 0:3.1.10-4.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-agent.noarch 0:3.8.2-1.pe.el6 will be installed
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-virt-what &gt;= 1.13-1.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-rubygem-deep-merge &gt;= 1.0.0-3.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-stomp &gt;= 1.3.3-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-shadow &gt;= 2.2.0-3.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-selinux &gt;= 2.0.94-4.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-rgen &gt;= 0.6.5-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-augeas &gt;= 0.5.0-7.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby &gt;= 1.9.3.551-2.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-puppet-enterprise-release &gt;= 3.8.2.0-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-puppet &gt;= 3.8.2.0-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-openssl &gt;= 1.0.0s-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-mcollective-common &gt;= 2.7.0.1-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-mcollective &gt;= 2.7.0.1-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-libyaml &gt;= 0.1.6-5.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-libldap &gt;= 2.4.39-5.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-hiera &gt;= 1.3.4.5-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-facter &gt;= 2.4.4.0-1.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-augeas &gt;= 1.3.0-2.pe.el6 for package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: ---&gt; Package pe-cloud-provisioner.noarch 0:1.2.0-1.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-cloud-provisioner-libs.x86_64 0:0.3.2-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-ldap.x86_64 0:0.9.12-7.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-rubygem-net-ssh.noarch 0:2.1.4-2.pe.el6 will be installed
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package cronie-anacron.x86_64 0:1.4.4-15.el6 will be updated
    centos67-pe-puppet-382: ---&gt; Package cronie-anacron.x86_64 0:1.4.4-15.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package pe-augeas.x86_64 0:1.3.0-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-facter.x86_64 0:2.4.4.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-hiera.noarch 0:1.3.4.5-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-libldap.x86_64 0:2.4.39-5.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-libyaml.x86_64 0:0.1.6-5.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-mcollective.noarch 0:2.7.0.1-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-mcollective-common.noarch 0:2.7.0.1-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-openssl.x86_64 0:1.0.0s-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-puppet.noarch 0:3.8.2.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-puppet-enterprise-release.noarch 0:3.8.2.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby.x86_64 0:1.9.3.551-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-augeas.x86_64 0:0.5.0-7.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-rgen.noarch 0:0.6.5-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-selinux.x86_64 0:2.0.94-4.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-shadow.x86_64 0:2.2.0-3.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-stomp.noarch 0:1.3.3-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-rubygem-deep-merge.noarch 0:1.0.0-3.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-virt-what.x86_64 0:1.13-1.el6 will be installed
    centos67-pe-puppet-382: --&gt; Finished Dependency Resolution
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependencies Resolved
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ================================================================================
    centos67-pe-puppet-382: Package            Arch   Version            Repository                   Size
    centos67-pe-puppet-382: ================================================================================
    centos67-pe-puppet-382: Installing:
    centos67-pe-puppet-382: dmidecode          x86_64 1:2.12-6.el6       base                         74 k
    centos67-pe-puppet-382: libxslt            x86_64 1.1.26-2.el6_3.1   base                        452 k
    centos67-pe-puppet-382: pciutils           x86_64 3.1.10-4.el6       base                         85 k
    centos67-pe-puppet-382: pe-agent           noarch 3.8.2-1.pe.el6     puppet-enterprise-installer 3.7 k
    centos67-pe-puppet-382: pe-cloud-provisioner
    centos67-pe-puppet-382: noarch 1.2.0-1.el6        puppet-enterprise-installer  51 k
    centos67-pe-puppet-382: pe-cloud-provisioner-libs
    centos67-pe-puppet-382: x86_64 0.3.2-2.pe.el6     puppet-enterprise-installer 4.6 M
    centos67-pe-puppet-382: pe-ruby-ldap       x86_64 0.9.12-7.pe.el6    puppet-enterprise-installer  46 k
    centos67-pe-puppet-382: pe-rubygem-net-ssh noarch 2.1.4-2.pe.el6     puppet-enterprise-installer 227 k
    centos67-pe-puppet-382: Updating:
    centos67-pe-puppet-382: cronie             x86_64 1.4.4-15.el6_7.1   updates                      74 k
    centos67-pe-puppet-382: libxml2            x86_64 2.7.6-20.el6_7.1   updates                     803 k
    centos67-pe-puppet-382: Installing for dependencies:
    centos67-pe-puppet-382: pe-augeas          x86_64 1.3.0-2.pe.el6     puppet-enterprise-installer 523 k
    centos67-pe-puppet-382: pe-facter          x86_64 2.4.4.0-1.pe.el6   puppet-enterprise-installer  99 k
    centos67-pe-puppet-382: pe-hiera           noarch 1.3.4.5-1.pe.el6   puppet-enterprise-installer  18 k
    centos67-pe-puppet-382: pe-libldap         x86_64 2.4.39-5.pe.el6    puppet-enterprise-installer 776 k
    centos67-pe-puppet-382: pe-libyaml         x86_64 0.1.6-5.el6        puppet-enterprise-installer 193 k
    centos67-pe-puppet-382: pe-mcollective     noarch 2.7.0.1-1.pe.el6   puppet-enterprise-installer 8.0 k
    centos67-pe-puppet-382: pe-mcollective-common
    centos67-pe-puppet-382: noarch 2.7.0.1-1.pe.el6   puppet-enterprise-installer 129 k
    centos67-pe-puppet-382: pe-openssl         x86_64 1.0.0s-1.pe.el6    puppet-enterprise-installer 6.7 M
    centos67-pe-puppet-382: pe-puppet          noarch 3.8.2.0-1.pe.el6   puppet-enterprise-installer 1.6 M
    centos67-pe-puppet-382: pe-puppet-enterprise-release
    centos67-pe-puppet-382: noarch 3.8.2.0-1.pe.el6   puppet-enterprise-installer  12 k
    centos67-pe-puppet-382: pe-ruby            x86_64 1.9.3.551-2.pe.el6 puppet-enterprise-installer 8.1 M
    centos67-pe-puppet-382: pe-ruby-augeas     x86_64 0.5.0-7.pe.el6     puppet-enterprise-installer  22 k
    centos67-pe-puppet-382: pe-ruby-rgen       noarch 0.6.5-1.pe.el6     puppet-enterprise-installer 238 k
    centos67-pe-puppet-382: pe-ruby-selinux    x86_64 2.0.94-4.pe.el6    puppet-enterprise-installer  57 k
    centos67-pe-puppet-382: pe-ruby-shadow     x86_64 2.2.0-3.pe.el6     puppet-enterprise-installer  11 k
    centos67-pe-puppet-382: pe-ruby-stomp      noarch 1.3.3-1.pe.el6     puppet-enterprise-installer  54 k
    centos67-pe-puppet-382: pe-rubygem-deep-merge
    centos67-pe-puppet-382: noarch 1.0.0-3.pe.el6     puppet-enterprise-installer  74 k
    centos67-pe-puppet-382: pe-virt-what       x86_64 1.13-1.el6         puppet-enterprise-installer  22 k
    centos67-pe-puppet-382: Updating for dependencies:
    centos67-pe-puppet-382: cronie-anacron     x86_64 1.4.4-15.el6_7.1   updates                      31 k
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Transaction Summary
    centos67-pe-puppet-382: ================================================================================
    centos67-pe-puppet-382: Install      26 Package(s)
    centos67-pe-puppet-382: Upgrade       3 Package(s)
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Total download size: 25 M
    centos67-pe-puppet-382: Downloading Packages:
    centos67-pe-puppet-382: --------------------------------------------------------------------------------
    centos67-pe-puppet-382: Total                                            11 MB/s |  25 MB     00:02
    centos67-pe-puppet-382: Running rpm_check_debug
    centos67-pe-puppet-382: Running Transaction Test
    centos67-pe-puppet-382: Transaction Test Succeeded
    centos67-pe-puppet-382: Running Transaction
    centos67-pe-puppet-382: Installing : pe-puppet-enterprise-release-3.8.2.0-1.pe.el6.noarch        1/32
    centos67-pe-puppet-382: Installing : pe-openssl-1.0.0s-1.pe.el6.x86_64                           2/32
    centos67-pe-puppet-382: Installing : pe-libldap-2.4.39-5.pe.el6.x86_64                           3/32
    centos67-pe-puppet-382: Installing : pe-libyaml-0.1.6-5.el6.x86_64                               4/32
    centos67-pe-puppet-382: Installing : pe-ruby-1.9.3.551-2.pe.el6.x86_64                           5/32
    centos67-pe-puppet-382: Installing : pe-rubygem-net-ssh-2.1.4-2.pe.el6.noarch                    6/32
    centos67-pe-puppet-382: Installing : pe-ruby-stomp-1.3.3-1.pe.el6.noarch                         7/32
    centos67-pe-puppet-382: Installing : pe-mcollective-common-2.7.0.1-1.pe.el6.noarch               8/32
    centos67-pe-puppet-382: Installing : pe-ruby-selinux-2.0.94-4.pe.el6.x86_64                      9/32
    centos67-pe-puppet-382: Installing : pe-ruby-rgen-0.6.5-1.pe.el6.noarch                         10/32
    centos67-pe-puppet-382: Installing : pe-rubygem-deep-merge-1.0.0-3.pe.el6.noarch                11/32
    centos67-pe-puppet-382: Installing : pe-hiera-1.3.4.5-1.pe.el6.noarch                           12/32
    centos67-pe-puppet-382: Installing : pe-augeas-1.3.0-2.pe.el6.x86_64                            13/32
    centos67-pe-puppet-382: Installing : pe-ruby-augeas-0.5.0-7.pe.el6.x86_64                       14/32
    centos67-pe-puppet-382: Updating   : libxml2-2.7.6-20.el6_7.1.x86_64                            15/32
    centos67-pe-puppet-382: Installing : 1:dmidecode-2.12-6.el6.x86_64                              16/32
    centos67-pe-puppet-382: Installing : pe-virt-what-1.13-1.el6.x86_64                             17/32
    centos67-pe-puppet-382: Installing : libxslt-1.1.26-2.el6_3.1.x86_64                            18/32
    centos67-pe-puppet-382: Installing : pe-cloud-provisioner-libs-0.3.2-2.pe.el6.x86_64            19/32
    centos67-pe-puppet-382: Installing : pe-mcollective-2.7.0.1-1.pe.el6.noarch                     20/32
    centos67-pe-puppet-382: Installing : pe-ruby-ldap-0.9.12-7.pe.el6.x86_64                        21/32
    centos67-pe-puppet-382: Installing : pe-ruby-shadow-2.2.0-3.pe.el6.x86_64                       22/32
    centos67-pe-puppet-382: Updating   : cronie-anacron-1.4.4-15.el6_7.1.x86_64                     23/32
    centos67-pe-puppet-382: Updating   : cronie-1.4.4-15.el6_7.1.x86_64                             24/32
    centos67-pe-puppet-382: Installing : pciutils-3.1.10-4.el6.x86_64                               25/32
    centos67-pe-puppet-382: Installing : pe-facter-2.4.4.0-1.pe.el6.x86_64                          26/32
    centos67-pe-puppet-382: Installing : pe-puppet-3.8.2.0-1.pe.el6.noarch                          27/32
    centos67-pe-puppet-382: Installing : pe-agent-3.8.2-1.pe.el6.noarch                             28/32
    centos67-pe-puppet-382: Installing : pe-cloud-provisioner-1.2.0-1.el6.noarch                    29/32
    centos67-pe-puppet-382: Cleanup    : cronie-anacron-1.4.4-15.el6.x86_64                         30/32
    centos67-pe-puppet-382: Cleanup    : cronie-1.4.4-15.el6.x86_64                                 31/32
    centos67-pe-puppet-382: Cleanup    : libxml2-2.7.6-20.el6.x86_64                                32/32
    centos67-pe-puppet-382: Verifying  : pe-puppet-enterprise-release-3.8.2.0-1.pe.el6.noarch        1/32
    centos67-pe-puppet-382: Verifying  : pe-hiera-1.3.4.5-1.pe.el6.noarch                            2/32
    centos67-pe-puppet-382: Verifying  : pe-mcollective-common-2.7.0.1-1.pe.el6.noarch               3/32
    centos67-pe-puppet-382: Verifying  : pciutils-3.1.10-4.el6.x86_64                                4/32
    centos67-pe-puppet-382: Verifying  : pe-libldap-2.4.39-5.pe.el6.x86_64                           5/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-augeas-0.5.0-7.pe.el6.x86_64                        6/32
    centos67-pe-puppet-382: Verifying  : pe-agent-3.8.2-1.pe.el6.noarch                              7/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-ldap-0.9.12-7.pe.el6.x86_64                         8/32
    centos67-pe-puppet-382: Verifying  : 1:dmidecode-2.12-6.el6.x86_64                               9/32
    centos67-pe-puppet-382: Verifying  : pe-mcollective-2.7.0.1-1.pe.el6.noarch                     10/32
    centos67-pe-puppet-382: Verifying  : pe-cloud-provisioner-libs-0.3.2-2.pe.el6.x86_64            11/32
    centos67-pe-puppet-382: Verifying  : cronie-1.4.4-15.el6_7.1.x86_64                             12/32
    centos67-pe-puppet-382: Verifying  : pe-rubygem-net-ssh-2.1.4-2.pe.el6.noarch                   13/32
    centos67-pe-puppet-382: Verifying  : pe-openssl-1.0.0s-1.pe.el6.x86_64                          14/32
    centos67-pe-puppet-382: Verifying  : pe-facter-2.4.4.0-1.pe.el6.x86_64                          15/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-selinux-2.0.94-4.pe.el6.x86_64                     16/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-stomp-1.3.3-1.pe.el6.noarch                        17/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-shadow-2.2.0-3.pe.el6.x86_64                       18/32
    centos67-pe-puppet-382: Verifying  : libxslt-1.1.26-2.el6_3.1.x86_64                            19/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-rgen-0.6.5-1.pe.el6.noarch                         20/32
    centos67-pe-puppet-382: Verifying  : pe-rubygem-deep-merge-1.0.0-3.pe.el6.noarch                21/32
    centos67-pe-puppet-382: Verifying  : pe-puppet-3.8.2.0-1.pe.el6.noarch                          22/32
    centos67-pe-puppet-382: Verifying  : cronie-anacron-1.4.4-15.el6_7.1.x86_64                     23/32
    centos67-pe-puppet-382: Verifying  : pe-libyaml-0.1.6-5.el6.x86_64                              24/32
    centos67-pe-puppet-382: Verifying  : pe-virt-what-1.13-1.el6.x86_64                             25/32
    centos67-pe-puppet-382: Verifying  : pe-augeas-1.3.0-2.pe.el6.x86_64                            26/32
    centos67-pe-puppet-382: Verifying  : pe-cloud-provisioner-1.2.0-1.el6.noarch                    27/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-1.9.3.551-2.pe.el6.x86_64                          28/32
    centos67-pe-puppet-382: Verifying  : libxml2-2.7.6-20.el6_7.1.x86_64                            29/32
    centos67-pe-puppet-382: Verifying  : libxml2-2.7.6-20.el6.x86_64                                30/32
    centos67-pe-puppet-382: Verifying  : cronie-1.4.4-15.el6.x86_64                                 31/32
    centos67-pe-puppet-382: Verifying  : cronie-anacron-1.4.4-15.el6.x86_64                         32/32
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installed:
    centos67-pe-puppet-382: dmidecode.x86_64 1:2.12-6.el6
    centos67-pe-puppet-382: libxslt.x86_64 0:1.1.26-2.el6_3.1
    centos67-pe-puppet-382: pciutils.x86_64 0:3.1.10-4.el6
    centos67-pe-puppet-382: pe-agent.noarch 0:3.8.2-1.pe.el6
    centos67-pe-puppet-382: pe-cloud-provisioner.noarch 0:1.2.0-1.el6
    centos67-pe-puppet-382: pe-cloud-provisioner-libs.x86_64 0:0.3.2-2.pe.el6
    centos67-pe-puppet-382: pe-ruby-ldap.x86_64 0:0.9.12-7.pe.el6
    centos67-pe-puppet-382: pe-rubygem-net-ssh.noarch 0:2.1.4-2.pe.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependency Installed:
    centos67-pe-puppet-382: pe-augeas.x86_64 0:1.3.0-2.pe.el6
    centos67-pe-puppet-382: pe-facter.x86_64 0:2.4.4.0-1.pe.el6
    centos67-pe-puppet-382: pe-hiera.noarch 0:1.3.4.5-1.pe.el6
    centos67-pe-puppet-382: pe-libldap.x86_64 0:2.4.39-5.pe.el6
    centos67-pe-puppet-382: pe-libyaml.x86_64 0:0.1.6-5.el6
    centos67-pe-puppet-382: pe-mcollective.noarch 0:2.7.0.1-1.pe.el6
    centos67-pe-puppet-382: pe-mcollective-common.noarch 0:2.7.0.1-1.pe.el6
    centos67-pe-puppet-382: pe-openssl.x86_64 0:1.0.0s-1.pe.el6
    centos67-pe-puppet-382: pe-puppet.noarch 0:3.8.2.0-1.pe.el6
    centos67-pe-puppet-382: pe-puppet-enterprise-release.noarch 0:3.8.2.0-1.pe.el6
    centos67-pe-puppet-382: pe-ruby.x86_64 0:1.9.3.551-2.pe.el6
    centos67-pe-puppet-382: pe-ruby-augeas.x86_64 0:0.5.0-7.pe.el6
    centos67-pe-puppet-382: pe-ruby-rgen.noarch 0:0.6.5-1.pe.el6
    centos67-pe-puppet-382: pe-ruby-selinux.x86_64 0:2.0.94-4.pe.el6
    centos67-pe-puppet-382: pe-ruby-shadow.x86_64 0:2.2.0-3.pe.el6
    centos67-pe-puppet-382: pe-ruby-stomp.noarch 0:1.3.3-1.pe.el6
    centos67-pe-puppet-382: pe-rubygem-deep-merge.noarch 0:1.0.0-3.pe.el6
    centos67-pe-puppet-382: pe-virt-what.x86_64 0:1.13-1.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Updated:
    centos67-pe-puppet-382: cronie.x86_64 0:1.4.4-15.el6_7.1       libxml2.x86_64 0:2.7.6-20.el6_7.1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependency Updated:
    centos67-pe-puppet-382: cronie-anacron.x86_64 0:1.4.4-15.el6_7.1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Complete!
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: puppet-enterprise-installer
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: Cleaning up list of fastest mirrors
    centos67-pe-puppet-382: ## Checking the agent certificate name detection...
    centos67-pe-puppet-382: ## Setting up puppet agent...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP 5: DONE
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Thanks for installing Puppet Enterprise!
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: To learn more and get started using Puppet Enterprise, refer to
    centos67-pe-puppet-382: the Puppet Enterprise Quick Start Guide
    centos67-pe-puppet-382: (http://docs.puppetlabs.com/pe/latest/quick_start.html) and the
    centos67-pe-puppet-382: Puppet Enterprise Deployment Guide
    centos67-pe-puppet-382: (http://docs.puppetlabs.com/guides/deployment_guide/index.html).
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ========================================================================
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ## NOTES
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise has been installed to &quot;/opt/puppet,&quot; and its
    centos67-pe-puppet-382: configuration files are located in &quot;/etc/puppetlabs&quot;.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Answers from this session saved to
    centos67-pe-puppet-382: &#39;/tmp/puppet-enterprise-3.8.2-el-6-x86_64/answers.lastrun.localhost&#39;
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: If you have a firewall running, please ensure outbound
    centos67-pe-puppet-382: connections are allowed to the following TCP ports: 8140, 61613
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:</code></pre></figure>
<figure class="highlight"><pre><code class="language-text" data-lang="text">The final provisioner is a shell provisioner that will run the scripts/centos-vmware-cleanup.sh bash script. This script will clean up the centos67 virtual machine and zero out all unused disk space to reduce the size of the image.
</code></pre></figure>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vmware-cleanup.sh
    centos67-pe-puppet-382: ==&gt; Pausing for 0 seconds...
    centos67-pe-puppet-382: ==&gt; erasing unused packages to free up space
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Remove Process
    centos67-pe-puppet-382: No Match for argument: gtk2
    centos67-pe-puppet-382: Determining fastest mirrors
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: centos.unixheads.org
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package(s) gtk2 available, but not installed.
    centos67-pe-puppet-382: No Match for argument: libX11
    centos67-pe-puppet-382: Package(s) libX11 available, but not installed.
    centos67-pe-puppet-382: No Match for argument: hicolor-icon-theme
    centos67-pe-puppet-382: Package(s) hicolor-icon-theme available, but not installed.
    centos67-pe-puppet-382: No Match for argument: avahi
    centos67-pe-puppet-382: Package(s) avahi available, but not installed.
    centos67-pe-puppet-382: No Match for argument: freetype
    centos67-pe-puppet-382: Package(s) freetype available, but not installed.
    centos67-pe-puppet-382: No Match for argument: bitstream-vera-fonts
    centos67-pe-puppet-382: No Packages marked for removal
    centos67-pe-puppet-382: ==&gt; Cleaning up yum cache
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: base extras updates
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: Cleaning up list of fastest mirrors
    centos67-pe-puppet-382: ==&gt; Force logs to rotate
    centos67-pe-puppet-382: ==&gt; Clear audit log and wtmp
    centos67-pe-puppet-382: ==&gt; Cleaning up udev rules
    centos67-pe-puppet-382: ==&gt; Remove the traces of the template MAC address and UUIDs
    centos67-pe-puppet-382: ==&gt; Cleaning up tmp
    centos67-pe-puppet-382: ==&gt; Remove the SSH host keys
    centos67-pe-puppet-382: ==&gt; Remove the root user’s shell history
    centos67-pe-puppet-382: ==&gt; yum -y clean all
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: base extras updates
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: /
    centos67-pe-puppet-382: 24828344
    centos67-pe-puppet-382: /tmp/script_7943.sh: line 59: bc: command not found
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: dd: invalid number `&#39;
    centos67-pe-puppet-382: /boot
    centos67-pe-puppet-382: 60502
    centos67-pe-puppet-382: /tmp/script_7943.sh: line 59: bc: command not found
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: dd: invalid number `&#39;
    centos67-pe-puppet-382: /tmp/script_7943.sh: line 67: /usr/sbin/vgdisplay: No such file or directory
    centos67-pe-puppet-382: ==&gt; Zero out the free space to save space in the final image
    centos67-pe-puppet-382: dd: writing `/EMPTY&#39;: No space left on device
    centos67-pe-puppet-382: 12783+0 records in
    centos67-pe-puppet-382: 12782+0 records out
    centos67-pe-puppet-382: 13403570176 bytes (13 GB) copied, 428.651 s, 31.3 MB/s</code></pre></figure>

<p>With the provisioners block having been completed, Packer will now shutdown the centos67-pe-puppet-382 virtual machine and unregister it from the ESXi virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67-pe-puppet-382: Gracefully halting virtual machine...
    centos67-pe-puppet-382: Waiting for VMware to clean up after itself...
==&gt; centos67-pe-puppet-382: Deleting unnecessary VMware files...
    centos67-pe-puppet-382: Deleting: /vmfs/volumes/datastore1/output-centos67-pe-puppet-382/vmware.log
==&gt; centos67-pe-puppet-382: Cleaning VMX prior to finishing up...
    centos67-pe-puppet-382: Unmounting floppy from VMX...
    centos67-pe-puppet-382: Detaching ISO from CD-ROM device...
    centos67-pe-puppet-382: Disabling VNC server...
==&gt; centos67-pe-puppet-382: Compacting the disk image
==&gt; centos67-pe-puppet-382: Unregistering virtual machine...
Build &#39;centos67-pe-puppet-382&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; centos67-pe-puppet-382: VM files in directory: /vmfs/volumes/datastore1/output-centos67-pe-puppet-382
[root@packer-centos packer-templates]#</code></pre></figure>

<p>The output of the packer build command shows that the template was successfully created at /vmfs/volumes/datastore1/output-centos67-pe-puppet-382 on the ESXi virtual machine.</p>

<h3>This brings us to the end of this post. I think it is pretty powerful that we only had to copy/update the template and add another provisioner script, in order to modify the Packer template we created last time to install Puppet Enterprise 3.8.2.</h3>

<h3>If you would like to not have to manually create the two files covered in this post, you can clone down <a href="https://github.com/sdorsett/packer-templates/tree/adding-second-packer-template">this github repository</a> by running the following command:</h3>

<pre>
git clone -b "adding-second-packer-template" https://github.com/sdorsett/packer-templates.git
</pre>  

<p>If you cloned the packer-templates repo in the last post, you can pull down the updates by running the following command:</p>

<pre>
git fetch --all
git pull origin "adding-second-packer-template"
</pre>  

<h3>In the next post we will extend what was covered in this post by installing the Puppet agent in Packer image.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/25/creating-a-packer-template-for-installing-centos-67/">
        Creating our first Packer template for installing CentOS 6.7 with vmtools
      </a>
    </h1>

    <span class="post-date">25 Dec 2015</span>

    <p>This is the fourth in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the last two posts we covered <a href="https://sdorsett.github.io/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">installing a ESXi virtual machine for use with Packer</a> and <a href="https://sdorsett.github.io/2015/12/24/installing-packer-and-ovftool-on-centos/">Setting up Packer, ovftool and Apache web server on a CentOS virtual machine</a>. In this post we will be putting all this prep work to use in order to install a CentOS 6.7 image using Packer.</p>

<p>Before we get started I would like to mentioned that many of the configuration files I am using have been influenced by or directly copied from the following github repositories:  </p>

<p><a href="https://github.com/frapposelli/packer-templates/">https://github.com/frapposelli/packer-templates</a><br>
<a href="https://github.com/nanliu/packer-templates/">https://github.com/nanliu/packer-templates/</a>  </p>

<p>These public repositories by Fabio and Nan have been extremely helpful in my own understanding of how Packer works.
 Well...enough talking, let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we created in the previous post.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
root@192.168.1.52&#39;s password:
Last login: Wed Dec 23 16:58:41 2015 from 192.168.1.163
[root@packer-centos ~]#</code></pre></figure>

<h2>2. Create a new folder for our packer-templates and run &quot;git init&quot; to start tracking changes.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# mkdir packer-templates
[root@packer-centos ~]# cd packer-templates/
[root@packer-centos packer-templates]# git init
Initialized empty Git repository in /root/packer-templates/.git/
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>3. Create directory structure for the .iso files, scripts and templates we will be using with Packer.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# mkdir -p ~/packer-templates/{iso,scripts,templates}
[root@packer-centos packer-templates]# ls
iso  scripts  templates
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>4. Download the CentOS 6.7 minimal .iso and place it in the packer-templates/iso/ folder</h2>

<p>Open <a href="http://isoredirect.centos.org/centos/6/isos/x86_64/">http://isoredirect.centos.org/centos/6/isos/x86_64/</a> in a browser and pick a mirror to download the .iso from. Copy the URL to the CentOS-6.7-x86_64-minimal.iso image file and use wget to pull the image down in the CentOS virtual machine</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# cd ~/packer-templates/iso/
[root@packer-centos iso]# wget http://mirror.cs.pitt.edu/centos/6.7/isos/x86_64/CentOS-6.7-x86_64-minimal.iso
--2015-12-23 20:04:30--  http://mirror.cs.pitt.edu/centos/6.7/isos/x86_64/CentOS-6.7-x86_64-minimal.iso
Resolving mirror.cs.pitt.edu... 136.142.23.206
Connecting to mirror.cs.pitt.edu|136.142.23.206|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 414187520 (395M) [application/octet-stream]
Saving to: “CentOS-6.7-x86_64-minimal.iso”

100%[========================================================&gt;] 414,187,520 7.01M/s   in 58s

2015-12-23 20:05:28 (6.77 MB/s) - “CentOS-6.7-x86_64-minimal.iso” saved [414187520/414187520]

[root@packer-centos iso]#</code></pre></figure>

<h2>5. Compare the sha1sum of the downloaded CentOS-6.7-x86_64-minimal.iso file to what is listed on the CentOS mirror.</h2>

<p>Open the sha1sum.txt file from the CentOS mirror you chose in your browser. It should show the following:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">7bb8c1c23a4fdef93e6f0a6347d570e5764d0b38  CentOS-6.7-x86_64-bin-DVD1.iso
79f58df5723f723fc62d5e8831ada38072096a46  CentOS-6.7-x86_64-bin-DVD2.iso
2ed5ea551dffc3e4b82847b3cee1f6cd748e8071  CentOS-6.7-x86_64-minimal.iso
c3678c6b72cbf2ed9b4e8a1ddb190fd262db8b7f  CentOS-6.7-x86_64-netinstall.iso
a7c05a7c0a4c6bdef8dd1cf8310613c154c2b9d5  CentOS-6.7-x86_64-LiveCD.iso
aebd4c2e81ace92ebda2bc909aca34a139ff2cea  CentOS-6.7-x86_64-LiveDVD.iso</code></pre></figure>

<p>Compare the sha1sum from above to the actual sha1sum of the downloaded .iso</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos iso]# sha1sum CentOS-6.7-x86_64-minimal.iso
2ed5ea551dffc3e4b82847b3cee1f6cd748e8071  CentOS-6.7-x86_64-minimal.iso
[root@packer-centos iso]#</code></pre></figure>

<p>The two hashes match so we know the file was downloaded without any corruption.</p>

<h2>6. Download patched vmtools from <a href="https://github.com/rasa/vmware-tools-patches">https://github.com/rasa/vmware-tools-patches</a> and place the .iso file in the packer-templates/iso/ folder.</h2>

<p>I have had issues with the VMware issued vmtools, specifically around CentOS 7 and trying to get hgfs (host guest file system) functional on Fusion. During that troubleshooting I discovered the patched vmware tools listed above and found installing those, rather than the VMware issue vmtools installer, resolved my issues.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# wget https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/7.1.3/3204469/packages/com.vmware.fusion.tools.linux.zip.tar
--2015-12-23 21:20:55--  https://softwareupdate.vmware.com/cds/vmw-desktop/fusion/7.1.3/3204469/packages/com.vmware.fusion.tools.linux.zip.tar
Resolving softwareupdate.vmware.com... 23.64.167.143, 2600:1404:a:589::2ef, 2600:1404:a:59a::2ef
Connecting to softwareupdate.vmware.com|23.64.167.143|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 62074880 (59M) [application/x-tar]
Saving to: “com.vmware.fusion.tools.linux.zip.tar”

100%[========================================================&gt;] 62,074,880  6.95M/s   in 8.6s

2015-12-23 21:21:04 (6.91 MB/s) - “com.vmware.fusion.tools.linux.zip.tar” saved [62074880/62074880]

[root@packer-centos ~]# tar xf com.vmware.fusion.tools.linux.zip.tar
[root@packer-centos ~]# unzip com.vmware.fusion.tools.linux.zip
Archive:  com.vmware.fusion.tools.linux.zip
  inflating: manifest.plist
   creating: payload/
  inflating: payload/linux.iso
 extracting: payload/linux.iso.sig
  inflating: payload/tools-linux.plist
[root@packer-centos ~]# cp payload/linux.iso ~/packer-templates/iso/
[root@packer-centos ~]# cd ~/packer-templates/iso/
[root@packer-centos iso]# ln -s ./linux.iso vmware-tools-linux.iso
[root@packer-centos iso]# ls -la
total 466960
drwxr-xr-x 2 root root      4096 Dec 23 21:22 .
drwxr-xr-x 6 root root      4096 Dec 23 21:22 ..
-rw-r--r-- 1 root root 414187520 Aug  4 21:59 CentOS-6.7-x86_64-minimal.iso
-rw-r--r-- 1 root root  63971328 Dec 23 21:21 linux.iso
lrwxrwxrwx 1 root root        11 Dec 23 21:22 vmware-tools-linux.iso -&gt; ./linux.iso
[root@packer-centos iso]#</code></pre></figure>

<h2>7. Create a packer .json file in the template/ folder for our image</h2>

<p>Create the following file in the packer-templates/templates/ directory. The centos67.json file contains the instructions Packer will use to install the CentOS 6.7 image.</p>

<pre>
[root@packer-centos packer-templates]# cat templates/centos67.json
{
  "variables": {
    "version": "1.0"
  },
  "builders": [
    {
      "name": "centos67",
      "vm_name": "centos67",
      "vmdk_name": "centos67",
      "type": "vmware-iso",
      "communicator": "ssh",
      "ssh_pty": "true",
      "headless": false,
      "disk_size": 16384,
      "guest_os_type": "rhel6-64",
      "iso_url": "./iso/CentOS-6.7-x86_64-minimal.iso",
      "iso_checksum": "2ed5ea551dffc3e4b82847b3cee1f6cd748e8071",
      "iso_checksum_type": "sha1",
      "shutdown_command": "echo 'vagrant' | sudo -S /sbin/shutdown -P now",

      "remote_host": "{{user `packer_remote_host`}}",
      "remote_datastore": "{{user `packer_remote_datastore`}}",
      "remote_username": "{{user `packer_remote_username`}}",
      "remote_password": "{{user `packer_remote_password`}}",
      "remote_type": "esx5",
      "ssh_username": "root",
      "ssh_password": "vagrant",
      "ssh_wait_timeout": "60m",
      "tools_upload_flavor": "linux",
      "http_directory": ".",
      "boot_wait": "5s",
      "vmx_data": {
        "memsize": "4096",
        "numvcpus": "2",
        "ethernet0.networkName": "{{user `packer_remote_network`}}",
        "ethernet0.present": "TRUE",
        "ethernet0.startConnected": "TRUE",
        "ethernet0.virtualDev": "e1000",
        "ethernet0.addressType": "generated",
        "ethernet0.generatedAddressOffset": "0",
        "ethernet0.wakeOnPcktRcv": "FALSE"

      },
      "vmx_data_post": {
        "ide1:0.startConnected": "FALSE",
        "ide1:0.clientDevice": "TRUE",
        "ide1:0.fileName": "emptyBackingString",
        "ethernet0.virtualDev": "vmxnet3"
      },
      "boot_command": [
        "<tab> text ks=http://:/scripts/centos-6-kickstart.cfg<enter><wait>"
      ]
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "iso/vmware-tools-linux.iso",
      "destination": "/tmp/vmware-tools-linux.iso"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vagrant-settings.sh"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vmware-tools_install.sh"
    },
    {
      "type": "shell",
      "execute_command": "echo 'vagrant' |  sudo -E -S sh ''",
      "script": "scripts/centos-vmware-cleanup.sh"
    }
  ]
}
</pre>

<p>Let us go over some of what&#39;s in this .json file</p>

<ul>
<li>the builders block</li>
</ul>

<p>This section contains builder specific instruction. We are using the vmware-iso builder so much of this is describing how we want to VMware backed virtual machine configured.</p>

<p>You might notice something a little different about remote_host, remote_datastore, remote_username, remote_password and ethernet0.networkName parameters. These parameters contain information about the ESXi host we are using to create the Packer image, so rather than hard coding this info into each and every template these values can be pulled from user defined variables.</p>

<p>The benefit of separating &quot;data from code&quot; is two fold. First, this prevents sensitive datacenter specific information from being included in our template, which could end up in github or some other git repository. Secondly, we only need to update one location if the password of our remote_host ever needs to be changed.</p>

<ul>
<li>the provisioners block</li>
</ul>

<p>This section contains instruction on what to do after the OS is successfully installed packer. You can use &quot;file&quot; provisioners to copy files into the Packer built OS, as well as &quot;shell&quot; provisioners to run scripts to perform additional configuration. You will get a closer look at &quot;shell&quot; provisioner scripts shortly</p>

<h2>8. Create the script/ files that Packer will use to install the CentOS 6.7 image</h2>

<p>The following files are referenced in the centos67.json template and need to be created in the packer-templates/scripts/ folder</p>

<ul>
<li>scripts/centos-6-kickstart.cfg - this is the CentOS 6 kickstart file that describes how CentOS 6 should be installed</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-6-kickstart.cfg
firewall --disabled

install
cdrom

lang en_US.UTF-8
keyboard us
timezone  Europe/Rome

network --bootproto=dhcp
rootpw vagrant
authconfig --enableshadow --passalgo=sha512

selinux —-disabled
bootloader --location=mbr
text
skipx

logging --level=info
zerombr

clearpart --all --initlabel
autopart

auth  --useshadow  --enablemd5
firstboot --disabled
reboot

%packages --ignoremissing
@Base
@Core
%end

%post
yum install wget git -y
VAGRANT_USER=vagrant
/usr/sbin/groupadd vagrant
/usr/sbin/useradd vagrant -g vagrant -G wheel
echo "vagrant"|passwd --stdin vagrant
echo "vagrant        ALL=(ALL)       NOPASSWD: ALL" >> /etc/sudoers

sed -i "s/^.*requiretty/#Defaults requiretty/" /etc/sudoers
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vagrant-settings.sh - this is a bash script that describes how vagrant speciffied settings should be configured</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vagrant-settings.sh
#!/bin/bash -eux

# Vagrant specific
date > /etc/vagrant_box_build_time

VAGRANT_USER=vagrant
VAGRANT_HOME=/home/$VAGRANT_USER
VAGRANT_KEY_URL=https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub

# Add vagrant user (if it doesn't already exist)
if ! id -u $VAGRANT_USER >/dev/null 2>&1; then
    /usr/sbin/groupadd $VAGRANT_USER
    /usr/sbin/useradd $VAGRANT_USER -g $VAGRANT_USER -G wheel
    echo "${VAGRANT_USER}"|passwd --stdin $VAGRANT_USER
    echo "${VAGRANT_USER}        ALL=(ALL)       NOPASSWD: ALL" >> /etc/sudoers
fi

# Installing vagrant keys
mkdir -pm 700 $VAGRANT_HOME/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key" >> $VAGRANT_HOME/.ssh/authorized_keys
chmod 0600 $VAGRANT_HOME/.ssh/authorized_keys
chown -R $VAGRANT_USER:$VAGRANT_USER $VAGRANT_HOME/.ssh
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vmware-tools_install.sh - this is a bash script that describes how vmtools should be installed</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vmware-tools_install.sh
#!/bin/bash
sudo yum upgrade ca-certificates -y
sudo yum install perl fuse-libs -y
sudo mkdir /mnt/cdrom
sudo mount -o loop /tmp/vmware-tools-linux.iso /mnt/cdrom
sudo cp /mnt/cdrom/VMwareTools*.tar.gz /tmp/
cd /tmp
tar xfz VMwareTools*.tar.gz
cd /tmp/vmware-tools-distrib
ls -la

# from http://www.virtuallyghetto.com/2015/06/automating-silent-installation-of-vmware-tools-on-linux-wautomatic-kernel-modules.html
# If you wish to change which Kernel modules get installed
# The last four entries (yes,no,no,no) map to the following:
#   VMware Host-Guest Filesystem
#   vmblock enables dragging or copying files
#   VMware automatic kernel modules
#   Guest Authentication
# and you can also change the other params as well
sudo cat > /tmp/answer << __ANSWER__
yes
/usr/bin
/etc
/etc/init.d
/usr/sbin
/usr/lib/vmware-tools
yes
/usr/share/doc/vmware-tools
yes
yes
yes
no
yes
no

__ANSWER__

sudo /tmp/vmware-tools-distrib/vmware-install.pl < /tmp/answer

sudo umount /mnt/cdrom
cd /tmp
rm -rf vmware-tools-distrib
rm -f VMwareTools*.tar.gz
rm /tmp/vmware-tools-linux.iso
[root@packer-centos packer-templates]#
</pre>

<ul>
<li>scripts/centos-vmware-cleanup.sh - a bash script that cleans up the Packer image prior to being exported</li>
</ul>

<pre>
[root@packer-centos packer-templates]# cat scripts/centos-vmware-cleanup.sh
#!/bin/bash -eux
# Based off the great "Preparing Linux Template VMs"
# (http://lonesysadmin.net/2013/03/26/preparing-linux-template-vms/) article
# by Bob Plankers, thanks Bob!

CLEANUP_PAUSE=${CLEANUP_PAUSE:-0}
echo "==> Pausing for ${CLEANUP_PAUSE} seconds..."
sleep ${CLEANUP_PAUSE}

echo "==> erasing unused packages to free up space"
/usr/bin/yum -y erase gtk2 libX11 hicolor-icon-theme avahi freetype bitstream-vera-fonts

echo "==> Cleaning up yum cache"
/usr/bin/yum clean all

echo "==> Force logs to rotate"
/usr/sbin/logrotate -f /etc/logrotate.conf
/bin/rm -f /var/log/*-???????? /var/log/*.gz

echo "==> Clear audit log and wtmp"
/bin/cat /dev/null > /var/log/audit/audit.log
/bin/cat /dev/null > /var/log/wtmp

echo "==> Cleaning up udev rules"
/bin/rm -f /etc/udev/rules.d/70*

echo "==> Remove the traces of the template MAC address and UUIDs"
/bin/sed -i '/^\(HWADDR\|UUID\)=/d' /etc/sysconfig/network-scripts/ifcfg-eth0

echo "==> Cleaning up tmp"
/bin/rm -rf /tmp/*
/bin/rm -rf /var/tmp/*

echo "==> Remove the SSH host keys"
/bin/rm -f /etc/ssh/*key*

echo "==> Remove the root user’s shell history"
/bin/rm -f ~root/.bash_history
unset HISTFILE

echo "==> yum -y clean all"
yum -y clean all

# Determine the version of RHEL
COND=`grep -i Taroon /etc/redhat-release`
if [ "$COND" = "" ]; then
        export PREFIX="/usr/sbin"
else
        export PREFIX="/sbin"
fi

FileSystem=`grep ext /etc/mtab| awk -F" " '{ print $2 }'`

for i in $FileSystem
do
        echo $i
        number=`df -B 512 $i | awk -F" " '{print $3}' | grep -v Used`
        echo $number
        percent=$(echo "scale=0; $number * 98 / 100" | bc )
        echo $percent
        dd count=`echo $percent` if=/dev/zero of=`echo $i`/zf
        /bin/sync
        sleep 15
        rm -f $i/zf
done

VolumeGroup=`$PREFIX/vgdisplay | grep Name | awk -F" " '{ print $3 }'`

for j in $VolumeGroup
do
        echo $j
        $PREFIX/lvcreate -l `$PREFIX/vgdisplay $j | grep Free | awk -F" " '{ print $5 }'` -n zero $j
        if [ -a /dev/$j/zero ]; then
                cat /dev/zero > /dev/$j/zero
                /bin/sync
                sleep 15
                $PREFIX/lvremove -f /dev/$j/zero
        fi
done

echo "==> Zero out the free space to save space in the final image"
dd if=/dev/zero of=/EMPTY bs=1M
rm -f /EMPTY

# Make sure we wait until all the data is written to disk, otherwise
# Packer might quit too early before the large files are deleted
sync
[root@packer-centos packer-templates]#
</pre>

<h2>9. Create packer-remote-info.json file that contains info on our ESXi virtual machine</h2>

<p>Create the following file that will contain the ESXi virtual machine specific information used by Packer. We will also add this file to .gitignore in a future step, to ensure this information does not get stored in a git repository.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# cat &lt;&lt; EOF &gt; ~/packer-templates/packer-remote-info.json
&gt; {
&gt;   &quot;packer_remote_host&quot;: &quot;192.168.1.51&quot;,
&gt;   &quot;packer_remote_username&quot;: &quot;root&quot;,
&gt;   &quot;packer_remote_password&quot;: &quot;password&quot;,
&gt;   &quot;packer_remote_datastore&quot;: &quot;datastore1&quot;,
&gt;   &quot;packer_remote_network&quot;: &quot;VM Network&quot;
&gt; }
&gt; EOF
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>10. Use yum to install the tree command so we can visualize the packer-templates directory structure</h2>

<p>The tree command is helpful by allowing you to display the files and folders from a specific point in the file system. We will install this now to assist in showing the directory structure of the packer-templates directory.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# yum install -y tree
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: mirror.utexas.edu
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package tree.x86_64 0:1.5.3-3.el6 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

==========================================================
 Package      Arch      Version         Repository   Size
==========================================================
Installing:
 tree         x86_64    1.5.3-3.el6     base         36 k

Transaction Summary
==========================================================
Install       1 Package(s)

Total download size: 36 k
Installed size: 65 k
Downloading Packages:
tree-1.5.3-3.el6.x86_64.rpm              |  36 kB    00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : tree-1.5.3-3.el6.x86_64                 1/1
  Verifying  : tree-1.5.3-3.el6.x86_64                 1/1

Installed:
  tree.x86_64 0:1.5.3-3.el6

Complete!
[root@packer-centos packer-templates]#</code></pre></figure>

<p>Run the tree command to see the directory structure:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# tree
.
├── iso
│   ├── CentOS-6.7-x86_64-minimal.iso
│   ├── linux.iso
│   └── vmware-tools-linux.iso -&gt; ./linux.iso
├── packer-remote-info.json
├── scripts
│   ├── centos-6-kickstart.cfg
│   ├── centos-vagrant-settings.sh
│   ├── centos-vmware-cleanup.sh
│   └── centos-vmware-tools_install.sh
└── templates
    └── centos67.json

3 directories, 9 files
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>11. Create .gitignore file that contains everything we don&#39;t have to stored in git</h2>

<p>Any files or folders listed in the .gitignore will be ignored by git. We will be adding the packer-remote-info.json file, since it contains username and password information, and the iso/ directory, since we don&#39;t want to upload the large .iso files to our git repository.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# cat .gitignore
iso/
packer-remote-info.json
[root@packer-centos packer-templates]# git status
# On branch master
#
# Initial commit
#
# Untracked files:
#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
#
#   .gitignore
#   scripts/
#   templates/
nothing added to commit but untracked files present (use &quot;git add&quot; to track)
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>12. Push the changes we have made to a github repository</h2>

<p>I created a public github repository for storing all the files created during this Packer series. During this step I will be pushing the current state of the files to the <a href="https://github.com/sdorsett/packer-templates/tree/first-packer-template">&quot;first-packer-template&quot; branch</a> of this github repository:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# git remote add origin https://sdorsett@github.com/sdorsett/packer-templates.git
[root@packer-centos packer-templates]# git add .
[root@packer-centos packer-templates]# git commit -m &quot;first-packer-template&quot;
[master (root-commit) 3fba017] first-packer-template
 6 files changed, 277 insertions(+), 0 deletions(-)
 create mode 100644 .gitignore
 create mode 100644 scripts/centos-6-kickstart.cfg
 create mode 100644 scripts/centos-vagrant-settings.sh
 create mode 100644 scripts/centos-vmware-cleanup.sh
 create mode 100644 scripts/centos-vmware-tools_install.sh
 create mode 100644 templates/centos67.json
[root@packer-centos packer-templates]# git checkout -b first-packer-template
Switched to a new branch &#39;first-packer-template&#39;
[root@packer-centos packer-templates]# git push origin first-packer-template
Password:
Counting objects: 10, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (8/8), done.
Writing objects: 100% (10/10), 3.90 KiB, done.
Total 10 (delta 0), reused 0 (delta 0)
To https://sdorsett@github.com/sdorsett/packer-templates.git
 * [new branch]      first-packer-template -&gt; first-packer-template
[root@packer-centos packer-templates]#</code></pre></figure>

<h2>13. packer build the template we created</h2>

<p>Now that we have all the necessary .iso files downloaded and template/script files created, we can test our build. In order to use the values in the packer-remote-info.json file, we will use the -var-file parameter to specify this file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos packer-templates]# packer build -var-file=./packer-remote-info.json templates/centos67.json
centos67 output will be in this color.

==&gt; centos67: Downloading or copying ISO
    centos67: Downloading or copying: file:///root/packer-templates/iso/CentOS-6.7-x86_64-minimal.iso
==&gt; centos67: Uploading ISO to remote machine...
==&gt; centos67: Creating virtual machine disk
==&gt; centos67: Building and writing VMX file
==&gt; centos67: Starting HTTP server on port 8448
==&gt; centos67: Registering remote VM...
==&gt; centos67: Starting virtual machine...
==&gt; centos67: Waiting 5s for boot...
==&gt; centos67: Connecting to VM via VNC
==&gt; centos67: Typing the boot command over VNC...
==&gt; centos67: Waiting for SSH to become available...</code></pre></figure>

<p>At this point you should see a centos67 virtual machine in the embedded host client of the ESXi virtual machine.</p>

<p><img src="/assets/01-centos67-virtual-machine.png" alt="screenshot">  </p>

<p>If you open the console of the centos67 virtual machine, you can watch the automated install as it progresses.</p>

<p><img src="/assets/02-centos67-automated-install.png" alt="screenshot">  </p>

<p><img src="/assets/03-centos67-automated-install.png" alt="screenshot">  </p>

<p><img src="/assets/04-centos67-automated-install.png" alt="screenshot">  </p>

<p><img src="/assets/05-centos67-install-completed.png" alt="screenshot">  </p>

<p>Once the CentOS 6.7 install completes and the virtual machine reboots, you will see the packer build output continue with the provisioners block of the Packer template.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Connected to SSH!</code></pre></figure>

<p>The first provisioner is the file provisioner that will copy iso/vmware-tools-linux.iso to /tmp/vmware-tools-linux.iso within the CentOS 6.7 virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Uploading iso/vmware-tools-linux.iso =&gt; /tmp/vmware-tools-linux.iso</code></pre></figure>

<p>The second provisioner is a shell provisioner that will run the scripts/centos-vagrant-settings.sh bash script. This script will added the necessary changes for this Packer image to be used by Vagrant.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Provisioning with shell script: scripts/centos-vagrant-settings.sh</code></pre></figure>

<p>The third provisioner is a shell provisioner that will run the scripts/centos-vmware-tools_install.sh bash script. This script will install all the needed dependencies for vmtools and then install vmtools using an answer file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Provisioning with shell script: scripts/centos-vmware-tools_install.sh
    centos67: Loaded plugins: fastestmirror
    centos67: Setting up Upgrade Process
    centos67: Determining fastest mirrors
    centos67: * base: dallas.tx.mirror.xygenhosting.com
    centos67: * extras: mirror.us.oneandone.net
    centos67: * updates: dallas.tx.mirror.xygenhosting.com
    centos67: No Packages marked for Update
    centos67: Loaded plugins: fastestmirror
    centos67: Setting up Install Process
    centos67: Loading mirror speeds from cached hostfile
    centos67: * base: dallas.tx.mirror.xygenhosting.com
    centos67: * extras: mirror.us.oneandone.net
    centos67: * updates: dallas.tx.mirror.xygenhosting.com
    centos67: Resolving Dependencies
    centos67: --&gt; Running transaction check
    centos67: ---&gt; Package fuse-libs.x86_64 0:2.8.3-4.el6 will be installed
    centos67: ---&gt; Package perl.x86_64 4:5.10.1-141.el6_7.1 will be installed
    centos67: --&gt; Processing Dependency: perl-libs = 4:5.10.1-141.el6_7.1 for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Processing Dependency: perl-libs for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Processing Dependency: perl(version) for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Processing Dependency: perl(Pod::Simple) for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Processing Dependency: perl(Module::Pluggable) for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Processing Dependency: libperl.so()(64bit) for package: 4:perl-5.10.1-141.el6_7.1.x86_64
    centos67: --&gt; Running transaction check
    centos67: ---&gt; Package perl-Module-Pluggable.x86_64 1:3.90-141.el6_7.1 will be installed
    centos67: ---&gt; Package perl-Pod-Simple.x86_64 1:3.13-141.el6_7.1 will be installed
    centos67: --&gt; Processing Dependency: perl(Pod::Escapes) &gt;= 1.04 for package: 1:perl-Pod-Simple-3.13-141.el6_7.1.x86_64
    centos67: ---&gt; Package perl-libs.x86_64 4:5.10.1-141.el6_7.1 will be installed
    centos67: ---&gt; Package perl-version.x86_64 3:0.77-141.el6_7.1 will be installed
    centos67: --&gt; Running transaction check
    centos67: ---&gt; Package perl-Pod-Escapes.x86_64 1:1.04-141.el6_7.1 will be installed
    centos67: --&gt; Finished Dependency Resolution
    centos67:
    centos67: Dependencies Resolved
    centos67:
    centos67: ========================================
    centos67: Package         Arch   Version
    centos67: Repository
    centos67: Size
    centos67: ========================================
    centos67: Installing:
    centos67: fuse-libs       x86_64 2.8.3-4.el6
    centos67: base     74 k
    centos67: perl            x86_64 4:5.10.1-141.el6_7.1
    centos67: updates  10 M
    centos67: Installing for dependencies:
    centos67: perl-Module-Pluggable
    centos67: x86_64 1:3.90-141.el6_7.1
    centos67: updates  40 k
    centos67: perl-Pod-Escapes
    centos67: x86_64 1:1.04-141.el6_7.1
    centos67: updates  33 k
    centos67: perl-Pod-Simple x86_64 1:3.13-141.el6_7.1
    centos67: updates 213 k
    centos67: perl-libs       x86_64 4:5.10.1-141.el6_7.1
    centos67: updates 579 k
    centos67: perl-version    x86_64 3:0.77-141.el6_7.1
    centos67: updates  52 k
    centos67:
    centos67: Transaction Summary
    centos67: ========================================
    centos67: Install       7 Package(s)
    centos67:
    centos67: Total size: 11 M
    centos67: Total download size: 74 k
    centos67: Installed size: 36 M
    centos67: Downloading Packages:
    centos67: fuse-libs-2.8.3- |  74 kB     00:00
    centos67: warning: rpmts_HdrFromFdno: Header V3 RSA/SHA1 Signature, key ID c105b9de: NOKEY
    centos67: Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
    centos67: Importing GPG key 0xC105B9DE:
    centos67: Userid : CentOS-6 Key (CentOS 6 Official Signing Key) &lt;centos-6-key@centos.org&gt;
    centos67: Package: centos-release-6-7.el6.centos.12.3.x86_64 (@anaconda-CentOS-201508042137.x86_64/6.7)
    centos67: From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
    centos67: Running rpm_check_debug
    centos67: Running Transaction Test
    centos67: Transaction Test Succeeded
    centos67: Running Transaction
    centos67:   Installing : 1:perl-Pod-Escapes   1/7
    centos67:   Installing : 1:perl-Module-Plug   2/7
    centos67:   Installing : 3:perl-version-0.7   3/7
    centos67:   Installing : 4:perl-libs-5.10.1   4/7
    centos67:   Installing : 1:perl-Pod-Simple-   5/7
    centos67:   Installing : 4:perl-5.10.1-141.   6/7
    centos67:   Installing : fuse-libs-2.8.3-4.   7/7
    centos67: Verifying  : 1:perl-Pod-Simple-   1/7
    centos67: Verifying  : 1:perl-Pod-Escapes   2/7
    centos67: Verifying  : fuse-libs-2.8.3-4.   3/7
    centos67: Verifying  : 1:perl-Module-Plug   4/7
    centos67: Verifying  : 3:perl-version-0.7   5/7
    centos67: Verifying  : 4:perl-libs-5.10.1   6/7
    centos67: Verifying  : 4:perl-5.10.1-141.   7/7
    centos67:
    centos67: Installed:
    centos67: fuse-libs.x86_64 0:2.8.3-4.el6
    centos67: perl.x86_64 4:5.10.1-141.el6_7.1
    centos67:
    centos67: Dependency Installed:
    centos67: perl-Module-Pluggable.x86_64 1:3.90-141.el6_7.1
    centos67: perl-Pod-Escapes.x86_64 1:1.04-141.el6_7.1
    centos67: perl-Pod-Simple.x86_64 1:3.13-141.el6_7.1
    centos67: perl-libs.x86_64 4:5.10.1-141.el6_7.1
    centos67: perl-version.x86_64 3:0.77-141.el6_7.1
    centos67:
    centos67: Complete!
    centos67: total 488
    centos67: drwxr-xr-x   7 root root   4096 Oct 30 07:10 .
    centos67: drwxrwxrwt.  4 root root   4096 Dec 24 02:34 ..
    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 bin
    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 doc
    centos67: drwxr-xr-x   5 root root   4096 Oct 30 07:10 etc
    centos67: -rw-r--r--   1 root root 269196 Oct 30 07:10 FILES
    centos67: -rw-r--r--   1 root root   2538 Oct 30 07:10 INSTALL
    centos67: drwxr-xr-x   2 root root   4096 Oct 30 07:10 installer
    centos67: drwxr-xr-x  15 root root   4096 Oct 30 07:10 lib
    centos67: -rwxr-xr-x   1 root root 196237 Oct 30 07:10 vmware-install.pl
    centos67: Creating a new VMware Tools installer database using the tar4 format.
    centos67:
    centos67: Installing VMware Tools.
    centos67:
    centos67: In which directory do you want to install the binary files?
    centos67: [/usr/bin]
    centos67: The path &quot;yes&quot; is a relative path. Please enter an absolute path.
    centos67:
    centos67: In which directory do you want to install the binary files?
    centos67: [/usr/bin]
    centos67: What is the directory that contains the init directories (rc0.d/ to rc6.d/)?
    centos67: [/etc/rc.d]
    centos67: What is the directory that contains the init scripts?
    centos67: [/etc/init.d]
    centos67: In which directory do you want to install the daemon files?
    centos67: [/usr/sbin]
    centos67: In which directory do you want to install the library files?
    centos67: [/usr/lib/vmware-tools]
    centos67: The path &quot;/usr/lib/vmware-tools&quot; does not exist currently. This program is
    centos67: going to create it, including needed parent directories. Is this what you want?
    centos67: [yes]
    centos67: In which directory do you want to install the documentation files?
    centos67: [/usr/share/doc/vmware-tools]
    centos67: The path &quot;/usr/share/doc/vmware-tools&quot; does not exist currently. This program
    centos67: is going to create it, including needed parent directories. Is this what you
    centos67: want? [yes]
    centos67: The installation of VMware Tools 9.9.4 build-3193940 for Linux completed
    centos67: successfully. You can decide to remove this software from your system at any
    centos67: time by invoking the following command: &quot;/usr/bin/vmware-uninstall-tools.pl&quot;.
    centos67:
    centos67: Before running VMware Tools for the first time, you need to configure it by
    centos67: invoking the following command: &quot;/usr/bin/vmware-config-tools.pl&quot;. Do you want
    centos67: this program to invoke the command for you now? [yes]
    centos67: Initializing...
    centos67:
    centos67:
    centos67: Making sure services for VMware Tools are stopped.
    centos67:
    centos67:
    centos67:
    centos67: Found a compatible pre-built module for vmci.  Installing it...
    centos67:
    centos67:
    centos67: Found a compatible pre-built module for vsock.  Installing it...
    centos67:
    centos67:
    centos67: The module vmxnet3 has already been installed on this system by another
    centos67: installer or package and will not be modified by this installer.
    centos67:
    centos67: The module pvscsi has already been installed on this system by another
    centos67: installer or package and will not be modified by this installer.
    centos67:
    centos67: The module vmmemctl has already been installed on this system by another
    centos67: installer or package and will not be modified by this installer.
    centos67:
    centos67: The VMware Host-Guest Filesystem allows for shared folders between the host OS
    centos67: and the guest OS in a Fusion or Workstation virtual environment.  Do you wish
    centos67: to enable this feature? [no]
    centos67: Found a compatible pre-built module for vmhgfs.  Installing it...
    centos67:
    centos67:
    centos67: Found a compatible pre-built module for vmxnet.  Installing it...
    centos67:
    centos67:
    centos67: The vmblock enables dragging or copying files between host and guest in a
    centos67: Fusion or Workstation virtual environment.  Do you wish to enable this feature?
    centos67: [no]
    centos67: VMware automatic kernel modules enables automatic building and installation of
    centos67: VMware kernel modules at boot that are not already present. This feature can be
    centos67:
    centos67: enabled/disabled by re-running vmware-config-tools.pl.
    centos67:
    centos67: Would you like to enable VMware automatic kernel modules?
    centos67: [no]
    centos67: Do you want to enable Guest Authentication (vgauth)? [yes]
    centos67: No X install found.
    centos67:
    centos67: Creating a new initrd boot image for the kernel.
    centos67: vmware-tools-thinprint start/running
    centos67: vmware-tools start/running
    centos67: The configuration of VMware Tools 9.9.4 build-3193940 for Linux for this
    centos67: running kernel completed successfully.
    centos67:
    centos67: You must restart your X session before any mouse or graphics changes take
    centos67: effect.
    centos67:
    centos67: You can now run VMware Tools by invoking &quot;/usr/bin/vmware-toolbox-cmd&quot; from the
    centos67: command line.
    centos67:
    centos67: To enable advanced X features (e.g., guest resolution fit, drag and drop, and
    centos67: file and text copy/paste), you will need to do one (or more) of the following:
    centos67: 1. Manually start /usr/bin/vmware-user
    centos67: 2. Log out and log back into your desktop session; and,
    centos67: 3. Restart your X session.
    centos67:
    centos67: Enjoy,
    centos67:
    centos67: --the VMware team
    centos67:</code></pre></figure>

<p>The final provisioner is a shell provisioner that will run the scripts/centos-vmware-cleanup.sh bash script. This script will clean up the centos67 virtual machine and zero out all unused disk space to reduce the size of the image.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Provisioning with shell script: scripts/centos-vmware-cleanup.sh
    centos67: ==&gt; Pausing for 0 seconds...
    centos67: ==&gt; erasing unused packages to free up space
    centos67: Loaded plugins: fastestmirror
    centos67: Setting up Remove Process
    centos67: No Match for argument: gtk2
    centos67: Loading mirror speeds from cached hostfile
    centos67: * base: dallas.tx.mirror.xygenhosting.com
    centos67: * extras: mirror.us.oneandone.net
    centos67: * updates: dallas.tx.mirror.xygenhosting.com
    centos67: Package(s) gtk2 available, but not installed.
    centos67: No Match for argument: libX11
    centos67: Package(s) libX11 available, but not installed.
    centos67: No Match for argument: hicolor-icon-theme
    centos67: Package(s) hicolor-icon-theme available, but not installed.
    centos67: No Match for argument: avahi
    centos67: Package(s) avahi available, but not installed.
    centos67: No Match for argument: freetype
    centos67: Package(s) freetype available, but not installed.
    centos67: No Match for argument: bitstream-vera-fonts
    centos67: No Packages marked for removal
    centos67: ==&gt; Cleaning up yum cache
    centos67: Loaded plugins: fastestmirror
    centos67: Cleaning repos: base extras updates
    centos67: Cleaning up Everything
    centos67: Cleaning up list of fastest mirrors
    centos67: ==&gt; Force logs to rotate
    centos67: ==&gt; Clear audit log and wtmp
    centos67: ==&gt; Cleaning up udev rules
    centos67: ==&gt; Remove the traces of the template MAC address and UUIDs
    centos67: ==&gt; Cleaning up tmp
    centos67: ==&gt; Remove the SSH host keys
    centos67: ==&gt; Remove the root user’s shell history
    centos67: ==&gt; yum -y clean all
    centos67: Loaded plugins: fastestmirror
    centos67: Cleaning repos: base extras updates
    centos67: Cleaning up Everything
    centos67: /
    centos67: 25211696
    centos67: /tmp/script_7943.sh: line 62: bc: command not found
    centos67:
    centos67: dd: invalid number `&#39;
    centos67: /boot
    centos67: 60474
    centos67: /tmp/script_7943.sh: line 62: bc: command not found
    centos67:
    centos67: dd: invalid number `&#39;
    centos67: /tmp/script_7943.sh: line 70: /usr/sbin/vgdisplay: No such file or directory
    centos67: ==&gt; Zero out the free space to save space in the final image
    centos67: dd: writing `/EMPTY&#39;: No space left on device
    centos67: 12970+0 records in
    centos67: 12969+0 records out
    centos67: 13599232000 bytes (14 GB) copied, 413.4 s, 32.9 MB/s</code></pre></figure>

<p>With the provisioners block having been completed, Packer will now shutdown the centos67 virtual machine and unregister it from the ESXi virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">==&gt; centos67: Gracefully halting virtual machine...
    centos67: Waiting for VMware to clean up after itself...
==&gt; centos67: Deleting unnecessary VMware files...
    centos67: Deleting: /vmfs/volumes/datastore1/output-centos67/vmware.log
==&gt; centos67: Cleaning VMX prior to finishing up...
    centos67: Unmounting floppy from VMX...
    centos67: Detaching ISO from CD-ROM device...
    centos67: Disabling VNC server...
==&gt; centos67: Compacting the disk image
==&gt; centos67: Unregistering virtual machine...
Build &#39;centos67&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; centos67: VM files in directory: /vmfs/volumes/datastore1/output-centos67
[root@packer-centos packer-templates]#</code></pre></figure>

<p>The output of the packer build command shows that the template was successfully created at /vmfs/volumes/datastore1/output-centos67 on the ESXi virtual machine.</p>

<h3>This seems like a good point to take break. We covered a lot of ground in this post, but as a result of all our work we have a working Packer template to build on.</h3>

<h3>If you would like to not have to manually create the files covered in this post, you can clone down <a href="https://github.com/sdorsett/packer-templates/tree/first-packer-template">this github repository</a> by running the following command:</h3>

<pre>
git clone -b "first-packer-template" https://github.com/sdorsett/packer-templates.git
</pre>  

<h3>You will still need to create the iso/ directory, download the needed .iso files and create the packer-remote-info.json file as covered in this post.</h3>

<h3>In the next post we will extend what was covered in this post by installing the Puppet agent in Packer image.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/12/24/installing-packer-and-ovftool-on-centos/">
        Setting up Packer, ovftool and Apache web server on a CentOS virtual machine
      </a>
    </h1>

    <span class="post-date">24 Dec 2015</span>

    <p>This is the third in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the <a href="https://sdorsett.github.io/2015/12/23/installing-esxi-virtual-machine-for-packer-depolyment/">last post</a> we setup a ESXi virtual machine that would be the target for creating Packer images. In order to follow along with this post you will need two things:</p>

<ul>
<li>A fresh CentOS virtual machine on which we will install Packer - I&#39;m using CentOS 6.6 minimal install named &quot;packer-centos&quot; with 2 vCPU, 4GB of memory and a 100GB virtual hard drive. I also gave this virtual machine the IP address of 192.168.1.52</li>
<li><a href="https://my.vmware.com/web/vmware/details?productId=491&downloadGroup=OVFTOOL410">VMware ovftool</a> - if you followed the previous post and are using ESXi 6.0 you will need a copy of ovftool 4.1.</li>
</ul>

<p>Let&#39;s get started...</p>

<h2>1. SSH to CentOS virtual machine you created.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
The authenticity of host &#39;192.168.1.52 (192.168.1.52)&#39; cant be established.
RSA key fingerprint is 58:f5:22:2e:f6:64:04:59:6b:0b:76:2f:33:6f:03:85.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;192.168.1.52&#39; (RSA) to the list of known hosts.
root@192.168.1.52&#39;s password:
Last login: Thu Oct 22 17:52:17 2015 from 192.168.1.1
[root@packer-centos ~]#</code></pre></figure>

<h2>2. Install the EPEL repository</h2>

<p>There will be several package we need to install that are coming from the CentOS EPEL repository, so we will need to install it.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# yum install -y epel-release
Loaded plugins: fastestmirror
Setting up Install Process
Determining fastest mirrors
 * base: yum.tamu.edu
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
base
base/primary_db
extras
extras/primary_db
updates
updates/primary_db
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package epel-release.noarch 0:6-8 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

=============================================================
 Package          Arch       Version     Repository     Size
=============================================================
Installing:
 epel-release     noarch     6-8         extras         14 k

Transaction Summary
=============================================================
Install       1 Package(s)

Total download size: 14 k
Installed size: 22 k
Downloading Packages:
epel-release-6-8.noarch.rpm     |  14 kB     00:00
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : epel-release-6-8.noarch     1/1
  Verifying  : epel-release-6-8.noarch     1/1

Installed:
  epel-release.noarch 0:6-8

Complete!

[root@packer-centos ~]#</code></pre></figure>

<h2>3. Use yum to make sure the following packages are installed:</h2>

<ul>
<li>git - for version control and the ability to pull down git repositories</li>
<li>wget - provides the ability to download packages from URLs</li>
<li>unzip - needed to unzip Packer, since it comes as a .zip</li>
<li>sshpass - used for running SSH commands, but it allows us to specify a password to use</li>
</ul>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# yum install -y git wget unzip sshpass
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: fedora-epel.mirror.lstn.net
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Package git-1.7.1-3.el6_4.1.x86_64 already installed and latest version
Package wget-1.12-5.el6_6.1.x86_64 already installed and latest version
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package sshpass.x86_64 0:1.05-1.el6 will be installed
---&gt; Package unzip.x86_64 0:6.0-2.el6_6 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

============================================================
 Package     Arch       Version        Repository     Size
============================================================
Installing:
 sshpass     x86_64     1.05-1.el6     epel           19 k
 unzip       x86_64     6.0-2.el6_6    base           149 k

Transaction Summary
============================================================
Install       2 Package(s)

Total download size: 168 k
Installed size: 346 k
Downloading Packages:
(1/2): sshpass-1.05-1.el6.x86_64.rpm     |  19 kB     00:00
(2/2): unzip-6.0-2.el6_6.x86_64.rpm      | 149 kB     00:00
------------------------------------------------------------
Total                                                                                                                                                                     593 kB/s | 168 kB     00:00
warning: rpmts_HdrFromFdno: Header V3 RSA/SHA256 Signature, key ID 0608b895: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
Importing GPG key 0x0608B895:
 Userid : EPEL (6) &lt;epel@fedoraproject.org&gt;
 Package: epel-release-6-8.noarch (@extras)
 From   : /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : sshpass-1.05-1.el6.x86_64     1/2
  Installing : unzip-6.0-2.el6_6.x86_64      2/2
  Verifying  : unzip-6.0-2.el6_6.x86_64      1/2
  Verifying  : sshpass-1.05-1.el6.x86_64     2/2

Installed:
  sshpass.x86_64 0:1.05-1.el6     unzip.x86_64 0:6.0-2.el6_6

Complete!
[root@packer-centos ~]#</code></pre></figure>

<h2>4. Install Packer</h2>

<p>Go to <a href="https://packer.io/downloads.html">https://packer.io/downloads.html</a> and copy the URL for the Linux 64-bit package. In the SSH session to our CentOS virtual machine, perform the following steps:</p>

<p>Create a new directory to install packer into</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# mkdir /usr/local/packer_0.8.6
[root@packer-centos ~]#</code></pre></figure>

<p>Download Packer using the URL you copied from the packer.io download page:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# wget https://releases.hashicorp.com/packer/0.8.6/packer_0.8.6_linux_amd64.zip
--2015-12-23 17:22:03--  https://releases.hashicorp.com/packer/0.8.6/packer_0.8.6_linux_amd64.zip
Resolving releases.hashicorp.com... 23.235.44.69
Connecting to releases.hashicorp.com|23.235.44.69|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 132616691 (126M) [application/zip]
Saving to: “packer_0.8.6_linux_amd64.zip”

100%[====================================&gt;] 132,616,691 6.97M/s   in 18s

2015-12-23 17:22:22 (6.95 MB/s) - “packer_0.8.6_linux_amd64.zip” saved [132616691/132616691]

[root@packer-centos ~]# unzip packer_0.8.6_linux_amd64.zip -d /usr/local/packer_8.6/
Archive:  packer_0.8.6_linux_amd64.zip
  inflating: /usr/local/packer_8.6/packer
  inflating: /usr/local/packer_8.6/packer-builder-amazon-chroot
  inflating: /usr/local/packer_8.6/packer-builder-amazon-ebs
  inflating: /usr/local/packer_8.6/packer-builder-amazon-instance
  inflating: /usr/local/packer_8.6/packer-builder-digitalocean
  inflating: /usr/local/packer_8.6/packer-builder-docker
  inflating: /usr/local/packer_8.6/packer-builder-file
  inflating: /usr/local/packer_8.6/packer-builder-googlecompute
  inflating: /usr/local/packer_8.6/packer-builder-null
  inflating: /usr/local/packer_8.6/packer-builder-openstack
  inflating: /usr/local/packer_8.6/packer-builder-parallels-iso
  inflating: /usr/local/packer_8.6/packer-builder-parallels-pvm
  inflating: /usr/local/packer_8.6/packer-builder-qemu
  inflating: /usr/local/packer_8.6/packer-builder-virtualbox-iso
  inflating: /usr/local/packer_8.6/packer-builder-virtualbox-ovf
  inflating: /usr/local/packer_8.6/packer-builder-vmware-iso
  inflating: /usr/local/packer_8.6/packer-builder-vmware-vmx
  inflating: /usr/local/packer_8.6/packer-post-processor-artifice
  inflating: /usr/local/packer_8.6/packer-post-processor-atlas
  inflating: /usr/local/packer_8.6/packer-post-processor-compress
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-import
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-push
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-save
  inflating: /usr/local/packer_8.6/packer-post-processor-docker-tag
  inflating: /usr/local/packer_8.6/packer-post-processor-vagrant
  inflating: /usr/local/packer_8.6/packer-post-processor-vagrant-cloud
  inflating: /usr/local/packer_8.6/packer-post-processor-vsphere
  inflating: /usr/local/packer_8.6/packer-provisioner-ansible-local
  inflating: /usr/local/packer_8.6/packer-provisioner-chef-client
  inflating: /usr/local/packer_8.6/packer-provisioner-chef-solo
  inflating: /usr/local/packer_8.6/packer-provisioner-file
  inflating: /usr/local/packer_8.6/packer-provisioner-powershell
  inflating: /usr/local/packer_8.6/packer-provisioner-puppet-masterless
  inflating: /usr/local/packer_8.6/packer-provisioner-puppet-server
  inflating: /usr/local/packer_8.6/packer-provisioner-salt-masterless
  inflating: /usr/local/packer_8.6/packer-provisioner-shell
  inflating: /usr/local/packer_8.6/packer-provisioner-shell-local
  inflating: /usr/local/packer_8.6/packer-provisioner-windows-restart
  inflating: /usr/local/packer_8.6/packer-provisioner-windows-shell
[root@packer-centos ~]#</code></pre></figure>

<p>Update ~/.bashrc to add &quot;/usr/local/packer_8.6&quot; to our path. Run &quot;source ~/.bashrc&quot; to re-read ~/.bashrc and validate $PATH has been updated.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# echo &#39;export PATH=&quot;/usr/local/packer_8.6:$PATH&quot;&#39; &gt;&gt; ~/.bashrc
[root@packer-centos ~]# source ~/.bashrc
[root@packer-centos ~]# echo $PATH
/usr/local/packer_8.6:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
[root@packer-centos ~]#</code></pre></figure>

<p>Ensure the packer binary can be found and is showing the proper version</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# which packer
/usr/local/packer_8.6/packer
[root@packer-centos ~]# packer -v
0.8.6
[root@packer-centos ~]#</code></pre></figure>

<h2>5. Stop the iptables firewall and disable it from started on reboot of the virtual machine</h2>

<p>Packer will start a web server service for providing kickstart and script files to Packer images during install. This service will use a random port within a range, so we will need to stop iptables in order to allow the Packer images to connect.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# service iptables stop
[root@packer-centos ~]# chkconfig iptables off
[root@packer-centos ~]#</code></pre></figure>

<h2>6. Install ovftool on the CentOS virtual machine</h2>

<p>Download linux 64bit version of ovftool 4.1 on your local machine</p>

<p><img src="/assets/01-download-ovftool-linux-64bit.png" alt="screenshot">  </p>

<p>SCP the downloaded file to the CentOS virtual machine</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">sdorsett-mbp:~ sdorsett$ scp ~/Downloads/VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle root@192.168.1.52:/root/
root@192.168.1.52&#39;s password:
VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle                    100%   37MB  12.4MB/s   00:03
sdorsett-mbp:~ sdorsett$</code></pre></figure>

<p>Install ovftool on the CentOS virtual machine and validate the version</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# ls
anaconda-ks.cfg  install.log  install.log.syslog  packer_0.8.6_linux_amd64.zip  VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle
[root@packer-centos ~]# ./VMware-ovftool-4.1.0-2459827-lin.x86_64.bundle
Extracting VMware Installer...done.
You must accept the VMware OVF Tool component for Linux End User
License Agreement to continue.  Press Enter to proceed.
VMWARE END USER LICENSE AGREEMENT

PLEASE NOTE THAT THE TERMS OF THIS END USER LICENSE AGREEMENT SHALL GOVERN YOUR
USE OF THE SOFTWARE, REGARDLESS OF ANY TERMS THAT MAY APPEAR DURING THE
INSTALLATION OF THE SOFTWARE.

IMPORTANT-READ CAREFULLY:   BY DOWNLOADING, INSTALLING, OR USING THE SOFTWARE,
YOU (THE INDIVIDUAL OR LEGAL ENTITY) AGREE TO BE BOUND BY THE TERMS OF THIS END
USER LICENSE AGREEMENT (&quot;EULA&quot;).  IF YOU DO NOT AGREE TO THE TERMS OF THIS
EULA, YOU MUST NOT DOWNLOAD, INSTALL, OR USE THE SOFTWARE, AND YOU MUST DELETE
OR RETURN THE UNUSED SOFTWARE TO THE VENDOR FROM WHICH YOU ACQUIRED IT WITHIN
THIRTY (30) DAYS AND REQUEST A REFUND OF THE LICENSE FEE, IF ANY, THAT YOU PAID
FOR THE SOFTWARE.
...

Do you agree? [yes/no]: yes

The product is ready to be installed.  Press Enter to begin
installation or Ctrl-C to cancel.

Installing VMware OVF Tool component for Linux 4.1.0
    Configuring...
[######################################################################] 100%
Installation was successful.
[root@packer-centos ~]# which ovftool
/usr/bin/ovftool
[root@packer-centos ~]# ovftool -v
VMware ovftool 4.1.0 (build-2459827)
[root@packer-centos ~]#</code></pre></figure>

<h2>7. Install apache web server on the CentOS virtual machine</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# yum install -y httpd
Loaded plugins: fastestmirror
Setting up Install Process
Loading mirror speeds from cached hostfile
 * base: yum.tamu.edu
 * epel: fedora-epel.mirror.lstn.net
 * extras: centos.firehosted.com
 * updates: mirrors.adams.net
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package httpd.x86_64 0:2.2.15-47.el6.centos.1 will be installed
--&gt; Processing Dependency: httpd-tools = 2.2.15-47.el6.centos.1 for package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: apr-util-ldap for package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: /etc/mime.types for package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: libaprutil-1.so.0()(64bit) for package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Processing Dependency: libapr-1.so.0()(64bit) for package: httpd-2.2.15-47.el6.centos.1.x86_64
--&gt; Running transaction check
---&gt; Package apr.x86_64 0:1.3.9-5.el6_2 will be installed
---&gt; Package apr-util.x86_64 0:1.3.9-3.el6_0.1 will be installed
---&gt; Package apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1 will be installed
---&gt; Package httpd-tools.x86_64 0:2.2.15-47.el6.centos.1 will be installed
---&gt; Package mailcap.noarch 0:2.1.31-2.el6 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

======================================================================
 Package        Arch       Version                  Repository   Size
======================================================================
Installing:
 httpd          x86_64     2.2.15-47.el6.centos.1   updates      830 k
Installing for dependencies:
 apr            x86_64     1.3.9-5.el6_2            base         123 k
 apr-util       x86_64     1.3.9-3.el6_0.1          base         87 k
 apr-util-ldap  x86_64     1.3.9-3.el6_0.1          base         15 k
 httpd-tools    x86_64     2.2.15-47.el6.centos.1   updates      77 k
 mailcap        noarch     2.1.31-2.el6             base         27 k

Transaction Summary
======================================================================
Install       6 Package(s)

Total download size: 1.1 M
Installed size: 3.6 M
Downloading Packages:
(1/6): apr-1.3.9-5.el6_2.x86_64.rpm                   | 123 kB  00:00
(2/6): apr-util-1.3.9-3.el6_0.1.x86_64.rpm            |  87 kB  00:00
(3/6): apr-util-ldap-1.3.9-3.el6_0.1.x86_64.rpm       |  15 kB  00:00
(4/6): httpd-2.2.15-47.el6.centos.1.x86_64.rpm        | 830 kB  00:00
(5/6): httpd-tools-2.2.15-47.el6.centos.1.x86_64.rpm  |  77 kB  00:00
(6/6): mailcap-2.1.31-2.el6.noarch.rpm                |  27 kB  00:00
----------------------------------------------------------------------
Total                                        711 kB/s | 1.1 MB  00:01
Running rpm_check_debug
Running Transaction Test
Transaction Test Succeeded
Running Transaction
  Installing : apr-1.3.9-5.el6_2.x86_64                         1/6
  Installing : apr-util-1.3.9-3.el6_0.1.x86_64                  2/6
  Installing : httpd-tools-2.2.15-47.el6.centos.1.x86_64        3/6
  Installing : apr-util-ldap-1.3.9-3.el6_0.1.x86_64             4/6
  Installing : mailcap-2.1.31-2.el6.noarch                      5/6
  Installing : httpd-2.2.15-47.el6.centos.1.x86_64              6/6
  Verifying  : httpd-tools-2.2.15-47.el6.centos.1.x86_64        1/6
  Verifying  : httpd-2.2.15-47.el6.centos.1.x86_64              2/6
  Verifying  : apr-util-ldap-1.3.9-3.el6_0.1.x86_64             3/6
  Verifying  : apr-1.3.9-5.el6_2.x86_64                         4/6
  Verifying  : mailcap-2.1.31-2.el6.noarch                      5/6
  Verifying  : apr-util-1.3.9-3.el6_0.1.x86_64                  6/6

Installed:
  httpd.x86_64 0:2.2.15-47.el6.centos.1

Dependency Installed:
  apr.x86_64 0:1.3.9-5.el6_2    apr-util.x86_64 0:1.3.9-3.el6_0.1    
  apr-util-ldap.x86_64 0:1.3.9-3.el6_0.1  httpd-tools.x86_64 0:2.2.15-47.el6.centos.1     
  mailcap.noarch 0:2.1.31-2.el6

Complete!
[root@packer-centos ~]#</code></pre></figure>

<h2>7. Remove the apache welcome.conf, to enable directory browsing, and start the httpd service</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# rm /etc/httpd/conf.d/welcome.conf
rm: remove regular file &#39;/etc/httpd/conf.d/welcome.conf&#39;? y
[root@packer-centos ~]# service httpd start
Starting httpd:                                            [  OK  ]
[root@packer-centos ~]#</code></pre></figure>

<h2>8. create the directory /var/www/html/box-files and test that the directory is visible in a browser</h2>

<p>Create the /var/www/hmlt/box-files/ directory and an empty test-file.txt</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# mkdir /var/www/html/box-files
[root@packer-centos ~]# touch /var/www/html/box-files/test-file.txt
[root@packer-centos ~]#</code></pre></figure>

<p>Open the ip address of the CentOS virtual machine in a browser and verify that the test-file.txt is visible</p>

<p><img src="/assets/02-browse-apache-box-file-directory.png" alt="screenshot">  </p>

<p>Delete /var/www/html/box-files/test-file.txt, since it will not be needed:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">[root@packer-centos ~]# rm /var/www/html/box-files/test-file.txt
rm: remove regular empty file &#39;/var/www/html/box-files/test-file.txt&#39;? y
[root@packer-centos ~]#</code></pre></figure>

<h3>That all for this post covering how to install Packer, ovftool and Apache web server on a CentOS virtual machine. In the next post we will create a Packer template that uses what we have setup so far.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page3">Older</a>
  
  
    
      <a class="pagination-item newer" href="/">Newer</a>
    
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
