<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Copying our existing CentOS 6.7 template and adding the Puppet agent &middot; sdorsett.github.io
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p></p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/posts/">All Posts</a>
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/sdorsett/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="https://github.com/sdorsett">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2018. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">sdorsett.github.io</a>
            <small>Things I find interesting</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Copying our existing CentOS 6.7 template and adding the Puppet agent</h1>
  <span class="post-date">26 Dec 2015</span>
  <p>This is the fifth in a series of posts on <a href="https://sdorsett.github.io/2015/12/22/pipeline-for-creating-packer-box-files/">using a Packer pipeline to generate Vagrant .box files</a>.</p>

<p>In the last post we covered <a href="https://sdorsett.github.io/2015/12/25/creating-a-packer-template-for-installing-centos-67/">creating a Packer template for installing CentOS 6.7 with vmtools</a>. In this post we will be basing a new Packer template on the one we created last post and add installing the Puppet Enterprise 3.8.2 agent.</p>

<p>This is an older version of the Puppet Enterprise agent, but it will let us create a Vagrant .box file that can be used for testing Puppet 3.x code.</p>

<p>Let&#39;s get started...</p>

<h2>1. Start off by connecting by SSH to CentOS virtual machine we have been using in previous posts.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>sdorsett-mbp:~ sdorsett$ ssh root@192.168.1.52
root@192.168.1.52<span class="err">&#39;</span>s password:
Last login: Fri Dec <span class="m">25</span> <span class="m">20</span>:22:44 <span class="m">2015</span> from <span class="m">192</span>.168.1.253
<span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c1">#</span></code></pre></figure>

<h2>2. Create a new bash script named centos-install-pe-puppet-382.sh at packer-templates/scripts/ to install the Puppet Enterprise 3.8.2 agent:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c1"># cd ~/packer-templates/scripts/</span>
<span class="o">[</span>root@packer-centos scripts<span class="o">]</span><span class="c1"># cat centos-install-pe-puppet-382.sh</span>
<span class="c1">#!/bin/bash</span>

<span class="nv">VERSION</span><span class="o">=</span><span class="s1">&#39;3.8.2&#39;</span>
<span class="nv">PKGNAME</span><span class="o">=</span><span class="s2">&quot;puppet-enterprise-</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">-el-6-x86_64&quot;</span>
<span class="nv">TARFILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PKGNAME</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="nv">URL</span><span class="o">=</span><span class="s2">&quot;https://pm.puppetlabs.com/puppet-enterprise/</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">TARFILE</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nv">TMPDIR</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span>
<span class="nv">HOSTNAME</span><span class="o">=</span><span class="sb">`</span>hostname<span class="sb">`</span>
<span class="nb">cd</span> <span class="nv">$TMPDIR</span>
<span class="nb">echo</span> <span class="s2">&quot;Fetching </span><span class="si">${</span><span class="nv">TARFILE</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">[</span> -e <span class="nv">$TARFILE</span> <span class="o">]</span> <span class="o">||</span> curl -fLO <span class="nv">$URL</span>
<span class="nb">echo</span> <span class="s2">&quot;Extracting </span><span class="si">${</span><span class="nv">TARFILE</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="o">[</span> -d <span class="nv">$PKGNAME</span> <span class="o">]</span> <span class="o">||</span> tar -xf <span class="nv">$TARFILE</span>
<span class="nb">cd</span> <span class="nv">$PKGNAME</span>

cat &gt; agent.ans <span class="s">&lt;&lt;EOF</span>
<span class="s">q_all_in_one_install=n</span>
<span class="s">q_database_install=n</span>
<span class="s">q_pe_database=n</span>
<span class="s">q_puppetca_install=n</span>
<span class="s">q_puppetdb_install=n</span>
<span class="s">q_puppetmaster_install=n</span>
<span class="s">q_puppet_enterpriseconsole_install=n</span>
<span class="s">q_run_updtvpkg=n</span>
<span class="s">q_continue_or_reenter_master_hostname=c</span>
<span class="s">q_fail_on_unsuccessful_master_lookup=n</span>
<span class="s">q_puppetagent_certname=$HOSTNAME</span>
<span class="s">q_puppetagent_install=y</span>
<span class="s">q_puppetagent_server=puppet</span>
<span class="s">q_puppet_cloud_install=y</span>
<span class="s">q_puppet_symlinks_install=y</span>
<span class="s">q_vendor_packages_install=y</span>
<span class="s">q_install=y</span>
<span class="s">EOF</span>

./puppet-enterprise-installer -a agent.ans

<span class="c1"># Remove certname so the system will use host FQDN</span>
sed -i <span class="s1">&#39;/certname =/d&#39;</span> /etc/puppetlabs/puppet/puppet.conf

<span class="c1"># Symlink so puppet is in vagrant provisioner PATH</span>
ln -s /opt/puppet/bin/facter /usr/bin/facter
ln -s /opt/puppet/bin/puppet /usr/bin/puppet

<span class="o">[</span>root@packer-deploy scripts<span class="o">]</span><span class="c1">#</span></code></pre></figure>

<h2>3. Copy the Packer template we created previously, as the starting point for a new CentOS 6.7 template that will have Puppet Enterprise 3.8.2 installed</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">[</span>root@packer-centos ~<span class="o">]</span><span class="c1"># cd ~/packer-templates/templates/</span>
<span class="o">[</span>root@packer-centos templates<span class="o">]</span><span class="c1"># ls</span>
centos67.json
<span class="o">[</span>root@packer-centos templates<span class="o">]</span><span class="c1"># cp centos67.json centos67-pe-puppet-382.json</span>
<span class="o">[</span>root@packer-centos templates<span class="o">]</span><span class="c1">#</span>
<span class="o">[</span>root@packer-deploy scripts<span class="o">]</span><span class="c1">#</span></code></pre></figure>

<h2>4. Update the provisioners blocker to include the &quot;scripts/centos-install-pe-puppet-382.sh&quot; bash script.</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">[</span>root@packer-centos templates<span class="o">]</span><span class="c1"># cat centos67-pe-puppet-382.json</span>
<span class="o">{</span>
  <span class="s2">&quot;variables&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;1.0&quot;</span>
  <span class="o">}</span>,
  <span class="s2">&quot;builders&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;centos67-pe-puppet-382&quot;</span>,
      <span class="s2">&quot;vm_name&quot;</span>: <span class="s2">&quot;centos67-pe-puppet-382&quot;</span>,
      <span class="s2">&quot;vmdk_name&quot;</span>: <span class="s2">&quot;centos67-pe-puppet-382&quot;</span>,
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;vmware-iso&quot;</span>,
      <span class="s2">&quot;communicator&quot;</span>: <span class="s2">&quot;ssh&quot;</span>,
      <span class="s2">&quot;ssh_pty&quot;</span>: <span class="s2">&quot;true&quot;</span>,
      <span class="s2">&quot;headless&quot;</span>: false,
      <span class="s2">&quot;disk_size&quot;</span>: <span class="m">16384</span>,
      <span class="s2">&quot;guest_os_type&quot;</span>: <span class="s2">&quot;rhel6-64&quot;</span>,
      <span class="s2">&quot;iso_url&quot;</span>: <span class="s2">&quot;./iso/CentOS-6.7-x86_64-minimal.iso&quot;</span>,
      <span class="s2">&quot;iso_checksum&quot;</span>: <span class="s2">&quot;2ed5ea551dffc3e4b82847b3cee1f6cd748e8071&quot;</span>,
      <span class="s2">&quot;iso_checksum_type&quot;</span>: <span class="s2">&quot;sha1&quot;</span>,
      <span class="s2">&quot;shutdown_command&quot;</span>: <span class="s2">&quot;echo &#39;vagrant&#39; | sudo -S /sbin/shutdown -P now&quot;</span>,

      <span class="s2">&quot;remote_host&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;remote_datastore&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;remote_username&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;remote_password&quot;</span>: <span class="s2">&quot;&quot;</span>,
      <span class="s2">&quot;remote_type&quot;</span>: <span class="s2">&quot;esx5&quot;</span>,
      <span class="s2">&quot;ssh_username&quot;</span>: <span class="s2">&quot;root&quot;</span>,
      <span class="s2">&quot;ssh_password&quot;</span>: <span class="s2">&quot;vagrant&quot;</span>,
      <span class="s2">&quot;ssh_wait_timeout&quot;</span>: <span class="s2">&quot;60m&quot;</span>,
      <span class="s2">&quot;tools_upload_flavor&quot;</span>: <span class="s2">&quot;linux&quot;</span>,
      <span class="s2">&quot;http_directory&quot;</span>: <span class="s2">&quot;.&quot;</span>,
      <span class="s2">&quot;boot_wait&quot;</span>: <span class="s2">&quot;5s&quot;</span>,
      <span class="s2">&quot;vmx_data&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;memsize&quot;</span>: <span class="s2">&quot;4096&quot;</span>,
        <span class="s2">&quot;numvcpus&quot;</span>: <span class="s2">&quot;2&quot;</span>,
        <span class="s2">&quot;ethernet0.networkName&quot;</span>: <span class="s2">&quot;&quot;</span>,
        <span class="s2">&quot;ethernet0.present&quot;</span>: <span class="s2">&quot;TRUE&quot;</span>,
        <span class="s2">&quot;ethernet0.startConnected&quot;</span>: <span class="s2">&quot;TRUE&quot;</span>,
        <span class="s2">&quot;ethernet0.virtualDev&quot;</span>: <span class="s2">&quot;e1000&quot;</span>,
        <span class="s2">&quot;ethernet0.addressType&quot;</span>: <span class="s2">&quot;generated&quot;</span>,
        <span class="s2">&quot;ethernet0.generatedAddressOffset&quot;</span>: <span class="s2">&quot;0&quot;</span>,
        <span class="s2">&quot;ethernet0.wakeOnPcktRcv&quot;</span>: <span class="s2">&quot;FALSE&quot;</span>

      <span class="o">}</span>,
      <span class="s2">&quot;vmx_data_post&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;ide1:0.startConnected&quot;</span>: <span class="s2">&quot;FALSE&quot;</span>,
        <span class="s2">&quot;ide1:0.clientDevice&quot;</span>: <span class="s2">&quot;TRUE&quot;</span>,
        <span class="s2">&quot;ide1:0.fileName&quot;</span>: <span class="s2">&quot;emptyBackingString&quot;</span>,
        <span class="s2">&quot;ethernet0.virtualDev&quot;</span>: <span class="s2">&quot;vmxnet3&quot;</span>
      <span class="o">}</span>,
      <span class="s2">&quot;boot_command&quot;</span>: <span class="o">[</span>
        <span class="s2">&quot;&lt;tab&gt; text ks=http://:/scripts/centos-6-kickstart.cfg&lt;enter&gt;&lt;wait&gt;&quot;</span>
      <span class="o">]</span>
    <span class="o">}</span>
  <span class="o">]</span>,
  <span class="s2">&quot;provisioners&quot;</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;file&quot;</span>,
      <span class="s2">&quot;source&quot;</span>: <span class="s2">&quot;iso/vmware-tools-linux.iso&quot;</span>,
      <span class="s2">&quot;destination&quot;</span>: <span class="s2">&quot;/tmp/vmware-tools-linux.iso&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;shell&quot;</span>,
      <span class="s2">&quot;execute_command&quot;</span>: <span class="s2">&quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;</span>,
      <span class="s2">&quot;script&quot;</span>: <span class="s2">&quot;scripts/centos-vagrant-settings.sh&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;shell&quot;</span>,
      <span class="s2">&quot;execute_command&quot;</span>: <span class="s2">&quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;</span>,
      <span class="s2">&quot;script&quot;</span>: <span class="s2">&quot;scripts/centos-vmware-tools_install.sh&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;shell&quot;</span>,
      <span class="s2">&quot;execute_command&quot;</span>: <span class="s2">&quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;</span>,
      <span class="s2">&quot;script&quot;</span>: <span class="s2">&quot;scripts/centos-install-pe-puppet-382.sh&quot;</span>
    <span class="o">}</span>,
    <span class="o">{</span>
      <span class="s2">&quot;type&quot;</span>: <span class="s2">&quot;shell&quot;</span>,
      <span class="s2">&quot;execute_command&quot;</span>: <span class="s2">&quot;echo &#39;vagrant&#39; |  sudo -E -S sh &#39;&#39;&quot;</span>,
      <span class="s2">&quot;script&quot;</span>: <span class="s2">&quot;scripts/centos-vmware-cleanup.sh&quot;</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span></code></pre></figure>

<h2>5. The packer-templates directory should now contain the following directories and files:</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># tree /root/packer-templates/</span>
/root/packer-templates/
├── iso
│   ├── CentOS-6.7-x86_64-minimal.iso
│   ├── linux.iso
│   └── vmware-tools-linux.iso -&gt; ./linux.iso
├── packer_cache
├── packer-remote-info.json
├── README.md
├── scripts
│   ├── centos-6-kickstart.cfg
│   ├── centos-install-pe-puppet-382.sh
│   ├── centos-vagrant-settings.sh
│   ├── centos-vmware-cleanup.sh
│   └── centos-vmware-tools_install.sh
└── templates
    ├── centos67.json
    └── centos67-pe-puppet-382.json

<span class="m">4</span> directories, <span class="m">12</span> files
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1">#</span></code></pre></figure>

<h2>6. Push the changes we have made to a github repository</h2>

<p>During this step pushed the two new files to the <a href="https://github.com/sdorsett/packer-templates/tree/adding-second-packer-template">adding-second-packer-template branch</a> of the github repository I have created for this series of blog posts:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># git status</span>
<span class="c1"># On branch first-packer-template</span>
<span class="c1"># Untracked files:</span>
<span class="c1">#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span>
<span class="c1">#</span>
<span class="c1">#  scripts/centos-install-pe-puppet-382.sh</span>
<span class="c1">#  templates/centos67-pe-puppet-382.json</span>
nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> to track<span class="o">)</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># git add .</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># git commit -m &quot;adding templates/centos67-pe-puppet-382.json and scripts/centos-install-pe-puppet-382.sh&quot;</span>
<span class="o">[</span>first-packer-template 75bb98e<span class="o">]</span> adding templates/centos67-pe-puppet-382.json and scripts/centos-install-pe-puppet-382.sh
 <span class="m">2</span> files changed, <span class="m">125</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">0</span> deletions<span class="o">(</span>-<span class="o">)</span>
 create mode <span class="m">100644</span> scripts/centos-install-pe-puppet-382.sh
 create mode <span class="m">100644</span> templates/centos67-pe-puppet-382.json
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># git checkout -b adding-second-packer-template</span>
Switched to a new branch <span class="s1">&#39;adding-second-packer-template&#39;</span>
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># git push origin adding-second-packer-template</span>
Password:
Counting objects: <span class="m">9</span>, <span class="k">done</span>.
Delta compression using up to <span class="m">2</span> threads.
Compressing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">6</span>/6<span class="o">)</span>, <span class="k">done</span>.
Writing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">6</span>/6<span class="o">)</span>, <span class="m">1</span>.95 KiB, <span class="k">done</span>.
Total <span class="m">6</span> <span class="o">(</span>delta <span class="m">1</span><span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>
To https://sdorsett@github.com/sdorsett/packer-templates.git
 * <span class="o">[</span>new branch<span class="o">]</span>      adding-second-packer-template -&gt; adding-second-packer-template
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1">#</span></code></pre></figure>

<h2>13. Have Packer build the new template we created</h2>

<p>Now that we have updated the new template file and created the script file that will install the Puppet Enterprise 3.8.2 agent, we can test our build. In order to use the values in the packer-remote-info.json file, we will use the -var-file parameter to specify this file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>root@packer-centos packer-templates<span class="o">]</span><span class="c1"># packer build -var-file=./packer-remote-info.json templates/centos67-pe-puppet-382.json</span>
centos67-pe-puppet-382 output will be in this color.

<span class="o">==</span>&gt; centos67-pe-puppet-382: Downloading or copying ISO
    centos67-pe-puppet-382: Downloading or copying: file:///root/packer-templates/iso/CentOS-6.7-x86_64-minimal.iso
<span class="o">==</span>&gt; centos67-pe-puppet-382: Uploading ISO to remote machine...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Creating virtual machine <span class="nv">disk</span>
<span class="o">==</span>&gt; centos67-pe-puppet-382: Building and writing VMX <span class="nv">file</span>
<span class="o">==</span>&gt; centos67-pe-puppet-382: Starting HTTP server on port <span class="nv">8019</span>
<span class="o">==</span>&gt; centos67-pe-puppet-382: Registering remote VM...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Starting virtual machine...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Waiting 7s <span class="k">for</span> boot...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Connecting to VM via <span class="nv">VNC</span>
<span class="o">==</span>&gt; centos67-pe-puppet-382: Typing the boot <span class="nb">command</span> over VNC...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Waiting <span class="k">for</span> SSH to become available...</code></pre></figure>

<p>At this point you should see a centos67 virtual machine in the embedded host client of the ESXi virtual machine.</p>

<p><img src="/assets/01-centos-67-pe-puppet-382-virtual-machine.png" alt="screenshot">  </p>

<p>Once the CentOS 6.7 install completes and the virtual machine reboots, you will see the packer build output continue with the provisioners block of the Packer template.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Connected to SSH!</code></pre></figure>

<p>The first provisioner is the file provisioner that will copy iso/vmware-tools-linux.iso to /tmp/vmware-tools-linux.iso within the CentOS 6.7 virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Uploading iso/vmware-tools-linux.iso <span class="o">=</span>&gt; /tmp/vmware-tools-linux.iso</code></pre></figure>

<p>The second provisioner is a shell provisioner that will run the scripts/centos-vagrant-settings.sh bash script. This script will added the necessary changes for this Packer image to be used by Vagrant.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vagrant-settings.sh</code></pre></figure>

<p>The third provisioner is a shell provisioner that will run the scripts/centos-vmware-tools_install.sh bash script. This script will install all the needed dependencies for vmtools and then install vmtools using an answer file.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vmware-tools_install.sh
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Upgrade Process
    centos67-pe-puppet-382: Determining fastest mirrors
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: No Packages marked <span class="k">for</span> Update
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Install Process
    centos67-pe-puppet-382: Loading mirror speeds from cached hostfile
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package <span class="m">4</span>:perl-5.10.1-141.el6_7.1.x86_64 already installed and latest version
    centos67-pe-puppet-382: Resolving Dependencies
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package fuse-libs.x86_64 <span class="m">0</span>:2.8.3-4.el6 will be installed
    centos67-pe-puppet-382: --&gt; Finished Dependency Resolution
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependencies Resolved
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="o">========================================</span>
    centos67-pe-puppet-382: Package  Arch   Version     Repository
    centos67-pe-puppet-382: Size
    centos67-pe-puppet-382: <span class="o">========================================</span>
    centos67-pe-puppet-382: Installing:
    centos67-pe-puppet-382: fuse-libs
    centos67-pe-puppet-382: x86_64 <span class="m">2</span>.8.3-4.el6 base  <span class="m">74</span> k
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Transaction Summary
    centos67-pe-puppet-382: <span class="o">========================================</span>
    centos67-pe-puppet-382: Install       <span class="m">1</span> Package<span class="o">(</span>s<span class="o">)</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Total download size: <span class="m">74</span> k
    centos67-pe-puppet-382: Installed size: <span class="m">251</span> k
    centos67-pe-puppet-382: Downloading Packages:
    centos67-pe-puppet-382: fuse-libs-2.8.3- <span class="p">|</span>  <span class="m">74</span> kB     <span class="m">00</span>:00
    centos67-pe-puppet-382: Running rpm_check_debug
    centos67-pe-puppet-382: Running Transaction Test
    centos67-pe-puppet-382: Transaction Test Succeeded
    centos67-pe-puppet-382: Running Transaction
    centos67-pe-puppet-382:   Installing : fuse-libs-2.8.3-4.   <span class="m">1</span>/1
    centos67-pe-puppet-382: Verifying  : fuse-libs-2.8.3-4.   <span class="m">1</span>/1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installed:
    centos67-pe-puppet-382: fuse-libs.x86_64 <span class="m">0</span>:2.8.3-4.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Complete!
    centos67-pe-puppet-382: total <span class="m">488</span>
    centos67-pe-puppet-382: drwxr-xr-x   <span class="m">7</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 .
    centos67-pe-puppet-382: drwxrwxrwt.  <span class="m">4</span> root root   <span class="m">4096</span> Dec <span class="m">26</span> <span class="m">20</span>:56 ..
    centos67-pe-puppet-382: drwxr-xr-x   <span class="m">2</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 bin
    centos67-pe-puppet-382: drwxr-xr-x   <span class="m">2</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 doc
    centos67-pe-puppet-382: drwxr-xr-x   <span class="m">5</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 etc
    centos67-pe-puppet-382: -rw-r--r--   <span class="m">1</span> root root <span class="m">269196</span> Oct <span class="m">30</span> <span class="m">07</span>:10 FILES
    centos67-pe-puppet-382: -rw-r--r--   <span class="m">1</span> root root   <span class="m">2538</span> Oct <span class="m">30</span> <span class="m">07</span>:10 INSTALL
    centos67-pe-puppet-382: drwxr-xr-x   <span class="m">2</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 installer
    centos67-pe-puppet-382: drwxr-xr-x  <span class="m">15</span> root root   <span class="m">4096</span> Oct <span class="m">30</span> <span class="m">07</span>:10 lib
    centos67-pe-puppet-382: -rwxr-xr-x   <span class="m">1</span> root root <span class="m">196237</span> Oct <span class="m">30</span> <span class="m">07</span>:10 vmware-install.pl
    centos67-pe-puppet-382: Creating a new VMware Tools installer database using the tar4 format.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installing VMware Tools.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: In which directory <span class="k">do</span> you want to install the binary files?
    centos67-pe-puppet-382: <span class="o">[</span>/usr/bin<span class="o">]</span>
    centos67-pe-puppet-382: The path <span class="s2">&quot;yes&quot;</span> is a relative path. Please enter an absolute path.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: In which directory <span class="k">do</span> you want to install the binary files?
    centos67-pe-puppet-382: <span class="o">[</span>/usr/bin<span class="o">]</span>
    centos67-pe-puppet-382: What is the directory that contains the init directories <span class="o">(</span>rc0.d/ to rc6.d/<span class="o">)</span>?
    centos67-pe-puppet-382: <span class="o">[</span>/etc/rc.d<span class="o">]</span>
    centos67-pe-puppet-382: What is the directory that contains the init scripts?
    centos67-pe-puppet-382: <span class="o">[</span>/etc/init.d<span class="o">]</span>
    centos67-pe-puppet-382: In which directory <span class="k">do</span> you want to install the daemon files?
    centos67-pe-puppet-382: <span class="o">[</span>/usr/sbin<span class="o">]</span>
    centos67-pe-puppet-382: In which directory <span class="k">do</span> you want to install the library files?
    centos67-pe-puppet-382: <span class="o">[</span>/usr/lib/vmware-tools<span class="o">]</span>
    centos67-pe-puppet-382: The path <span class="s2">&quot;/usr/lib/vmware-tools&quot;</span> does not exist currently. This program is
    centos67-pe-puppet-382: going to create it, including needed parent directories. Is this what you want?
    centos67-pe-puppet-382: <span class="o">[</span>yes<span class="o">]</span>
    centos67-pe-puppet-382: In which directory <span class="k">do</span> you want to install the documentation files?
    centos67-pe-puppet-382: <span class="o">[</span>/usr/share/doc/vmware-tools<span class="o">]</span>
    centos67-pe-puppet-382: The path <span class="s2">&quot;/usr/share/doc/vmware-tools&quot;</span> does not exist currently. This program
    centos67-pe-puppet-382: is going to create it, including needed parent directories. Is this what you
    centos67-pe-puppet-382: want? <span class="o">[</span>yes<span class="o">]</span>
    centos67-pe-puppet-382: The installation of VMware Tools <span class="m">9</span>.9.4 build-3193940 <span class="k">for</span> Linux completed
    centos67-pe-puppet-382: successfully. You can decide to remove this software from your system at any
    centos67-pe-puppet-382: <span class="nb">time</span> by invoking the following command: <span class="s2">&quot;/usr/bin/vmware-uninstall-tools.pl&quot;</span>.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Before running VMware Tools <span class="k">for</span> the first time, you need to configure it by
    centos67-pe-puppet-382: invoking the following command: <span class="s2">&quot;/usr/bin/vmware-config-tools.pl&quot;</span>. Do you want
    centos67-pe-puppet-382: this program to invoke the <span class="nb">command</span> <span class="k">for</span> you now? <span class="o">[</span>yes<span class="o">]</span>
    centos67-pe-puppet-382: Initializing...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Making sure services <span class="k">for</span> VMware Tools are stopped.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module <span class="k">for</span> vmci.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module <span class="k">for</span> vsock.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module vmxnet3 has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module pvscsi has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The module vmmemctl has already been installed on this system by another
    centos67-pe-puppet-382: installer or package and will not be modified by this installer.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The VMware Host-Guest Filesystem allows <span class="k">for</span> shared folders between the host OS
    centos67-pe-puppet-382: and the guest OS in a Fusion or Workstation virtual environment.  Do you wish
    centos67-pe-puppet-382: to <span class="nb">enable</span> this feature? <span class="o">[</span>no<span class="o">]</span>
    centos67-pe-puppet-382: Found a compatible pre-built module <span class="k">for</span> vmhgfs.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Found a compatible pre-built module <span class="k">for</span> vmxnet.  Installing it...
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The vmblock enables dragging or copying files between host and guest in a
    centos67-pe-puppet-382: Fusion or Workstation virtual environment.  Do you wish to <span class="nb">enable</span> this feature?
    centos67-pe-puppet-382: <span class="o">[</span>no<span class="o">]</span>
    centos67-pe-puppet-382: VMware automatic kernel modules enables automatic building and installation of
    centos67-pe-puppet-382: VMware kernel modules at boot that are not already present. This feature can be
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: enabled/disabled by re-running vmware-config-tools.pl.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Would you like to <span class="nb">enable</span> VMware automatic kernel modules?
    centos67-pe-puppet-382: <span class="o">[</span>no<span class="o">]</span>
    centos67-pe-puppet-382: Do you want to <span class="nb">enable</span> Guest Authentication <span class="o">(</span>vgauth<span class="o">)</span>? <span class="o">[</span>yes<span class="o">]</span>
    centos67-pe-puppet-382: No X install found.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Creating a new initrd boot image <span class="k">for</span> the kernel.
    centos67-pe-puppet-382: vmware-tools-thinprint start/running
    centos67-pe-puppet-382: vmware-tools start/running
    centos67-pe-puppet-382: The configuration of VMware Tools <span class="m">9</span>.9.4 build-3193940 <span class="k">for</span> Linux <span class="k">for</span> this
    centos67-pe-puppet-382: running kernel completed successfully.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You must restart your X session before any mouse or graphics changes take
    centos67-pe-puppet-382: effect.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You can now run VMware Tools by invoking <span class="s2">&quot;/usr/bin/vmware-toolbox-cmd&quot;</span> from the
    centos67-pe-puppet-382: <span class="nb">command</span> line.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: To <span class="nb">enable</span> advanced X features <span class="o">(</span>e.g., guest resolution fit, drag and drop, and
    centos67-pe-puppet-382: file and text copy/paste<span class="o">)</span>, you will need to <span class="k">do</span> one <span class="o">(</span>or more<span class="o">)</span> of the following:
    centos67-pe-puppet-382: <span class="m">1</span>. Manually start /usr/bin/vmware-user
    centos67-pe-puppet-382: <span class="m">2</span>. Log out and log back into your desktop session<span class="p">;</span> and,
    centos67-pe-puppet-382: <span class="m">3</span>. Restart your X session.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Enjoy,
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: --the VMware team
    centos67-pe-puppet-382:</code></pre></figure>

<p>The fourth provisioner is the shell provisioner that will run the scripts/centos-install-pe-puppet-382.sh bash script. This is the script we added to the Packer template to install the Puppet Enterprise 3.8.2 agent.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-install-pe-puppet-382.sh
    centos67-pe-puppet-382: Fetching puppet-enterprise-3.8.2-el-6-x86_64.tar.gz
    centos67-pe-puppet-382: % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
    centos67-pe-puppet-382: Dload  Upload   Total   Spent    Left  Speed
    centos67-pe-puppet-382: <span class="m">100</span>  437M  <span class="m">100</span>  437M    <span class="m">0</span>     <span class="m">0</span>  6688k      <span class="m">0</span>  <span class="m">0</span>:01:06  <span class="m">0</span>:01:06 --:--:-- 6879k
    centos67-pe-puppet-382: Extracting puppet-enterprise-3.8.2-el-6-x86_64.tar.gz
    centos67-pe-puppet-382: <span class="o">========================================================================</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise v3.8.2 installer
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise documentation can be found at http://docs.puppetlabs.com/pe/3.8/
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP <span class="m">1</span>: READ ANSWERS FROM FILE
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="c1">## Reading answers from file: ./agent.ans</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP <span class="m">2</span>: SELECT AND CONFIGURE ROLES
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: This installer lets you <span class="k">select</span> and install the various roles
    centos67-pe-puppet-382: required in a Puppet Enterprise deployment: puppet master,
    centos67-pe-puppet-382: console, database, cloud provisioner, and puppet agent.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: NOTE: when specifying hostnames during installation, use the fully-qualified domain name <span class="o">(</span>foo.example.com<span class="o">)</span> rather than a shortened name <span class="o">(</span>foo<span class="o">)</span>.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; puppet master
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The puppet master serves configurations to a group of puppet
    centos67-pe-puppet-382: agent nodes. This role also provides MCollective<span class="s1">&#39;s message queue</span>
<span class="s1">    centos67-pe-puppet-382: and client interface. It should be installed on a robust,</span>
<span class="s1">    centos67-pe-puppet-382: dedicated server.</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: ?? Install puppet master? [y/N] n</span>
<span class="s1">    centos67-pe-puppet-382: ?? Puppet master hostname to connect to? [Default: puppet] puppet</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: -&gt; database support</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: This role provides database support for PuppetDB and PE&#39;</span>s
    centos67-pe-puppet-382: console. PuppetDB is a centralized data service that caches data
    centos67-pe-puppet-382: generated by Puppet and provides access to it via a robust API.
    centos67-pe-puppet-382: The console uses data provided by a PostgreSQL server and
    centos67-pe-puppet-382: database both of which will be installed along with PuppetDB on
    centos67-pe-puppet-382: the node you specify.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: IMPORTANT: If you choose not to install PuppetDB at this time,
    centos67-pe-puppet-382: you will be prompted <span class="k">for</span> the host name of the node you intend to
    centos67-pe-puppet-382: use to provide database services. Note that you must install
    centos67-pe-puppet-382: database support on that node <span class="k">for</span> the console to <span class="k">function</span>. When
    centos67-pe-puppet-382: using a separate node, you should install database support on it
    centos67-pe-puppet-382: BEFORE installing the console role.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install PuppetDB? <span class="o">[</span>y/N<span class="o">]</span> n
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: -&gt; console
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: The console is a web interface where you can view reports,
    centos67-pe-puppet-382: classify nodes, control Puppet runs, and invoke MCollective
    centos67-pe-puppet-382: agents. It can be installed on the puppet master<span class="s1">&#39;s node, but for</span>
<span class="s1">    centos67-pe-puppet-382: performance considerations, especially in larger deployments, it</span>
<span class="s1">    centos67-pe-puppet-382: can also be installed on a separate node.</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: ?? Install the console? [y/N] n</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: -&gt; cloud provisioner</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: The cloud provisioner can create and bootstrap new machine</span>
<span class="s1">    centos67-pe-puppet-382: instances and add them to your Puppet infrastructure. It should</span>
<span class="s1">    centos67-pe-puppet-382: be installed on a trusted node where site administrators have</span>
<span class="s1">    centos67-pe-puppet-382: shell access.</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: ?? Install the cloud provisioner? [y/N] y</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: -&gt; puppet agent</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: The puppet agent role is automatically installed with the</span>
<span class="s1">    centos67-pe-puppet-382: console, puppet master, puppetdb, and cloud provisioner roles.</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: ?? Puppet agent needs a unique name (&quot;certname&quot;) for its</span>
<span class="s1">    centos67-pe-puppet-382: certificate; this can be an arbitrary string. Certname for this</span>
<span class="s1">    centos67-pe-puppet-382: node? [Default: localhost] localhost.localdomain</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: -&gt; Vendor Packages</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: The installer has detected that Puppet Enterprise requires</span>
<span class="s1">    centos67-pe-puppet-382: additional packages from your operating system vendor&#39;</span>s
    centos67-pe-puppet-382: repositories, and can automatically install them. If you choose
    centos67-pe-puppet-382: not to install these packages automatically, the installer will
    centos67-pe-puppet-382: <span class="nb">exit</span> so you can install them manually.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Additional vendor packages required <span class="k">for</span> installation:
    centos67-pe-puppet-382: * dmidecode
    centos67-pe-puppet-382: * libxslt
    centos67-pe-puppet-382: * pciutils
    centos67-pe-puppet-382:
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Install these packages automatically? <span class="o">[</span>Y/n<span class="o">]</span> y
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP <span class="m">3</span>: CONFIRM PLAN
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: You have selected to install the following components <span class="o">(</span>and their dependencies<span class="o">)</span>
    centos67-pe-puppet-382: * Cloud Provisioner
    centos67-pe-puppet-382: * Puppet Agent
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ?? Perform installation? <span class="o">[</span>Y/n<span class="o">]</span> y
    centos67-pe-puppet-382: <span class="c1">## Answers saved in the following files: /tmp/puppet-enterprise-3.8.2-el-6-x86_64/answers.lastrun.localhost and /etc/puppetlabs/installer/answers.install</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="o">========================================================================</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP <span class="m">4</span>: INSTALL PACKAGES
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="c1">## Installing packages from repositories...</span>
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Install Process
    centos67-pe-puppet-382: Loading mirror speeds from cached hostfile
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: mirror.rackspace.com
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package zlib-1.2.3-29.el6.x86_64 already installed and latest version
    centos67-pe-puppet-382: Package which-2.19-6.el6.x86_64 already installed and latest version
    centos67-pe-puppet-382: Package net-tools-1.60-110.el6_2.x86_64 already installed and latest version
    centos67-pe-puppet-382: Resolving Dependencies
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package cronie.x86_64 <span class="m">0</span>:1.4.4-15.el6 will be updated
    centos67-pe-puppet-382: --&gt; Processing Dependency: <span class="nv">cronie</span> <span class="o">=</span> <span class="m">1</span>.4.4-15.el6 <span class="k">for</span> package: cronie-anacron-1.4.4-15.el6.x86_64
    centos67-pe-puppet-382: ---&gt; Package cronie.x86_64 <span class="m">0</span>:1.4.4-15.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package dmidecode.x86_64 <span class="m">1</span>:2.12-6.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package libxml2.x86_64 <span class="m">0</span>:2.7.6-20.el6 will be updated
    centos67-pe-puppet-382: ---&gt; Package libxml2.x86_64 <span class="m">0</span>:2.7.6-20.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package libxslt.x86_64 <span class="m">0</span>:1.1.26-2.el6_3.1 will be installed
    centos67-pe-puppet-382: ---&gt; Package pciutils.x86_64 <span class="m">0</span>:3.1.10-4.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-agent.noarch <span class="m">0</span>:3.8.2-1.pe.el6 will be installed
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-virt-what &gt;<span class="o">=</span> <span class="m">1</span>.13-1.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-rubygem-deep-merge &gt;<span class="o">=</span> <span class="m">1</span>.0.0-3.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-stomp &gt;<span class="o">=</span> <span class="m">1</span>.3.3-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-shadow &gt;<span class="o">=</span> <span class="m">2</span>.2.0-3.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-selinux &gt;<span class="o">=</span> <span class="m">2</span>.0.94-4.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-rgen &gt;<span class="o">=</span> <span class="m">0</span>.6.5-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby-augeas &gt;<span class="o">=</span> <span class="m">0</span>.5.0-7.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-ruby &gt;<span class="o">=</span> <span class="m">1</span>.9.3.551-2.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-puppet-enterprise-release &gt;<span class="o">=</span> <span class="m">3</span>.8.2.0-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-puppet &gt;<span class="o">=</span> <span class="m">3</span>.8.2.0-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-openssl &gt;<span class="o">=</span> <span class="m">1</span>.0.0s-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-mcollective-common &gt;<span class="o">=</span> <span class="m">2</span>.7.0.1-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-mcollective &gt;<span class="o">=</span> <span class="m">2</span>.7.0.1-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-libyaml &gt;<span class="o">=</span> <span class="m">0</span>.1.6-5.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-libldap &gt;<span class="o">=</span> <span class="m">2</span>.4.39-5.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-hiera &gt;<span class="o">=</span> <span class="m">1</span>.3.4.5-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-facter &gt;<span class="o">=</span> <span class="m">2</span>.4.4.0-1.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: --&gt; Processing Dependency: pe-augeas &gt;<span class="o">=</span> <span class="m">1</span>.3.0-2.pe.el6 <span class="k">for</span> package: pe-agent-3.8.2-1.pe.el6.noarch
    centos67-pe-puppet-382: ---&gt; Package pe-cloud-provisioner.noarch <span class="m">0</span>:1.2.0-1.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-cloud-provisioner-libs.x86_64 <span class="m">0</span>:0.3.2-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-ldap.x86_64 <span class="m">0</span>:0.9.12-7.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-rubygem-net-ssh.noarch <span class="m">0</span>:2.1.4-2.pe.el6 will be installed
    centos67-pe-puppet-382: --&gt; Running transaction check
    centos67-pe-puppet-382: ---&gt; Package cronie-anacron.x86_64 <span class="m">0</span>:1.4.4-15.el6 will be updated
    centos67-pe-puppet-382: ---&gt; Package cronie-anacron.x86_64 <span class="m">0</span>:1.4.4-15.el6_7.1 will be an update
    centos67-pe-puppet-382: ---&gt; Package pe-augeas.x86_64 <span class="m">0</span>:1.3.0-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-facter.x86_64 <span class="m">0</span>:2.4.4.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-hiera.noarch <span class="m">0</span>:1.3.4.5-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-libldap.x86_64 <span class="m">0</span>:2.4.39-5.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-libyaml.x86_64 <span class="m">0</span>:0.1.6-5.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-mcollective.noarch <span class="m">0</span>:2.7.0.1-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-mcollective-common.noarch <span class="m">0</span>:2.7.0.1-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-openssl.x86_64 <span class="m">0</span>:1.0.0s-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-puppet.noarch <span class="m">0</span>:3.8.2.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-puppet-enterprise-release.noarch <span class="m">0</span>:3.8.2.0-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby.x86_64 <span class="m">0</span>:1.9.3.551-2.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-augeas.x86_64 <span class="m">0</span>:0.5.0-7.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-rgen.noarch <span class="m">0</span>:0.6.5-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-selinux.x86_64 <span class="m">0</span>:2.0.94-4.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-shadow.x86_64 <span class="m">0</span>:2.2.0-3.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-ruby-stomp.noarch <span class="m">0</span>:1.3.3-1.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-rubygem-deep-merge.noarch <span class="m">0</span>:1.0.0-3.pe.el6 will be installed
    centos67-pe-puppet-382: ---&gt; Package pe-virt-what.x86_64 <span class="m">0</span>:1.13-1.el6 will be installed
    centos67-pe-puppet-382: --&gt; Finished Dependency Resolution
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependencies Resolved
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="o">================================================================================</span>
    centos67-pe-puppet-382: Package            Arch   Version            Repository                   Size
    centos67-pe-puppet-382: <span class="o">================================================================================</span>
    centos67-pe-puppet-382: Installing:
    centos67-pe-puppet-382: dmidecode          x86_64 <span class="m">1</span>:2.12-6.el6       base                         <span class="m">74</span> k
    centos67-pe-puppet-382: libxslt            x86_64 <span class="m">1</span>.1.26-2.el6_3.1   base                        <span class="m">452</span> k
    centos67-pe-puppet-382: pciutils           x86_64 <span class="m">3</span>.1.10-4.el6       base                         <span class="m">85</span> k
    centos67-pe-puppet-382: pe-agent           noarch <span class="m">3</span>.8.2-1.pe.el6     puppet-enterprise-installer <span class="m">3</span>.7 k
    centos67-pe-puppet-382: pe-cloud-provisioner
    centos67-pe-puppet-382: noarch <span class="m">1</span>.2.0-1.el6        puppet-enterprise-installer  <span class="m">51</span> k
    centos67-pe-puppet-382: pe-cloud-provisioner-libs
    centos67-pe-puppet-382: x86_64 <span class="m">0</span>.3.2-2.pe.el6     puppet-enterprise-installer <span class="m">4</span>.6 M
    centos67-pe-puppet-382: pe-ruby-ldap       x86_64 <span class="m">0</span>.9.12-7.pe.el6    puppet-enterprise-installer  <span class="m">46</span> k
    centos67-pe-puppet-382: pe-rubygem-net-ssh noarch <span class="m">2</span>.1.4-2.pe.el6     puppet-enterprise-installer <span class="m">227</span> k
    centos67-pe-puppet-382: Updating:
    centos67-pe-puppet-382: cronie             x86_64 <span class="m">1</span>.4.4-15.el6_7.1   updates                      <span class="m">74</span> k
    centos67-pe-puppet-382: libxml2            x86_64 <span class="m">2</span>.7.6-20.el6_7.1   updates                     <span class="m">803</span> k
    centos67-pe-puppet-382: Installing <span class="k">for</span> dependencies:
    centos67-pe-puppet-382: pe-augeas          x86_64 <span class="m">1</span>.3.0-2.pe.el6     puppet-enterprise-installer <span class="m">523</span> k
    centos67-pe-puppet-382: pe-facter          x86_64 <span class="m">2</span>.4.4.0-1.pe.el6   puppet-enterprise-installer  <span class="m">99</span> k
    centos67-pe-puppet-382: pe-hiera           noarch <span class="m">1</span>.3.4.5-1.pe.el6   puppet-enterprise-installer  <span class="m">18</span> k
    centos67-pe-puppet-382: pe-libldap         x86_64 <span class="m">2</span>.4.39-5.pe.el6    puppet-enterprise-installer <span class="m">776</span> k
    centos67-pe-puppet-382: pe-libyaml         x86_64 <span class="m">0</span>.1.6-5.el6        puppet-enterprise-installer <span class="m">193</span> k
    centos67-pe-puppet-382: pe-mcollective     noarch <span class="m">2</span>.7.0.1-1.pe.el6   puppet-enterprise-installer <span class="m">8</span>.0 k
    centos67-pe-puppet-382: pe-mcollective-common
    centos67-pe-puppet-382: noarch <span class="m">2</span>.7.0.1-1.pe.el6   puppet-enterprise-installer <span class="m">129</span> k
    centos67-pe-puppet-382: pe-openssl         x86_64 <span class="m">1</span>.0.0s-1.pe.el6    puppet-enterprise-installer <span class="m">6</span>.7 M
    centos67-pe-puppet-382: pe-puppet          noarch <span class="m">3</span>.8.2.0-1.pe.el6   puppet-enterprise-installer <span class="m">1</span>.6 M
    centos67-pe-puppet-382: pe-puppet-enterprise-release
    centos67-pe-puppet-382: noarch <span class="m">3</span>.8.2.0-1.pe.el6   puppet-enterprise-installer  <span class="m">12</span> k
    centos67-pe-puppet-382: pe-ruby            x86_64 <span class="m">1</span>.9.3.551-2.pe.el6 puppet-enterprise-installer <span class="m">8</span>.1 M
    centos67-pe-puppet-382: pe-ruby-augeas     x86_64 <span class="m">0</span>.5.0-7.pe.el6     puppet-enterprise-installer  <span class="m">22</span> k
    centos67-pe-puppet-382: pe-ruby-rgen       noarch <span class="m">0</span>.6.5-1.pe.el6     puppet-enterprise-installer <span class="m">238</span> k
    centos67-pe-puppet-382: pe-ruby-selinux    x86_64 <span class="m">2</span>.0.94-4.pe.el6    puppet-enterprise-installer  <span class="m">57</span> k
    centos67-pe-puppet-382: pe-ruby-shadow     x86_64 <span class="m">2</span>.2.0-3.pe.el6     puppet-enterprise-installer  <span class="m">11</span> k
    centos67-pe-puppet-382: pe-ruby-stomp      noarch <span class="m">1</span>.3.3-1.pe.el6     puppet-enterprise-installer  <span class="m">54</span> k
    centos67-pe-puppet-382: pe-rubygem-deep-merge
    centos67-pe-puppet-382: noarch <span class="m">1</span>.0.0-3.pe.el6     puppet-enterprise-installer  <span class="m">74</span> k
    centos67-pe-puppet-382: pe-virt-what       x86_64 <span class="m">1</span>.13-1.el6         puppet-enterprise-installer  <span class="m">22</span> k
    centos67-pe-puppet-382: Updating <span class="k">for</span> dependencies:
    centos67-pe-puppet-382: cronie-anacron     x86_64 <span class="m">1</span>.4.4-15.el6_7.1   updates                      <span class="m">31</span> k
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Transaction Summary
    centos67-pe-puppet-382: <span class="o">================================================================================</span>
    centos67-pe-puppet-382: Install      <span class="m">26</span> Package<span class="o">(</span>s<span class="o">)</span>
    centos67-pe-puppet-382: Upgrade       <span class="m">3</span> Package<span class="o">(</span>s<span class="o">)</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Total download size: <span class="m">25</span> M
    centos67-pe-puppet-382: Downloading Packages:
    centos67-pe-puppet-382: --------------------------------------------------------------------------------
    centos67-pe-puppet-382: Total                                            <span class="m">11</span> MB/s <span class="p">|</span>  <span class="m">25</span> MB     <span class="m">00</span>:02
    centos67-pe-puppet-382: Running rpm_check_debug
    centos67-pe-puppet-382: Running Transaction Test
    centos67-pe-puppet-382: Transaction Test Succeeded
    centos67-pe-puppet-382: Running Transaction
    centos67-pe-puppet-382: Installing : pe-puppet-enterprise-release-3.8.2.0-1.pe.el6.noarch        <span class="m">1</span>/32
    centos67-pe-puppet-382: Installing : pe-openssl-1.0.0s-1.pe.el6.x86_64                           <span class="m">2</span>/32
    centos67-pe-puppet-382: Installing : pe-libldap-2.4.39-5.pe.el6.x86_64                           <span class="m">3</span>/32
    centos67-pe-puppet-382: Installing : pe-libyaml-0.1.6-5.el6.x86_64                               <span class="m">4</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-1.9.3.551-2.pe.el6.x86_64                           <span class="m">5</span>/32
    centos67-pe-puppet-382: Installing : pe-rubygem-net-ssh-2.1.4-2.pe.el6.noarch                    <span class="m">6</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-stomp-1.3.3-1.pe.el6.noarch                         <span class="m">7</span>/32
    centos67-pe-puppet-382: Installing : pe-mcollective-common-2.7.0.1-1.pe.el6.noarch               <span class="m">8</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-selinux-2.0.94-4.pe.el6.x86_64                      <span class="m">9</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-rgen-0.6.5-1.pe.el6.noarch                         <span class="m">10</span>/32
    centos67-pe-puppet-382: Installing : pe-rubygem-deep-merge-1.0.0-3.pe.el6.noarch                <span class="m">11</span>/32
    centos67-pe-puppet-382: Installing : pe-hiera-1.3.4.5-1.pe.el6.noarch                           <span class="m">12</span>/32
    centos67-pe-puppet-382: Installing : pe-augeas-1.3.0-2.pe.el6.x86_64                            <span class="m">13</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-augeas-0.5.0-7.pe.el6.x86_64                       <span class="m">14</span>/32
    centos67-pe-puppet-382: Updating   : libxml2-2.7.6-20.el6_7.1.x86_64                            <span class="m">15</span>/32
    centos67-pe-puppet-382: Installing : <span class="m">1</span>:dmidecode-2.12-6.el6.x86_64                              <span class="m">16</span>/32
    centos67-pe-puppet-382: Installing : pe-virt-what-1.13-1.el6.x86_64                             <span class="m">17</span>/32
    centos67-pe-puppet-382: Installing : libxslt-1.1.26-2.el6_3.1.x86_64                            <span class="m">18</span>/32
    centos67-pe-puppet-382: Installing : pe-cloud-provisioner-libs-0.3.2-2.pe.el6.x86_64            <span class="m">19</span>/32
    centos67-pe-puppet-382: Installing : pe-mcollective-2.7.0.1-1.pe.el6.noarch                     <span class="m">20</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-ldap-0.9.12-7.pe.el6.x86_64                        <span class="m">21</span>/32
    centos67-pe-puppet-382: Installing : pe-ruby-shadow-2.2.0-3.pe.el6.x86_64                       <span class="m">22</span>/32
    centos67-pe-puppet-382: Updating   : cronie-anacron-1.4.4-15.el6_7.1.x86_64                     <span class="m">23</span>/32
    centos67-pe-puppet-382: Updating   : cronie-1.4.4-15.el6_7.1.x86_64                             <span class="m">24</span>/32
    centos67-pe-puppet-382: Installing : pciutils-3.1.10-4.el6.x86_64                               <span class="m">25</span>/32
    centos67-pe-puppet-382: Installing : pe-facter-2.4.4.0-1.pe.el6.x86_64                          <span class="m">26</span>/32
    centos67-pe-puppet-382: Installing : pe-puppet-3.8.2.0-1.pe.el6.noarch                          <span class="m">27</span>/32
    centos67-pe-puppet-382: Installing : pe-agent-3.8.2-1.pe.el6.noarch                             <span class="m">28</span>/32
    centos67-pe-puppet-382: Installing : pe-cloud-provisioner-1.2.0-1.el6.noarch                    <span class="m">29</span>/32
    centos67-pe-puppet-382: Cleanup    : cronie-anacron-1.4.4-15.el6.x86_64                         <span class="m">30</span>/32
    centos67-pe-puppet-382: Cleanup    : cronie-1.4.4-15.el6.x86_64                                 <span class="m">31</span>/32
    centos67-pe-puppet-382: Cleanup    : libxml2-2.7.6-20.el6.x86_64                                <span class="m">32</span>/32
    centos67-pe-puppet-382: Verifying  : pe-puppet-enterprise-release-3.8.2.0-1.pe.el6.noarch        <span class="m">1</span>/32
    centos67-pe-puppet-382: Verifying  : pe-hiera-1.3.4.5-1.pe.el6.noarch                            <span class="m">2</span>/32
    centos67-pe-puppet-382: Verifying  : pe-mcollective-common-2.7.0.1-1.pe.el6.noarch               <span class="m">3</span>/32
    centos67-pe-puppet-382: Verifying  : pciutils-3.1.10-4.el6.x86_64                                <span class="m">4</span>/32
    centos67-pe-puppet-382: Verifying  : pe-libldap-2.4.39-5.pe.el6.x86_64                           <span class="m">5</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-augeas-0.5.0-7.pe.el6.x86_64                        <span class="m">6</span>/32
    centos67-pe-puppet-382: Verifying  : pe-agent-3.8.2-1.pe.el6.noarch                              <span class="m">7</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-ldap-0.9.12-7.pe.el6.x86_64                         <span class="m">8</span>/32
    centos67-pe-puppet-382: Verifying  : <span class="m">1</span>:dmidecode-2.12-6.el6.x86_64                               <span class="m">9</span>/32
    centos67-pe-puppet-382: Verifying  : pe-mcollective-2.7.0.1-1.pe.el6.noarch                     <span class="m">10</span>/32
    centos67-pe-puppet-382: Verifying  : pe-cloud-provisioner-libs-0.3.2-2.pe.el6.x86_64            <span class="m">11</span>/32
    centos67-pe-puppet-382: Verifying  : cronie-1.4.4-15.el6_7.1.x86_64                             <span class="m">12</span>/32
    centos67-pe-puppet-382: Verifying  : pe-rubygem-net-ssh-2.1.4-2.pe.el6.noarch                   <span class="m">13</span>/32
    centos67-pe-puppet-382: Verifying  : pe-openssl-1.0.0s-1.pe.el6.x86_64                          <span class="m">14</span>/32
    centos67-pe-puppet-382: Verifying  : pe-facter-2.4.4.0-1.pe.el6.x86_64                          <span class="m">15</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-selinux-2.0.94-4.pe.el6.x86_64                     <span class="m">16</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-stomp-1.3.3-1.pe.el6.noarch                        <span class="m">17</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-shadow-2.2.0-3.pe.el6.x86_64                       <span class="m">18</span>/32
    centos67-pe-puppet-382: Verifying  : libxslt-1.1.26-2.el6_3.1.x86_64                            <span class="m">19</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-rgen-0.6.5-1.pe.el6.noarch                         <span class="m">20</span>/32
    centos67-pe-puppet-382: Verifying  : pe-rubygem-deep-merge-1.0.0-3.pe.el6.noarch                <span class="m">21</span>/32
    centos67-pe-puppet-382: Verifying  : pe-puppet-3.8.2.0-1.pe.el6.noarch                          <span class="m">22</span>/32
    centos67-pe-puppet-382: Verifying  : cronie-anacron-1.4.4-15.el6_7.1.x86_64                     <span class="m">23</span>/32
    centos67-pe-puppet-382: Verifying  : pe-libyaml-0.1.6-5.el6.x86_64                              <span class="m">24</span>/32
    centos67-pe-puppet-382: Verifying  : pe-virt-what-1.13-1.el6.x86_64                             <span class="m">25</span>/32
    centos67-pe-puppet-382: Verifying  : pe-augeas-1.3.0-2.pe.el6.x86_64                            <span class="m">26</span>/32
    centos67-pe-puppet-382: Verifying  : pe-cloud-provisioner-1.2.0-1.el6.noarch                    <span class="m">27</span>/32
    centos67-pe-puppet-382: Verifying  : pe-ruby-1.9.3.551-2.pe.el6.x86_64                          <span class="m">28</span>/32
    centos67-pe-puppet-382: Verifying  : libxml2-2.7.6-20.el6_7.1.x86_64                            <span class="m">29</span>/32
    centos67-pe-puppet-382: Verifying  : libxml2-2.7.6-20.el6.x86_64                                <span class="m">30</span>/32
    centos67-pe-puppet-382: Verifying  : cronie-1.4.4-15.el6.x86_64                                 <span class="m">31</span>/32
    centos67-pe-puppet-382: Verifying  : cronie-anacron-1.4.4-15.el6.x86_64                         <span class="m">32</span>/32
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Installed:
    centos67-pe-puppet-382: dmidecode.x86_64 <span class="m">1</span>:2.12-6.el6
    centos67-pe-puppet-382: libxslt.x86_64 <span class="m">0</span>:1.1.26-2.el6_3.1
    centos67-pe-puppet-382: pciutils.x86_64 <span class="m">0</span>:3.1.10-4.el6
    centos67-pe-puppet-382: pe-agent.noarch <span class="m">0</span>:3.8.2-1.pe.el6
    centos67-pe-puppet-382: pe-cloud-provisioner.noarch <span class="m">0</span>:1.2.0-1.el6
    centos67-pe-puppet-382: pe-cloud-provisioner-libs.x86_64 <span class="m">0</span>:0.3.2-2.pe.el6
    centos67-pe-puppet-382: pe-ruby-ldap.x86_64 <span class="m">0</span>:0.9.12-7.pe.el6
    centos67-pe-puppet-382: pe-rubygem-net-ssh.noarch <span class="m">0</span>:2.1.4-2.pe.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependency Installed:
    centos67-pe-puppet-382: pe-augeas.x86_64 <span class="m">0</span>:1.3.0-2.pe.el6
    centos67-pe-puppet-382: pe-facter.x86_64 <span class="m">0</span>:2.4.4.0-1.pe.el6
    centos67-pe-puppet-382: pe-hiera.noarch <span class="m">0</span>:1.3.4.5-1.pe.el6
    centos67-pe-puppet-382: pe-libldap.x86_64 <span class="m">0</span>:2.4.39-5.pe.el6
    centos67-pe-puppet-382: pe-libyaml.x86_64 <span class="m">0</span>:0.1.6-5.el6
    centos67-pe-puppet-382: pe-mcollective.noarch <span class="m">0</span>:2.7.0.1-1.pe.el6
    centos67-pe-puppet-382: pe-mcollective-common.noarch <span class="m">0</span>:2.7.0.1-1.pe.el6
    centos67-pe-puppet-382: pe-openssl.x86_64 <span class="m">0</span>:1.0.0s-1.pe.el6
    centos67-pe-puppet-382: pe-puppet.noarch <span class="m">0</span>:3.8.2.0-1.pe.el6
    centos67-pe-puppet-382: pe-puppet-enterprise-release.noarch <span class="m">0</span>:3.8.2.0-1.pe.el6
    centos67-pe-puppet-382: pe-ruby.x86_64 <span class="m">0</span>:1.9.3.551-2.pe.el6
    centos67-pe-puppet-382: pe-ruby-augeas.x86_64 <span class="m">0</span>:0.5.0-7.pe.el6
    centos67-pe-puppet-382: pe-ruby-rgen.noarch <span class="m">0</span>:0.6.5-1.pe.el6
    centos67-pe-puppet-382: pe-ruby-selinux.x86_64 <span class="m">0</span>:2.0.94-4.pe.el6
    centos67-pe-puppet-382: pe-ruby-shadow.x86_64 <span class="m">0</span>:2.2.0-3.pe.el6
    centos67-pe-puppet-382: pe-ruby-stomp.noarch <span class="m">0</span>:1.3.3-1.pe.el6
    centos67-pe-puppet-382: pe-rubygem-deep-merge.noarch <span class="m">0</span>:1.0.0-3.pe.el6
    centos67-pe-puppet-382: pe-virt-what.x86_64 <span class="m">0</span>:1.13-1.el6
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Updated:
    centos67-pe-puppet-382: cronie.x86_64 <span class="m">0</span>:1.4.4-15.el6_7.1       libxml2.x86_64 <span class="m">0</span>:2.7.6-20.el6_7.1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Dependency Updated:
    centos67-pe-puppet-382: cronie-anacron.x86_64 <span class="m">0</span>:1.4.4-15.el6_7.1
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Complete!
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: puppet-enterprise-installer
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: Cleaning up list of fastest mirrors
    centos67-pe-puppet-382: <span class="c1">## Checking the agent certificate name detection...</span>
    centos67-pe-puppet-382: <span class="c1">## Setting up puppet agent...</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: STEP <span class="m">5</span>: DONE
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Thanks <span class="k">for</span> installing Puppet Enterprise!
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: To learn more and get started using Puppet Enterprise, refer to
    centos67-pe-puppet-382: the Puppet Enterprise Quick Start Guide
    centos67-pe-puppet-382: <span class="o">(</span>http://docs.puppetlabs.com/pe/latest/quick_start.html<span class="o">)</span> and the
    centos67-pe-puppet-382: Puppet Enterprise Deployment Guide
    centos67-pe-puppet-382: <span class="o">(</span>http://docs.puppetlabs.com/guides/deployment_guide/index.html<span class="o">)</span>.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="o">========================================================================</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: <span class="c1">## NOTES</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Puppet Enterprise has been installed to <span class="s2">&quot;/opt/puppet,&quot;</span> and its
    centos67-pe-puppet-382: configuration files are located in <span class="s2">&quot;/etc/puppetlabs&quot;</span>.
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: Answers from this session saved to
    centos67-pe-puppet-382: <span class="s1">&#39;/tmp/puppet-enterprise-3.8.2-el-6-x86_64/answers.lastrun.localhost&#39;</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: If you have a firewall running, please ensure outbound
    centos67-pe-puppet-382: connections are allowed to the following TCP ports: <span class="m">8140</span>, <span class="m">61613</span>
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: ------------------------------------------------------------------------
    centos67-pe-puppet-382:</code></pre></figure>
<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>The final provisioner is a shell provisioner that will run the scripts/centos-vmware-cleanup.sh bash script. This script will clean up the centos67 virtual machine and zero out all unused disk space to reduce the size of the image.
</code></pre></div>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>    
<span class="o">==</span>&gt; centos67-pe-puppet-382: Provisioning with shell script: scripts/centos-vmware-cleanup.sh
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Pausing <span class="k">for</span> <span class="m">0</span> seconds...
    centos67-pe-puppet-382: <span class="o">==</span>&gt; erasing unused packages to free up space
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Setting up Remove Process
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: gtk2
    centos67-pe-puppet-382: Determining fastest mirrors
    centos67-pe-puppet-382: * base: centos.unixheads.org
    centos67-pe-puppet-382: * extras: centos.unixheads.org
    centos67-pe-puppet-382: * updates: centos-mirror.jchost.net
    centos67-pe-puppet-382: Package<span class="o">(</span>s<span class="o">)</span> gtk2 available, but not installed.
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: libX11
    centos67-pe-puppet-382: Package<span class="o">(</span>s<span class="o">)</span> libX11 available, but not installed.
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: hicolor-icon-theme
    centos67-pe-puppet-382: Package<span class="o">(</span>s<span class="o">)</span> hicolor-icon-theme available, but not installed.
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: avahi
    centos67-pe-puppet-382: Package<span class="o">(</span>s<span class="o">)</span> avahi available, but not installed.
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: freetype
    centos67-pe-puppet-382: Package<span class="o">(</span>s<span class="o">)</span> freetype available, but not installed.
    centos67-pe-puppet-382: No Match <span class="k">for</span> argument: bitstream-vera-fonts
    centos67-pe-puppet-382: No Packages marked <span class="k">for</span> removal
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Cleaning up yum cache
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: base extras updates
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: Cleaning up list of fastest mirrors
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Force logs to rotate
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Clear audit log and wtmp
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Cleaning up udev rules
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Remove the traces of the template MAC address and UUIDs
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Cleaning up tmp
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Remove the SSH host keys
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Remove the root user’s shell <span class="nb">history</span>
    centos67-pe-puppet-382: <span class="o">==</span>&gt; yum -y clean all
    centos67-pe-puppet-382: Loaded plugins: fastestmirror
    centos67-pe-puppet-382: Cleaning repos: base extras updates
    centos67-pe-puppet-382: Cleaning up Everything
    centos67-pe-puppet-382: /
    centos67-pe-puppet-382: <span class="m">24828344</span>
    centos67-pe-puppet-382: /tmp/script_7943.sh: line <span class="m">59</span>: bc: <span class="nb">command</span> not found
    centos67-pe-puppet-382:
    centos67-pe-puppet-382: dd: invalid number <span class="sb">`</span><span class="s1">&#39;</span>
<span class="s1">    centos67-pe-puppet-382: /boot</span>
<span class="s1">    centos67-pe-puppet-382: 60502</span>
<span class="s1">    centos67-pe-puppet-382: /tmp/script_7943.sh: line 59: bc: command not found</span>
<span class="s1">    centos67-pe-puppet-382:</span>
<span class="s1">    centos67-pe-puppet-382: dd: invalid number `&#39;</span>
    centos67-pe-puppet-382: /tmp/script_7943.sh: line <span class="m">67</span>: /usr/sbin/vgdisplay: No such file or directory
    centos67-pe-puppet-382: <span class="o">==</span>&gt; Zero out the free space to save space in the final image
    centos67-pe-puppet-382: dd: writing <span class="sb">`</span>/EMPTY<span class="err">&#39;</span>: No space left on device
    centos67-pe-puppet-382: <span class="m">12783</span>+0 records in
    centos67-pe-puppet-382: <span class="m">12782</span>+0 records out
    centos67-pe-puppet-382: <span class="m">13403570176</span> bytes <span class="o">(</span><span class="m">13</span> GB<span class="o">)</span> copied, <span class="m">428</span>.651 s, <span class="m">31</span>.3 MB/s</code></pre></figure>

<p>With the provisioners block having been completed, Packer will now shutdown the centos67-pe-puppet-382 virtual machine and unregister it from the ESXi virtual machine.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">==</span>&gt; centos67-pe-puppet-382: Gracefully halting virtual machine...
    centos67-pe-puppet-382: Waiting <span class="k">for</span> VMware to clean up after itself...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Deleting unnecessary VMware files...
    centos67-pe-puppet-382: Deleting: /vmfs/volumes/datastore1/output-centos67-pe-puppet-382/vmware.log
<span class="o">==</span>&gt; centos67-pe-puppet-382: Cleaning VMX prior to finishing up...
    centos67-pe-puppet-382: Unmounting floppy from VMX...
    centos67-pe-puppet-382: Detaching ISO from CD-ROM device...
    centos67-pe-puppet-382: Disabling VNC server...
<span class="o">==</span>&gt; centos67-pe-puppet-382: Compacting the disk <span class="nv">image</span>
<span class="o">==</span>&gt; centos67-pe-puppet-382: Unregistering virtual machine...
Build <span class="s1">&#39;centos67-pe-puppet-382&#39;</span> finished.

<span class="o">==</span>&gt; Builds finished. The artifacts of successful builds are:
--&gt; centos67-pe-puppet-382: VM files in directory: /vmfs/volumes/datastore1/output-centos67-pe-puppet-382
<span class="o">[</span>root@packer-centos packer-templates<span class="o">]</span><span class="c1">#    </span></code></pre></figure>

<p>The output of the packer build command shows that the template was successfully created at /vmfs/volumes/datastore1/output-centos67-pe-puppet-382 on the ESXi virtual machine.</p>

<h3>This brings us to the end of this post. I think it is pretty powerful that we only had to copy/update the template and add another provisioner script, in order to modify the Packer template we created last time to install Puppet Enterprise 3.8.2.</h3>

<h3>If you would like to not have to manually create the two files covered in this post, you can clone down <a href="https://github.com/sdorsett/packer-templates/tree/adding-second-packer-template">this github repository</a> by running the following command:</h3>

<pre>
git clone -b "adding-second-packer-template" https://github.com/sdorsett/packer-templates.git
</pre>  

<p>If you cloned the packer-templates repo in the last post, you can pull down the updates by running the following command:</p>

<pre>
git fetch --all
git pull origin "adding-second-packer-template"
</pre>  

<h3>In the next post we will extend what was covered in this post by installing the Puppet agent in Packer image.</h3>

<h3>Please provide any feedback or suggestions to my twitter account located on the about page.</h3>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2018/08/08/creating-an-openstack-instance-on-ovh-public-cloud/">
            Creating an openstack instance on OVH public cloud
            <small>08 Aug 2018</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/28/scripted-packer-build-and-export/">
            Scripted Packer build, ovftool export and Vagrant .box file creation
            <small>28 Dec 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/12/27/using-ovftool-to-export-packer-generated-virtual-machines/">
            Using ovftool to convert Packer generated virtual machines into Vagrant .box files
            <small>27 Dec 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>
